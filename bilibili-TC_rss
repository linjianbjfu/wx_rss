<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>bilibili-TC</id>
    <title>哔哩哔哩技术</title>
    <updated>2024-03-19T08:00:05.673Z</updated>
    <generator>awesome</generator>
    <author>
        <name>哔哩哔哩技术</name>
    </author>
    <subtitle>提供B站相关技术的介绍和讲解</subtitle>
    <logo>http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754SVM7VMibhzz9AicOz5qdQ5oaN6TgXhbVyGHQYPwBErEYQCOnhibA1Qp431JkpPKY0qGhT0EfDchicXMQ/0?wx_fmt=png</logo>
    <icon>http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754SVM7VMibhzz9AicOz5qdQ5oaN6TgXhbVyGHQYPwBErEYQCOnhibA1Qp431JkpPKY0qGhT0EfDchicXMQ/0?wx_fmt=png</icon>
    <entry>
        <title type="html"><![CDATA[自研流媒体协议探索与实践]]></title>
        <id>2247498735_1</id>
        <link href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498735&amp;idx=1&amp;sn=9b2f6a3dbdb5bb8ec48236f3ef729d88&amp;chksm=cf2f3ecaf858b7dcb74f6144951a0b3ec26ab1134bd97482cffdf6514ee2aebdd2c5c4e80b57#rd"/>
        <updated>2024-03-18T12:29:01.000Z</updated>
        <summary type="html"><![CDATA[<div style="line-height: 1.6;font-size: 16px;"><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>本期作者</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;background-position: center center;background-repeat: no-repeat;background-size: cover;overflow: hidden;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QHsWONBeRGGZyZjzkpSVMPafqibLFeuOsJq21iaoEkCQ3uEIDCkQCSRDnia1wdib7cCq2XbMjGWL6EiaA/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100015077" data-ratio="0.9951456310679612" data-s="300,640" data-type="jpeg" data-w="206" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QHsWONBeRGGZyZjzkpSVMPafqibLFeuOsJq21iaoEkCQ3uEIDCkQCSRDnia1wdib7cCq2XbMjGWL6EiaA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>流媒体技术部直播组</p></div><div style="margin-top: 5px;text-align: justify;font-size: 12px;"><p style="text-align: center;white-space: normal;">B站内部端到端的直播流媒体技术研发团队，为B站直播量身打造了高性能、高性价比的流媒体服务体系</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>背景</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">自从我站从2020年逐步灰度自研P2P开始, 在直播下行带宽方面取得巨大的成功,带宽成本每年节省数亿。与此同时, 由于直播下行同时存在FLV和HLS两种直播协议,在回源带宽上也产生了双份费用,在2022年整个行业也处在下行阶段,为了进一步降本增效, 我们从回源成本出发,设计了一套新的流媒体协议,以应对当前多种下行协议分发的难题。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>问题</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">在没有HLS协议之前, 整个直播体系只有RTMP/FLV, 所有用户都是通过观看FLV, 并通过CDN进行回源获取到直播内容。如下图:</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100015076" data-ratio="0.2458808618504436" data-s="300,640" data-type="png" data-w="789" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QHsWONBeRGGZyZjzkpSVMPIoTEJp95A3YAwMTC9icaBvZoRXziczFNND1ibQxNwPibeKfQFA91zSW12w/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">当有了HLS协议之后, 情况如下, 尽管绝大多数用户会使用HLS, 但总有老版客户端会使用FLV进行播放, 这就导致FLV和HLS两种协议, CDN要分别进行回源, 即使播放的内容是一致的, 由于协议不同便会产生双倍回源带宽。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100015079" data-ratio="0.35207496653279785" data-s="300,640" data-type="png" data-w="747" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QHsWONBeRGGZyZjzkpSVMPcPMgKR6eUXwBibgcrrvoSBK5THTkdRFaiarsopY5eADelIUaoVdKZl0w/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>技术选型</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">当前尽管各种流媒体协议层出不穷, 比如Webrtc,RTP, CMAF, 但具体结合到B站自身的业务上面, 可选择余地并不大。首先B站自研P2P要求所有CDN对于同一个流媒体切片文件强一致性, 如果直接将RTMP的流放在不同的节点进行媒体切片会导致, 由于缺乏对媒体文件名的统一规则, 和切片起始信息所以会导致切片文件不能完全一致。这就要求新的流媒体协议能够在协议层提供一些额外进行去对齐切片信息，这样才能保证在不同节点的流能够得到完全相同的切片。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">自研流媒体协议—BMT(Bili Media Transport)正是为了解决该问题,进行设计和开发的。我们从以下几个角度进行考虑：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1、兼容性不同协议在不同设备和网络环境下的表现都不同，所以兼容性是一个非常重要的考虑因素。我们希望BMT协议可以在各种设备和网络环境下都能够表现良好。</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">兼容足够多的编解码 RTMP/FLV 不支持265,266，及AV1 限制了进一步的应用场景，所以我们希望BMT在Codec兼容上提供更多类型</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">多轨道能力 在直播场景下, 多轨道的能力往往会被忽视, 但某些创新性的直播玩法就会对多轨道提出要求, BMT在设计之初, 就对这种情况进行了考虑, 最多支持16个轨道。</p></li></ul><p style="word-break: break-all;white-space: normal;">2、载荷比是指在传输同样的媒体信息时，协议本身所需要的额外开销。我们希望BMT协议的载荷比要尽可能地小，这样可以减少回源带宽的使用。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div powered-by="xiumi.us"><p><br></p><table resolved="" width="570"><colgroup><col style="width: 0px;"><col style="width: 0px;"><col style="width: 0px;"><col style="width: 0px;"></colgroup><tbody><tr><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><br></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">BMT</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">RTMP/FLV</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">CMAF</span></td></tr><tr><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">音频包字节数</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">16bytes</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">17bytes</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">140bytes</span></td></tr><tr><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">视频包字节数</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">12bytes</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">13bytes</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">134bytes</span></td></tr><tr><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">封装消耗比(1-载荷比)</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">0.338%</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">0.349%</span></td><td style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">3.489%</span></td></tr></tbody></table><p><br></p></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">3、握手简化是指协议在建立连接时需要的步骤越少越好。我们希望BMT协议的握手过程尽可能简化，这样可以提高协议的效率和性能。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100015078" data-ratio="0.9272197962154294" data-s="300,640" data-type="png" data-w="687" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QHsWONBeRGGZyZjzkpSVMPpvagxkh003oUV2oZRGsGq0AMHNgTjq15kukA3ibFyYFbIic0bK0L3SmQ/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>核心库开发</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">以协议为基础, 遵循协议标准开发了内部通用的c程序库 libbmt, 使用统一的库, 用于对接到各个流媒体服务当中。为了顺利对接各种流媒体服务, 我们还对常用的组件 如ffmpeg , mpv等进行了bmt协议的扩展与兼容</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100015080" data-ratio="0.7105882352941176" data-s="300,640" data-type="jpeg" data-w="850" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QHsWONBeRGGZyZjzkpSVMPg2icFkzibQ6u2j2e9QdP8u8OjXwWC8JFw5FAicuGnq7ib0Fz1DsH6CBeOA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>回源架构设计</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">在回源体系设计上, &nbsp;充分利用了现有的技术资产进行复用, 在cdn侧使用quic进行传输层加速, 在边缘动态分发切片, 可以按需进行回源, 从而减少回源成本。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100015083" data-ratio="0.425" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QHsWONBeRGGZyZjzkpSVMPYkH5kz07KTnHKL66bpuKmJ318ut7aLApp0hP8aSvvslwkcuXY1TyPw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>线上效果</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">BMT上线至23年5月灰度90%左右, 每日节省自建CDN回源带宽约100G+, 基本符合预期。在整个开发过程中，针对新的流媒体协议积累了一套完整的技术体系, 后续针对这套协议的升级改造,整体成本也会更低。</p><p style="word-break: break-all;white-space: normal;">在2022年跨晚晚会多音轨玩法中，也正式得益于BMT出色的兼容能力，才得以完美满足了整体直播活动技术需求。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>未来展望</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">随着基础技术能力建设的完成, BMT协议作为回源协议的主力投入到了生产之中。除了回源外, BMT在上行推流端也存在着应用场景, BMT在直播流内部,进行了逻辑切片,在推流时,将逻辑前置到用户侧,可以节省云端的CPU消耗,进一步降本增效。随着BMT协议本身的迭代,我们也可以在直播流内部携带一些业务相关信息,可以在用户推流时增加更多互动玩法, 比如主播端通过AI场景识别, 将这些信息添加到BMT的直播流中, 在云端和播端可以利用这些信息进行各种直播玩法, 为业务赋能。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>开发者问答</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;font-size: 13px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>读完文章你有什么收获？</strong></span>欢迎在留言区告诉我们。转发并留言，小编将选取1则最有价值的评论，送出<span style="text-decoration: underline;"><strong>BW纪念盒蛋一个</strong></span>（见下图）。<span style="color: rgb(255, 102, 149);"><strong>3月22日中午12点开奖。如果喜欢本期内容的话，欢迎点个“在看”吧！</strong></span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 45%;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100015082" data-ratio="0.7506329113924051" data-s="300,640" data-type="jpeg" data-w="790" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QHsWONBeRGGZyZjzkpSVMPG90NibzibDEycVhjVylzTXSvA2kbIeymdwjmGIvWGK0ZdusS09YFBJicA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>往期精彩指路</strong></p></div></div></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;font-size: 13px;"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247487748&amp;idx=1&amp;sn=c9cbcacf3bba25b478abf2a0f5c0e75f&amp;chksm=cf2cd421f85b5d37adce8fc782151942912bf38a24be2ebd42b000505bcae60a4833d9a230cd&amp;scene=21#wechat_redirect" textvalue="全链路压测改造之全链自动化测试实践" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">全链路压测改造之全链自动化测试实践</a></p></li><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247493174&amp;idx=1&amp;sn=648bf0ffb5e31b1c211d22e636e2c3df&amp;chksm=cf2f2313f858aa0580dad7ee9b8347739122dcaba50071616e444a73ad28f4c3dcaf62c79f33&amp;scene=21#wechat_redirect" textvalue="哔哩哔哩⼤数据建设之路—实时DQC篇" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">哔哩哔哩⼤数据建设之路—实时DQC篇</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247491092&amp;idx=1&amp;sn=b09492563c760775ed61f75db1bd5822&amp;chksm=cf2cdb31f85b5227b96a3da04fd89153c40635ce4d9ae20cbe9baadc58dbae9e41060d3cd003&amp;scene=21#wechat_redirect" textvalue="Apache Kyuubi 在B站大数据场景下的应用实践" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">Apache Kyuubi 在B站大数据场景下的应用实践</a></p></li></ul></div></div></div></div></div><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzUxNTE4OTc0Mg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EVKwaZXNTl9OCCo7pxLHz2e2I3kV3rTPao5LlIickfJS79DNd2yjqjfYEtwtMOyVuKhJoDIq6UU4U9TQbjvOLaQ/0?wx_fmt=png" data-nickname="哔哩哔哩招聘" data-alias="" data-signature="生产快乐的地方" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="Mzg3Njc0NTgwMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754SVM7VMibhzz9AicOz5qdQ5oaN6TgXhbVyGHQYPwBErEYQCOnhibA1Qp431JkpPKY0qGhT0EfDchicXMQ/0?wx_fmt=png" data-nickname="哔哩哔哩技术" data-alias="bilibili-TC" data-signature="提供B站相关技术的介绍和讲解" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p>]]></summary>
        <author>
            <name>B站流媒体技术部</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[万字长文解析：大模型需要怎样的硬件算力]]></title>
        <id>2247498723_1</id>
        <link href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498723&amp;idx=1&amp;sn=a13fdc862f3cc9e4832219cad27e7bcf&amp;chksm=cf2f3ec6f858b7d02c9afdf02f4d955d46e36d6bec8f441d91bf1c38f7b1a166aecdb24fcb17#rd"/>
        <updated>2024-03-14T14:45:05.000Z</updated>
        <summary type="html"><![CDATA[<div><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>本期作者</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><div style="line-height: 1.6;font-size: 16px;"><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 50% 0%;background-repeat: no-repeat;background-size: 100.488%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9XSYftbRjpRlRUvicgOW80icwg6c62Vog9hZZu2kPuRcBicvsOI5w8so1g/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100015032" data-ratio="0.9951456310679612" data-s="300,640" data-type="jpeg" data-w="206" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9XSYftbRjpRlRUvicgOW80icwg6c62Vog9hZZu2kPuRcBicvsOI5w8so1g/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>B站系统部服务器团队</p></div><div style="margin-top: 5px;text-align: justify;font-size: 12px;"><p style="text-align: center;white-space: normal;">负责服务器硬件引入与迭代，服务器资源交付、服务器硬件与系统运维。</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 53%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>郁晨</p></div><div style="margin-top: 5px;font-size: 12px;"><p style="text-align: left;">哔哩哔哩资深开发工程师</p></div></div></div></div><div style="display: inline-block;vertical-align: middle;width: 32%;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 47.2731%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9VN9HtcS54ht2XV8yLtZAgAnb0CZlumXmnStNe1qicBxcl4TkKpBXD9w/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100015033" data-ratio="1.382" data-s="300,640" data-type="jpeg" data-w="1000" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9VN9HtcS54ht2XV8yLtZAgAnb0CZlumXmnStNe1qicBxcl4TkKpBXD9w/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div></div></div><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>背景</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">2017年，《Attention Is All You Need》的一声惊雷，给世人带来了Transformer模型。2022年，以Transformer结构为核心的chatGPT，凭借其震惊世界的表现，掀起了“AI元年"&nbsp;的序幕：从此，各方纷纷投入大模型领域，前赴后继，热情高涨。然而，随之而来地，大模型在软硬件基础设施、算法及数据集等多方面的挑战和困难也逐步显现；今天我们将从AI-Infra角度出发，带大家了解目前大模型在算力、存储、通信等多方面上硬件资源的挑战和瓶颈，并且提供相关指标的量化手段和选型指导。</p><p style="word-break: break-all;white-space: normal;"><br></p></div></div><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>二、LLMs引发的硬件瓶颈</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在Transformer及大语言模型（LLMs）出现前，绝大部分的AI模型训练和推理，对算力、显存等硬件资源要求不高，使用单机CPU/GPU或分布式小集群即可满足需求。但LLMs的出现，在算力、显存和通信三个方向，都带来特别大的压力：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1)&nbsp; 算力瓶颈：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">进行大模型训练时，每输入一个token，整个模型中的每个参数上要进行6~8次的浮点数运算；而若以300万tokens的数据集来训练一个175B的GPT3模型，那么使用单张理论峰值算力为312TFLOPS(FP16)的A100 GPU，即使不考虑单卡在集群中的性能折损，也至少需要32年才能完成。这是无法被接受的；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）显存瓶颈：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">大模型训练中，LLM训练时的显存压力非常大。微软&amp;英伟达[1]给出了模型状态显存占用公式：单个模型副本中每个参数量大约需要20倍于自身大小的空间占用(基于混合精度[10]&nbsp;&amp; ADAM优化器的SOTA技术来完成训练)。以175B模型训练为例，因为单个模型参数量达到175Billion，则至少需要3.5TB的显存空间占用。而目前主流算力卡如A100、H100只有80GB的显存空间，所以至少需要44块80GB显存的GPU才能塞下一个模型副本。并且由于算力需求巨大，整个系统会有多个模型副本，总的显存占用是很夸张的。此外，模型训练时，还需要保存激活值用于反向传播。激活值还将额外占用很大一部分空间。虽然有优化激活值空间占用的技术，如激活值重计算(Activation Recomputation)等，但是会引入额外的通信量和计算量；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">模型推理中的显存压力相对小些，其中一个原因是推理中计算对精度要求不像训练那般高(训练中的优化器状态更新需要在至少32位精度下进行)。另外，由于推理和训练表现是关联的，只需保证训练出的模型的优质，即使推理时缩减参数精度也不会有很大影响。但即便如此，由于LLM通常拥有足够大的参数量，推理只需1~2倍于模型参数的空间占用也是惊人的；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3）通信瓶颈：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">由于大模型训练&amp;推理通常都不能在单卡进行，所以我们需要多算力卡构成集群，不可避免的就存在服务器机内和机间通信。由于大模型本身的结构宽度、激活值尺寸都非常大，根据张量并行、流水线并行等通信规则，机间和机内通信压力都会很大。另外，虽然当前使用多种并行技术将集群利用率保持的比较好，但这是榨干的各种硬件互联带宽资源换来的；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">整个集群的通信，不在是简单的点对点(send&amp;recv)，而是涉及到多个节点间的集合通信(collective communication)概念。集合通信虽然给AI框架封装提供了高效易用的APIs接口、并基于硬件互联架构优化了底层数据流量，但会引入额外的通信冗余：例如使用Nvidia的通信库NCCL进行Allreduce时，每处理1Byte的数据量就需要约2Byte的传输。而我们整个集群在训练和推理阶段，充斥着高频且大量的集合通信操作，所以会带来非常严重且不可避免的数据传输损耗；</p></li><li><p style="word-break: break-all;">由于算力和显存都存在瓶颈，业界诞生和迭代了很多硬件资源优化技术，如zeRO、选择性激活值重计算等。但其中绝大多数，只是在做不同硬件资源间的"trade off"：用通信换算力、用通信换显存等。这也导致整个集群中通信压力进一步增大；</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>三、LLMs硬件需求量化</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">上述的分析，让大家对于LLMs的硬件需求有了一个简单认知。但关于每种规模的LLM究竟需要多少算力、显存和互联带宽等问题，可能还未特别明确。为了让大家产生具象而客观的认知，本节尝试量化了LLMs所需的大部分硬件资源指标。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.1 模型参数量估算</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.1.1 为什么估算模型参数量？</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">准确地来说，模型参数量并不是一种硬件参数指标。但模型的参数量很重要，它和整个模型的算力、显存及通信带宽等主要硬件资源量化估算都紧密相关。因此，本小节先给出模型参数量的估算公式和推导过程，以便读者顺利理解后续的章节。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.1.2 怎么估算模型参数量？</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">概括来说，大模型整体参数量约为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="1" style="" data-formula="12lh^2"><svg xmlns="http://www.w3.org/2000/svg" width="5.153ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 2277.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;，&nbsp;其中l为&nbsp;tranformer块的个数，单个&nbsp;transformer块的模型参数量约为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="3" style="" data-formula="12h^2"><svg xmlns="http://www.w3.org/2000/svg" width="4.479ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 1979.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="msup" transform="translate(1000, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;，h 为Transformer块中隐藏层维度数。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>3.1.2.1&nbsp;分析推理</strong></span></p><p style="word-break: break-all;white-space: normal;">目前所有大模型，以Transformer模型为核心的，各种大模型的结构差异不大。总的来说，LLMs存在一定共性和规律，其结构如图1所示：一个大模型通常是由多个Transformer块串联而成，每个 Transformer 块中都包含固定的结构和计算顺序；</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-cropselx1="0" data-cropselx2="548" data-cropsely1="0" data-cropsely2="171" data-imgfileid="100014910" data-ratio="3.2018779342723005" data-s="300,640" data-type="png" data-w="852" style="vertical-align: middle;width: 180px;height: 576px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754SU1e5FtZWH06jOG1RraLia1IFZFj3mI2p9QMpXDDuSKj7ODicj8mtFhhaPR2meSZjaMCRESyup88Fw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p style="word-break: break-all;"><sup>(图1.&nbsp;LLM结构示意图，source&nbsp;from[2]）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">基于此，LLM模型的参数量计算可以做到层层剥离：一个完整的模型共由l个transformer块串行而成。此外，在首块transformer之前和尾块transformer后还存在一定的结构。因此，我们可以将整个模型参数统计分为3部分：1.transformer块结构(&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="5" style="" data-formula="12lh^2+13lh"><svg xmlns="http://www.w3.org/2000/svg" width="12.158ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 5374 915.9" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(2499.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(3500, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(4500, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(4798, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;)、2.首块transformer之前的结构(Vh)、 3.尾块transformer之后的结构(0)。当h较大时，第一部分参数量中的&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="7" style="" data-formula="O(lh^2)"><svg xmlns="http://www.w3.org/2000/svg" width="6.377ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 2818.6 1083.9" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="4F" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path></g><g data-mml-node="mo" transform="translate(763, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(1152, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1450, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(2429.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>&nbsp;的量级远高于剩余部分，所以整体可改写为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="9" style="" data-formula="12lh^2"><svg xmlns="http://www.w3.org/2000/svg" width="5.153ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 2277.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">接下来，我们就来具体分析下三部分参数量是如何推导的(参考[6])：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">一、&nbsp; 串联的Transformer块结构共有&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="12" style="" data-formula="12lh^2+13lh"><svg xmlns="http://www.w3.org/2000/svg" width="12.158ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 5374 915.9" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(2499.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(3500, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(4500, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(4798, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;的参数量：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">整个模型共存在l个transformer块，每个&nbsp;transformer&nbsp;块中包含的&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="14" style="" data-formula="12h^2"><svg xmlns="http://www.w3.org/2000/svg" width="4.479ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 1979.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="msup" transform="translate(1000, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;的参数量。而对于每个transformer块而言，其参数计算过程如下：</p><p style="word-break: break-all;white-space: normal;">1）首先，多头自注意力结构共包含&nbsp;&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="16" style="" data-formula="4h^2+4h"><svg xmlns="http://www.w3.org/2000/svg" width="8.548ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 3778 915.9" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="msup" transform="translate(500, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(1701.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(2702, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(3202, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;参数量：1）该结构一共有 a 个头。每一个头都拥有一个self-attention结构，其中包含&nbsp;&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="18" style="" data-formula="W_i^Q 、 W_i^K、W_i^V"><svg xmlns="http://www.w3.org/2000/svg" width="18.164ex" height="2.919ex" role="img" focusable="false" viewBox="0 -988.6 8028.6 1290.2" aria-hidden="true" style="vertical-align: -0.682ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 490.8) scale(0.707)"><path data-c="51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="mi" transform="translate(944, -293.8) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(2005.9, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">、</text></g><g data-mml-node="msubsup" transform="translate(3123.4, 0)"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 363) scale(0.707)"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(944, -284.4) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(5198.6, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">、</text></g><g data-mml-node="msubsup" transform="translate(6316, 0)"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 369.2) scale(0.707)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(944, -293.8) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;三个矩阵，用于生成 Q、K、V 三个矩阵。而&nbsp;&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="2" style="" data-formula="W_i^Q 、 W_i^K、W_i^V"><svg xmlns="http://www.w3.org/2000/svg" width="18.167ex" height="2.919ex" role="img" focusable="false" viewBox="0 -988.6 8029.7 1290.2" aria-hidden="true" style="vertical-align: -0.682ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 490.8) scale(0.707)"><path data-c="51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="mi" transform="translate(944, -293.8) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(2005.9, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">、</text></g><g data-mml-node="msubsup" transform="translate(3123.9, 0)"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 363) scale(0.707)"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(944, -284.4) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(5199.1, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">、</text></g><g data-mml-node="msubsup" transform="translate(6317.1, 0)"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 369.2) scale(0.707)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(944, -293.8) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;每个矩阵形状是(h，h/a)。因此：&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="4" style="" data-formula="W_i^Q 、 W_i^K、W_i^V"><svg xmlns="http://www.w3.org/2000/svg" width="18.167ex" height="2.919ex" role="img" focusable="false" viewBox="0 -988.6 8029.7 1290.2" aria-hidden="true" style="vertical-align: -0.682ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 490.8) scale(0.707)"><path data-c="51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="mi" transform="translate(944, -293.8) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(2005.9, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">、</text></g><g data-mml-node="msubsup" transform="translate(3123.9, 0)"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 363) scale(0.707)"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(944, -284.4) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(5199.1, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">、</text></g><g data-mml-node="msubsup" transform="translate(6317.1, 0)"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 369.2) scale(0.707)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(944, -293.8) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;三种矩阵的参数量是&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="6" style="" data-formula="h*h/a*a*3=3h^2"><svg xmlns="http://www.w3.org/2000/svg" width="20.037ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 8856.4 1083.9" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(798.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1520.4, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2096.4, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(2596.4, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(3347.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(4069.9, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(4821.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(5543.3, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(6321.1, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(7376.9, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="msup" transform="translate(7876.9, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;。此外每种矩阵还包含了h个偏置。总计；2）另外，后面有个 WO矩阵形状是(h，h)，参数量是&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="8" style="" data-formula="h^2"><svg xmlns="http://www.w3.org/2000/svg" width="2.216ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 979.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;，还包含了h个偏置。总计&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="10" style="" data-formula="h^2+h"><svg xmlns="http://www.w3.org/2000/svg" width="6.285ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 2778 915.9" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(1201.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(2202, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;。综上，多头自注意力的结构中共包含&nbsp;&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="15" style="" data-formula="4h^2+4h"><svg xmlns="http://www.w3.org/2000/svg" width="8.548ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 3778 915.9" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="msup" transform="translate(500, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(1701.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(2702, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(3202, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;参数；</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014907" data-ratio="0.5596026490066225" data-s="300,640" data-type="png" data-w="604" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8vcucW5nGhA8XyibkJIEViaz7lFO9YaK86LzbRj9UeyGTC1g685AdbHzw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="text-align: center;white-space: normal;" powered-by="xiumi.us"><sup>(图&nbsp;2.&nbsp;Transformer&nbsp;中多头自注意力计算流程示意图，source&nbsp;from[3]）</sup></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）其次，&nbsp;MLP中共包含&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="1" style="" data-formula="8h^2+5h"><svg xmlns="http://www.w3.org/2000/svg" width="8.548ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 3778 915.9" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="msup" transform="translate(500, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(1701.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(2702, 0)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mi" transform="translate(3202, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;&nbsp;的参数：MLP有两个矩阵和一个激活函数。第一个矩阵形状是(h,4h)，另一个矩阵形状是(4h,h)，合计&nbsp;&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="3" style="" data-formula="8h^2"><svg xmlns="http://www.w3.org/2000/svg" width="3.347ex" height="1.937ex" role="img" focusable="false" viewBox="0 -833.9 1479.6 855.9" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="msup" transform="translate(500, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;的参数量。此外，两个矩阵中还分别包含了 4h 和 h 的偏置；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3）最后，layer norm中包含4h的参数：包含了2个可训练模型参数：缩放参数λ和平移参数&nbsp;β；而在Self-attention 和MLP两个结构中各有一个layer norm：每个layer norm 中都是对于 b*s个tokens 进行 h 个数的归一化，所以有h个参数对(λ和&nbsp;β)。故一个transformer块中共需要&nbsp;&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="5" style="" data-formula="2*2h=4h"><svg xmlns="http://www.w3.org/2000/svg" width="11.154ex" height="1.756ex" role="img" focusable="false" viewBox="0 -694 4930 776" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(722.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(1444.4, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(1944.4, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(2798.2, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(3854, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(4354, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;个参数；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">二、&nbsp; 首块transformer之前的结构的参数量为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="7" style="" data-formula="Vh"><svg xmlns="http://www.w3.org/2000/svg" width="3.043ex" height="1.62ex" role="img" focusable="false" viewBox="0 -694 1345 716" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(769, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;:</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在首个tranformer block之是input embedding的结构，其中包含了word embedding、 postional encoding两个结构：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）Word embedding主要包含一个(V,h)的矩阵。用于将tokens 从词典的独立热编码维度(one hot vector)转换到隐藏层维度上。所以Word embedding结构中有&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="9" style="" data-formula="V*h"><svg xmlns="http://www.w3.org/2000/svg" width="5.18ex" height="1.62ex" role="img" focusable="false" viewBox="0 -694 2289.4 716" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mo" transform="translate(991.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1713.4, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;&nbsp;的参数；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）Postional encoding 的参数可以忽略不记。这是因为具体两种情况参数量都非常少：1）如果不可训练(例如使用正弦、余弦函数)，则不存在参数；2）如果可训练，参数量很少可以忽略；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">三、&nbsp; 尾块transformer之后的结构的参数量约为0:</p><p style="word-break: break-all;white-space: normal;">在最后一个tranformer block 结尾还可能还衔接了一个线性层矩阵和Softmax结构：1）线性层，对应了一个(h,V)的矩阵，用于生成的 token 数据从隐藏层维度转回到词典维度。这里的线性层就是之前 word embedding矩阵的转置，所以不涉及参数和训练；2）Softmax结构也基本无参数量；</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>3.1.2.2&nbsp;&nbsp;结论验证</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;text-align: left;">论文[4]给出类似的结论，模型参数量P计算公式为：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;text-align: center;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;text-align: center;">&nbsp;</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;text-align: center;cursor: pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="11" data-formula="𝑃 = 12𝑙ℎ^2(1+{\frac{13}{12h} }+{\frac{V+s}{12lh} } )= 12lh^2+13lh +Vh+sh"><svg xmlns="http://www.w3.org/2000/svg" width="52.143ex" height="2.816ex" role="img" focusable="false" viewBox="0 -892 23047.4 1244.8" aria-hidden="true" style="vertical-align: -0.798ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g></g><g data-mml-node="mo" transform="translate(1028.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(2084.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3084.6, 0)"><g data-mml-node="mo"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g><g data-mml-node="msup" transform="translate(3382.6, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g><g data-mml-node="mn" transform="translate(576, 421.1) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(4362.1, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(4751.1, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(5473.3, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(6473.6, 0)"><g data-mml-node="mfrac"><g data-mml-node="mn" transform="translate(423.6, 394) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500, 0)"></path></g><g data-mml-node="mrow" transform="translate(220, -345) scale(0.707)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g><rect width="1314.4" height="60" x="120" y="220"></rect></g></g><g data-mml-node="mo" transform="translate(8250.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(9250.4, 0)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 398) scale(0.707)"><g data-mml-node="mi"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mo" transform="translate(769, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(1547, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g><g data-mml-node="mrow" transform="translate(270.2, -345) scale(0.707)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(1298, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g><rect width="1625.5" height="60" x="120" y="220"></rect></g></g><g data-mml-node="mo" transform="translate(11115.9, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(11782.7, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(12838.5, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(13838.5, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(14136.5, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(15338.3, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(16338.5, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(17338.5, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(17636.5, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(18434.7, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(19434.9, 0)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(20203.9, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(21002.1, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(22002.4, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(22471.4, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;text-align: center;">&nbsp;</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">其中s 表示 tokens序列长度，h为隐藏层维度数，V代表词典维度数。对比论文[4]中公式和我们分析出的公式，发现两者基本一致：只相差了sh的参数量，sh量相比billion级别的模型参数量而言是微小的。</p><p style="word-break: break-all;white-space: normal;">再尝试将一些主流模型代入试算公式&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="14" style="" data-formula="12lh^2"><svg xmlns="http://www.w3.org/2000/svg" width="5.153ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 2277.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;，发现是公式和实际结果基本保持一致：（其中llama系列的模型结构和标准Transformer结构差异不小，但依然在可接受的误差范围内）</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014906" data-ratio="0.47045454545454546" data-s="300,640" data-type="png" data-w="440" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8A1VpicCIibJ0EgGMBYnXVy9Bib3rCpRYqBTfCn80m7edj2z0RrDiazbU2g/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(表1.&nbsp;&nbsp;LLMs模型参数真实参数量和估算结果的比较)</sup></p></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;white-space: normal;">注：Llama2-34B、Llama2-70B，非早期标准transformer-decoder结构。参数量估算公式为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="1" style="" data-formula="12.65lh^2"><svg xmlns="http://www.w3.org/2000/svg" width="8.044ex" height="1.937ex" role="img" focusable="false" viewBox="0 -833.9 3555.6 855.9" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(1000, 0)"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(1278, 0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(1778, 0)"></path></g><g data-mml-node="mi" transform="translate(2278, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(2576, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;</p></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>&nbsp;3.2 模型算力需求估算</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.2.1 为什么要估算模型算力需求？</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">LLMs的结构呈现特定规律，已被证实能够相当准确地预测模型训练和推理所需的计算资源。因此，通过估算模型算力需求，我们能够有针对性地指导实际工作的开展：不仅有助于选择更加合适的硬件设备，还能评估出所需的算力卡数以及潜在硬件瓶颈等关键信息。这些相关内容，将在后续章节展开。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.2.2 怎么估算模型算力需求？</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">模型的参数量和模型算力消耗之间存在一个简单换算关系：每个token输入集群时，单个参数量的训练需要6~8次浮点数运算，推理需要2次浮点数运算。接下来，我们看下这个结论是怎么一步步推导出来的。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>3.2.2.1&nbsp;通用矩阵乘法中的浮点计算次数</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">首先，我们可以发现，矩阵乘法(General Matrix Multiple)存在浮点计算次数规律的：如[m,k]的矩阵和[k,n]的矩阵相乘，需要&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="16" style="" data-formula="2mkn"><svg xmlns="http://www.w3.org/2000/svg" width="5.654ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 2499 705" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1378, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(1899, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>&nbsp;次浮点运算。公式中“2”是系数，表示矩阵乘法中的每个参数都需要约2次的浮点运算：1次加法和1次乘法。</p><p style="word-break: break-all;white-space: normal;">而神经网络中的绝大部分运算都可以想象成是矩阵乘法，也可以应用上述给出的浮点计算公式。这里举个例子帮助理解：如图3。该图中输入层(x0~2)是3个神经元，输出层是2个神经元(y0~1)。那么前向传播过程可以看作一个[1,3]的矩阵和[3,2]的矩阵相乘，得到[1,2]的矩阵结果。图中灰色椭圆的"b0"、"b1"是偏置(Bias)。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014908" data-ratio="1.0658823529411765" data-s="300,640" data-type="png" data-w="850" style="vertical-align: middle;width: 263px;height: 280px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8522C3LG6rxTAjnGMI93bm8qm4rvefWh3rDNT9yrbKXeueNdicktgwgw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(图&nbsp;3.&nbsp;&nbsp;一个简单的神经网络示意图)</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在这个过程中，完成的运算如下：</p><p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg" data-croporisrc="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9yGUuhedUDuD8hg2pPjHhCCBhiaqQkPicdOcDTQnp7bUdvkv5PTgnCmXg/640?wx_fmt=png&amp;from=appmsg" data-cropx1="0" data-cropx2="567" data-cropy1="12.1067615658363" data-cropy2="77.68505338078292" data-imgfileid="100015069" data-ratio="0.1164021164021164" data-s="300,640" data-type="jpeg" data-w="567" style="width: 562px;height: 65px;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9dQFKH2JqLHdOoNQ3IFT1ReshBArBpFDeibicC6K9SdFOLzyiblcngfYRg/640?wx_fmt=jpeg"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;"></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">上述2个公式中，每个公式都有3个加法、3个乘法计算。所以[1,3]的矩阵和[3,2]的矩阵相乘共包含&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="22" style="" data-formula="2*1*3*2=12"><svg xmlns="http://www.w3.org/2000/svg" width="16.215ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 7166.9 748" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(722.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(1444.4, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2166.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(2888.9, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(3611.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(4333.3, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(5111.1, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(6166.9, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g></svg></mjx-container></span>&nbsp;&nbsp;次浮点计算量(称为FLOPs)。从而推广到一般：[m,k]的矩阵和[k,n]的矩阵相乘，需要&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="24" style="" data-formula="2mkn"><svg xmlns="http://www.w3.org/2000/svg" width="5.654ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 2499 705" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1378, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(1899, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>&nbsp; FLOPs。</p><p style="word-break: break-all;white-space: normal;">而GPU在不同精度单位下，浮点数运算的效率是不同的。例如，A100在16位精度(FP16或BF16)下每秒可以进行&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="26" style="" data-formula="314*10^{12}"><svg xmlns="http://www.w3.org/2000/svg" width="9.506ex" height="2.005ex" role="img" focusable="false" viewBox="0 -864 4201.6 886" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500, 0)"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(1000, 0)"></path></g><g data-mml-node="mo" transform="translate(1722.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(2444.4, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g></g></g></svg></mjx-container></span>&nbsp;次浮点运算。而在32位精度下，每秒只能进行&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="28" style="" data-formula="156*10^{12}"><svg xmlns="http://www.w3.org/2000/svg" width="9.506ex" height="2.005ex" role="img" focusable="false" viewBox="0 -864 4201.6 886" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500, 0)"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(1000, 0)"></path></g><g data-mml-node="mo" transform="translate(1722.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(2444.4, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g></g></g></svg></mjx-container></span>&nbsp;次浮点运算。所以，我们可以理所当然的想到一个提速思路&nbsp;-&nbsp;让所有运算在低精度下进行来提高训练/推理效率。但是，这里有个无法忽略的问题：某些计算必须要在高精度下进行。例如全程在低精度下进行模型训练，往往会出现由于精度不够导致数值溢出和无法收敛的问题。所以目前大模型训练通常采用的是混合精度方式[10]进行：如图4，前向传播、反向传播这些无需高精度的计算采用16位精度(FP16或BF16)进行，优化器状态更新在32位精度(FP32)进行。而模型推理的要求就比较低，可以在16位、8位甚至4位精度进行，整个任务的计算效率非常高。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014914" data-ratio="0.43703703703703706" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 568px;height: 248px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8YSRqWhK89Z7w5Qvl7ibPauBZR3XTnpbticHGiaxyGlqn5qhdGdBWpNGGg/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（图4.&nbsp;混合精度训练示意图，source&nbsp;from&nbsp;[10]）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>3.2.2.2&nbsp;分析推理</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">先观察模型训练和推理的算力主要用在哪里了：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">模型的训练，就是通过多次迭代(iteration)计算完成的。每次迭代包含前向传播、反向传播两个步骤。1）前向传播中，输入值和当前层的模型参数做矩阵乘法，其产生的结果称为激活值。激活值再作为后一层的输入值和后一层参数做矩阵乘法，所以整个前向传播就可认为主要是一系列链式的矩阵乘法；2）&nbsp;而反向传播，是从最后一层开始，应用链式法则反向逐步进行激活值偏导数和梯度的计算。其算力需求大约是前向传播的两倍[4]；3）前向传播过程中产生的激活值是需要被暂存的，并且在反向传播中被使用。而大模型场景下，产生的的激活值总量通常非常大。业界通常会采用激活值重计算进行显存优化：在反向传播开始前重新进行前向传播计算，如果采用的是全激活值重计算(full activation recomputation)，则额外引入了和前向传播同量的计算工作量；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">模型的推理，相当于就是一个前向传播的过程，经过一系列链式的计算，最终生成预测结果的tokens。</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们令模型需要浮点计算次数(FLOPs)为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="32" style="" data-formula="F"><svg xmlns="http://www.w3.org/2000/svg" width="1.695ex" height="1.538ex" role="img" focusable="false" viewBox="0 -680 749 680" aria-hidden="true" style="vertical-align: 0px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g></g></g></svg></mjx-container></span>&nbsp;，而&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="30" style="" data-formula="F_前、F_反"><svg xmlns="http://www.w3.org/2000/svg" width="8.982ex" height="2.417ex" role="img" focusable="false" viewBox="0 -750 3970.1 1068.2" aria-hidden="true" style="vertical-align: -0.72ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g><g data-mml-node="mo" transform="translate(1564.9, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">、</text></g><g data-mml-node="msub" transform="translate(2682.9, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">反</text></g></g></g></g></svg></mjx-container></span>&nbsp;是前后向传播分别需要的FLOPs。那么：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;text-align: center;">&nbsp;<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="80" style="" data-formula="\begin{aligned}
训练：\\
&amp;  F = F_前+F_反=3F_前  (未开启激活值重计算时)\\
&amp;  F = 2F_前+F_反=4F_前 (开启全激活值重计算时)\\
推理：\\
&amp;  F = F_前\\

\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="47.966ex" height="14.49ex" role="img" focusable="false" viewBox="0 -3452.2 21201.1 6404.5" aria-hidden="true" style="vertical-align: -6.679ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 2702.2)"><g data-mml-node="mtd"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">训</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">练</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">：</text></g></g></g><g data-mml-node="mtr" transform="translate(0, 1402.2)"><g data-mml-node="mtd" transform="translate(2520.7, 0)"></g><g data-mml-node="mtd" transform="translate(2520.7, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(1026.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msub" transform="translate(2082.6, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g><g data-mml-node="mo" transform="translate(3591.9, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(4592.1, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">反</text></g></g><g data-mml-node="mo" transform="translate(6157.1, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(7212.8, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="msub" transform="translate(7712.8, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g><g data-mml-node="mo" transform="translate(9000, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(9389, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">未</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">开</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">启</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">重</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(7562.1, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g><g data-mml-node="mo" transform="translate(17791.3, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, 34.1)"><g data-mml-node="mtd" transform="translate(2520.7, 0)"></g><g data-mml-node="mtd" transform="translate(2520.7, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(1026.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(2082.6, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="msub" transform="translate(2582.6, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g><g data-mml-node="mo" transform="translate(4091.9, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(5092.1, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">反</text></g></g><g data-mml-node="mo" transform="translate(6657.1, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(7712.8, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="msub" transform="translate(8212.8, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g><g data-mml-node="mo" transform="translate(9500, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(9889, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">开</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">启</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">全</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">重</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(7562.1, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g><g data-mml-node="mo" transform="translate(18291.3, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, -1334.1)"><g data-mml-node="mtd"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">推</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">理</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">：</text></g></g></g><g data-mml-node="mtr" transform="translate(0, -2634.1)"><g data-mml-node="mtd" transform="translate(2520.7, 0)"></g><g data-mml-node="mtd" transform="translate(2520.7, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(1026.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msub" transform="translate(2082.6, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">此时，我们只需要知道&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="45" style="" data-formula="F_前"><svg xmlns="http://www.w3.org/2000/svg" width="2.912ex" height="2.258ex" role="img" focusable="false" viewBox="0 -680 1287.1 998.2" aria-hidden="true" style="vertical-align: -0.72ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g></g></g></svg></mjx-container></span>&nbsp;，就可以估算出训练和推理各自需要多少FLOPs。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">接下来进行&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="47" style="" data-formula="F_前"><svg xmlns="http://www.w3.org/2000/svg" width="2.912ex" height="2.258ex" role="img" focusable="false" viewBox="0 -680 1287.1 998.2" aria-hidden="true" style="vertical-align: -0.72ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g></g></g></svg></mjx-container></span>&nbsp;的计算推导：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">先确定符号：我们令B对应batch size，s对应sequence length，h对应hidden dimension，l对应layers number(更多信息请参考表3)；接着，我们再来观察大模型结构：大模型本身由l个transformer块串联而成。此外，首transformer块前和尾transformer块后还有一些结构。所以大模型的算力估算可以分为两大块：一、l个transformer块中的FLOPs；二、其他结构中的FLOPs：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">一、&nbsp; l个transformer块中，每个transformer块都由多头注意力结构和MLP两种结构构成：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）注意力结构中，</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">每个head中都发生了前一层传入的激活值([,s,h]的矩阵)和&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="49" style="" data-formula="W_i^Q 、 W_i^K、W_i^V"><svg xmlns="http://www.w3.org/2000/svg" width="18.167ex" height="2.919ex" role="img" focusable="false" viewBox="0 -988.6 8029.7 1290.2" aria-hidden="true" style="vertical-align: -0.682ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 490.8) scale(0.707)"><path data-c="51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="mi" transform="translate(944, -293.8) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(2005.9, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">、</text></g><g data-mml-node="msubsup" transform="translate(3123.9, 0)"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 363) scale(0.707)"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(944, -284.4) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(5199.1, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">、</text></g><g data-mml-node="msubsup" transform="translate(6317.1, 0)"><g data-mml-node="mi"><path data-c="57" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1118.8, 369.2) scale(0.707)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mi" transform="translate(944, -293.8) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;中的每个([h,h/a]矩阵)相乘的运算，这部分共涉及算力为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="51" style="" data-formula="3*2*B*s*h*h/a= 6Bsh^2/a"><svg xmlns="http://www.w3.org/2000/svg" width="32.13ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 14201.3 1083.9" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(722.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(1444.4, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(2166.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(2888.9, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mo" transform="translate(3870.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(4592.3, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(5283.6, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(6005.8, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(6804, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(7526.2, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(8102.2, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(8602.2, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(9409, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(10464.8, 0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mi" transform="translate(10964.8, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(11723.8, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(12192.8, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(13172.3, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(13672.3, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g></g></g></svg></mjx-container></span>&nbsp; FLOPs。&nbsp;而由于有a个head，所以整个结构需要的&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="53" style="" data-formula="6Bsh^2"><svg xmlns="http://www.w3.org/2000/svg" width="6.126ex" height="1.937ex" role="img" focusable="false" viewBox="0 -833.9 2707.6 855.9" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(1259, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(1728, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp; FLOPs；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">另外，有些非标准矩阵乘的计算，共有&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="55" style="" data-formula="4Bs^2 h"><svg xmlns="http://www.w3.org/2000/svg" width="6.126ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 2707.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="msup" transform="translate(1259, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(2131.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;FLOPs：在每个head中，得到KQV三个矩阵结果后，需要进行&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="57" style="" data-formula="softmax((Q,K^T)/ \sqrt{dk} )"><svg xmlns="http://www.w3.org/2000/svg" width="23.811ex" height="2.758ex" role="img" focusable="false" viewBox="0 -969 10524.5 1219" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(954, 0)"><path data-c="66" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mi" transform="translate(1504, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1865, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2743, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3272, 0)"><path data-c="78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(3844, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(4233, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(4622, 0)"><path data-c="51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="mo" transform="translate(5413, 0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="msup" transform="translate(5857.7, 0)"><g data-mml-node="mi"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(947, 363) scale(0.707)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g><g data-mml-node="mo" transform="translate(7352.5, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(7741.5, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="msqrt" transform="translate(8241.5, 0)"><g transform="translate(853, 0)"><g data-mml-node="mi"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(520, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><g data-mml-node="mo" transform="translate(0, 109)"><path data-c="221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path></g><rect width="1041" height="60" x="853" y="849"></rect></g><g data-mml-node="mo" transform="translate(10135.5, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>&nbsp;，以实现同个sequence内tokens间的Q与K点积运算、缩放。Q的形状[&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="59" style="" data-formula="B"><svg xmlns="http://www.w3.org/2000/svg" width="1.717ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 759 683" aria-hidden="true" style="vertical-align: 0px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g></g></g></svg></mjx-container></span>&nbsp;,s,h/a]，&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="61" style="" data-formula="K^T"><svg xmlns="http://www.w3.org/2000/svg" width="3.382ex" height="1.904ex" role="img" focusable="false" viewBox="0 -841.7 1494.8 841.7" aria-hidden="true" style="vertical-align: 0px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(947, 363) scale(0.707)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;的形状为[&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="67" style="" data-formula="B"><svg xmlns="http://www.w3.org/2000/svg" width="1.717ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 759 683" aria-hidden="true" style="vertical-align: 0px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g></g></g></svg></mjx-container></span>&nbsp;,h/a,s]，涉及个[s,h/a]*[h/a,s]矩阵乘。共有&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="69" style="" data-formula="2B*s*(h/a)*s"><svg xmlns="http://www.w3.org/2000/svg" width="16.772ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 7413.3 1000" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mo" transform="translate(1481.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(2203.4, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(2894.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(3616.9, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(4005.9, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(4581.9, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(5081.9, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(5610.9, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(6222.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(6944.3, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></svg></mjx-container></span>&nbsp;的算力需求。由于共有a个头，所以共&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="72" style="" data-formula="2Bs^2h"><svg xmlns="http://www.w3.org/2000/svg" width="6.126ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 2707.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="msup" transform="translate(1259, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(2131.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp; FLOPs；之后，将softmax结果与V进行element-wise相乘，前者维度为[&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="74" style="" data-formula="B"><svg xmlns="http://www.w3.org/2000/svg" width="1.717ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 759 683" aria-hidden="true" style="vertical-align: 0px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g></g></g></svg></mjx-container></span>&nbsp;,s,s]，后者维度为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="76" style="" data-formula="B"><svg xmlns="http://www.w3.org/2000/svg" width="1.717ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 759 683" aria-hidden="true" style="vertical-align: 0px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g></g></g></svg></mjx-container></span>&nbsp;,s,s/a]，需要&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="78" style="" data-formula="\frac{2Bs^2}{a}"><svg xmlns="http://www.w3.org/2000/svg" width="4.473ex" height="3.112ex" role="img" focusable="false" viewBox="0 -1023.5 1977.1 1375.6" aria-hidden="true" style="vertical-align: -0.797ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 394) scale(0.707)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="msup" transform="translate(1259, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.792)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mi" transform="translate(801.5, -345) scale(0.707)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><rect width="1737.1" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span>&nbsp; FLOPs。由于共有a个头，所以共&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="80" style="" data-formula="2Bs^2 h"><svg xmlns="http://www.w3.org/2000/svg" width="6.126ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 2707.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="msup" transform="translate(1259, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(2131.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;FLOPs；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">此外，WO是一个[h,h]的矩阵。之前的激活值可以认为是一个[,s,h]的矩阵。这里矩阵乘法为[b,s,h]*[h,h]，共有&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="82" style="" data-formula="2Bsh^2"><svg xmlns="http://www.w3.org/2000/svg" width="6.126ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 2707.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(1259, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(1728, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp; FLOPs；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">单个attention共包含&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="84" style="" data-formula="8Bsh^2+4Bs^2h"><svg xmlns="http://www.w3.org/2000/svg" width="15.017ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 6637.6 915.9" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(1259, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(1728, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(2929.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(3930, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(4430, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="msup" transform="translate(5189, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(6061.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp; FLOPs。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）MLP中，包含了[h, 4h]的矩阵，以及[4h, h]的矩阵，还有一个激活层。</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">激活值和第一个线性层相乘：[B,s,h]*[h,4h]&nbsp;共&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="86" style="" data-formula="8Bsh^2"><svg xmlns="http://www.w3.org/2000/svg" width="6.126ex" height="1.937ex" role="img" focusable="false" viewBox="0 -833.9 2707.6 855.9" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(1259, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(1728, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp; FLOPs；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">激活值和第二个线性层相乘：[B,s,4h]*[4h,h]&nbsp;共&nbsp;&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="88" style="" data-formula="8Bsh^2"><svg xmlns="http://www.w3.org/2000/svg" width="6.126ex" height="1.937ex" role="img" focusable="false" viewBox="0 -833.9 2707.6 855.9" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(1259, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(1728, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;FLOPs；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">激活层为约0FLOPs：是确定的数学缩放公式，可认为无需矩阵乘；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">单个MLP共有包含&nbsp;&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="93" style="" data-formula="16Bsh^2"><svg xmlns="http://www.w3.org/2000/svg" width="7.257ex" height="1.937ex" role="img" focusable="false" viewBox="0 -833.9 3207.6 855.9" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(1759, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(2228, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;FLOPs。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">因此，每个transformer块算力需求为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="95" style="" data-formula="(24Bsh^2+4Bs^2h)"><svg xmlns="http://www.w3.org/2000/svg" width="17.908ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 7915.6 1083.9" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1389, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(2148, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(2617, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(3818.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(4819, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(5319, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="msup" transform="translate(6078, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(6950.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(7526.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>&nbsp;。由于有l个transformer块，共计&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="97" style="" data-formula="l(24Bsh^2+4Bs^2h)"><svg xmlns="http://www.w3.org/2000/svg" width="18.583ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 8213.6 1083.9" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mo" transform="translate(298, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(687, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1687, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(2446, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(2915, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(4116.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(5117, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(5617, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="msup" transform="translate(6376, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(7248.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(7824.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>&nbsp;FLOPs。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">二、&nbsp; 其他结构中的FLOPs:</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">主要是输出层logit 层的计算。最后一个transformer block输出的激活值为[B,s,h]，和[h,V]的线性层进行矩阵乘法：需要&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="99" style="" data-formula="2BshV"><svg xmlns="http://www.w3.org/2000/svg" width="6.952ex" height="1.62ex" role="img" focusable="false" viewBox="0 -694 3073 716" aria-hidden="true" style="vertical-align: -0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(1259, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(1728, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(2304, 0)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g></g></g></svg></mjx-container></span>&nbsp; FLOPs。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">因此，前向传播浮点计算次数如下：</p><p style="text-align: center;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="45" style="" data-formula="\begin{aligned}
F_前
&amp;=24Bslh^21+ 4Bs^2l+2BshV \\
&amp;= 24Bslh^2(1+ \frac{s}{6h}+ \frac{V}{12lh}  )
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="32.972ex" height="8.075ex" role="img" focusable="false" viewBox="0 -2034.5 14573.7 3569.1" aria-hidden="true" style="vertical-align: -3.472ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 1150.6)"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g></g><g data-mml-node="mtd" transform="translate(1287.1, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(2333.6, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(3092.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(3561.6, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(3859.6, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 413) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mn" transform="translate(4839.1, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(5561.3, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(6561.6, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(7061.6, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="msup" transform="translate(7820.6, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 413) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(8693.1, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mo" transform="translate(9213.3, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(10213.6, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(10713.6, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(11472.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(11941.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(12517.6, 0)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, -826.5)"><g data-mml-node="mtd" transform="translate(1287.1, 0)"></g><g data-mml-node="mtd" transform="translate(1287.1, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(2333.6, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(3092.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(3561.6, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(3859.6, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 413) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(4839.1, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(5228.1, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(5950.3, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mfrac" transform="translate(6950.6, 0)"><g data-mml-node="mi" transform="translate(523.5, 676)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mrow" transform="translate(220, -686)"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g><rect width="1276" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(8688.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mfrac" transform="translate(9689, 0)"><g data-mml-node="mi" transform="translate(772.5, 676)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mrow" transform="translate(220, -686)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(1298, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g><rect width="2074" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(12003, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="text-align: center;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">而通常在大模型中，6h远大于s，12lh远大于V，所以还可以进一步简化：</p><p style="text-align: center;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="47" style="" data-formula="\begin{aligned}
F_前
&amp; \approx 24Bslh^2
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="13.86ex" height="2.72ex" role="img" focusable="false" viewBox="0 -851 6126.2 1202.1" aria-hidden="true" style="vertical-align: -0.794ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, -32.9)"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g></g><g data-mml-node="mtd" transform="translate(1287.1, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(2333.6, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(3092.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(3561.6, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(3859.6, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 413) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="text-align: center;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">综上，可得单个LLM模型副本的训练和推理的算力需求如下：</p><p style="text-align: center;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="49" style="" data-formula="\begin{aligned}
训练：\\
&amp;  F = 3F_前=72Bsh^2l  (未开启激活值重计算时)\\
&amp;  F = 4F_前=96Bsh^2l (开启全激活值重计算时)\\
推理：\\
&amp;  F = F_前=24Bsh^2l\\

\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="46.176ex" height="15.399ex" role="img" focusable="false" viewBox="0 -3653.1 20409.9 6806.3" aria-hidden="true" style="vertical-align: -7.134ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 2903.1)"><g data-mml-node="mtd"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">训</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">练</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">：</text></g></g></g><g data-mml-node="mtr" transform="translate(0, 1469.2)"><g data-mml-node="mtd" transform="translate(2520.7, 0)"></g><g data-mml-node="mtd" transform="translate(2520.7, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(1026.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(2082.6, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="msub" transform="translate(2582.6, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g><g data-mml-node="mo" transform="translate(4147.5, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(5203.2, 0)"><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(6203.2, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(6962.2, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(7431.2, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 413) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(8410.8, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mo" transform="translate(8708.8, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(9097.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">未</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">开</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">启</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">重</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(7562.1, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g><g data-mml-node="mo" transform="translate(17500.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, -32.9)"><g data-mml-node="mtd" transform="translate(2520.7, 0)"></g><g data-mml-node="mtd" transform="translate(2520.7, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(1026.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(2082.6, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="msub" transform="translate(2582.6, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g><g data-mml-node="mo" transform="translate(4147.5, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(5203.2, 0)"><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(6203.2, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(6962.2, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(7431.2, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 413) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(8410.8, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mo" transform="translate(8708.8, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(9097.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">开</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">启</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">全</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">重</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(7562.1, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g><g data-mml-node="mo" transform="translate(17500.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, -1401)"><g data-mml-node="mtd"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">推</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">理</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">：</text></g></g></g><g data-mml-node="mtr" transform="translate(0, -2835)"><g data-mml-node="mtd" transform="translate(2520.7, 0)"></g><g data-mml-node="mtd" transform="translate(2520.7, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(1026.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msub" transform="translate(2082.6, 0)"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(643, -176.7) scale(0.707)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">前</text></g></g><g data-mml-node="mo" transform="translate(3647.5, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(4703.2, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(5703.2, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(6462.2, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="msup" transform="translate(6931.2, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 413) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(7910.8, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="text-align: center;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">结合3.1节对于模型参数量的评估公式&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="115" style="" data-formula="12lh^2"><svg xmlns="http://www.w3.org/2000/svg" width="5.153ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 2277.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;，发现</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）模型训练中：如果没有应用激活值重计算，单模型副本处理每个tokens时，单参数上算力需求约为6FLOPs。如果应用全激活值重计算，提升至8FLOPs；</p><p style="word-break: break-all;white-space: normal;">2）模型推理中：单模型副本处理每个tokens时，单参数上算力需求约为6FLOPs；</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>3.2.2.3&nbsp;结论验证</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">英伟达&amp;微软在[4]给出训练所需的算力：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;text-align: center;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="117" style="" data-formula="F=96Bslh^2(1+ \frac{s}{6h}+ \frac{V}{16lh}  )"><svg xmlns="http://www.w3.org/2000/svg" width="27.776ex" height="2.8ex" role="img" focusable="false" viewBox="0 -877 12277 1237.5" aria-hidden="true" style="vertical-align: -0.816ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="46" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(1026.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(2082.6, 0)"><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(3082.6, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(3841.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(4310.6, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(4608.6, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(5588.1, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(5977.1, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(6699.3, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mfrac" transform="translate(7699.6, 0)"><g data-mml-node="mi" transform="translate(434.6, 394) scale(0.707)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mrow" transform="translate(220, -345) scale(0.707)"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g><rect width="960.8" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(9122.6, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mfrac" transform="translate(10122.8, 0)"><g data-mml-node="mi" transform="translate(610.7, 394) scale(0.707)"><path data-c="56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mrow" transform="translate(220, -345) scale(0.707)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(1298, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g><rect width="1525.1" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(11888, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">与我们上述分析及公式基本一致。侧面反应了上述公式准确性。</p><p style="word-break: break-all;white-space: normal;">我们尝试本节推出公式和LLMs模型的实际计算量进行对比，发现保持基本一致：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="294" data-imgfileid="100014911" data-ratio="0.5111111111111111" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 536px;height: 274px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX997QwFTQC6xBPDlJqsdzqibATcUAVzStQqDXLziaoewgCp8Yrj5KNZwoA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(表2.&nbsp;LLMs实际算力需求和公式估算结果的比较)</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>&nbsp;3.3 模型通信资源量估算</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.3.1 为什么要估算模型通信资源量？</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">LLMs运行中产生通信的原因，在第二节LLM引发的通信瓶颈中有说明，这里就不赘述了。</p><p style="word-break: break-all;white-space: normal;">量化和归纳集群中的通信量、通信频率以及流量方向的等规则，让我们了解整个LLM集群内的机器内(Intra)和机器间(Inter)的通信压力(前者关联的是机内高速互联带宽，如NVLink、PCIe等。后者关联的目前主要是RDMA网络和网卡)，从而更好地指导设备选型、组网设计和部署工作的开展，后续也更容易对自研通信的算法、网络流量进行针对性优化。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.3.2 怎么评估模型通信需求？</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">无论是训练还是推理，当前LLM集群中通信规则基本确定。我们可以根据模型规模、并行度配置以及其他超参数来推算出集群中的流量：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）目前主流模型训练是数据并行(Data Parallel)、张量并行(Tensor Parallel)、流水线并行(Pipeline Parallel)构成的3D并行。而在模型推理方向中TP、PP也是标配。3D并行中的通信规则是确定的；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）各自做显存优化、算力优化的各种技术(如zeRO系列、序列并行[2]等)，在用通信资源换取其他硬件资源时，引入的通信量和规则也是确定的；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3）集群中的集合通信被AI框架中各种并行技术、显存优化技术所调用，限定在特定几个原语(primitives)的范围之内，其底层的流量规则也是确定的。后续会写一个LLM集合通信相关的文章，所以这里不做过多展开；</p><p style="word-break: break-all;white-space: normal;">在进行集群中LLM流量规则分析和流量量化前，我们先进行必要的参数说明。本文后续章节都会用得到：</p></div><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><span style="font-family: 等线;font-size: 12pt;letter-spacing: 0.034em;"></span><p style="vertical-align: middle;display: inline-block;line-height: 0;"><br></p></div><div style="text-align: center;" powered-by="xiumi.us"><p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg" data-imgfileid="100015061" data-ratio="2.5313807531380754" data-s="300,640" data-type="jpeg" data-w="478" style="width: 578px;height: 1463px;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9TrJhzibEECefiasbicsQdlUIkFvpVvxcIVCzwOFMw0nbPE5fDGCzswBMA/640?wx_fmt=jpeg&amp;from=appmsg"></p><p><sup>(表3.&nbsp;参数含义表）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>3.3.2.1&nbsp;并行技术</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">并行技术分为数据并行(Data Parallelism)和模型并行(Model Parallelism)。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">一、&nbsp; 数据并行</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）简单数据并行</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">DP的示意图如图5所示：其核心思路很简单，将模型结构看成一个整体。通过复制多个模型副本，并将每个模型副本部署到不同设备上运行。</p><p style="word-break: break-all;white-space: normal;">对于AI场景而言，DP仅在模型训练场景中使用。而推理中由于只需一份模型副本即可实现推理，所以DP不适用。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014915" data-ratio="0.31851851851851853" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 469px;height: 149px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8mKPk7rPzXEuE03E5hejGId4icMxic1CDv1ONRXbKVb6bu4BIzrOshPsQ/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（图5.&nbsp;DP流程示意图，source&nbsp;from&nbsp;Nvidia)</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">数据并行工作流程是，在训练时每个迭代开始时，每个模型副本喂入不同的数据样本。在前向传播和反向传播都完成后，各个模型副本间以allreduce的通信原语进行梯度数据同步；而这里的allreduce同步其实有同步(Synchronous)和异步(Asynchronous)两种模式：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">同步模式，如NCCL中的Ring、Tree算法等，是需要等待所有节点上的完成数据同步后，才会开始下一次数据并行；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">异步模式，例如参数服务器，是无需等待所有节点都完成数据同步。每个节点只需要保证获得最新的参数副本即可；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">数据并行的优点和缺点都比较明显：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">优点：1.具备通用性，不关心模型的具体结构，实现比较简单；2.在多种并行技术中，DP拥有最少的数据通信频率和通信量：每次迭代仅做一次梯度同步，是在无硬件瓶颈下的首要并行选择；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">缺点：在数据并行中的每个模型的副本中，都要缓存一个完整的模型状态数据：高达约20Ψ个数据；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">所以，当前LLM训练场景中，通常在保证模型能够塞下(通过TP和PP)的情况下，保证足够的数据并行度；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">二、模型并行</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">模型并行指的是在每个模型副本内，将模型结构进行切分：模型的各个部分使用不同的算力节点来负责计算。由于是对具体的模型结构的拆分，而每种算法的模型结构各不不同，所以模型并行比简单数据并行要复杂。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">而在LLM领域，由于是基于transformer结构的，具备共性。所以针对transformer结构的模型并行技术得以发展：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">流水线并行(PP)，指的是把LLM中的l个transformer块看成一个序列。通常把序列进行几等份的均匀切分，每个算力节点保存一个由几个transformer块串联成的一段结构。对应术语做层间并行(Inter-layer parallelism)</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">张量并行(TP), 指的是把每个transformer块进行更细化的拆解：由于LLM模型主要是多个重复的transformer块构成。把每个tranformer块的结构进行拆解，这就是TP的主要思路，对应的术语叫做层内并行(Intra-layer parallelism)；</p></li></ul><p style="word-break: break-all;white-space: normal;">如图6所示，TP和PP都是大模型时代的模型并行的产物，对于大模型训练和推理都至关重要，解决了模型副本高效切割等关键问题。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014913" data-ratio="0.6794717887154862" data-s="300,640" data-type="png" data-w="833" style="vertical-align: middle;width: 359px;height: 244px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8gU5ibicywKibL236Sn8DSRTzickUQNmG3kPyMBgdViaKTRxj9TxM2pxcJUA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（图6.&nbsp;&nbsp;流水线并行和张量并行的示意图，&nbsp;source&nbsp;from&nbsp;OpenAI）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）流水线并行</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">PP中，l个transformer块被切割成了p段，部署到p个GPU上，每个GPU称之为一个PP stage。每个stage大约有&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="119" style="" data-formula="l_{local} = l/p"><svg xmlns="http://www.w3.org/2000/svg" width="10.016ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 4427.2 1000" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" transform="translate(298, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(298, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(783, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(1216, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1745, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g><g data-mml-node="mo" transform="translate(2070.4, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3126.2, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3424.2, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(3924.2, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g></svg></mjx-container></span>&nbsp;个transformer块。如果仅仅引入上述的切分的思想，整个模型只会有一个batch输入：会发现整个系统非常高的硬件空闲率(如图7.b所展示的)。每个时刻都只会有1个算力卡在工作，剩下的算力卡都在闲置。通常，我们将硬件空闲率(idle rate)称之为气泡(bubble)，如何降低气泡大小是各种PP技术需要解决的主要难题之一。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">引入pipeline的概念可以提高硬件利用率(如图7.c所示)：在一个物理模型副本上，将每次迭代所用的batch size B拆分成m个microbatch；此时，系统中可认为独立存在m个逻辑模型副本:&nbsp;每个副本被喂入不同的训练样本(micro-batch)，计算出不同的梯度数据。并在m个副本都完成前后向传播的任务后，就会进行逻辑副本间的梯度同步和参数更新，这就是Google的PP技术(Gpipe[7])的逻辑。而微软的PP技术(Pipedream[13])编排的更加复杂些，但也能获得更小的气泡。但两者其基本思想类似,所以就不展开讨论了。</p><p style="word-break: break-all;white-space: normal;">因此，可以将流水线并行看作是数据并行和模型并行的混合产物。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014917" data-ratio="0.7320525783619818" data-s="300,640" data-type="png" data-w="989" style="vertical-align: middle;width: 441px;height: 323px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8odxRS3J7JeI6SQzAug6CekTdvkKUvastsB8teSluC8qh9r3rxp7Rcw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(图7.&nbsp;&nbsp;Gpipe中流水线并行图示，source&nbsp;from&nbsp;[7])</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们再来看下PP内部的通信情况：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">PP产生的通信发生在前后向传播内，</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">前向传播时前一个PP stage将本GPU上最后一个输出的激活值(bsh个参数量)传播给下一个PP stage对应的GPU，用于后续链式计算；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">反向传播时后一个PP stage将激活值偏导数(bsh个参数量)传递给上个PP stage，也用于链式计算；</p></li></ul><p style="word-break: break-all;white-space: normal;">因此，一次迭代内两个相邻的stage GPU间发生了2bsh个参数量的send/recv。而一般PP编排的比较精妙，是可以将上述通信过程overlap到计算过程中(如图8所示)。我们这里不展开，在后续集群拥塞章节进行专项展开。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014918" data-ratio="1.3537037037037036" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 341px;height: 462px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8Z6ekehmgMPSuIMho9naBhjXuzkktIibUPLkNdSLeTgRaCWL0FBvVaGA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(图8.&nbsp;PP中的通信和计算的示意图，source&nbsp;from [13])</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）张量并行</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">TP是针对transformer结构的定制化拆解技术，利用的是1.transformer块多头注意力结构中每个头之间的独立性、2.矩阵乘法的可拆解性。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">对每个transformer块中的attention结构和MLP结构都可以进行拆解：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;">多头的attention结构可以按head进行拆分，每个head都可以放到不同的GPU上；接着，后续衔接的WO矩阵可以按行拆分到各个GPU上，以实现和当前头内KQV投影的矩阵乘；最终每个张量并行的GPU上都会获得一份[b,s,h]的激活值，需要对于该激活值进行allreduce同步(对应图9中的绿色矩形"g")。由于训练中前向传播和反向传播都是链式的，而反向传播也需要对于激活值的偏导数进行allreduce(对应图9中的绿色矩形"f")。所以每个microbatch，涉及2次allreduce；</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014919" data-ratio="0.5834932821497121" data-s="300,640" data-type="png" data-w="1042" style="vertical-align: middle;width: 379px;height: 221px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8jdo8k9DSvRgRniaPSvRu5axNDrgtDqNdUA21iaxRIU1LfgcAicB0eMXsg/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(图9.&nbsp;&nbsp;张量并行中自注意力结构的拆分，source&nbsp;from&nbsp;[8])</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">MLP是由两个线性层和一个激活函数构成的。两个线性层，可以做是两个矩阵：一个是[h,4h]，另一个是[4h,h]；可以将第一个矩阵按列拆分，第二个按行拆分。最后在做allreduce；类似地，这个过程中，前向传播和反向传播共涉及2次allreduce；</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014916" data-ratio="0.5034965034965035" data-s="300,640" data-type="png" data-w="572" style="vertical-align: middle;width: 433px;height: 218px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8pTcw0TqDQeWPqJrBF0YNO4ph3AkRtudFr7TCCiaSF83nenXUGBVNib4Q/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(图10.&nbsp;&nbsp;张量并行中MLP结构的拆分，source&nbsp;from&nbsp;[8])</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">因此，从张量并行本身来看，每个transformer块需要进行4次关于激活值和激活值偏导数的allreduce，每次allreduce的通信量和bsh有关的。如果将TP和PP结合来看，每个GPU保存了本PP stage中的&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="121" style="" data-formula="l_{local}"><svg xmlns="http://www.w3.org/2000/svg" width="4.056ex" height="1.927ex" role="img" focusable="false" viewBox="0 -694 1792.6 851.8" aria-hidden="true" style="vertical-align: -0.357ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" transform="translate(298, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(298, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(783, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(1216, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1745, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g></g></g></svg></mjx-container></span>&nbsp;个transformer块。所以每个gpu，在一个microbatch范围内需要通信的参数总量是&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="123" style="" data-formula="4bshl_{local}"><svg xmlns="http://www.w3.org/2000/svg" width="8.522ex" height="1.927ex" role="img" focusable="false" viewBox="0 -694 3766.6 851.8" aria-hidden="true" style="vertical-align: -0.357ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(929, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(1398, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="msub" transform="translate(1974, 0)"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" transform="translate(298, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(298, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(783, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(1216, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1745, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g></g></g></svg></mjx-container></span>&nbsp;，进一步化简为：</p><p style="text-align: center;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="52" style="" data-formula="\begin{aligned}
算法通信量(每个microbatch)
&amp;=(bshl_{local}*4)\\
&amp; = 4bsh*(\frac{l}{p})\\ 
&amp;= \frac{4bshl}{p} （单位：参数个数）
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="54.345ex" height="13.801ex" role="img" focusable="false" viewBox="0 -3300 24020.7 6100" aria-hidden="true" style="vertical-align: -6.335ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 2550)"><g data-mml-node="mtd"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">法</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(4479, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(4868, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">每</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(6826.2, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(7704.2, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(8049.2, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(8482.2, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(8933.2, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(9418.2, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(9847.2, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(10376.2, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(10737.2, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(11170.2, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(11746.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mtd" transform="translate(12135.2, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(1333.6, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(1722.6, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(2151.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(2620.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="msub" transform="translate(3196.6, 0)"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" transform="translate(298, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(298, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(783, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(1216, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1745, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g><g data-mml-node="mo" transform="translate(5211.4, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(5933.6, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(6433.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, 630)"><g data-mml-node="mtd" transform="translate(12135.2, 0)"></g><g data-mml-node="mtd" transform="translate(12135.2, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(1833.6, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(2262.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(2731.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(3529.8, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(4252, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mfrac" transform="translate(4641, 0)"><g data-mml-node="mi" transform="translate(322.5, 676)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(220, -686)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><rect width="703" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(5584, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, -1920)"><g data-mml-node="mtd" transform="translate(12135.2, 0)"></g><g data-mml-node="mtd" transform="translate(12135.2, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(220, 676)"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(929, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(1398, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(1974, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g><g data-mml-node="mi" transform="translate(1104.5, -686)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><rect width="2472" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(4323.3, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">（</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">位</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">：</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">）</text></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="word-break: break-all;white-space: normal;">当前LLM训练，通常是 TP/PP/DP构成的3D并行(如图11所示)：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014920" data-ratio="0.6620370370370371" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 371px;height: 246px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8X4s1fy1M3vylyAfAC3um2Mn1tTLIAoSVicNuRYw6SX7ibj4jpicu97ljw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(图11.&nbsp;3D并行示意图)</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">d*p*t个gpu构成了整个系统:&nbsp;系统中，每p*t个GPU构成了一个物理模型副本，共有d个这样的物理模型副本。每个物理副本中，还有因pipeline机制引入的多个逻辑模型副本；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">物理模型副本间采用allreduce进行梯度同步，同步频率是每次迭代同步一次，总量上是关于模型梯度(共Ψ个参数量)。通常, 不同物理副本上的同号GPU使用各自的RDMA网卡进行同步，每个GPU的通信量为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="128" style="" data-formula="\frac{Ψ}{pt}"><svg xmlns="http://www.w3.org/2000/svg" width="2.378ex" height="3.075ex" role="img" focusable="false" viewBox="0 -877 1050.9 1359.1" aria-hidden="true" style="vertical-align: -1.091ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="TeXAtom" transform="translate(250.4, 394) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="3A8" d="M340 622Q338 623 335 625T331 629T325 631T314 634T298 635T274 636T239 637H212V683H224Q248 680 389 680T554 683H566V637H539Q479 637 464 635T439 622L438 407Q438 192 439 192Q443 193 449 195T474 207T507 232T536 276T557 344Q560 365 562 417T573 493Q587 536 620 544Q627 546 671 546H715L722 540V515Q714 509 708 509Q680 505 671 476T658 392T644 307Q599 177 451 153L438 151V106L439 61Q446 54 451 52T476 48T539 46H566V0H554Q530 3 389 3T224 0H212V46H239Q259 46 273 46T298 47T314 48T325 51T331 54T335 57T340 61V151Q126 178 117 406Q115 503 69 509Q55 509 55 526Q55 541 59 543T86 546H107H120Q150 546 161 543T184 528Q198 514 204 493Q212 472 213 420T226 316T272 230Q287 216 303 207T330 194L339 192Q340 192 340 407V622Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -345) scale(0.707)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="810.9" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span>&nbsp;个参数；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">而物理副本内，有&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="130" style="" data-formula="m= \frac{B}{db}"><svg xmlns="http://www.w3.org/2000/svg" width="7.517ex" height="2.782ex" role="img" focusable="false" viewBox="0 -877 3322.6 1229.7" aria-hidden="true" style="vertical-align: -0.798ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(1155.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(2211.6, 0)"><g data-mml-node="mi" transform="translate(287.2, 394) scale(0.707)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mrow" transform="translate(220, -345) scale(0.707)"><g data-mml-node="mi"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(520, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g></g><rect width="871" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span>&nbsp;个逻辑副本，逻辑副本间也是关于梯度的allreduce同步。但由于逻辑副本模型分片都是和GPU绑定的，所以每个GPU上逻辑副本间的梯度同步无实质通信量；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">而逻辑副本内，GPU之间还有TP和PP的通信量，这里就不赘述了;</p></li></ul><p style="word-break: break-all;white-space: normal;">综上，我们可简单计算出3种并行中，计算一个batch上TP、PP、DP的通信情况。并且由于一个迭代中，有m个microbatch，所以每个GPU在一个迭代内通信情况如下：</p><p style="word-break: break-all;white-space: normal;"><br></p><p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg" data-imgfileid="100015070" data-ratio="0.9814814814814815" data-s="300,640" data-type="jpeg" data-w="1080" style="" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9Ta2A2RthMdLWTrkRmPybdZnN05ZxwD5nYQJb3HAOaLrqibicM3ZdjFZQ/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（表4.&nbsp;3D并行中per&nbsp;GPU通信规则）</sup></p></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;"><p style="white-space: normal;">PP的流量在Megatron-lm 第二篇paper[4]和第三篇paper[2]中都是有优化的，这里贴出了实际通信量&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="133" style="" data-formula="\frac{bsh}{t} *2"><svg xmlns="http://www.w3.org/2000/svg" width="6.622ex" height="2.8ex" role="img" focusable="false" viewBox="0 -884.7 2926.7 1237.5" aria-hidden="true" style="vertical-align: -0.798ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 394) scale(0.707)"><g data-mml-node="mi"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(429, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(898, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g><g data-mml-node="mi" transform="translate(613.5, -345) scale(0.707)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><rect width="1242.3" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1704.5, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(2426.7, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></svg></mjx-container></span>&nbsp;（单位：参数量）</p></div></div></div></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在3种并行技术中：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">TP中的通信频率最大、通信量最高，因为它和输入的tokens数量、模型宽度、transformer层数都有关。所以TP一般限定在机内，并由GPU间高速互联(如NVLink)进行；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">PP的通信仍然和输入tokens数量、模型宽度都有关，但不和transformer层数有关，所以PP中的通信量和频率比TP小；</p></li><li><p style="word-break: break-all;">DP具有最少的通信量和通信频率，它和输入的tokens数量无关；</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>3.3.2.2&nbsp;&nbsp;集合通信的冗余率</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）在介绍集合通信的冗余率概念前，我们先简单看看集合通信是什么：</p><p style="word-break: break-all;white-space: normal;">在3D并行中，AI框架层通过集合通信库提供的集合通信APIs，来实现多个GPU间的数据同步。如下图所示集合通信库对上提供规范的通信原语，对下是各种机间、机内的点对点通信的组合拼接。还需要考虑到底层的硬件组网拓扑、服务器内算力卡互联拓扑等。不同集群规模、硬件和互联架构下，其最优的算法和通信规则都是不同的。本小节只做相关的必要展开，后续还会有通信库相关文章做探讨。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014922" data-ratio="0.6777777777777778" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 578px;height: 392px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8WpXbmaVDdXl90E1ZrLvUp7Oicagodic2HaSFOL8wkpVR4cicqGbMNeC1w/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（图12.&nbsp;AI/HPC应用中的软件架构）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）集合通信为什么会有通信冗余？</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在Nvidia算力卡集群中，默认使用的集合通信库是NV开源的集合通信库NCCL。NCCL中有主要有两种图算法：Flat Ring和Double Binary Tree。前者是小规模集群中使用的，后者是为了克服Ring在百卡以上范围内时延(latency)过大的问题而使用的。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们以ring allreduce为例，简单分析下ring算法中带来的额外通信：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">若有n个成员，每个成员有x的数据量要做allreduce：先将每个成员的数据x切分为n份，并通过2(n-1)个steps完成数据同步。其中每个step中每个成员都向其后一个邻居成员发送x/n的数据量。因此，每个成员共需要发送2(n-1)个x/n的数据：通过n-1个steps完成reduce-scatter，再通过n-1个steps完成allgather；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">由此可以发现，在ring allreduce中每个成员即使待规约数据量仅为x，也需要每个成员总计发送x*2(n-1)/n的数据量。这里的2(n-1)/n就是集合通信算法产生的冗余率。在节点数量足够多时，使用ring算法每完成1字节的allreduce，就需要链路真实传输2字节数据。</p><p style="word-break: break-all;white-space: normal;">可以简单把集合通信的数据冗余理解成“为实现有效数据同步，而不得不进行的额外数据收发”。例如图13中，nccl-test中有”算法带宽“和“总线带宽”两种指标，也是反应了集合通信冗余率的概念：算法带宽对应有效集合通信速率，总线带宽对应真实集合通信速率，总线带宽=算法带宽*集合通信冗余率。这里由于是8个GPU，所以冗余率是&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="135" style="" data-formula="\frac{2*(8-1)}{8} =1.75"><svg xmlns="http://www.w3.org/2000/svg" width="13.724ex" height="3.185ex" role="img" focusable="false" viewBox="0 -1047.1 6066 1407.7" aria-hidden="true" style="vertical-align: -0.816ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 516.8) scale(0.707)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(500, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(1000, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(1389, 0)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mo" transform="translate(1889, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(2667, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(3167, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mn" transform="translate(1300.5, -345) scale(0.707)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><rect width="2714.5" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(3232.2, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(4288, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500, 0)"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(778, 0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(1278, 0)"></path></g></g></g></svg></mjx-container></span>&nbsp;</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014923" data-ratio="0.6729435084241824" data-s="300,640" data-type="png" data-w="1009" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8VKL034g3vMjJetFderukfjyVVMViccDR8p94zBQdFkYicdQggMGyDxLQ/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="text-align: center;white-space: normal;" powered-by="xiumi.us"><sup>（图13.&nbsp;NCCL-Test中反映出的通信冗余率）</sup></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3）集合通信冗余率统计：</p><p style="word-break: break-all;white-space: normal;">1. &nbsp;同一种软件算法中，不同的原语中的冗余率也是不同的，例如ring中allreduce是2(n-1)/n，而allgather是(n-1)/n。这里给出NCCL中Ring/Tree算法下各种集合通信的冗余率：</p></div><p style="white-space: normal;text-align: center;" powered-by="xiumi.us"><br></p><div powered-by="xiumi.us" style="text-align: center;"><p style="text-align: center;"><br></p><table><tbody><tr style="height: 27px;"><td width="150" colspan="1" rowspan="1" style="background: rgb(234, 250, 241);vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;"><strong>通信原语</strong></span><o:p></o:p></p></td><td width="150" colspan="1" rowspan="1" style="background: rgb(234, 250, 241);vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><strong><span style="font-size: 14px;">冗余率</span></strong><o:p></o:p></p></td></tr><tr style="height: 27px;"><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">allreduce</span><o:p></o:p></p></td><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">2(n-1)/n</span><o:p></o:p></p></td></tr><tr style="height: 27px;"><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">all2all</span><o:p></o:p></p></td><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">(n-1)/n</span><o:p></o:p></p></td></tr><tr style="height: 27px;"><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">allgather</span><o:p></o:p></p></td><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">(n-1)/n</span><o:p></o:p></p></td></tr><tr style="height: 27px;"><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">reducescatter</span><o:p></o:p></p></td><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">(n-1)/n</span><o:p></o:p></p></td></tr><tr style="height: 27px;"><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">gather</span><o:p></o:p></p></td><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">(n-1)/n</span><o:p></o:p></p></td></tr><tr style="height: 27px;"><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">sendrecv</span><o:p></o:p></p></td><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">1</span><o:p></o:p></p></td></tr><tr style="height: 27px;"><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">broadcast</span><o:p></o:p></p></td><td width="150" colspan="1" rowspan="1" style="vertical-align: middle;padding: 0px 7.2px;border-color: rgb(203, 205, 209);word-break: break-all;" align="center" valign="middle"><p style="text-align: center;"><span style="font-size: 14px;">1</span></p></td></tr></tbody></table></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（表5.&nbsp;NCCL中Ring/Tree算法下各种集合通信的冗余率）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">不同硬件架构图算法下，集合通信冗余率是有差异的：例如国产GPU卡互联方案中，主流采用full-mesh方式(缺失类NVSwitch技术)，其算法对应的也是full-mesh。具体通信规则如下图所示，其allreduce中的冗余率也是2(n-1)/n：通过reduce-scatter、allgather两个步骤完成allreduce，每个步骤中的单节点都需要完成"(n-1)/n*数据量"的通信；而如参数服务器、在网计算(In-network computing)等方式，冗余率等数据还会发生变化；</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014926" data-ratio="0.562037037037037" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 578px;height: 325px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8Cib49yPicpU3zp5EpKjvRnaYvPlkkpbgZwIz4tOkeqOBHmfRow6CF5Yg/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（图14.&nbsp;&nbsp;单机内4卡full-mesh时allreduce示意图）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.4 模型显存占用估算</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.4.1 为什么要评估显存占用？</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">大模型的显存占用是可以预估的，这是因为大模型本身显存占用就是固定的几个部分。</p><p style="word-break: break-all;white-space: normal;">当前GPU显存容量是大模型训练、推理的瓶颈：目前主流算力卡如A100，其显存只有80GB。我们在训练时，经常会遇到OOM(Out Of Memory)的报错提示。所以对模型的显存占用有一个认知和预估是非常重要的。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.4.2 怎么评估显存占用？</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">模型的训练中显存占用特别大，而推理中的显存占用相对要小些。因此，我们着重分析当前LLMs的训练中的显存占用情况。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>3.4.2.1&nbsp;训练中显存占用分析</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">训练中，普遍使用混合精度训练和ADAM优化器相结合。而在这样的背景下，显存占用可分为两块:1.模型状态(model states）、2.激活值为主的其它残余状态(residual states)。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1)&nbsp; 模型状态</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">采用混合精度训练可以节省内存和提高训练速度，所以被广泛使用。而混合精度训练有 FP16-FP32 和BF16-FP32两种，两种方式中的显存占用是一致的。在分析中间激活的显存占用时，中间激活值是以16位精度格式(FP16或BF16)来保存的，每个元素占了2个字节。唯一例外的是，dropout操作的mask矩阵，每个元素只占1个字节。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">标准的模型训练中，每个iteration内的流程如下。总的看下来，一个模型副本内，需要18～20Ψ的空间用于模型状态存储：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">先将前一层传入的激活值作为输入值，结合模型的保存的16位精度的参数(2Ψ)来进行前向、反向传播后，得到梯度数据(2Ψ)：在这个过程中，分别需要2Ψ显存存储16位精度的参数、梯度数据；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">之后，使用计算出梯度数据，进行优化器状态状态更新，计算得到包括计算一阶动量(momentum)、二阶动量(varience)：一阶动量和二阶动量都是32位精度缓存，分别需要4Ψ的空间；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">接着，使用一阶、二阶动量来更新参数。在这个过程中，需要先将需要一个4Ψ的梯度 buffer 来存储参数即将变化的差值信息(如果此时将之前16位精度的梯度缓存给释放，此处只需要额外增加2Ψ的空间)；此外，使用之前的参数减去变化差值得到更新后的参数，这还需要4Ψ的空间用于在32位精度更新参数。</p></li><li><p style="word-break: break-all;">最后，得到的更新后的参数，由fp32转fp16。并且将fp16的参数用于下一个iteration的计算；</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014924" data-ratio="0.875" data-s="300,640" data-type="png" data-w="776" style="vertical-align: middle;width: 427px;height: 374px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8mVUxD8P0QM8ehkgeicicTj8ogRx0mDX0IJt7Q4lmRYKWkbMY4Bnjeicxg/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(图&nbsp;15.&nbsp;&nbsp;模型训练中每个iteration中的数据更新示意图，source&nbsp;from&nbsp;[11])</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在推理过程中，由于只有前向传播，而没有反向传播，所以只需要2Ψ的空间用于存储模型状态中的模型参数部分；并且在推理中有KV-cache等技术可以节约硬件资源。另外由于推理并不依赖高精度，所以可以进一步将精度进行压缩至INT8、INT4等；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2)&nbsp; 残余状态</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">残余状态部分主要由激活值和一些临时缓存和无法再使用的碎片空间内存构成。其中，临时缓存和碎片的占用空间不大。我们着重观察激活值部分。之前有提到，激活值是在前向传播时产生的各层的输出结果，而在反向传播的链式求导过程中会被使用。由于激活值空间占用比较大，业界还有各种激活值优化技术。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">首先，我们分析下全量的激活值空间占用是多少：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">整个LLM模型包含了l个transformer块，每个transformer块中的激活具体可分为三部分：1.自注意力结构中的的激活值、 2.MLP中激活、3.Layer Norm中激活</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1. &nbsp;自注意力结构中：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">QKV矩阵乘：共享bsh的输入激活值，对应2bsh 字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="137" style="" data-formula="QK^T"><svg xmlns="http://www.w3.org/2000/svg" width="5.172ex" height="2.343ex" role="img" focusable="false" viewBox="0 -841.7 2285.8 1035.7" aria-hidden="true" style="vertical-align: -0.439ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="msup" transform="translate(791, 0)"><g data-mml-node="mi"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(947, 363) scale(0.707)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;矩阵乘：由于存储了Q和K两个矩阵，而Q和K的形状都是(b,s,h)。所以需要存储2bsh的参数，共计4bsh字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">Softmax：需要存储&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="139" style="" data-formula="QK^T"><svg xmlns="http://www.w3.org/2000/svg" width="5.172ex" height="2.343ex" role="img" focusable="false" viewBox="0 -841.7 2285.8 1035.7" aria-hidden="true" style="vertical-align: -0.439ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="msup" transform="translate(791, 0)"><g data-mml-node="mi"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(947, 363) scale(0.707)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;矩阵乘的结果作为softmax的输入，而&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="141" style="" data-formula="QK^T"><svg xmlns="http://www.w3.org/2000/svg" width="5.172ex" height="2.343ex" role="img" focusable="false" viewBox="0 -841.7 2285.8 1035.7" aria-hidden="true" style="vertical-align: -0.439ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="msup" transform="translate(791, 0)"><g data-mml-node="mi"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(947, 363) scale(0.707)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;的形状为(b,a,s,s)。所以需要&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="143" style="" data-formula="2bs^2a"><svg xmlns="http://www.w3.org/2000/svg" width="5.273ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 2330.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="msup" transform="translate(929, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(1801.6, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g></g></g></svg></mjx-container></span>&nbsp;字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">Softmax dropout：仅需要保存一个mask矩阵，其结构&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="145" style="" data-formula="QK^T"><svg xmlns="http://www.w3.org/2000/svg" width="5.172ex" height="2.343ex" role="img" focusable="false" viewBox="0 -841.7 2285.8 1035.7" aria-hidden="true" style="vertical-align: -0.439ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="msup" transform="translate(791, 0)"><g data-mml-node="mi"><path data-c="4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(947, 363) scale(0.707)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g></g></svg></mjx-container></span>&nbsp;和一致，所以需要&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="147" style="" data-formula="bs^2a"><svg xmlns="http://www.w3.org/2000/svg" width="4.142ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 1830.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="msup" transform="translate(429, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(1301.6, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g></g></g></svg></mjx-container></span>&nbsp;字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">Score*V:&nbsp;分别需要存储score和V，score对应&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="150" style="" data-formula="2bs^2a"><svg xmlns="http://www.w3.org/2000/svg" width="5.273ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 2330.6 844.9" aria-hidden="true" style="vertical-align: -0.025ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="msup" transform="translate(929, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(1801.6, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g></g></g></svg></mjx-container></span>&nbsp;字节，V对应2bsh字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">结果和WO矩阵乘：需要保存其输入，大小为 2bsh字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">dropout：需要保存mask矩阵，大小为 bsh字节;</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">因此，共计&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="152" style="" data-formula="11bsh+5bs^2a"><svg xmlns="http://www.w3.org/2000/svg" width="13.636ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 6027 915.9" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(1429, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(1898, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(2696.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(3696.4, 0)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mi" transform="translate(4196.4, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="msup" transform="translate(4625.4, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(5498, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g></g></g></svg></mjx-container></span>&nbsp;字节；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2. &nbsp;MLP中：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">第一个线性层：保存其输入的激活值，需要2bsh字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">激活函数：保存其输入的激活值，需要8bsh字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">第二个线性层：保存其输入的激活值，需要8bsh字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">dropout：需要保存mask矩阵，大小为 bsh字节;</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">因此，共计19bsh字节；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3. &nbsp;Layer Norm中：由于自注意力和MLP各自关联一个LayerNorm，每个LayerNorm需要存储输入的激活值为2bsh字节，所以共计4bsh字节；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">综上，一个transformer块共需要&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="154" style="" data-formula="(34bsh+5bs^2a)"><svg xmlns="http://www.w3.org/2000/svg" width="15.396ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 6805 1083.9" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1389, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(1818, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(2287, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(3085.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(4085.4, 0)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mi" transform="translate(4585.4, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="msup" transform="translate(5014.4, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(5887, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(6416, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>&nbsp;字节的激活值占用。整个LLM单个模型副本约有l个tranformer块，共计&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="156" style="" data-formula="l(34bsh+5bs^2a)"><svg xmlns="http://www.w3.org/2000/svg" width="16.07ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 7103 1083.9" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mo" transform="translate(298, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(687, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1687, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(2116, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(2585, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(3383.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(4383.4, 0)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mi" transform="translate(4883.4, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="msup" transform="translate(5312.4, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(6185, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(6714, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>&nbsp;字节激活值的空间占用。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">接着，我们分析下基于3D并行时，激活值占用情况：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在3D并行中，每个PP stage的GPU上有l/p个transformer块。而对于每个tranformer块来说，被切分到TP上的t个GPU上来保存。在这种情况下，每个transformer块的激活值占用是和刚才分析的简单情况下的全量激活值空间占用不同。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1. &nbsp;自注意力结构中：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">QKV矩阵乘：发生变化。原本多头间共享bsh个输入值(2bsh字节数据)&nbsp;。&nbsp;现在做TP产生了t个切分，每个切分上都得保存一份输入值。所以激活值从2bsh字节变为2bsht字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">其余部分保持不变；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">WO后的dropout：发生变化。有t个切分，每个切分都得保存mask矩阵，总大小由bsh字节变为bsht字节;&nbsp;</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">因此，共计&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="168" style="" data-formula="3bsht+8bsh+5bs^2a"><svg xmlns="http://www.w3.org/2000/svg" width="20.553ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 9084.4 915.9" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(929, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(1398, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(1974, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(2557.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(3557.4, 0)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mi" transform="translate(4057.4, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4486.4, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(4955.4, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(5753.7, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(6753.9, 0)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mi" transform="translate(7253.9, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="msup" transform="translate(7682.9, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(8555.4, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g></g></g></svg></mjx-container></span>&nbsp;字节；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2. &nbsp;MLP中：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">第一个线性层：发生变化。该矩阵被认为按列切分成t个子矩阵。所以每个子矩阵都得保存一份输入的激活值，激活值从bsht字节变成了2bsht字节；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">其余部分保持不变</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">dropout：发生变化。需要保存t个mask矩阵，大小为由bsh字节变为bsht字节;</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">因此，共计&nbsp;&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="166" style="" data-formula="3bsht+18bsh"><svg xmlns="http://www.w3.org/2000/svg" width="13.646ex" height="1.756ex" role="img" focusable="false" viewBox="0 -694 6031.4 776" aria-hidden="true" style="vertical-align: -0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(929, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(1398, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(1974, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(2557.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(3557.4, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(4557.4, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4986.4, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(5455.4, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;字节；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3. &nbsp;Layer Norm中：发生变化。自注意力和MLP各自关联一个LayerNorm，而由于注意力结构和MLP都进行了切分成了t份，相应地LayerNorm也有t份。因此，激活值从4bsh字节变为4bsht字节；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">综上，在3D并行中，一个transformer块共需要&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="170" style="" data-formula="(10bsht+24bsh+5bs^2a)"><svg xmlns="http://www.w3.org/2000/svg" width="24.576ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 10862.4 1083.9" aria-hidden="true" style="vertical-align: -0.566ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1389, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(1818, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(2287, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(2863, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(3446.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(4446.4, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(5446.4, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(5875.4, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(6344.4, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(7142.7, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(8142.9, 0)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mi" transform="translate(8642.9, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="msup" transform="translate(9071.9, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(9944.4, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(10473.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>&nbsp;字节的激活值占用。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们假设目前采用的PP是pipedream的1F1B模式[13]，为了保持比较低的气泡，则第一个PP stage上的micro batch个数为p(即m=p)，此时第一个PP stage上每个GPU的激活值占用为：</p><p style="text-align: center;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="54" style="" data-formula="\begin{aligned}
&amp;3D并行中的单GPU激活值占用\\
&amp;= (10bsht+24bsh+5bs^2a)*\frac{l}{p}*p/t \\
&amp;= bshl(10+ \frac{24}{t} + \frac{5sa}{ht} )
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="37.086ex" height="13.348ex" role="img" focusable="false" viewBox="0 -3200 16391.9 5900" aria-hidden="true" style="vertical-align: -6.109ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 2450)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="44" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mo" transform="translate(1605.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">并</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">行</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">中</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">的</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(6084.7, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(6870.7, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(7621.7, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(8666.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text></g></g></g><g data-mml-node="mtr" transform="translate(0, 530)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(1333.6, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(1722.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(2722.6, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3151.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(3620.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(4196.6, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(4779.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(5780, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(6780, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(7209, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(7678, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(8476.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(9476.4, 0)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mi" transform="translate(9976.4, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="msup" transform="translate(10405.4, 0)"><g data-mml-node="mi"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mn" transform="translate(469, 413) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mi" transform="translate(11278, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(11807, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(12418.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mfrac" transform="translate(13140.4, 0)"><g data-mml-node="mi" transform="translate(322.5, 676)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(220, -686)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><rect width="703" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(14305.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(15027.9, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(15530.9, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(16030.9, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, -2003)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(1333.6, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(1762.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(2231.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(2807.6, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mo" transform="translate(3105.6, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(3494.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(4716.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mfrac" transform="translate(5717, 0)"><g data-mml-node="mn" transform="translate(220, 676)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(539.5, -686)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><rect width="1200" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(7379.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mfrac" transform="translate(8379.4, 0)"><g data-mml-node="mrow" transform="translate(220, 676)"><g data-mml-node="mn"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(969, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g></g><g data-mml-node="mrow" transform="translate(500.5, -686)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(576, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="1698" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(10317.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">如果将l个transformer块，存在l个PP stage上。那么此时，每个PP上只有一个transformer块。每个GPU只需要存入tranformer块的输入值即可，后续所有的激活值都可以通过全激活值重计算(full activatiton recomputation)来重算。所以每个GPU只需保存2bsh 字节的数据；</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>3.4.2.2&nbsp;显存优化技术</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">除了上述的显存占用外，业界还有些显存优化相关的技术。正如之前所言，这些技术通常在做显存、算力和通信之间trade off的游戏。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）zeRO系列技术-&nbsp;显存和算力的优化</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">zeRO技术可以看作是改进版数据并行技术：微软在Deepspeed框架中提出的zeRO系列技术，包括zeRO、zeRO Offload 及zeRO Infinity，将数据并行的显存占用、优化器参数更新的计算逐步进行卸载到CPU的内存、CPU core、NVMe磁盘上，以优化集群中数据并行中的算力和显存的资源使用。但是zeRO系列技术采取主要思想还是硬件资源间trade off：需要引入额外集群内通信来换取更小的显存占用和计算量；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">zeRO是一个系列技术，主要技术概括如下：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">zeRO 提出将zeRO-DP和 zeRO-R技术。zeRO-dp负责将model states进行分割并且存储到各个进行数据并行的gpu上，包含zeRO stage1~3；zeRO-R进一步优化residual states的显存占用;(部分存储卸载，通信换内存)</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">zeRO-offload，提出将模型的model-states计算和更新卸载到cpu中进行(部分计算和存储卸载到CPU和CPU memory中，通信换内存)；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">zeRO-infinity，进一步盯上了服务器上的NVMe磁盘资源。将显存占用卸载到NVMe上进行；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">zeRO技术中，最广泛使用的是zeRO-DP：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">zeRO-DP 是将显存占用所需要的model states进行切分，然后每个数据并行的副本仅仅保存其中的一部分。如图6所示，&nbsp;具体分为三种方案：1.stage1 是仅仅切分优化器状态()；2.stage2是切分优化器状态和梯度(&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="174" style="" data-formula="P_{os+g}"><svg xmlns="http://www.w3.org/2000/svg" width="5.1ex" height="2.213ex" role="img" focusable="false" viewBox="0 -683 2254 978" aria-hidden="true" style="vertical-align: -0.667ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="TeXAtom" transform="translate(642, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(485, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(954, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(1732, 0)"><path data-c="67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g></g></g></g></g></svg></mjx-container></span>&nbsp;)；3.stage3 是切分优化器状态、梯度、参数(&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="176" style="" data-formula="P_{os+g+p}"><svg xmlns="http://www.w3.org/2000/svg" width="7.149ex" height="2.213ex" role="img" focusable="false" viewBox="0 -683 3159.8 978" aria-hidden="true" style="vertical-align: -0.667ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="TeXAtom" transform="translate(642, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(485, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(954, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(1732, 0)"><path data-c="67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mo" transform="translate(2209, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(2987, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g></g></g></svg></mjx-container></span>&nbsp;)；</p></li><li><p style="word-break: break-all;">通常大部分的 AI 框架都支持和默认开启了&nbsp;类zeRO 的数据并行优化机制，例如 Pytorch 中的 FSDP(Fully Sharded Data Parallel)，&nbsp;就是 zeRO3的思想；</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014927" data-ratio="0.41219768664563616" data-s="300,640" data-type="png" data-w="951" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8R1jxdPraaAy3GyxB8QdZgzwQmgza4SNEG5rsUg3k9T1vm8OajWUFJA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（图16.&nbsp;zeRO&nbsp;DP的三阶切分示意图，source&nbsp;from[12]）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">如果应用 zeRO DP中的Stage 1~3，DP中的每个模型副本中的显存占用将被进一步优化：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;" powered-by="xiumi.us"><p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg" data-imgfileid="100015071" data-ratio="0.687382297551789" data-s="300,640" data-type="png" data-w="1062" style="" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX93nUy8ygV3VTuCtS5JbklneKsTydXmDhy5mwZLYFBb3jIoZk6Q3vR9Q/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(表6.&nbsp;zeRO-DP中的模型状态的显存优化)</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">zeRO-DP，涉及的流量如下：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg" data-imgfileid="100015072" data-ratio="2.0287539936102235" data-s="300,640" data-type="jpeg" data-w="626" style="" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9WziaBrAphicDCPxRkjOoxMpTrjHicyOziaxLtKSXd0nzgV6jdWmWskR8ZA/640?wx_fmt=jpeg&amp;from=appmsg"></p><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（表7.&nbsp;zeRO-DP中三阶段涉及的流量）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）选择性重计算(selective activation recomputationp[2]), 会选择性地重计算部分激活值：只对生成激活值占用空间大、算力要求少的结构进行激活值重计算。相比全计算方案，整体的激活值占用、算力需求进一步优化。限于篇幅原因，不展开介绍；</p><p style="word-break: break-all;white-space: normal;">3）另外，还有序列并行(sequence parallel[2])的技术，也可以优化激活值占用：通过修改张量并行的使用的通信原语，减少3D并行中重复激活值的缓存。限于篇幅原因，不展开介绍；</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>3.4.2.3&nbsp;显存占用评估总结</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">综上，我们可以总结出显存占用情况：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;">模型状态(model states ，约18～20Ψ)：1.参数(2Ψ)、2.梯度(2Ψ)、3.优化器状态(一阶动量&nbsp;、二阶动量、梯度buffer、参数buffer，&nbsp;共计16Ψ)；如果应用zeRO-DP技术后，这部分显存占用会发生如表8的变化:</p><p style="word-break: break-all;"><br></p></li></ul></div><div style="text-align: center;" powered-by="xiumi.us"><p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg" data-imgfileid="100015042" data-ratio="1.0579439252336449" data-s="300,640" data-type="png" data-w="1070" style="width: 336px;height: 355px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9Sc4wOJAib4iaprdTt95g174nCibcXUvKicqLXal8W0ULw7PqiczXiazNgKMA/640?wx_fmt=png&amp;from=appmsg"></p><p><sup>(表8.&nbsp;zeRO-DP优化后的per&nbsp;GPU上的模型状态量)</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;">残差状态(residual states)中主要是激活值占用。激活值占用情况如下表9：</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg" data-cropselx1="0" data-cropselx2="471" data-cropsely1="0" data-cropsely2="427" data-imgfileid="100015043" data-ratio="0.9058823529411765" data-s="300,640" data-type="png" data-w="765" style="width: 471px;height: 427px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX9OUGcItCmWHrBjfjCzJL7niam0aA4GXibHc9o7gaRT0N3oQvChKMxPNzQ/640?wx_fmt=png&amp;from=appmsg"></p><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(表9.&nbsp;LLM训练中的激活值占用情况)</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.5 集群扩展性估算</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.5.1 阿姆达尔定律</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">阿姆达尔定律(Amdahl's law)1967年由美国人阿姆达尔提出，反应了并行运算的效率提升能力。阿姆达尔定律的一种写法是：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;text-align: center;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="255" style="" data-formula="S_{latency(s)} =  \frac{1}{(1-p)+p/s}"><svg xmlns="http://www.w3.org/2000/svg" width="20.283ex" height="3.195ex" role="img" focusable="false" viewBox="0 -864.9 8965.3 1412" aria-hidden="true" style="vertical-align: -1.238ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="53" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="TeXAtom" transform="translate(613, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(298, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(827, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1188, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1654, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2254, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2687, 0)"><path data-c="79" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(3177, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(3566, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(4035, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g><g data-mml-node="mo" transform="translate(4069, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(5124.8, 0)"><g data-mml-node="mn" transform="translate(1743.5, 394) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mrow" transform="translate(220, -370.3) scale(0.707)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(889, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(1667, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(2170, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(2559, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(3337, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3840, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(4340, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g><rect width="3600.5" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span>&nbsp;</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">其中&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="257" style="" data-formula="S_{latency}"><svg xmlns="http://www.w3.org/2000/svg" width="6.583ex" height="2.262ex" role="img" focusable="false" viewBox="0 -705 2909.5 1000" aria-hidden="true" style="vertical-align: -0.667ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="53" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="TeXAtom" transform="translate(613, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(298, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(827, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1188, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1654, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2254, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2687, 0)"><path data-c="79" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></g></g></svg></mjx-container></span>&nbsp;&nbsp;表示的是一个百分比，代表的是整个任务的理论加速比&nbsp;；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">s表示可以通过并技术加速的倍率，例如在训练中对应GPU总数;</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">p表示可以通过并行技术进行加速的任务时间比重；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">(1-p)表示无法通过并行技术进行加速的任务时间比重；</p></li></ul><p style="word-break: break-all;white-space: normal;">该定律的一个关键点在于它明确了：并行系统中的加速比上限取决于系统中无法并行的串行部分，而非并行部分；例如，有个需要单线程执行20小时的任务需要使用多进程的方式来加速。如果该任务中有一个1小时的部分无法被并行执行。这个时候无论怎么去优化整个任务，最终的任务执行时间必然大于1小时；如图17中，有4个任务，每个任务的加速比的阈值上限已经确定，无论增加如何多的进程，只会无限逼近而无法超过该阈值。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014928" data-ratio="0.8234610917537747" data-s="300,640" data-type="png" data-w="861" style="vertical-align: middle;width: 436px;height: 359px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8hJaZwYhv0aqZxLTqex8NAByuxKhxETqkcgyUpmVsLmuASrnb4rHetw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>&nbsp;(图17.&nbsp;&nbsp;阿姆达尔定律示意图，source&nbsp;from&nbsp;[9])</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">那么阿姆达尔定律在当前的大模型算力集群中是怎么应用的呢？</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">假设在模型训练时，其网络通信占比0.05%，这个是无法通过各种并行技术进行加速，可以认为p；而GPU计算占比应该为1 -&nbsp;0.05%=99.95%, 对应公式中的(1-p)；其中有512个模型副本进行数据并行。那么这时加速比&nbsp;= 1 /&nbsp;（0.05%&nbsp;+ 99.95%/512）=407.8：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">这表示相比单卡，如果可并行的部分进行提速512倍的话，整个系统的速度最多能加速到原来的407.8倍；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">此时，如果比较的512张卡受网络制约的情况和 512张卡无制约的情况，最终得到的加速比的407.8/512 =79.6%&nbsp;。即所有GPU在集群中至多发挥79.6%的单卡的算力性能；</p></li></ul><p style="word-break: break-all;white-space: normal;">由此可见，机内、机间互联传输等无法通过并行加速的任务时间，是制约整个集群能力的关键。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.5.2 集群性能评估指标</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">实际上，在LLMs相关算力集群中，我们通常使用两种指标来评估集群性能：Tokens per second per GPU （单卡每秒的Tokens处理量）、FLOPs per second per GPU（单卡每秒的浮点运算量）：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">Tokens per second per GPU ：通过统计一段时间内，模型吃入或生成的Tokens 数量。并且除以集群中的GPU卡数和时间，得到单卡的tokens处理速度；</p></li><li><p style="word-break: break-all;">FLOPs &nbsp;per second per GPU：由于整个模型的算力总量可以预估，此时只需要再获得实际进行模型训练/推理的时间，就可以得到实际的单卡每秒的浮点运算量；</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.5.3 模型训练时间估算</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">根据阿姆达尔定律，由于整个系统中有网络通信等无法并行加速项的存在，集群中存在加速比上限。通常，训练集群中的GPU利用率通常约30%～55%之间[2,3,6]。集群训练耗时计算公式如下：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">未应用激活值重新计算时：</p><p style="word-break: break-all;margin-bottom: 15px;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="259" style="" data-formula="T_{total} = \frac{6*InputTokens总数*模型参数量 }{算力卡数*单卡算力*单卡利用率}=\frac{6*Bs*12lh^2 }{算力卡数* 集群中单卡表现}"><svg xmlns="http://www.w3.org/2000/svg" width="49.364ex" height="3.473ex" role="img" focusable="false" viewBox="0 -1023.5 21818.7 1535.3" aria-hidden="true" style="vertical-align: -1.158ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(846, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1207, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1736, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g><g data-mml-node="mo" transform="translate(2350, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(3405.8, 0)"><g data-mml-node="mrow" transform="translate(220, 481.4) scale(0.707)"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(500, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="49" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g><g data-mml-node="mi" transform="translate(1504, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2104, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(2607, 0)"><path data-c="75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3179, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(3540, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(4244, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(4729, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(5250, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(5716, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(6316, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(6785, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">总</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(8465.5, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(8965.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g></g><g data-mml-node="mrow" transform="translate(659.7, -370.3) scale(0.707)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(3361, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(3861, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text></g><g data-mml-node="mo" transform="translate(7221.9, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(7721.9, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g></g><rect width="9510.2" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(13433.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(14489.6, 0)"><g data-mml-node="mrow" transform="translate(1879.9, 394) scale(0.707)"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(500, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(1759, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(2228, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(2728, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(3728, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(4026, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.792)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(220, -370.3) scale(0.707)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(3361, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(3861, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">集</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">群</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">中</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">表</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">现</text></g></g><rect width="7089.1" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span>&nbsp;<br></p></li><li><p style="word-break: break-all;margin-bottom: 15px;">应用了全激活值重新计算时：</p><p style="word-break: break-all;margin-bottom: 15px;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="261" style="" data-formula="T_{total}= \frac{8*InputTokens数*模型参数量 }{算力卡数*单卡算力*单卡利用率} = \frac{8*Bs*12lh^2 }{算力卡数*集群中单卡表现}"><svg xmlns="http://www.w3.org/2000/svg" width="48.019ex" height="3.473ex" role="img" focusable="false" viewBox="0 -1023.5 21224.5 1535.3" aria-hidden="true" style="vertical-align: -1.158ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(846, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1207, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1736, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g><g data-mml-node="mo" transform="translate(2350, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(3405.8, 0)"><g data-mml-node="mrow" transform="translate(220, 481.4) scale(0.707)"><g data-mml-node="mn"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mo" transform="translate(500, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="49" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g><g data-mml-node="mi" transform="translate(1504, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2104, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(2607, 0)"><path data-c="75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3179, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(3540, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(4244, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(4729, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(5250, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(5716, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(6316, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(6785, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(7625.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(8125.2, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g></g><g data-mml-node="mrow" transform="translate(362.6, -370.3) scale(0.707)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(3361, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(3861, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text></g><g data-mml-node="mo" transform="translate(7221.9, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(7721.9, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g></g><rect width="8916.1" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(12839.7, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(13895.5, 0)"><g data-mml-node="mrow" transform="translate(1879.9, 394) scale(0.707)"><g data-mml-node="mn"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mo" transform="translate(500, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(1759, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(2228, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(2728, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(3728, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(4026, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.792)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(220, -370.3) scale(0.707)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(3361, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(3861, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">集</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">群</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">中</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">表</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">现</text></g></g><rect width="7089.1" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span>&nbsp;</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们代入公式，进行一个试算：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">已知集群中有3072 张 A100&nbsp;卡，假设单卡利用率为50%；如果该集群都用于进行 1Trillion模型的预训练，整个预训练过程中喂入的 Tokens 总数为450B；集群默认开启激活值重计算；</p><p style="word-break: break-all;white-space: normal;">此时套用公式后，得到预训练总时长：</p><p style="word-break: break-all;white-space: normal;"><br></p><p style="text-align: center;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="58" style="" data-formula="\begin{aligned}
&amp;=\frac{8*(450*10^9)*(1000*10^9)}{3072*312*10^{12}}\\
&amp;= 7512019.23sec\\
&amp; = 86.94 days
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="31.481ex" height="11.357ex" role="img" focusable="false" viewBox="0 -2760 13914.4 5020" aria-hidden="true" style="vertical-align: -5.113ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 1186)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(220, 710)"><g data-mml-node="mn"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mo" transform="translate(722.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(1444.4, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(1833.4, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000, 0)"></path></g><g data-mml-node="mo" transform="translate(3555.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(4277.9, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mn" transform="translate(1000, 393.1) scale(0.707)"><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path></g></g><g data-mml-node="mo" transform="translate(5681.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(6292.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(7014.9, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(7403.9, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1500, 0)"></path></g><g data-mml-node="mo" transform="translate(9626.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(10348.3, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mn" transform="translate(1000, 393.1) scale(0.707)"><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path></g></g><g data-mml-node="mo" transform="translate(11751.9, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(2717.4, -824)"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(1000, 0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(1500, 0)"></path></g><g data-mml-node="mo" transform="translate(2222.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(2944.4, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500, 0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(1000, 0)"></path></g><g data-mml-node="mo" transform="translate(4666.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(5388.9, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g></g><rect width="12340.9" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -710)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500, 0)"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(1000, 0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(1500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(2000, 0)"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(2500, 0)"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(3000, 0)"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(3500, 0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(3778, 0)"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(4278, 0)"></path></g><g data-mml-node="mi" transform="translate(6111.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(6580.6, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(7046.6, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, -2010)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500, 0)"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(1000, 0)"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(1278, 0)"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(1778, 0)"></path></g><g data-mml-node="mi" transform="translate(3611.6, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(4131.6, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(4660.6, 0)"><path data-c="79" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(5150.6, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="word-break: break-all;white-space: normal;"><br></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>4.&nbsp;&nbsp;</strong><strong>集群硬件资源试算和实测分析</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">结束了工程化参数的分析和公式推导工作，我们来看下如何通过上述信息来指导硬件选型。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>4.1 硬件资源估算</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">在模型训练中，对算力卡的硬件性能要求较高。目前算力、通信和显存三个方向都存在瓶颈，制约了集群整体表现。并且，不同的软件配置下，整个集群中的显存、通信和算力的压力都是不同的。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>4.1.1 集群规模估算</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">目前，绝大部分卡在16位精度(FP16或BF16)下算力水平都在300TFLOPS左右。所以我们以此为算力卡基准算力，分析当前常见的几种规模的模型需要的卡数：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）GPT3-175B</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们代入paper[4]中175B模型训练任务的预设条件：”使用300B tokens进行训练，总耗时23天“。而此时，我们以单卡300TLOPS作为业界算力卡基准，分析预设条件中需要的卡数：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">之前提到集群中的GPU利用率通常约30%～55%之间，我们设此时集群中的单卡利用率在50%；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">根据3.5.3节的公式，易得单GPU上的算力性能计算公式为：</p></li></ul><p style="text-align: center;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="60" style="" data-formula="\begin{aligned}
&amp;算力卡数\\
&amp; =  \frac{算力总需求}{单卡峰值性能*单卡利用率*时间} \\
&amp; =  \frac{tokens总数*PerToken单参数量的算力需求*模型参数量}{单卡峰值性能*单卡利用率*时间}\\ 
&amp;\\
 &amp;算力卡数_{未开启激活值重计算}\\
&amp; =  \frac{(300*10^{9})*6*(174.6*10^9)}{(300*10^{12})*0.50*(23*24*3600)}\\
&amp;\approx  1057张 

\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="56.453ex" height="29.837ex" role="img" focusable="false" viewBox="0 -6844.1 24952.2 13188.1" aria-hidden="true" style="vertical-align: -14.353ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 6094.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g></g></g><g data-mml-node="mtr" transform="translate(0, 4118.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1055.8, 0)"><g data-mml-node="mrow" transform="translate(4636.5, 676)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">总</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">需</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">求</text></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">峰</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">性</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">能</text></g><g data-mml-node="mo" transform="translate(5319.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(6097, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g><g data-mml-node="mo" transform="translate(10575.9, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(11353.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">间</text></g></g><rect width="13234.2" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, 1482.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(220, 676)"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(846, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(1367, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1833, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2433, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(3179.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">总</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(5138, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(5638, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(6389, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(6855, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(7306, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(8010, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(8495, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(9016, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(9482, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(10359.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">的</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">需</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">求</text></g><g data-mml-node="mo" transform="translate(18199.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(18977.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g></g><g data-mml-node="mrow" transform="translate(5292.2, -710)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">峰</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">性</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">能</text></g><g data-mml-node="mo" transform="translate(5319.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(6097, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g><g data-mml-node="mo" transform="translate(10575.9, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(11353.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">间</text></g></g><rect width="23378.7" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -477.9)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"></g></g><g data-mml-node="mtr" transform="translate(0, -1777.9)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text></g><g data-mml-node="msub" transform="translate(2798.5, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">未</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">开</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">启</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">重</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text></g></g></g></g></g><g data-mml-node="mtr" transform="translate(0, -3970.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(1667.2, 710)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000, 0)"></path></g><g data-mml-node="mo" transform="translate(2111.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(2833.4, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path></g></g></g><g data-mml-node="mo" transform="translate(4237, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(4848.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(5570.4, 0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(6292.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(7014.9, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(7403.9, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(500, 0)"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(1000, 0)"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(1500, 0)"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(1778, 0)"></path></g><g data-mml-node="mo" transform="translate(9904.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(10626.3, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mn" transform="translate(1000, 393.1) scale(0.707)"><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path></g></g><g data-mml-node="mo" transform="translate(12029.9, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -824)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000, 0)"></path></g><g data-mml-node="mo" transform="translate(2111.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(2833.4, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g><g data-mml-node="mo" transform="translate(4590.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(5201.8, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(5924, 0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500, 0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(778, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1278, 0)"></path></g><g data-mml-node="mo" transform="translate(7924.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(8646.4, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(9035.4, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(10257.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(10979.9, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(12202.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(12924.3, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1500, 0)"></path></g><g data-mml-node="mo" transform="translate(14924.3, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><rect width="15513.3" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -6094.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(1000, 0)"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(1500, 0)"></path></g><g data-mml-node="mo" transform="translate(3611.3, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">张</text></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="text-align: center;"><br></p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">由于训练时激活值占用显存空间过大，通常为了节约内存还会开启激活值重计算的技术：1.全激活值重计算虽然能获得特别好的激活值优化表现，但是整体算力需求上升33%; 2.选择性激活值重计算结合序列并行能保持算力和显存之间较好的trade off：在降低5倍激活值占用[2]基础上，只需要提高约5%[2]以内的额外算力开销。因此，我们以训练开启选择性重计算进行预估，需要1110张GPU卡（1057*1.05)；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）LLaMa-65B</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在论文[15]给出了llama 65B模型的训练情况：”使用了1.4T的tokens，训练用时约21天”。我们代入单卡300TFLOPS的算力，分析预设条件中需要的卡数：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">假设此时集群中的单卡利用率在50%。则算力卡数即可如下推导</p></li></ul><p style="text-align: center;">&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="66" style="" data-formula="\begin{aligned}

&amp; 算力卡数_{未开启激活值重计算}\\
&amp; =  \frac{(1.4*10^{12})*6*(65.2*10^9)}{(300*10^{12})*0.5*(21*24*3600)}\\
&amp;\approx 2012 张\\


\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="37.527ex" height="12.027ex" role="img" focusable="false" viewBox="0 -2908.1 16586.9 5316.1" aria-hidden="true" style="vertical-align: -5.448ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 2158.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text></g><g data-mml-node="msub" transform="translate(2798.5, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">未</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">开</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">启</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">重</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text></g></g></g></g></g><g data-mml-node="mtr" transform="translate(0, -34.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(1601.4, 710)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500, 0)"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(778, 0)"></path></g><g data-mml-node="mo" transform="translate(1889.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(2611.4, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g><g data-mml-node="mo" transform="translate(4368.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(4979.8, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(5702, 0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(6424.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(7146.4, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(7535.4, 0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500, 0)"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(1000, 0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(1278, 0)"></path></g><g data-mml-node="mo" transform="translate(9535.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(10257.9, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mn" transform="translate(1000, 393.1) scale(0.707)"><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path></g></g><g data-mml-node="mo" transform="translate(11661.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -824)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000, 0)"></path></g><g data-mml-node="mo" transform="translate(2111.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(2833.4, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g><g data-mml-node="mo" transform="translate(4590.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(5201.8, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(5924, 0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500, 0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(778, 0)"></path></g><g data-mml-node="mo" transform="translate(7424.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(8146.4, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(8535.4, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(9757.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(10479.9, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(11702.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(12424.3, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1500, 0)"></path></g><g data-mml-node="mo" transform="translate(14424.3, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><rect width="15013.3" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -2158.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(1000, 0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(1500, 0)"></path></g><g data-mml-node="mo" transform="translate(3611.3, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">张</text></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="text-align: center;"><br></p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">我们依然假设集群采用选择性激活值重计算和序列并行，那么需要的GPU数量为2113张(2012*1.05)；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3)&nbsp; LLaMa-13B</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">[15]中给出了13B的模型是1T的tokens来训练，在此基础上如果我们假设需要15天来完成训练，则需要的算力卡数量为：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">假设集群中单卡利用率在50%，则卡数计算方法如下<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p></li></ul><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="1" style="" data-formula="\begin{aligned}

&amp; 算力卡数_{未开启激活值重计算}\\
&amp; =  \frac{(1*10^{12})*6*(13.0*10^9)}{(300*10^{12})*0.5*(15*24*3600)}\\
&amp;\approx 402 张\\


\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="37.527ex" height="12.027ex" role="img" focusable="false" viewBox="0 -2908.1 16586.9 5316.1" aria-hidden="true" style="vertical-align: -5.448ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 2158.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text></g><g data-mml-node="msub" transform="translate(2798.5, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">未</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">开</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">启</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">重</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text></g></g></g></g></g><g data-mml-node="mtr" transform="translate(0, -34.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(1990.4, 710)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1111.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(1833.4, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g><g data-mml-node="mo" transform="translate(3590.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(4201.8, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(4924, 0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(5646.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(6368.4, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(6757.4, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500, 0)"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(1000, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1278, 0)"></path></g><g data-mml-node="mo" transform="translate(8757.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(9479.9, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mn" transform="translate(1000, 393.1) scale(0.707)"><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path></g></g><g data-mml-node="mo" transform="translate(10883.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -824)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000, 0)"></path></g><g data-mml-node="mo" transform="translate(2111.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(2833.4, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g><g data-mml-node="mo" transform="translate(4590.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(5201.8, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(5924, 0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500, 0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(778, 0)"></path></g><g data-mml-node="mo" transform="translate(7424.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(8146.4, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(8535.4, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(9757.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(10479.9, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(11702.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(12424.3, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1500, 0)"></path></g><g data-mml-node="mo" transform="translate(14424.3, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><rect width="15013.3" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -2158.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(1000, 0)"></path></g><g data-mml-node="mo" transform="translate(3111.3, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">张</text></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;">我们依然假设集群采用选择性激活值重计算和序列并行，所以13B模型需要约422张卡(402*1.05)；</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>4.1.2 显存占用估算</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">根据3.4.2.3 小结中的计算公式，我们可以计算出显存的占用情况。整个GPU显存占用可以份为2个部分：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">1. 单GPU模型状态：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p></li></ul><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="4" style="" data-formula="\begin{aligned}
&amp;<1>.模型状态缓存_{无zeRO优化} = \frac{20*模型参数量}{p*t}\\
&amp;<2>.模型状态缓存_{zeroStage1} = \frac{4+16*模型参数量/d}{p*t}\\
&amp;<3>.模型状态缓存_{zeroStage2} = \frac{2+18*模型参数量/d}{p*t}\\
&amp;<4>.模型状态缓存_{zeroStage3} = \frac{20*模型参数量/d}{p*t}\\
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="50.557ex" height="23.136ex" role="img" focusable="false" viewBox="0 -5363 22346.3 10226" aria-hidden="true" style="vertical-align: -11.002ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 3937)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mo" transform="translate(3334, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">状</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">态</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">缓</text></g><g data-mml-node="msub" transform="translate(7535.2, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">存</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">无</text></g><g data-mml-node="mi" transform="translate(840.2, 0)"><path data-c="7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="mi" transform="translate(1305.2, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1771.2, 0)"><path data-c="52" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path></g><g data-mml-node="mi" transform="translate(2530.2, 0)"><path data-c="4F" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path></g><g data-mml-node="mo" transform="translate(3293.2, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">优</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">化</text></g></g></g><g data-mml-node="mo" transform="translate(11942.4, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(12998.1, 0)"><g data-mml-node="mrow" transform="translate(220, 676)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(1000, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(1777.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g></g><g data-mml-node="mrow" transform="translate(2305.3, -686)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(725.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1447.4, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="6179" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, 1297)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mo" transform="translate(3334, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">状</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">态</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">缓</text></g><g data-mml-node="msub" transform="translate(7535.2, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">存</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="mi" transform="translate(465, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(931, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1382, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1867, 0)"><path data-c="53" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mi" transform="translate(2512, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(2873, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3402, 0)"><path data-c="67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mi" transform="translate(3879, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mn" transform="translate(4345, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g><g data-mml-node="mo" transform="translate(11851.4, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(12907.1, 0)"><g data-mml-node="mrow" transform="translate(220, 710)"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(722.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(1722.4, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(2722.4, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(3500.2, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(7979.2, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(8479.2, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g><g data-mml-node="mrow" transform="translate(3815.4, -686)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(725.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1447.4, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="9199.2" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -1343)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mo" transform="translate(3334, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">状</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">态</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">缓</text></g><g data-mml-node="msub" transform="translate(7535.2, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">存</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="mi" transform="translate(465, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(931, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1382, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1867, 0)"><path data-c="53" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mi" transform="translate(2512, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(2873, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3402, 0)"><path data-c="67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mi" transform="translate(3879, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mn" transform="translate(4345, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mo" transform="translate(11851.4, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(12907.1, 0)"><g data-mml-node="mrow" transform="translate(220, 710)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(722.2, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(1722.4, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(2722.4, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(3500.2, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(7979.2, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(8479.2, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g><g data-mml-node="mrow" transform="translate(3815.4, -686)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(725.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1447.4, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="9199.2" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -3983)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mo" transform="translate(3334, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">状</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">态</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">缓</text></g><g data-mml-node="msub" transform="translate(7535.2, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">存</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="mi" transform="translate(465, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(931, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1382, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1867, 0)"><path data-c="53" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mi" transform="translate(2512, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(2873, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3402, 0)"><path data-c="67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mi" transform="translate(3879, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mn" transform="translate(4345, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g></g></g><g data-mml-node="mo" transform="translate(11851.4, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(12907.1, 0)"><g data-mml-node="mrow" transform="translate(220, 710)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(1000, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(1777.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(6256.7, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(6756.7, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g><g data-mml-node="mrow" transform="translate(2954.1, -686)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(725.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1447.4, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="7476.7" height="60" x="120" y="220"></rect></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">2. 单GPU激活值缓存：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p></li></ul><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="13" style="" data-formula="\begin{aligned}
<1>.&amp;激活值_{无重计算} = b*s*h*l*(10+24/t+ \frac{5*a*s}{h*t} )\\ 

&amp;\\<2>.&amp;激活值_{(选择性重计算+序列并行)}= b*s*h*l*34/t  \\
&amp;\\<3>.&amp;激活值_{全激活值重计算} = 2b*s*h \\
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="55.726ex" height="16.766ex" role="img" focusable="false" viewBox="0 -3955.3 24630.9 7410.7" aria-hidden="true" style="vertical-align: -7.817ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 2613.3)"><g data-mml-node="mtd"><g data-mml-node="mo"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1055.8, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1833.6, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2611.6, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(2889.6, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text></g><g data-mml-node="msub" transform="translate(1958.3, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">无</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">重</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text></g></g></g><g data-mml-node="mo" transform="translate(5225, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(6280.8, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(6932, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(7654.3, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(8345.5, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(9067.7, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(9865.9, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(10588.2, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mo" transform="translate(11108.4, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(11830.6, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(12219.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(13441.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(14442, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(15442, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(15942, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(16525.3, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mfrac" transform="translate(17525.5, 0)"><g data-mml-node="mrow" transform="translate(220, 676)"><g data-mml-node="mn"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mo" transform="translate(722.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1444.4, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(2195.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(2917.9, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g><g data-mml-node="mrow" transform="translate(972.7, -686)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(798.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1520.4, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="3586.9" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(21352.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, 866.3)"><g data-mml-node="mtd" transform="translate(2889.6, 0)"></g><g data-mml-node="mtd" transform="translate(2889.6, 0)"></g></g><g data-mml-node="mtr" transform="translate(0, -433.7)"><g data-mml-node="mtd"><g data-mml-node="mo"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1055.8, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(1833.6, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2611.6, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(2889.6, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text></g><g data-mml-node="msub" transform="translate(1958.3, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(389, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">选</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">择</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">性</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">重</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text></g><g data-mml-node="mo" transform="translate(5430.4, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mo" transform="translate(6208.4, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">序</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">列</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">并</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">行</text></g><g data-mml-node="mo" transform="translate(9569.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g><g data-mml-node="mo" transform="translate(9890.1, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(10945.9, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(11597.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(12319.3, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(13010.6, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(13732.8, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(14531, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(15253.2, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mo" transform="translate(15773.5, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(16495.7, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(17495.7, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(17995.7, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, -1837.2)"><g data-mml-node="mtd" transform="translate(2889.6, 0)"></g><g data-mml-node="mtd" transform="translate(2889.6, 0)"></g></g><g data-mml-node="mtr" transform="translate(0, -3137.2)"><g data-mml-node="mtd"><g data-mml-node="mo"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1055.8, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(1833.6, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2611.6, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(2889.6, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text></g><g data-mml-node="msub" transform="translate(1958.3, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">全</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">激</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">活</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">值</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">重</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text></g></g></g><g data-mml-node="mo" transform="translate(7007.5, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(8063.2, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(8563.2, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(9214.5, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(9936.7, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(10627.9, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(11350.1, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">整个GPU的显存占用，等于模型状态和激活值缓存。由于当前zeRO3对于系统的通信损耗过大，目前训练主流还是zeRO1或zeRO2。我们也将试算单卡显存占用2种典型值：1.有zeRO1的3D并行&nbsp;+&nbsp;选择性重新计算+序列并行；2.无zeRO的3D并行+无激活值重计算：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们对于各种模型进行配置敲定：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）llama&nbsp;13B</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在上一小节中，已经计算出llama 13B在使用1T tokens、用15天完成训练时，需要约300TFLOPS的算力卡约422张。根据[16],13B模型的常见并行度是t=2，p=1。为了3D并行度和机器数量凑整，我们令GPU总数为424: t=2、p=1、d=212。此外，B需要是b*d倍数，所以我们可以令B=1272、b=1、s=4096；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）llama&nbsp;65B:</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">上一小节中&nbsp;，已经计算出65B的模型在使用1.4T tokens、用21天完成训练时，使用2113张卡。而目前65B一个推荐并行度是t=4，p=4。为了3D并行度和机器数量凑整，我们令GPU总数为2112：t=4、p=4、d=132。再根据限制条件B需要是b*d倍数，设B=2112、b=1、s=2048；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3）GPT-175B</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">根据[2,4]，目前175B中的TP并行度、PP并行度通常设为(t=8，p=8)或者(t=8，p=16)。我们以(t=8，p=8)为例，原定总卡数为1110，为3D并行和机器数量凑整，可设整个集群卡数为1152张(t=8，p=8，d=18)。B=1152、s=2048：由于流线型中micro-batch份数需要为整数，所以我们令B为1152；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;white-space: normal;">此外，我们给出机器数量不变时，3种并行度变化下的显存计算结果进行参考&nbsp;:&nbsp;由于3种并行中dp通信开销最少，优先考虑高dp并行度下进行tp和pp的变换，结果见表10：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014931" data-ratio="0.46111111111111114" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 578px;height: 267px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8ZwdyEugR33qjicbuE5RgSiczTc2xkDOSNTb6tz4kMbnMJQrQzfqibpQTg/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>(表10.&nbsp;LLMs显存占用试算表)</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">由上表可见，</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">要支持相应规模的模型训练，以常见的zeRO1+选择性重计算为例，单张算力卡的显存占用在30-80GB之间。表格中有些并行度下的显存占用较小，但不具备参考意义，是因为这些并行度下已经达到了通信瓶颈，我们将在4.1.3中的表格中详细说明。此外，由于不同的AI框架的显存优化效果不同，在增大batch size时实际显存占用可能要比上表要大；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">需要额外说明的是，在模型规模上升时，单卡的显存需求并没有显著上升：因为单个模型副本的显存占用虽然增大了，但是相应地我们使用了更大的TP、PP的并行度&nbsp;，这使得每个GPU上的模型参数量和其显存占用并没有明显上升；</p></li><li><p style="word-break: break-all;">此外，若在GPU显存大小确定时，我们还可以通过本节的显存计算公式反推出合适的并行度参数。限于篇幅，不做展开；</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>4.1.3&nbsp; 通信需求预估</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>4.1.3.1&nbsp;通信瓶颈估算方法</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">一、确定LLM中的通信瓶颈</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在LLM训练集群中，每个GPU持续在做3件事情：1.从关联的GPU接收到运算所需要的数据、2.使用数据，进行计算&nbsp;、3.计算生成的数据发送给下一个关联GPU。从这个角度来看，每个GPU都像是工厂流水线上的自动化机器人：每个机器人需要从相邻机器人处拿到待处理工件，加工后并把完成工件传递给下一个机器人继续加工。所以，每个机器人获取工件的速度需跟得上其加工速度，否则就会出现异常等待、最终导致工厂整体效率下降；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">回到GPU本身，此时可以发现存在类似道理：如果每个GPU通信和计算之间可以完全同步，那么集群是最高效的。&nbsp;但是，真的可以做到通信和计算两种资源之间的同步进行吗？</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">答案是不能的。观察下TP、PP和DP三种技术，分析3D并行中的真实的计算和通信流程：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）DP</p><p style="word-break: break-all;white-space: normal;">DP中的梯度同步是发生在每次迭代的前后向传播后进行的，如图18。也就是说标准情况下，DP中的通信需要前后向计算都结束后才能开始。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014929" data-ratio="1.2297297297297298" data-s="300,640" data-type="png" data-w="888" style="vertical-align: middle;width: 251px;height: 309px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8icIT8WiaUgrDUMM4PlByjB8qmqZhmHWUzeNncBibeYJZYHgLfMdJT32kQ/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（图18.&nbsp;简单数据并行示意图,&nbsp;source&nbsp;from&nbsp;[13]）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">但实际上，根据神经网络的链式求导原理：在反向传播开始时，最后一层往前的梯度数据就在同时进行了。所以在DP上有overlap的优化(如图19)：梯度allreduce几乎和反向传播同时进行。那么只要保证梯度allreduce的时间能够被反向传播时间所包含，整个集群就是高效无阻塞的。目前非大模型领域，已有些类似的优化方式(如[14])；但大模型领域若开启3D并行后情况比较复杂：涉及到多个物理副本和逻辑副本，所以目前没有采用这种overlap方式。当前，DP维度的梯度同步，主要还是等前/后向传输完毕后才进行的。</p><p style="word-break: break-all;white-space: normal;">因此，我们在3D并行中，通常对于DP上梯度allreduce的通信可以要求固定占比对应计算时间(例如5%)。如果这个比率过大，根据阿姆达尔定律，整个集群的利用率将变低。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014930" data-ratio="0.44907407407407407" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 474px;height: 213px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8lX6YOvPNboBRZaQjddM2Xo7oPT3RZZib1DPojwibLDQcdhuiaXVduT9Hw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（图19.&nbsp;简单数据并行中的通信overlap示意图,&nbsp;source&nbsp;from&nbsp;[14]）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）PP</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">PP中所产生的通信理论上是可以overlap的。如图8所示：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">前向传播中，每个PP stage的GPU上产生的激活值数据可以在下一个计算流程(即反向传播时)发送给下一个PP stage的GPU；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">反向传播中，每个PP stage的GPU上产生的激活值偏导数据可以在下一个计算流程(即前向传播时)发送给上一个PP stage的GPU；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">而表4展示了，每个GPU在PP 上引入的通信量为一次迭代前、后向分别传输&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="277" style="" data-formula="\frac{bsh}{t}参数"><svg xmlns="http://www.w3.org/2000/svg" width="7.784ex" height="2.8ex" role="img" focusable="false" viewBox="0 -884.7 3440.5 1237.5" aria-hidden="true" style="vertical-align: -0.798ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 394) scale(0.707)"><g data-mml-node="mi"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(429, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(898, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g><g data-mml-node="mi" transform="translate(613.5, -345) scale(0.707)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><rect width="1242.3" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1760.1, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g></g></g></svg></mjx-container></span>&nbsp;。只要带宽足够，这部分通信时间能够被前、后向传播时间cover，整个集群就是高效无拥塞的；但并不是所有的PP都是采用的overlap的方式来进行通信传输的，我们还需要保证每次通信时间不超过相关计算时间的一个时间占比&nbsp;，以保证非overlap技术方案中的高效性；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3）TP</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">TP中通信和计算无法overlap。attention和mlp中都是需要等待计算结束后，才能通过通信原语进行数据同步。所以我们可以设定每次通信时间不超过相关计算时间的期望比值，如5%&nbsp;；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">综上，我们可以发现：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">对于确定可以overlap到计算时间段中的通信任务，我们仅需要其耗时小于计算的耗时。从而确定最小的通信带宽要求；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">对于无法overlap到计算中的通信，我们可以设定一个预期的计算通信耗时占比，例如5%。从而预估出最小的通信带宽要求；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">二、计算各种并行中的带宽需求</p><p style="word-break: break-all;white-space: normal;">结合表3, 我们可以估算训练时，perGPU上每个迭代中的通信情况：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;" powered-by="xiumi.us"><p><br></p></div><p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg" data-imgfileid="100015050" data-ratio="0.8953703703703704" data-s="300,640" data-type="jpeg" data-w="1080" style="" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Sj4nibtRCDSsqspDJs0tPX968lojRjZMnu3QGLr1L5uT20sS5ibJauRuWqz2hmrlYxt0Px65B6ReqA/640?wx_fmt=jpeg&amp;from=appmsg"></p><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（表11.&nbsp;LLM训练中per&nbsp;GPU通信量）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">注：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">应用sequence parallel(SP)时，在NV集群中真实通信量保持不变：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">无SP时：单个micro-batch可认为需要4次集合通信，每次都是关于参数量&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="279" style="" data-formula="bsh*l_{local}"><svg xmlns="http://www.w3.org/2000/svg" width="9.527ex" height="1.927ex" role="img" focusable="false" viewBox="0 -694 4211.1 851.8" aria-hidden="true" style="vertical-align: -0.357ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(429, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(898, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(1696.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msub" transform="translate(2418.4, 0)"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" transform="translate(298, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(298, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(783, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(1216, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1745, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g></g></g></svg></mjx-container></span>&nbsp;进行allreduce；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">有SP时：单个micro-batch可认为需要8次集合通信，每次都是关于参数量&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="281" style="" data-formula="bsh*l_{local}"><svg xmlns="http://www.w3.org/2000/svg" width="9.527ex" height="1.927ex" role="img" focusable="false" viewBox="0 -694 4211.1 851.8" aria-hidden="true" style="vertical-align: -0.357ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(429, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(898, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(1696.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msub" transform="translate(2418.4, 0)"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" transform="translate(298, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(298, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(783, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(1216, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1745, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g></g></g></svg></mjx-container></span>&nbsp;进行4次reduce-scatter、4次allgather: 1）前向，attention前、mlp前分别进行allgather；attention后、mlp后分别进行reduce-scatter；2）反向，attention后、mlp后分别进行allgather；attention前、mlp前分别进行reduce-scatter；</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">根据表5得，在NCCL中Ring/Tree算法中关于t个节点的allreduce通信冗余率为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="283" style="" data-formula="\frac{2(t-1)}{t}"><svg xmlns="http://www.w3.org/2000/svg" width="5.662ex" height="3.167ex" role="img" focusable="false" viewBox="0 -1047.1 2502.6 1399.9" aria-hidden="true" style="vertical-align: -0.798ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 516.8) scale(0.707)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(500, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(889, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(1250, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(2028, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2528, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mi" transform="translate(1123.7, -345) scale(0.707)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><rect width="2262.6" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span>&nbsp;，关于t的allgather和reduce-scatter各为&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="285" style="" data-formula="\frac{t-1}{t}"><svg xmlns="http://www.w3.org/2000/svg" width="3.618ex" height="2.764ex" role="img" focusable="false" viewBox="0 -868.9 1598.9 1221.7" aria-hidden="true" style="vertical-align: -0.798ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 398) scale(0.707)"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(361, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(1139, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mi" transform="translate(671.8, -345) scale(0.707)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><rect width="1358.9" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span>&nbsp;。</p><p style="word-break: break-all;white-space: normal;">因此从通信量上看，在NV集群中开SP前后的TP上通信量不变。</p></div></div></div></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">另外，我们还可以进一步分析各种并行度下的带宽需求和参数间的关系：</p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">&nbsp;TP：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p></li></ol><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="19" style="" data-formula="\begin{aligned}
TP带宽需求
&amp;=  \frac{数据量}{通信耗时} \\
&amp;=  \frac{TP通信量_{单microbatch}}{单microbatchTP计算耗时*经验的期望比率} \\
&amp;= \frac{单次通信量*次数}{ \frac{tokens数量*单GPU模型size}{GPU利用率*单卡算力性能}*期望耗时占比 } \\
&amp;= \frac{(4bshl/p)}{ \frac{(bs)*((6至8)*\frac{12lh^2}{pt} )}{GPU利用率*单卡算力性能}*期望耗时占比 } \\
&amp;= \frac{4t}{ \frac{((6至8)*12h )}{GPU利用率*单卡算力性能}*期望耗时占比 } \\
&amp;= \frac{C*t}{h} (其中C为常数)
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="56.417ex" height="39.847ex" role="img" focusable="false" viewBox="0 -9056.2 24936.2 17612.4" aria-hidden="true" style="vertical-align: -19.358ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 7630.2)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(704, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1732.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">带</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">宽</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">需</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">求</text></g></g><g data-mml-node="mtd" transform="translate(5093.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1055.8, 0)"><g data-mml-node="mrow" transform="translate(640.1, 676)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">据</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g></g><rect width="3561" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, 4892.1)"><g data-mml-node="mtd" transform="translate(5093.7, 0)"></g><g data-mml-node="mtd" transform="translate(5093.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(5066.2, 778.2)"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(704, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1732.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text></g><g data-mml-node="msub" transform="translate(3413.3, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(840.2, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1718.2, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2063.2, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2496.2, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2947.2, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3432.2, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3861.2, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(4390.2, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(4751.2, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5184.2, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(1118, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1996, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2341, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2774, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3225, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3710, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4139, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(4668, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5029, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5462, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(6038, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(6742, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(7770.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g><g data-mml-node="mo" transform="translate(11409.5, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(12187.3, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">经</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">验</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">的</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g></g><rect width="18269" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, 2256.1)"><g data-mml-node="mtd" transform="translate(5093.7, 0)"></g><g data-mml-node="mtd" transform="translate(5093.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(4000.7, 676)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(4479, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5256.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g></g><g data-mml-node="mrow" transform="translate(220, -971.8)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 481.4) scale(0.707)"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(846, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(1367, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1833, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2433, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(2902, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(4582.5, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5082.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(5922.7, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(6708.7, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(7459.7, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(8226.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text></g><g data-mml-node="mi" transform="translate(9907.2, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(10376.2, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(10721.2, 0)"><path data-c="7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="mi" transform="translate(11186.2, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g><g data-mml-node="mrow" transform="translate(674.7, -370.3) scale(0.707)"><g data-mml-node="mi"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(786, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(1537, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(2304, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g><g data-mml-node="mo" transform="translate(4824.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5324.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">性</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">能</text></g></g><rect width="8439.3" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(8679.3, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(9457.1, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text></g></g><rect width="14698.5" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -987.4)"><g data-mml-node="mtd" transform="translate(5093.7, 0)"></g><g data-mml-node="mtd" transform="translate(5093.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(4988.1, 710)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(889, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(1318, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(1787, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(2363, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2661, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(3161, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(3664, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -1507.2)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(904.1, 692.6) scale(0.707)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(389, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(818, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(1287, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(1676, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(2176, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(2565, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(2954, 0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(3454, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">至</text></g><g data-mml-node="mn" transform="translate(4294.2, 0)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mo" transform="translate(4794.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(5183.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mfrac" transform="translate(5683.2, 0)"><g data-mml-node="mrow" transform="translate(220, 394) scale(0.792)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(837.5, -345) scale(0.792)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="2119" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(8042.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -370.3) scale(0.707)"><g data-mml-node="mi"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(786, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(1537, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(2304, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g><g data-mml-node="mo" transform="translate(4824.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5324.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">性</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">能</text></g></g><rect width="7530" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(7770, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(8547.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text></g></g><rect width="13789.2" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -4659.4)"><g data-mml-node="mtd" transform="translate(5093.7, 0)"></g><g data-mml-node="mtd" transform="translate(5093.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(6584.1, 676)"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -1007.1)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(1950.3, 516.8) scale(0.707)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(389, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(778, 0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(1278, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">至</text></g><g data-mml-node="mn" transform="translate(2118.2, 0)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mo" transform="translate(2618.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(3007.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(3507.2, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(4507.2, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(5083.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -370.3) scale(0.707)"><g data-mml-node="mi"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(786, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(1537, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(2304, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g><g data-mml-node="mo" transform="translate(4824.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5324.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">性</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">能</text></g></g><rect width="7530" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(7770, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(8547.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text></g></g><rect width="13789.2" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -7859.2)"><g data-mml-node="mtd" transform="translate(5093.7, 0)"></g><g data-mml-node="mtd" transform="translate(5093.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(220, 676)"><g data-mml-node="mi"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(982.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1704.4, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><g data-mml-node="mi" transform="translate(964.7, -686)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><rect width="2265.4" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(3839, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(4228, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">其</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">中</text></g><g data-mml-node="mi" transform="translate(6186.3, 0)"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(7224, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">为</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">常</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(9744.7, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">可以发现，TP中通信带宽压力的公式和t成正比，和h成反比：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1）在模型变大时，h是逐渐变大的:&nbsp;当张量并行度t固定时，TP带宽要求是随模型规模变大逐步变小的。例如，175B和1T模型训练中，一般都使用t=8，而1T模型中的h更大，所以1T模型的TP上的带宽压力比175B的要小；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2）在现实中，我们在模型中通常使用尽量小的t和p。这是因为TP和PP中的通信开销较为昂贵：TP通信频率最大，TP的通信频率是和b、s、h、l都有关系的。PP通信和b、s、h相关。而DP通信只和s、h有关；另外，由于TP间集合通信在通信量不变的情况下，NCCL集合通信冗余率是&nbsp;<span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="289" style="" data-formula="\frac{2(t-1)}{t}"><svg xmlns="http://www.w3.org/2000/svg" width="5.662ex" height="3.167ex" role="img" focusable="false" viewBox="0 -1047.1 2502.6 1399.9" aria-hidden="true" style="vertical-align: -0.798ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 516.8) scale(0.707)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(500, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(889, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(1250, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(2028, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2528, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mi" transform="translate(1123.7, -345) scale(0.707)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><rect width="2262.6" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span>&nbsp;，在t越小时真实的通信量越小，所以t会倾向取小。例如在175B、65B、13B模型上，TP并行度(t)通常分别为8、4和2。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2. &nbsp;PP：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="25" style="" data-formula="\begin{aligned}
PP带宽需求
&amp;=  \frac{数据量}{通信耗时} \\
&amp;=  \frac{PP通信量_{单microbatch}}{单microbatchPP计算耗时*经验的期望比率} \\
&amp;= \frac{单次通信量*次数}{ \frac{tokens数量*单GPU模型size}{GPU利用率*单卡算力性能}*期望耗时占比 } \\
&amp;= \frac{(2bsh/t)}{ \frac{(bs)*((6至8)*\frac{12lh^2}{pt} )}{GPU利用率*单卡算力性能}*期望耗时占比 } \\
&amp;= \frac{C}{ \frac{l}{p}*h}  (其中C为常数)
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="56.63ex" height="34.096ex" role="img" focusable="false" viewBox="0 -7785.2 25030.2 15070.5" aria-hidden="true" style="vertical-align: -16.482ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 6359.2)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(751, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1779.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">带</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">宽</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">需</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">求</text></g></g><g data-mml-node="mtd" transform="translate(5140.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1055.8, 0)"><g data-mml-node="mrow" transform="translate(640.1, 676)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">据</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g></g><rect width="3561" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, 3621.1)"><g data-mml-node="mtd" transform="translate(5140.7, 0)"></g><g data-mml-node="mtd" transform="translate(5140.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(5066.2, 778.2)"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(751, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1779.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text></g><g data-mml-node="msub" transform="translate(3460.3, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(840.2, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1718.2, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2063.2, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2496.2, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2947.2, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3432.2, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3861.2, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(4390.2, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(4751.2, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5184.2, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(1118, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1996, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2341, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2774, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3225, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3710, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4139, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(4668, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5029, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5462, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(6038, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(6789, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(7817.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g><g data-mml-node="mo" transform="translate(11456.5, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(12234.3, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">经</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">验</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">的</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g></g><rect width="18316" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, 985.1)"><g data-mml-node="mtd" transform="translate(5140.7, 0)"></g><g data-mml-node="mtd" transform="translate(5140.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(4000.7, 676)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(4479, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5256.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g></g><g data-mml-node="mrow" transform="translate(220, -971.8)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 481.4) scale(0.707)"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(846, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(1367, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1833, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2433, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(2902, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(4582.5, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5082.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(5922.7, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(6708.7, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(7459.7, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(8226.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text></g><g data-mml-node="mi" transform="translate(9907.2, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(10376.2, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(10721.2, 0)"><path data-c="7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="mi" transform="translate(11186.2, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g><g data-mml-node="mrow" transform="translate(674.7, -370.3) scale(0.707)"><g data-mml-node="mi"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(786, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(1537, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(2304, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g><g data-mml-node="mo" transform="translate(4824.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5324.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">性</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">能</text></g></g><rect width="8439.3" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(8679.3, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(9457.1, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text></g></g><rect width="14698.5" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -2258.4)"><g data-mml-node="mtd" transform="translate(5140.7, 0)"></g><g data-mml-node="mtd" transform="translate(5140.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(5208.1, 710)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(889, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(1318, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(1787, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2363, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(2863, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(3224, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -1507.2)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(904.1, 692.6) scale(0.707)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(389, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(818, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(1287, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(1676, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(2176, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(2565, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(2954, 0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(3454, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">至</text></g><g data-mml-node="mn" transform="translate(4294.2, 0)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mo" transform="translate(4794.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(5183.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mfrac" transform="translate(5683.2, 0)"><g data-mml-node="mrow" transform="translate(220, 394) scale(0.792)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(837.5, -345) scale(0.792)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="2119" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(8042.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -370.3) scale(0.707)"><g data-mml-node="mi"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(786, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(1537, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(2304, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g><g data-mml-node="mo" transform="translate(4824.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5324.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">性</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">能</text></g></g><rect width="7530" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(7770, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(8547.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text></g></g><rect width="13789.2" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -5958.3)"><g data-mml-node="mtd" transform="translate(5140.7, 0)"></g><g data-mml-node="mtd" transform="translate(5140.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mi" transform="translate(998.1, 676)"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mrow" transform="translate(220, -844.7)"><g data-mml-node="mfrac"><g data-mml-node="mi" transform="translate(292.5, 394) scale(0.707)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(220, -345) scale(0.707)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><rect width="555.7" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1017.9, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1740.1, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g><rect width="2516.1" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(4089.7, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(4478.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">其</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">中</text></g><g data-mml-node="mi" transform="translate(6436.9, 0)"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(7474.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">为</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">常</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(9995.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">可以发现，PP带宽压力和每个PP stage上存在的transformer block数(l/p)成反比，和h也成反比；当模型越大时，若每个PP stage上的blocks数量不变，那么其通信压力不变；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3. &nbsp;DP：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="31" style="" data-formula="\begin{aligned}
DP带宽需求
&amp;=  \frac{数据量}{通信耗时} \\
&amp;=  \frac{DP通信量_{单迭代}}{单迭代计算耗时*经验的期望比率} \\
&amp;= \frac{单次通信量*次数}{ \frac{tokens数量*单GPU模型size}{GPU利用率*单卡算力性能}*期望耗时占比 } \\
&amp;= \frac{ \frac{12lh^2}{pt}*1}{ \frac{(bs)*((6至8)*\frac{12lh^2}{pt}* \frac{B}{bd}  )}{GPU利用率*单卡算力性能}*期望耗时占比 } \\
&amp;= \frac{C*d}{ Bs}  (其中C为常数)
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="48.62ex" height="33.813ex" role="img" focusable="false" viewBox="0 -7722.6 21489.8 14945.3" aria-hidden="true" style="vertical-align: -16.341ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 6296.6)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="44" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(828, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1856.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">带</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">宽</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">需</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">求</text></g></g><g data-mml-node="mtd" transform="translate(5217.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1055.8, 0)"><g data-mml-node="mrow" transform="translate(640.1, 676)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">据</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g></g><rect width="3561" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, 3558.5)"><g data-mml-node="mtd" transform="translate(5217.7, 0)"></g><g data-mml-node="mtd" transform="translate(5217.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(3524.5, 778.2)"><g data-mml-node="mi"><path data-c="44" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(828, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1856.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text></g><g data-mml-node="msub" transform="translate(3537.3, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">迭</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">代</text></g></g></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">迭</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">代</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g><g data-mml-node="mo" transform="translate(6159.4, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(6937.2, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">经</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">验</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">的</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g></g><rect width="13018.9" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, 922.5)"><g data-mml-node="mtd" transform="translate(5217.7, 0)"></g><g data-mml-node="mtd" transform="translate(5217.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(4000.7, 676)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(4479, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5256.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g></g><g data-mml-node="mrow" transform="translate(220, -971.8)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 481.4) scale(0.707)"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(846, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(1367, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1833, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2433, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(2902, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(4582.5, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5082.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(5922.7, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(6708.7, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(7459.7, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(8226.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text></g><g data-mml-node="mi" transform="translate(9907.2, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(10376.2, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(10721.2, 0)"><path data-c="7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="mi" transform="translate(11186.2, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g><g data-mml-node="mrow" transform="translate(674.7, -370.3) scale(0.707)"><g data-mml-node="mi"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(786, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(1537, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(2304, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g><g data-mml-node="mo" transform="translate(4824.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5324.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">性</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">能</text></g></g><rect width="8439.3" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(8679.3, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(9457.1, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text></g></g><rect width="14698.5" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -2826.7)"><g data-mml-node="mtd" transform="translate(5217.7, 0)"></g><g data-mml-node="mtd" transform="translate(5217.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(5252.2, 942.2)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 394) scale(0.707)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.792)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(734.7, -345) scale(0.707)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="1840.4" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2302.6, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(3024.8, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -1507.2)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(306.1, 692.6) scale(0.707)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(389, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(818, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(1287, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(1676, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(2176, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(2565, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(2954, 0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(3454, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">至</text></g><g data-mml-node="mn" transform="translate(4294.2, 0)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mo" transform="translate(4794.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(5183.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mfrac" transform="translate(5683.2, 0)"><g data-mml-node="mrow" transform="translate(220, 394) scale(0.792)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(837.5, -345) scale(0.792)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="2119" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(8042.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mfrac" transform="translate(8542.2, 0)"><g data-mml-node="mi" transform="translate(295.2, 394) scale(0.792)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mrow" transform="translate(220, -389.4) scale(0.792)"><g data-mml-node="mi"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(429, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g><rect width="951.3" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(9733.5, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220, -370.3) scale(0.707)"><g data-mml-node="mi"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(786, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(1537, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(2304, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g><g data-mml-node="mo" transform="translate(4824.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5324.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">性</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">能</text></g></g><rect width="7530" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(7770, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(8547.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text></g></g><rect width="13789.2" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -6526.6)"><g data-mml-node="mtd" transform="translate(5217.7, 0)"></g><g data-mml-node="mtd" transform="translate(5217.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(220, 676)"><g data-mml-node="mi"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(982.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1704.4, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g><g data-mml-node="mrow" transform="translate(718.2, -686)"><g data-mml-node="mi"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(759, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g><rect width="2424.4" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(3998, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(4387, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">其</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">中</text></g><g data-mml-node="mi" transform="translate(6345.3, 0)"><path data-c="43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(7383, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">为</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">常</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="mo" transform="translate(9903.7, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">可以发现，DP并行带宽压力和数据并行度d成正比，和一个迭代喂入整个系统的tokens数量(Bs)成反比；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;white-space: normal;">上述公式中，TP和PP中带宽要求和模型规模成反比的原因：通信和计算两个任务中，虽然在模型尺寸变大时两者都会发生变化。但是两者变化的速度是不同的：模型规模越大时，算力需求提升的速度(和h的平方成正比)比通信传输量(和h成正比)提升的速度更快。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>4.1.3.2&nbsp;通信带宽估算</strong></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">根据表4的公式，进行1次迭代时的各种通信相关的数据计算方法如下：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">耗时计算：</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">每个microbatch的计算耗时为：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="33" style="" data-formula="\begin{aligned}
T_{PerMicrobatch}
&amp; =\frac{tokens数量_{单个microbatch}*单个模型副本算力需求}{单个模型副本GPU数量*单卡算力*单卡利用率} \\
&amp; =\frac{bs*(6至8)*单个模型参数量}{(p
*t
)*单卡算力*单卡利用率} 
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="59.826ex" height="11.67ex" role="img" focusable="false" viewBox="0 -2829.1 26443 5158.2" aria-hidden="true" style="vertical-align: -5.269ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 1300.9)"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(751, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1217, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1668, 0)"><path data-c="4D" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(2719, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3064, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(3497, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3948, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(4433, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4862, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5391, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5752, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(6185, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(5414.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(329.6, 778.2)"><g data-mml-node="mi"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(361, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(846, 0)"><path data-c="6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(1367, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1833, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2433, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(3179.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="msub" transform="translate(4020, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(1680.5, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2558.5, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2903.5, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(3336.5, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3787.5, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(4272.5, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4701.5, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5230.5, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5591.5, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(6024.5, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g><g data-mml-node="mo" transform="translate(9855.3, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(10633, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">副</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">本</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">需</text><text data-variant="normal" transform="translate(7562.1, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">求</text></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">副</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">本</text></g><g data-mml-node="mi" transform="translate(5319.2, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(6105.2, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(6856.2, 0)"><path data-c="55" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"></path></g><g data-mml-node="mo" transform="translate(7901, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(9859.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(10637, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text></g><g data-mml-node="mo" transform="translate(14275.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(15053.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g></g><rect width="19454.7" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -1369.1)"><g data-mml-node="mtd" transform="translate(5414.7, 0)"></g><g data-mml-node="mtd" transform="translate(5414.7, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(373.1, 710)"><g data-mml-node="mi"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(429, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(1120.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(1842.4, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(2231.4, 0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(3009.2, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">至</text></g><g data-mml-node="mn" transform="translate(4127.2, 0)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mo" transform="translate(4627.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(5016.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(5794, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">模</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">型</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">参</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(389, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(1114.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1836.4, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(2197.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(2586.4, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(3364.2, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">力</text></g><g data-mml-node="mo" transform="translate(7003, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(7780.7, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">卡</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">利</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">用</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">率</text></g></g><rect width="12181.9" height="60" x="120" y="220"></rect></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">一次迭代中的计算耗时为：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="35" style="" data-formula="\begin{aligned}
T_{PerGlobalbatch}
&amp; =Microbatch数量*T_{PerMicrobatch} \\
&amp; = \frac{B}{b*d} *T_{PerMicrobatch} \\

\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="45.327ex" height="7.593ex" role="img" focusable="false" viewBox="0 -1928 20034.5 3356" aria-hidden="true" style="vertical-align: -3.231ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 1178)"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(751, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1217, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1668, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(2454, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(2752, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3237, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3666, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(4195, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(4493, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4922, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5451, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5812, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(6245, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(5457.2, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(1333.6, 0)"><path data-c="4D" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(2384.6, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2729.6, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(3162.6, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3613.6, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(4098.6, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4527.6, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5056.6, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5417.6, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5850.6, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(6704.3, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(8662.6, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msub" transform="translate(9162.6, 0)"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(751, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1217, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1668, 0)"><path data-c="4D" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(2719, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3064, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(3497, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3948, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(4433, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4862, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5391, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5752, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(6185, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></g></g><g data-mml-node="mtr" transform="translate(0, -731)"><g data-mml-node="mtd" transform="translate(5457.2, 0)"></g><g data-mml-node="mtd" transform="translate(5457.2, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mi" transform="translate(787.2, 676)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mrow" transform="translate(220, -686)"><g data-mml-node="mi"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(651.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1373.4, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g><rect width="2093.4" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(3889.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msub" transform="translate(4611.4, 0)"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(751, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(1217, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1668, 0)"><path data-c="4D" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(2719, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3064, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(3497, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3948, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(4433, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4862, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5391, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5752, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(6185, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">TP通信计算：</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">TP的通信量和通信频率的计算：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="37" style="" data-formula="\begin{aligned}
&amp;<1>.TP单次通信量 = 4bsh(t-1)/t \\
&amp;\\
&amp;<2>.TP通信次数_{单microbatch} = 4l/p\\
&amp;\\
&amp;<3>.TP通信次数_{单迭代} = 通信次数_{单microbatch}* \frac{B}{bd} 
\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="46.808ex" height="16.57ex" role="img" focusable="false" viewBox="0 -3912.1 20689 7324.2" aria-hidden="true" style="vertical-align: -7.72ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 3162.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(3334, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(4038, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(5066.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" transform="translate(4201.2, 0)"></path></g><g data-mml-node="mn" transform="translate(10323.7, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(10823.7, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(11252.7, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(11721.7, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(12297.7, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(12686.7, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(13270, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(14270.2, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(14770.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(15159.2, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(15659.2, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, 1862.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"></g></g><g data-mml-node="mtr" transform="translate(0, 562.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(3334, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(4038, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(5066.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text></g><g data-mml-node="msub" transform="translate(7587.5, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(840.2, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1718.2, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2063.2, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2496.2, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2947.2, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3432.2, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3861.2, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(4390.2, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(4751.2, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5184.2, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g><g data-mml-node="mo" transform="translate(12550.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(13606.6, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(14106.6, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(14404.6, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(14904.6, 0)"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, -806.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"></g></g><g data-mml-node="mtr" transform="translate(0, -2715.1)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(3334, 0)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(4038, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(5066.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text></g><g data-mml-node="msub" transform="translate(7587.5, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">迭</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">代</text></g></g></g><g data-mml-node="mo" transform="translate(10260.1, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><text data-variant="normal" transform="translate(778, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(1618.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(2458.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text></g><g data-mml-node="msub" transform="translate(13558.9, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(840.2, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1718.2, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2063.2, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(2496.2, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2947.2, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3432.2, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3861.2, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(4390.2, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(4751.2, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5184.2, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g><g data-mml-node="mo" transform="translate(18800, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mfrac" transform="translate(19300, 0)"><g data-mml-node="mi" transform="translate(315, 676)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mrow" transform="translate(220, -686)"><g data-mml-node="mi"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(429, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g><rect width="1149" height="60" x="120" y="220"></rect></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">假设TP通信和计算的时间消耗比重是5%。由于已经获得出TP中的计算耗时和TP通信量，则可预估出所需单GPU对外通信带宽。推导过程如下(下面公式是单个迭代的计算方法，使用单个microbatch的方式是类似的)：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="39" style="" data-formula="\begin{aligned}
TP带宽需求_{RingBased}
&amp;=  \frac{数据量}{耗时} \\
&amp;=  \frac{TP通信量_{单迭代}}{T_{perGlobalbatch计算}*期望计算和通信占比} \\
&amp;=  \frac{TP通信量_{单迭代}}{T_{perGlobalbatch计算}*0.05} \\

\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="57.034ex" height="18.155ex" role="img" focusable="false" viewBox="0 -4262.3 25209.1 8024.6" aria-hidden="true" style="vertical-align: -8.512ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 2836.3)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(704, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1732.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">带</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">宽</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">需</text></g><g data-mml-node="msub" transform="translate(4253.5, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">求</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="52" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path></g><g data-mml-node="mi" transform="translate(759, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1104, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1704, 0)"><path data-c="67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mi" transform="translate(2181, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(2940, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3469, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(3938, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(4404, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(8625.5, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1055.8, 0)"><g data-mml-node="mrow" transform="translate(220, 676)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">据</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g></g><g data-mml-node="mrow" transform="translate(640.1, -710)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g></g><rect width="2720.7" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, 98.2)"><g data-mml-node="mtd" transform="translate(8625.5, 0)"></g><g data-mml-node="mtd" transform="translate(8625.5, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(4582.1, 778.2)"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(704, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1732.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text></g><g data-mml-node="msub" transform="translate(3413.3, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">迭</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">代</text></g></g></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(969, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1420, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(2206, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(2504, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(2989, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3418, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3947, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(4245, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4674, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5203, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5564, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5997, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(6573, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text></g></g></g><g data-mml-node="mo" transform="translate(6470.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(7247.9, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">和</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text></g></g><rect width="15010" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -2758.2)"><g data-mml-node="mtd" transform="translate(8625.5, 0)"></g><g data-mml-node="mtd" transform="translate(8625.5, 0)"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(1773.3, 778.2)"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(704, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1732.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text></g><g data-mml-node="msub" transform="translate(3413.3, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">迭</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">代</text></g></g></g></g><g data-mml-node="mrow" transform="translate(220, -686)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(969, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1420, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(2206, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(2504, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(2989, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3418, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3947, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(4245, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4674, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5203, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5564, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5997, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(6573, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text></g></g></g><g data-mml-node="mo" transform="translate(6692.3, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(7414.5, 0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(778, 0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(1278, 0)"></path></g></g><rect width="9392.5" height="60" x="120" y="220"></rect></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">PP相关信息计算：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p></li></ul><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="41" style="" data-formula="\begin{aligned}
&amp;<1>.PP单次通信量 = 2bsh/t\\
&amp;\\
&amp;<2>.PP通信次数_{单个microbatch} = 2\\
&amp;\\
&amp;<3>.PP通信次数_{单个迭代}=2* \frac{B}{bd} \\
&amp;\\
&amp;<4>.PP带宽需求 = 通信总量/期望通信时间\\
&amp;=  \frac{PP单次通信量*PP通信次数_{单个迭代}}{T_{perGlobalbatch计算}*期望计算和通信占比}\\ 
&amp;=  \frac{PP单次通信量*单个迭代中的通信次数}{T_{perGlobalbatch计算}*0.05}\\ 



\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="42.332ex" height="35.092ex" role="img" focusable="false" viewBox="0 -8005.3 18710.7 15510.6" aria-hidden="true" style="vertical-align: -16.98ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 7255.3)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(3334, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(4085, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(5113.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" transform="translate(4201.2, 0)"></path></g><g data-mml-node="mn" transform="translate(10370.7, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(10870.7, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(11299.7, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(11768.7, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(12344.7, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(12844.7, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, 5955.3)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"></g></g><g data-mml-node="mtr" transform="translate(0, 4655.3)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(3334, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(4085, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(5113.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text></g><g data-mml-node="msub" transform="translate(7634.5, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(1680.5, 0)"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2558.5, 0)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2903.5, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(3336.5, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3787.5, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(4272.5, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4701.5, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5230.5, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5591.5, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(6024.5, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g><g data-mml-node="mo" transform="translate(13192, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(14247.7, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, 3287.2)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"></g></g><g data-mml-node="mtr" transform="translate(0, 1378.2)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(3334, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(4085, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(5113.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text></g><g data-mml-node="msub" transform="translate(7634.5, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">迭</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">代</text></g></g></g><g data-mml-node="mo" transform="translate(10901.3, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(11957.1, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(12679.3, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mfrac" transform="translate(13401.5, 0)"><g data-mml-node="mi" transform="translate(315, 676)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mrow" transform="translate(220, -686)"><g data-mml-node="mi"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(429, 0)"><path data-c="64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g><rect width="1149" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -368.8)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"></g></g><g data-mml-node="mtr" transform="translate(0, -1668.8)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(3334, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(4085, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(5113.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">带</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">宽</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">需</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">求</text><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" transform="translate(3361, 0)"></path><text data-variant="normal" transform="translate(4139, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(4979.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(5819.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">总</text><text data-variant="normal" transform="translate(6659.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(12891.5, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mo" transform="translate(13669.2, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">间</text></g></g></g><g data-mml-node="mtr" transform="translate(0, -3747)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(462, 778.2)"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(751, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1779.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(6258.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(6758.7, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(7509.7, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(8538.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text></g><g data-mml-node="msub" transform="translate(11059.2, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">迭</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">代</text></g></g></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(969, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1420, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(2206, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(2504, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(2989, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3418, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3947, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(4245, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4674, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5203, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5564, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5997, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(6573, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text></g></g></g><g data-mml-node="mo" transform="translate(6470.1, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(7247.9, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">和</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text></g></g><rect width="15010" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, -6501.2)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(220, 676)"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(751, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1779.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(6258.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(7036.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">迭</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">代</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">中</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">的</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(7562.1, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g></g><g data-mml-node="mrow" transform="translate(3343.2, -686)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 0)"><path data-c="65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(969, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1420, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(2206, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(2504, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(2989, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3418, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3947, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(4245, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(4674, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5203, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(5564, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5997, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(6573, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text></g></g></g><g data-mml-node="mo" transform="translate(6692.3, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(7414.5, 0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(778, 0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(1278, 0)"></path></g></g><rect width="15638.9" height="60" x="120" y="220"></rect></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">DP相关信息计算：<span style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;</span></p></li></ul><p style="text-align: center;"><span style="cursor:pointer;"><mjx-container jax="SVG" role="presentation" tabindex="0" ctxtmenu_counter="43" style="" data-formula="\begin{aligned}
&amp;<1>.DP单次通信量 =  \frac{48lh^2}{pt} \\
&amp;\\
&amp;<2>.DP通信次数_{单个迭代} =1\\
&amp;\\
&amp;<3>.DP带宽需求 = 通信总量/期望通信时间\\
&amp;=   \frac{DP单次通信量*DP通信次数_{单个迭代}}{T_{Globalbatch计算耗时}*期望计算和通信占比} 


\end{aligned}"><svg xmlns="http://www.w3.org/2000/svg" width="42.506ex" height="23.788ex" role="img" focusable="false" viewBox="0 -5507.2 18787.7 10514.4" aria-hidden="true" style="vertical-align: -11.328ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0, 3997.3)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(3334, 0)"><path data-c="44" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(4162, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(5190.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" transform="translate(4201.2, 0)"></path></g><g data-mml-node="mfrac" transform="translate(10447.7, 0)"><g data-mml-node="mrow" transform="translate(220, 676)"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500, 0)"></path></g><g data-mml-node="mi" transform="translate(1000, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="msup" transform="translate(1298, 0)"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(926.8, -686)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><rect width="2477.6" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mtr" transform="translate(0, 2067.3)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"></g></g><g data-mml-node="mtr" transform="translate(0, 767.3)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(3334, 0)"><path data-c="44" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(4162, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(5190.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text></g><g data-mml-node="msub" transform="translate(7711.5, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">迭</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">代</text></g></g></g><g data-mml-node="mo" transform="translate(10978.3, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(12034.1, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0, -600.9)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"></g></g><g data-mml-node="mtr" transform="translate(0, -1900.9)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="mn" transform="translate(1333.6, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(2111.3, 0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mo" transform="translate(2889.3, 0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(3334, 0)"><path data-c="44" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(4162, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(5190.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">带</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">宽</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">需</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">求</text><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" transform="translate(3361, 0)"></path><text data-variant="normal" transform="translate(4139, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(4979.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(5819.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">总</text><text data-variant="normal" transform="translate(6659.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(12968.5, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mo" transform="translate(13746.2, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">间</text></g></g></g><g data-mml-node="mtr" transform="translate(0, -3979)"><g data-mml-node="mtd"></g><g data-mml-node="mtd"><g data-mml-node="mi"></g><g data-mml-node="mo" transform="translate(277.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1333.6, 0)"><g data-mml-node="mrow" transform="translate(477.1, 778.2)"><g data-mml-node="mi"><path data-c="44" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(828, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(1856.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(6335.7, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(6835.7, 0)"><path data-c="44" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(7663.7, 0)"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(8692.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">次</text></g><g data-mml-node="msub" transform="translate(11213.2, 0)"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">数</text></g><g data-mml-node="TeXAtom" transform="translate(840.2, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">单</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">个</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">迭</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">代</text></g></g></g></g><g data-mml-node="mrow" transform="translate(220, -710)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(584, -176.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(786, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(1084, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1569, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(1998, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(2527, 0)"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(2825, 0)"><path data-c="62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3254, 0)"><path data-c="61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(3783, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(4144, 0)"><path data-c="63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(4577, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(5153, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">耗</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">时</text></g></g></g><g data-mml-node="mo" transform="translate(6654.3, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(7432, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">期</text><text data-variant="normal" transform="translate(840.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">望</text><text data-variant="normal" transform="translate(1680.5, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">计</text><text data-variant="normal" transform="translate(2520.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">算</text><text data-variant="normal" transform="translate(3361, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">和</text><text data-variant="normal" transform="translate(4201.2, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">通</text><text data-variant="normal" transform="translate(5041.4, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">信</text><text data-variant="normal" transform="translate(5881.7, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">占</text><text data-variant="normal" transform="translate(6721.9, 0) matrix(1 0 0 -1 0 0)" font-size="839.7px" font-family="serif">比</text></g></g><rect width="15194.2" height="60" x="120" y="220"></rect></g></g></g></g></g></g></svg></mjx-container></span>&nbsp;</p><p style="word-break: break-all;white-space: normal;">使用上述公式，对于4.1.2预设的各种模型和其配置进行通信带宽试算：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014933" data-ratio="0.5018518518518519" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Sn2lufMzpYE9jw4za6pdK8uUKyDOFKb4VYSZgGxyzC9PYyUM6fvHUzdqqDTgTXkHdBDjUIsrpibibg/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（表12.&nbsp;LLM训练中通信带宽试算表）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">TP通信一般对应如NVLink的机内高速互联：由上表可见，运行经典规模的三种大模型，机内互联带宽一般需要在单向100-300GB/s之间。而目前国内可买到的NV GPU机内互联带宽最高为单向200GB/s(如A800、H800)，主流国产算力卡的机内互联带宽单向最大也不会超过200GB/s；前面提到，我们可以通过调低TP并行度来减少机内互联带宽压力，但其他两种并行度也需要协同调整，这可能会带来其他的集群影响，需要结合表10和表12综合评估。</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">DP的通信一般走机间RDMA网络通信：由上表可见，需要每个GPU独享100-400Gb/s的RDMA网卡带宽；前面提到，DP的带宽和B、s、d都有关系，我们可以尝试调大Bs或者调小数据并行度d来减少网络带宽需求；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">PP通信使用的物理链路和并行度有关，和机内通信和机间通信都有关系。但从上表可以看出，PP的通信带宽相比DP、PP都是比较小的，对硬件没有额外的压力；</p></li></ul><p style="word-break: break-all;white-space: normal;">在机器硬件参数确定时，我们还可以通过上述公式去反推出合适的并行度参数。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>5.&nbsp;</strong><strong>小结</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">本篇文章主要展示了LLM中硬件资源的估算方法和硬件瓶颈的理论推导，让大家了解大模型硬件选型等工作是如何开展的。我们发现了大模型中算力、带宽和显存三者都很重要，缺一不可:&nbsp;例如只增加单卡算力时，由于通信瓶颈存在并不会带来集群性能的相应提升；此外，硬件只决定了集群性能的理论上限、集群中软件和组网等还会导致上限的进一步收缩，因此集群组网设计和拥塞控制算法配置、集群通信库算法等都是非常重要的。有机会的话，我们将于后续的系列文章继续介绍。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>参考</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><ul class="list-paddingleft-1" style="list-style-type: disc;"><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">Using&nbsp;DeepSpeed&nbsp;and&nbsp;Megatron&nbsp;to&nbsp;Train&nbsp;Megatron-Turing&nbsp;NLG&nbsp;530B,&nbsp;A&nbsp;Large-Scale&nbsp;Generative&nbsp;Language&nbsp;Model,https://arxiv.org/pdf/2201.11990.pdf</p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">Reduc</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">i</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">ng&nbsp;Activati</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">on&nbsp;Recomputation&nbsp;in</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;Large&nbsp;Transformer&nbsp;Models,</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">https://arxiv.or</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">g/pdf/2205.05198.pdf</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">The&nbsp;Illustrated&nbsp;Transformer,https://jalammar.github.io/illustrated-transformer/</p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">Efficient&nbsp;Large-Scale&nbsp;Language&nbsp;Model&nbsp;Training&nbsp;on&nbsp;GPU&nbsp;Clusters&nbsp;Using&nbsp;Megatron-</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">LM,</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">https://arxiv.org/pdf/2104.04473.pdf</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">Language</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">&nbsp;Models&nbsp;are&nbsp;Few-Shot&nbsp;</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">Learners,</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">https://arxiv.org/pdf/2005.14165.pdf</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">分析tran</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">sformer模型的参数量、计算量、中间激活、KV&nbsp;cache&nbsp;-&nbsp;知乎</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">https://zhuanlan.zhi</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">hu.com/p/624740065</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">GPipe:&nbsp;Easy&nbsp;Scaling&nbsp;with&nbsp;Micro-Ba</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">tch&nbsp;Pipeline&nbsp;Parallelism，</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">https://arxiv.org/pdf/1811.06965.pdf</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">Megatron-LM:&nbsp;Trai</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">ni</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">ng&nbsp;Multi-Billion&nbsp;Parameter&nbsp;Language&nbsp;Models&nbsp;Using&nbsp;Model&nbsp;Parallelism，</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">htt</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">ps://arxiv.org</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">/pdf/1909.0</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">8</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">053.pd</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">f</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">h</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">tt</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">ps://en.wikipedia.org/wiki/Amdahl%27s_law</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">MIXED&nbsp;PRECIS</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">ION&nbsp;TRAINING,</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">https://arxiv.org/pdf/1710.03740.pdf</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">ZeRO-Offload:&nbsp;Democratizin</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">g&nbsp;Billion-Scale&nbsp;Model&nbsp;Training,</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">https://arxiv.org/pdf/2101.06840.pdf</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">ZeRO:&nbsp;Memory&nbsp;Optimizations&nbsp;Toward&nbsp;Training&nbsp;Trillion&nbsp;Parameter&nbsp;Models,https://arxiv.org/pdf/1910.02054.pdf</p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">PipeDream:&nbsp;Fast&nbsp;and&nbsp;Efficient&nbsp;</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">Pipeline&nbsp;Parallel&nbsp;DNN&nbsp;Training,</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">https://arxiv.org/pdf/1806.03377.pdf</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">Optimizing&nbsp;Network&nbsp;Performance&nbsp;for&nbsp;Distributed&nbsp;DNN&nbsp;Training&nbsp;on&nbsp;GPU&nbsp;Clusters:&nbsp;ImageNet/AlexNe</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">t&nbsp;Training&nbsp;in&nbsp;1.5&nbsp;Minute,</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">https://arxiv.org/pdf/1902</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">.06855.pdf</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">LLaMA</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">:&nbsp;Open&nbsp;and&nbsp;Effic</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">ient&nbsp;Foundation&nbsp;Language&nbsp;Models,</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">https://arxiv.org/pdf/2302.13971.pdf</span></p></div></li><li><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">https://github.com/alibaba/Megatron-LLaMA/blob/main/examples/LLaMA/LLaMA_13_standalone.sh</p></div></li></ul></div><div style="line-height: 1.6;font-size: 16px;"><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>开发者问答</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;font-size: 13px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>关于大模型硬件选型，你还有哪些考虑？</strong></span>欢迎在留言区告诉我们。转发并留言，小编将选取1则最有价值的评论，送出<span style="text-decoration: underline;"><strong>哔哩哔哩双层六芒星玻璃杯1个</strong></span>（见下图）。<span style="color: rgb(255, 102, 149);"><strong>3月19日中午12点开奖。如果喜欢本期内容的话，欢迎点个“在看”吧！</strong></span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 45%;height: auto;"><img class="js_asyningdom rich_pages wxw-img" data-imgfileid="100015010" data-ratio="1" data-s="300,640" data-type="jpeg" data-w="800" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754SU1e5FtZWH06jOG1RraLia11xukAibpPB0SYGNxWA3hiah9ibL7rXAIyoBUp8libbibLjnIk1hKTM48QTg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>往期精彩指路</strong></p></div></div></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;font-size: 13px;"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247495018&amp;idx=1&amp;sn=2845aaddc80d7fd08ad7cfdf879c782e&amp;chksm=cf2f284ff858a15943ea5df90ea476245d1c67da5265622bdc29ecfd57ea0128f607e89a8871&amp;scene=21#wechat_redirect" textvalue="哔哩哔哩大规模AI模型推理实践" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">哔哩哔哩大规模AI模型推理实践</a></p></li><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247496872&amp;idx=1&amp;sn=7647f520422d80760060e18a99163d13&amp;chksm=cf2f318df858b89b7da28bad96e56672859fa867a731040e60bd2751592f6a13ae4f3e85df72&amp;scene=21#wechat_redirect" textvalue="基于多模态的视频高能点提取技术" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">基于多模态的视频高能点提取技术</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247493513&amp;idx=1&amp;sn=650a9b1d050986766ef4474f90e41a27&amp;chksm=cf2f22acf858abba61ce36e1497ab12817e0f18ca38e19cc37c9e66a3c31e4d0e00e1117e9ad&amp;scene=21#wechat_redirect" textvalue="B站容器云平台VPA技术实践" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">B站容器云平台VPA技术实践</a></p></li></ul></div></div></div></div><p style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 13px;letter-spacing: 4px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><br></p><p style="margin-bottom: 0px;white-space: normal;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 13px;letter-spacing: 4px;text-align: center;background-color: rgb(255, 255, 255);"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3289447926347317252#wechat_redirect" textvalue="通用工程" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="color: var(--weui-LINK);outline: 0px;cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">通用工程</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2390333109742534656#wechat_redirect" textvalue="大前端" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="color: var(--weui-LINK);outline: 0px;cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">大前端</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3297757408550699008#wechat_redirect" textvalue="业务线" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="color: var(--weui-LINK);outline: 0px;cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">业务线</span></a></p><p style="margin-bottom: 0px;white-space: normal;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 13px;letter-spacing: 4px;text-align: center;background-color: rgb(255, 255, 255);"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2329861166598127619#wechat_redirect" textvalue="大数据" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="color: var(--weui-LINK);outline: 0px;cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">大数据</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2782124818895699969#wechat_redirect" textvalue="AI" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="color: var(--weui-LINK);outline: 0px;cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">AI</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2532608330440081409#wechat_redirect" textvalue="多媒体" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="color: var(--weui-LINK);outline: 0px;cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">多媒体</span></a></p><p><br></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzUxNTE4OTc0Mg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EVKwaZXNTl9OCCo7pxLHz2e2I3kV3rTPao5LlIickfJS79DNd2yjqjfYEtwtMOyVuKhJoDIq6UU4U9TQbjvOLaQ/0?wx_fmt=png" data-nickname="哔哩哔哩招聘" data-alias="" data-signature="生产快乐的地方" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="Mzg3Njc0NTgwMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754SVM7VMibhzz9AicOz5qdQ5oaN6TgXhbVyGHQYPwBErEYQCOnhibA1Qp431JkpPKY0qGhT0EfDchicXMQ/0?wx_fmt=png" data-nickname="哔哩哔哩技术" data-alias="bilibili-TC" data-signature="提供B站相关技术的介绍和讲解" data-from="0" data-is_biz_ban="0"></mp-common-profile></p></div><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p>]]></summary>
        <author>
            <name>郁晨</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[数据库不应放在容器中？- B站Kubernetes有状态服务实践(Elasticsearch/Clickhouse)]]></title>
        <id>2247498612_1</id>
        <link href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498612&amp;idx=1&amp;sn=f8f3cc34e0ec3c2c9fbf9558f1b72209&amp;chksm=cf2f3e51f858b747c0f09cf99c6820d8e8eda7c95575ca58d1717bf2a3ec34107a59ba865d26#rd"/>
        <updated>2024-03-11T14:09:01.000Z</updated>
        <summary type="html"><![CDATA[<div style="line-height: 1.6;font-size: 16px;"><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>本期作者</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 41.9147%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4zncxYp44MpqyZolW1PJpjm8xibTLkR4a7qo2XGFVmBec9cmqHeohQLQ/640?wx_fmt=png&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014934" data-ratio="1.2576687116564418" data-s="300,640" data-type="png" data-w="163" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4zncxYp44MpqyZolW1PJpjm8xibTLkR4a7qo2XGFVmBec9cmqHeohQLQ/640?wx_fmt=png&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>王星轶</p></div><div style="margin-top: 5px;text-align: justify;font-size: 12px;"><p style="text-align: center;white-space: normal;">哔哩哔哩资深开发工程师</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 53%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>田伟</p></div><div style="margin-top: 5px;font-size: 12px;"><p style="text-align: left;">哔哩哔哩资深开发工程师</p></div></div></div></div><div style="display: inline-block;vertical-align: middle;width: 32%;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 96.616%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX41v4pIjE3HZ5VoxLceM7JGm093UrhpQmLQUymdicJ5cmepZb1a4arhww/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014935" data-ratio="1.3351851851851853" data-s="300,640" data-type="jpeg" data-w="1080" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX41v4pIjE3HZ5VoxLceM7JGm093UrhpQmLQUymdicJ5cmepZb1a4arhww/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 100%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4Xe3b1cfKqfjnFJk47MyGsZvglDQWiaITuMIsW0mquqfnU68PYoXvzeA/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014937" data-ratio="1.3324074074074075" data-s="300,640" data-type="jpeg" data-w="1080" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4Xe3b1cfKqfjnFJk47MyGsZvglDQWiaITuMIsW0mquqfnU68PYoXvzeA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>钟善毫</p></div><div style="margin-top: 5px;text-align: justify;font-size: 12px;"><p style="text-align: center;white-space: normal;">哔哩哔哩高级开发工程师</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 53%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>陈健</p></div><div style="margin-top: 5px;font-size: 12px;"><p style="text-align: left;">哔哩哔哩高级开发工程师</p></div></div></div></div><div style="display: inline-block;vertical-align: middle;width: 32%;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 50%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4Edo64jm82RjeJtzJ4vrUZXHicT2FEWnZ8d0StArIAfNdDYHqziaGjsAg/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014938" data-ratio="1.2853688029020556" data-s="300,640" data-type="jpeg" data-w="827" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4Edo64jm82RjeJtzJ4vrUZXHicT2FEWnZ8d0StArIAfNdDYHqziaGjsAg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>前言</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">云原生时代下， Kubernetes已成为容器技术的事实标准，&nbsp;使得基础设施领域应用下自动化运维管理与编排成为可能。对于无状态服务而言，&nbsp;业界早已落地数套成熟且较完美的解决方案。可对于有状态的服务，&nbsp;方案的复杂度就以几何倍数增长，&nbsp;例如分布式应用多个实例间的依赖关系(主从/主备)，数据库应用的实例依赖本地盘中存储的数据(实例被干掉，&nbsp;丢失实例与本地盘中数据的关联关系也会导致实例重建失败)。</p><p style="word-break: break-all;white-space: normal;">多种原因导致有状态的应用一度成为了容器技术圈子的禁忌话题，&nbsp;直到目前，&nbsp;有状态的服务是否适合放置在容器中并交由K8s编排托管(例如生产环境的数据库)的话题依然争论不止。本文基于Elasticsearch/Clickhouse在B站生产环境的容器化/K8s编排能力落地，&nbsp;将阐述为何我们需要进行容器化/on k8s，&nbsp;容器化中遭遇的挑战以及解决方案，&nbsp;落地的技术细节以及收益。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>一、现状</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">企业级、生产环境下项目的推进，&nbsp;核心需要围绕<strong>成本、质量、效率</strong>，我们首先对B站目前使用es/ck的现状进行分析。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">以elasticsearch为例(简称'es')， es在B站拥有广泛的应用场景，&nbsp;包括各类2b/2c的在线业务及站内搜索，&nbsp;内部审核、企效、风控等平台。&nbsp;我们为此搭建了数套公共ES集群，&nbsp;并为每套集群划分职能，&nbsp;例如2c公共集群、2b公共集群、内部系统集群等。&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">起初，&nbsp;这套系统运行的较为稳定，&nbsp;运维工作也相对简单，&nbsp;我们只需关注公共集群资源利用率并对其进行相应的扩缩容即可。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">但随着业务的不断接入，&nbsp;缺陷也逐渐暴露，&nbsp;不同的业务写入/查询qps具有波动性，&nbsp;当集群在某一时刻资源水位线达到峰值时(如瞬时cpu)，&nbsp;<strong>整个集群所有业务的查询请求可能会出现耗时增加甚至超时</strong>。并且，&nbsp;公共集群模式下所有业务共享集群中的<strong>查询缓存与操作系统page&nbsp;cache，&nbsp;而缓存淘汰策略(通常为LRU)</strong>无法基于<strong>业务优先级</strong>进行设定，&nbsp;导致集群中部分业务查询耗时不稳定，&nbsp;降低了用户体验。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">为此我们进一步的对集群进行拆分，&nbsp;直接响应c端用户的集群，&nbsp;我们使用裸金属服务器搭建独立集群，&nbsp;与其它业务进行隔离，&nbsp;解决查询超时的问题。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">稳定性的问题看似解决了，&nbsp;但成本也提高了，&nbsp;由于ES属于分布式存储，&nbsp;为了防止脑裂、维持高可用，&nbsp;一个集群我们至少使用3台裸金属服务器进行搭建，&nbsp;而大部分业务资源占用极少，&nbsp;部分独立集群整体资源利用率甚至不到5%。这在以降本增效为主题的互联网时代下也是不可接受的。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">同理，&nbsp;对于clickhouse(简称'ck')，&nbsp;目前在B站主要应用于交互式的查询分析、报表以及日志、调用链等可观测场景，&nbsp;目前集群数量30+，&nbsp;拥有500+个物理机器节点。以上es集群面临的多租户以及资源利用率低的问题同样适用于ck。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">使用运维手段解决是否可行呢，&nbsp;为每个集群中的节点设定相应的cgroup与namespace限制，&nbsp;在有限的裸金属服务器上尽可能的承载更多的集群，&nbsp;有效的提升资源利用率。这在理论上看似可行，&nbsp;&nbsp;但随着集群数量的增多，&nbsp;运维工作的复杂度呈几何倍数递增，&nbsp;不同配置的集群的创建、销毁、扩缩容将成为日常运维工作的噩梦，&nbsp;我们很快便否决了这一方案。&nbsp;事实证明我们的决定也是正确的，&nbsp;以es为例，测试环境与线上环境的集群数量有100+套，&nbsp;如果采用这种模式，&nbsp;我们无法接受臃肿庞大的运维成本。&nbsp;对于ck来说，&nbsp;组件的运维复杂度甚至高于es，&nbsp;显然也不可取。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">开源ES与CK并没有很好的考虑多租户的问题，&nbsp;基于源码进行二次开发是否可行呢?经过评估，&nbsp;我们也否决了这个路径，&nbsp;在应用层支持多租户的隔离确实是一个方案，&nbsp;如果要做到良好的隔离的效果，&nbsp;技术复杂度与开发成本是相当高的，&nbsp;同时资源隔离的特性，&nbsp;也不适宜在应用层花费巨大精力进行改造，&nbsp;好比大炮打蚊子，&nbsp;收益与代价不成正比。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>事情仿佛陷入了困局，&nbsp;仔细思考一下我们究竟需要怎样的能力来改善现状</strong></p><ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">良好的资源隔离能力，&nbsp;解决不同业务间相互影响的问题</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">集群资源的编排能力，&nbsp;保证集群高可用的前提下尽可能提升资源利用率</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">良好的自动化运维能力，&nbsp;低运维甚至免运维</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">开发成本低，&nbsp;少重复造轮子</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">对标裸金属服务器集群，&nbsp;性能不能有明显劣化</p></li></ol><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">梳理完核心需求后，&nbsp;经过调研，&nbsp;剩下两条技术路径</p><ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">自研运维平台，&nbsp;集成对集群拓扑、资源自动化调度、编排能力</p></li><li><p style="word-break: break-all;">将ES/CK运行于容器中，&nbsp;并交由k8s进行资源调度与编排</p></li></ol></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div powered-by="xiumi.us"><p><br></p><table resolved=""><colgroup><col><col><col><col><col></colgroup><tbody><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>解决方案</strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>运维成本</strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>隔离性</strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>开发成本</strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>资源利用率</strong></p></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>公共集群</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>中</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>弱</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>低</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>中</p></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>独立集群</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>中</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>强</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>低</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>低</p></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>运维平台</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>中</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>强</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>高</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>高</p></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>组件二开</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>中</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>中</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>高</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>中</p></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>on&nbsp;k8s</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>低</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>强</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>中</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p>高</p></td></tr></tbody></table><p style="text-align: center;"><span style="vertical-align: super;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;font-size: 12px;">各类方案对比</span><br></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">两条路径本质相同， 都是利用<strong>Linux&nbsp;Namespace，&nbsp;Linux&nbsp;Cgroups和rootfs</strong>三种技术构建隔离环境并对隔离的资源进行编排调度。但对于自研运维平台来说，&nbsp;如果平台设计的自动化能力较低，&nbsp;日常隐形的<strong>运维成本</strong>将会大大增加，&nbsp;如需求平台自动化能力较强，&nbsp;包括智能的对集群编排，&nbsp;资源分配，&nbsp;随之对应的就是较大的开发成本，&nbsp;这与自己实现了一套k8s的编排调度的能力无甚区别，&nbsp;属于重复造轮子，&nbsp;也不合理。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">将有状态的服务容器化并托管k8s也并非易事，&nbsp;<strong>简单的跑个demo</strong>和在<strong>生产环境稳定运行</strong>，&nbsp;并能在发生相应故障下做到<strong>快速排障，&nbsp;止损，&nbsp;恢复</strong>，&nbsp;是完全不同的两个概念。&nbsp;在遇到故障时，&nbsp;排障难度是叠加的，&nbsp;但<strong>技术领域很难通过堆人来叠加排障效率</strong>，&nbsp;同时存在一个k8s专家和一个ES专家，&nbsp;可能都会对疑难杂症束手无策，&nbsp;毕竟站在不同的视角只能了解到局部的故障细节，&nbsp;但运行在容器与k8s中的有状态应用在排障时则需要<strong>全局视角的技术储备</strong>。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">尽管这是一件较有挑战性的事， 但作为以终身学习标榜的技术人员不应安于现状，&nbsp;偏安一隅，&nbsp;如果你是一名<strong>数据库专家</strong>，&nbsp;为何不能同时也成为一名<strong>k8s专家</strong>呢。</p><p style="word-break: break-all;white-space: normal;">同时， B站在k8s引擎的技术储备丰富，&nbsp;拥有专家团队提供技术支持，&nbsp;我们更不应该面对新技术时故步自封。&nbsp;最终，&nbsp;我们选择了第二条路径，&nbsp;开始着手调研es容器化与k8s编排。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>二、&nbsp; 总体架构</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014936" data-ratio="0.7592592592592593" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4qQfIhNtRvfMakWpVqNibwe38DU3TVKyuSVF3siaP7xwNPv8vEsFyDwDw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>整体架构图</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);">ps: 生产环境不会搭建只有2个master节点的es集群，以上仅做示例</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">Operator负责创建各种有状态的应用(StatefulSet)，存储卷(PVC)，&nbsp;以及负责St</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">atefulSet的调谐工作。&nbsp;同时节点会将</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">cpu、mem、磁盘</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">等可用资源信息上报， 调度器将基于这些信息将 Pod调度到合适的节点，并在该节点上创建存储卷并挂载至容器。</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">k8s集群内容器间的服务发现通过CoreDNS来实现。同时，pod之间的通信</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">都是通过 Macvlan来完成。</span></p></div><p style="word-break: break-all;white-space: normal;padding-right: 8px;padding-left: 8px;line-height: 1.6;font-size: 16px;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>三、&nbsp; 技术细节</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">将有状态的服务容器化并交由k8s编排并不简单，&nbsp;我们需要关注许多技术难点，&nbsp;此章节对k8s中的控制器、持久化存储、磁盘调度、调度器、容器网络、服务发现、集群高可用等细节进阐述，&nbsp;在解决了这些技术难点后， es/ck on k8s就是一件水到渠成的事了。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.1 控制器</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在k8s中，&nbsp;编排策略与资源调度的最小单位一般基于pod来完成，&nbsp;pod是一个逻辑概念，可以包含一个或者多个容器，pod内容器共享网络和存储，通过<strong>Cgroups</strong>与<strong>Namespace</strong><strong>对资源隔离和限制</strong>。我们可以简单的理解每一个pod都是一个虚拟机(但并不是虚拟机)，&nbsp;容器则是运行在这个虚拟机中的用户程序。控制器是一个重要的组件，它可以根据我们的期望状态和实际状态来进行<strong>调谐</strong>，以确保我们的应用程序始终处于所需的状态。在 K8s 中，用户通过<strong>声明式&nbsp;API&nbsp;</strong>定义资源的“预期状态”，Controller则负责监视资源的实际状态，当资源的实际状态和“预期状态”不一致时，Controller则对系统进行必要的更改，以确保两者一致,&nbsp;这个过程称为<strong>调谐(reconcile)</strong>。而这些控制器的主要管理职责为保证 Pod 资源健康运行，如副本个数、发布策略等。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">k8s具有以下默认的控制器，&nbsp;这些控制器决定了pod编排以及调度的行为</p><ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">Deployment:&nbsp;无状态控制器，&nbsp;主要用于创建无状态的服务<br></p></li><li><p style="word-break: break-all;margin-bottom: 15px;">Replicaset:&nbsp;无状态控制器，&nbsp;并提供副本参数配置，&nbsp;控制器会维持pod的数量在期望值<br></p></li><li><p style="word-break: break-all;margin-bottom: 15px;">Statefulset:&nbsp;有状态控制器，&nbsp;管理有状态应用的工作负载。<br></p></li><li><p style="word-break: break-all;margin-bottom: 15px;">Job与CronJob:&nbsp;任务控制器，&nbsp;支持定时，&nbsp;一次或多次执行某类任务<br></p></li></ol><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们发现k8s中默认的控制器都不能很好的满足我们的需求，&nbsp;以es为例， es中节点分为master/data/coordinating/ingest等，&nbsp;每个实例都可能具备一种或多种角色，&nbsp;而Statefulset仅仅依赖init container行为以及pod的序号来维护这些实例间的关系，&nbsp;较为死板，&nbsp;并且pod名一旦被确定，&nbsp;那么集群拓扑关系也随之确定，&nbsp;如果我们要往集群中加入一个master节点，&nbsp;流程将会较为繁琐。<br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">k8s中还支持<strong>自定义资源(CRD)</strong>与<strong>自定义的控制器</strong>，&nbsp;在自定义控制器内，&nbsp;我们可以根据自定义API变化来完成具体的部署和运维工作。</p><p style="word-break: break-all;white-space: normal;">以下是对CRD及自定义operator工作流程的说明。如对此概念熟悉的读者可酌情跳过阅读。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">CRD(custom resource definition)</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">用来定义和管理标准k8s对象之外的资源，是k8s api的扩展，允许用户使用自己的模式和行为定义资源。&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">operator</p><p style="word-break: break-all;white-space: normal;">用来自动化管理在k8s上特定的应用和服务资源(如有状态应用数据库、缓存、监控等)的工具，本质上就是k8s中的控制器。它们监视着自定义资源的更改变化事件，根据资源指定的状态进行处理。</p></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014942" data-ratio="0.33951497860199714" data-s="300,640" data-type="jpeg" data-w="701" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4rMnibplXZx9WGLQC89UShgjwTDFsdbD5iaGM8ncZBKQXYSRt65sBNXvw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">当有被监视资源的相关事件触发时，会进入到reconcile cycle(调谐循环)。简单来说，就是根据资源期望状态和实际状态的差异来采取适当的操作，比如资源的创建更新和删除就是在这个循环机制中进行。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014941" data-ratio="0.35520684736091296" data-s="300,640" data-type="jpeg" data-w="701" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX49WHtx5BYch1CgpGpTRhC9ib24SYztiaiajPIL61CGodUToNUxkEibYkCRQ/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">k8s operator的实现有多种方式，使用operator sdk或者其他脚手架工具/框架(如kubebuilder)去构建。因此有了这个crd + operator，可以开发出满足自己业务需求的控制器。我们可以基于crd与operator完成pod的数据存储，pod重启后数据是否丢弃数据等行为进行定制化的控制。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.2 持久化存储</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">基于较高的&nbsp;IOPS和低延迟等<strong>性能考虑</strong>， 我们选择使用<strong>本地盘(local&nbsp;pv)</strong>。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">使用本地盘代表着如果宿主机宕机，&nbsp;势必会导致数据丢失，&nbsp;<strong>所以Elasticsearch中的索引需要配置副本，&nbsp;在Clickhouse中可以选择ReplicatedMergeTree表引擎来使用副本，这是数据高可用的前提。</strong></p><p style="word-break: break-all;white-space: normal;">如果一台机器存在多块的磁盘，且为不同介质(ssd/hdd), 假如每一个分区被独立的使用，容易产生碎片，&nbsp;资源利用率低。此外， pod挂载的存储也有动态扩容的需求(不停服务进行磁盘扩容)。基于以上考虑我们选择使用了LVM(Logical Volume Manager)技术。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014940" data-ratio="0.7707948243992606" data-s="300,640" data-type="jpeg" data-w="541" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX46PhsCSia4YkTeTUObmob44HRADdHleoaq3xYrNKueKCBnMXFZ9Ker3w/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>LVM(Logical&nbsp;Volume&nbsp;Manager)</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">LVM技术将物理卷(physical volume)组成卷组(volume group)， 基于逻辑卷(logical volume)进行磁盘管理， 提供了动态扩缩容的能力。以下是一些概念简介。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">PV：物理卷(physical volume)就是指硬盘分区或从逻辑上与磁盘分区具有同样功能的设备(如raid)，是LVM的基本储存逻辑块，但和基本的物理存储介质(如分区，磁盘等)比较，却包含有与LVM相关的管理参数。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">VG：卷组(volume group)LVM卷组类似于非LVM系统中的物理硬盘，尤其物理卷组成，可以在卷组上创建一个或多个LVM分区(逻辑卷)，LVM卷组由一个或多个物理卷组成</p><p style="word-break: break-all;white-space: normal;">LV：逻辑卷(logical volume)LVM的逻辑卷类似非LVM系统中的硬盘分区，在逻辑卷之上可以创建文件系统。</p></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">有了LVM这个利器， kubernetes就可以利用这个工具给 pod 创建数据卷，我们使用LVM 把同介质的多块磁盘统一为一个卷组。如果pod需要一块Nvme介质的数据卷，那么就在这个卷组上创建一个逻辑卷，并在这个逻辑卷上创建需要的文件系统，这样pod的数据卷(pv)对应的数据盘就完成了初始化，pod创建时可直接挂载并使用。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014943" data-ratio="0.7842227378190255" data-s="300,640" data-type="jpeg" data-w="862" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4TMia83iaficfiane9f2WA0RzR4egF4YNOqecnTv8GCBjMerWJz87jX9RAQ/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">首先， agent将上报每一个机器的逻辑卷组可用大小，&nbsp;上报完成后，&nbsp;调度器就可基于每个机器卷组类别以及可用大小选择合适的机器来创建逻辑卷，最后机器上的agent会按照pvc申明的逻辑卷的大小和磁盘类别等信息通过Lvm在逻辑卷组上创建逻辑卷，&nbsp;最后，&nbsp;在pod创建时， agent会将数据卷挂载并提供pod使用。具体过程如下。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014939" data-ratio="0.17118402282453637" data-s="300,640" data-type="jpeg" data-w="701" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4eG9aaLBbC7xCdu1W7sXlwibjGxrOIeacZRNX4QUc0cTrc9kateD0H4Q/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.3 磁盘上报</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">csi-agent通过lvm来管理磁盘分区，首先agent会识别机器上的<strong>裸盘(未经格式化或分区的磁盘，即磁盘上没有任何文件系统或分区表的数据)</strong>，通过lvm创建物理卷，然后把该同类型的物理卷组成一个lvm的卷组，最后在卷组上创建逻辑卷。lvm提供了现成的工具来获取机器的卷组类型和大小， csi agent只需进行上报即可。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">status:</span></code><br><code><span class="code-snippet_outer"> &nbsp;allocatable:</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;csi.storage.io/csi-vg-hdd: <span class="code-snippet__string">"178789"</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;csi.storage.io/csi-vg-ssd: <span class="code-snippet__string">"3102"</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;capacity:</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;csi.storage.io/csi-vg-hdd: <span class="code-snippet__string">"178824"</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;csi.storage.io/csi-vg-ssd: <span class="code-snippet__string">"3112"</span></span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">如上展示了一台机器上的两个卷组，一个介质为hdd，&nbsp;另一个介质为ssd，&nbsp;并且提供了容量大小信息。&nbsp;&nbsp;&nbsp;&nbsp;创建卷组时，&nbsp;卷组下所有磁盘分区需要为裸盘，同时，&nbsp;我们也需要将磁盘介质区分清楚，&nbsp;防止将不同介质的磁盘划分为一个卷组，&nbsp;尤其节点磁盘在拥有磁盘raid时需要特别注意。另外，&nbsp;在实践中我们发现机器重启时， nvme盘的盘符会发生变化，&nbsp;<strong>基于盘符去创建物理卷会产生问题</strong>，&nbsp;而nvme的插槽口一般是不会改变的，&nbsp;我们后续基于了<strong>nvme的槽口信息</strong>来创建物理卷。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014947" data-ratio="0.36445012787723785" data-s="300,640" data-type="jpeg" data-w="782" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX47icGiaofbAbjCOA7HTUhteLDlwJ0ibBLOnsbwyuaL1tiaMEib5yr4FJ2G1A/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.4 磁盘调度</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">完成了磁盘上报， 接下来就可以根据磁盘信息进行调度了。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">调度器会对当前集群下所有机器的各类磁盘的水位线进行计算，&nbsp;结合策略(集中式或分散式)进行pod调度，pod所调度的<strong>目标节点一定具备满足pod所需要的所有类型的数据盘</strong>。用户只需通过申请pvc，&nbsp;申明所需要的资源类型，大小和读写属性。调度器会自动进行数据盘挂载， pvc与pv的绑定。下文详细阐述了这些自动化的步骤是如何实现的。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">k8s的api都是申明式的，磁盘同理，用户只需申明磁盘的大小，类型，磁盘创建的时机和属性等等，控制器会自动实现你期望的结果。</p><p style="word-break: break-all;white-space: normal;">先介绍几个关键的申明对象的概念。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">Persistent Volume(PV)</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">对底层存储的一种抽象，例如一个持久化存储在宿主机上的目录，独立于pod的生命周期，lvm基于某一个卷组创建逻辑卷。csi-agent监听到事件后在节点上创建localvolume。如果已经存在，pod重启后不会再创建。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">PersistentVolumeClaim(PVC)</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">描述Pod期望使用的的持久化存储的属性(如大小、读写权限)， 通常由开发人员创建。无需关注具体PV实现的底层细节， PVC与PV绑定后Pod即可正常使用。es和clickhouse的pvc都是对应operator自动创建。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">StorageClass</p><p style="word-break: break-all;white-space: normal;">定义创建PV的模板(PV的属性， 例如大小、类型)， 并使用存储插件动态的创建PV，这是低运维甚至免运维的前置条件之一。在pvc申明对应的StorageClass，比如StorageClass定义了lvm的vg组，那么创建pv时就会在vg组上创建逻辑卷，还比如只有pod创建的时候在创建pv，可以指定StorageClass的volumeBindingMode为WaitForFirstConsumer来实现。因此StorageClass就是申明创建pv的属性和类型等。</p></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">利用k8s中Dynamic Provisioning的能力，&nbsp;可以动态的创建PV，&nbsp;无需运维人员手动维护。但在k8s中<strong>没有内置本地盘的Provisioner</strong>，&nbsp;<strong>我们需要自定义存储插件</strong>。为此我们基于了开源的存储插件进行了适配性改造。</p><p style="word-break: break-all;white-space: normal;">每一个节点的csi agent插件将上报机器磁盘空闲资源，并通过crd来描述这些资源，而调度器会监听这些crd对象，在调度pod的时候，根据crd描述的每一个机器的资源情况，选择合适的节点进行调度。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014945" data-ratio="0.9153976311336718" data-s="300,640" data-type="jpeg" data-w="591" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4QMqq13SRZuyFZrnRaiaianWBC7zlTWDIKHj26NpJCIcTicujAdMPiaZ3Jg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>存储插件的架构图</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">status:</span></code><br><code><span class="code-snippet_outer"> &nbsp;allocatable:</span></code><br><code><span class="code-snippet_outer">csi.storage.io/csi-vg-hdd: <span class="code-snippet__string">"178789"</span></span></code><br><code><span class="code-snippet_outer">csi.storage.io/csi-vg-ssd: <span class="code-snippet__string">"3102"</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;capacity:</span></code><br><code><span class="code-snippet_outer">csi.storage.io/csi-vg-hdd: <span class="code-snippet__string">"178824"</span></span></code><br><code><span class="code-snippet_outer">csi.storage.io/csi-vg-ssd: <span class="code-snippet__string">"3112"</span></span></code><br></pre></p><div style="text-align: center;" powered-by="xiumi.us"><p><sup>磁盘CRD信息</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">通过计算每一类磁盘卷组大小， 以及节点已占用大小， 可以计算出每个节点中每一类介质磁盘的空闲大小， 并且根据集中式或均匀式的策略来进行资源对象的创建。调度过程主要涉及csi-scheduler、csi-agent、csi-controller, 三个组件相互配置并完成资源上报，调度，数据卷的创建和挂载。</p><p style="word-break: break-all;white-space: normal;">下文是三个组件的详细介绍。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">调度器(csi-scheduler)</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1.csi-scheduler 是 Kubernetes 的调度插件，负责基于申请的 PV 大小、节点剩余磁盘空间大小，磁盘类型，节点负载使用情况进行合理的调度。如果节点后期上报了更多的资源信息，可以实现更加丰富的调度来满足业务的各种需求。基于原生的k8s的调度框架做一个单独的调度插件比较简单，同时调度策略更加灵活，可以实现集中式和分散式调度满足各种业务需求。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2.调度插件主要实现Filter和Score两个阶段，在预选阶段(Filter)过滤掉不满足的资源的节点，在优选阶段(Score)对满足条件的节点根据调度策略是集中式还是分散式打不同的分数，比如集中式策略的目的是减少资源碎片，在满足资源下剩余可用资源越少分数越高。对于分散式资源剩余越多分数越高，最终得分越高的节点越容易被选中。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3.一旦调度完成，那么对应的pvc上会打上annotation，csi-controller监听PVC维护PVC、LV之间的关系， csi-agent监听LV来创建相应的数据卷并且在pod创建的时候负责挂载数据卷。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">csi-agent</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">运行在每个节点上的服务，利用lvm技术管理本地磁盘，自动识别机器的SSD/HDD/NVME 裸盘，并根据这些磁盘类型划分为对应磁盘卷组，用户无需介入。对运维来说只需要按照规范交付裸盘机器。同时csi-agent监听LV创建本地数据卷，在pod创建的时候负责数据卷的挂载等操作。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">csi-controller</p><p style="word-break: break-all;white-space: normal;">控制平面， 监听PVC维护PVC、LV之间的关系。节点侧csi-agent监听LV来创建相应的数据卷。</p><p><span style="display: none;line-height: 0px;">‍</span><span style="display: none;line-height: 0px;">‍</span><span style="display: none;line-height: 0px;">‍</span></p></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.5 数据卷创建</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">Name: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;csi-sc</span></code><br><code><span class="code-snippet_outer">IsDefaultClass: &nbsp; &nbsp; &nbsp; &nbsp;No</span></code><br><code><span class="code-snippet_outer">Annotations: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; kubectl.kubernetes.io/last-applied-configuration={<span class="code-snippet__string">"allowVolumeExpansion"</span>:<span class="code-snippet__literal">true</span>，<span class="code-snippet__string">"apiVersion"</span>:<span class="code-snippet__string">"storage.k8s.io/v1"</span>，<span class="code-snippet__string">"kind"</span>:<span class="code-snippet__string">"StorageClass"</span>，<span class="code-snippet__string">"metadata"</span>:{<span class="code-snippet__string">"annotations"</span>:{}，<span class="code-snippet__string">"name"</span>:<span class="code-snippet__string">"csi-sc"</span>}，<span class="code-snippet__string">"mountOptions"</span>:[<span class="code-snippet__string">"rw"</span>]，<span class="code-snippet__string">"parameters"</span>:{<span class="code-snippet__string">"csi.storage.io/disk-type"</span>:<span class="code-snippet__string">"nvme"</span>，<span class="code-snippet__string">"csi.storage.k8s.io/fstype"</span>:<span class="code-snippet__string">"xfs"</span>}，<span class="code-snippet__string">"provisioner"</span>:<span class="code-snippet__string">"csi.storage.io"</span>，<span class="code-snippet__string">"reclaimPolicy"</span>:<span class="code-snippet__string">"Delete"</span>，<span class="code-snippet__string">"volumeBindingMode"</span>:<span class="code-snippet__string">"WaitForFirstConsumer"</span>}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer">Provisioner: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csi.storage.io</span></code><br><code><span class="code-snippet_outer">Parameters: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;csi.storage.io/disk-type=nvme，csi.storage.k8s.io/fstype=xfs</span></code><br><code><span class="code-snippet_outer">AllowVolumeExpansion: &nbsp;True</span></code><br><code><span class="code-snippet_outer">MountOptions: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rw</span></code><br><code><span class="code-snippet_outer">ReclaimPolicy: &nbsp; &nbsp; &nbsp; &nbsp; Delete</span></code><br><code><span class="code-snippet_outer">VolumeBindingMode: &nbsp; &nbsp; WaitForFirstConsumer</span></code><br><code><span class="code-snippet_outer">Events: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;none&gt;</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们基于此存储插件定义的一个<strong>StorageClass</strong>，&nbsp;名称为csi-sc，&nbsp;由存储插件csi.storage.io进行动态pv创建，&nbsp;磁盘介质为nvme ssd，&nbsp;文件系统为xfs。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">VolumeBindingMode:&nbsp;<strong>WaitForFirstConsumer</strong>， 将PVC与PV的绑定延迟到Pod调度之后， 防止提前绑定导致Pod调度失败的问题(使用local pv时非常重要的配置)。ReclaimPolicy: Delete，&nbsp;意味着当用户手动删除pvc时pv也会被自动删除，这在pv所对应的本地盘损坏的情况下是必要的，&nbsp;可以防止在删除pvc之后pod仍被调度到该宿主机上(pvc和pv的绑定一对一的，pv不被删除，pod就不会漂移)。</p><p style="word-break: break-all;white-space: normal;">最终,&nbsp;用户只需通过pvc申明期望使用的数据盘，并在pvc里申明了<strong>StorageClass</strong>, 剩余的工作都是由存储插件完成了。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.6 容器网络</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">容器默认配置下，&nbsp;不同宿主机上的容器<strong>无法通过ip地址进行互相访问</strong>。无论是Elasticsearch或是Clickhouse，&nbsp;都是分布式应用，例如es中选举主节点，&nbsp;分片rebalance，&nbsp;或仅仅只是一次简单的查询请求都需要<strong>同一集群内的不同实例进行内部通信</strong>，&nbsp;而这些实例又分布在不同宿主机上，&nbsp;我们需要让这些容器完成<strong>可靠、高性能</strong>的跨主机通信。</p><p style="word-break: break-all;white-space: normal;">社区拥有众多的容器网络解决方案。macvlan是linux内核支持的一种网络功能，可以支持在不同的网络命名空间上配置二层网络，具有性能损耗小、管理成本低等优点。B站macvlan容器网络方案已在生产环境运行数年， 稳定性有保障， 我们决定复用公司Paas团队的技术沉淀。具体做法是通过每个节点的<strong>CNI插件</strong>进行pod ip的分配, 以及其它初始化工作。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;" powered-by="xiumi.us"><p><br></p><table resolved=""><colgroup><col><col><col></colgroup><tbody><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>网络模式</strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>优势</strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>劣势</strong></p></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>macvlan</strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;" align="left" valign="top"><p><br></p><p>1.&nbsp;&nbsp;pod拥有独立ip，&nbsp;k8s集群内外皆可访问</p><p>2.&nbsp;&nbsp;请求不经过kube-proxy，&nbsp;性能理论最优</p><p><br></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;" align="left" valign="top"><p><br></p><p>1.&nbsp;&nbsp;ip余量取决于宿主机网段所在的机房、机柜等信息，&nbsp;可能存在ip不足的情况</p><p>2.&nbsp;&nbsp;pod&nbsp;ip变更时客户端需感知</p><p><br></p></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>overlay</strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;" align="left" valign="top"><p>1.&nbsp;&nbsp;无需考虑ip不足的问题</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;" align="left" valign="top"><p><br></p><p>1.&nbsp;&nbsp;k8s集群外访问需实现ingress网络方案、nginx反向代理</p><p>2.&nbsp;&nbsp;一次外部请求可能数次转发(kube-proxy、nginx反向代理)，&nbsp;性能理论较差</p><p>3.&nbsp;&nbsp;目前只支持七层代理，&nbsp;不支持四层代理</p><p>4.&nbsp;&nbsp;过多的service导致iptables规则膨胀，&nbsp;性能有损</p><p><br></p></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><strong>host</strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;" align="left" valign="top"><p>1.&nbsp;&nbsp;无需考虑ip不足的问题</p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;" align="left" valign="top"><p><br></p><p>1.&nbsp;&nbsp;需要对宿主机端口进行规划，&nbsp;创建集群时的逻辑需要改造</p><p>2.&nbsp;&nbsp;额外维护集群&nbsp;-&nbsp;端口号这一映射关系以供客户端访问，&nbsp;存在隐形维护成本</p><p><br></p></td></tr></tbody></table><p><br></p></div><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.7 服务发现</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">es中存在许多<strong>集群间内部通信</strong>，&nbsp;例如节点间的分片rebalance。&nbsp;为此我们使用了<strong>headless&nbsp;service+core&nbsp;dns</strong>组件来解决此类问题。当内部请求需要获取pod地址时， core dns组件会返回pod的dns记录，&nbsp;并解析成对应的pod ip。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">macvlan的网络模式虽然解决了从k8s集群外访问到ES集群的问题，&nbsp;但我们发现Pod的IP是不固定的，&nbsp;集群的发版，&nbsp;滚动重启，&nbsp;扩缩容都可能导致pod&nbsp;ip地址发生变化，&nbsp;对于下游业务来说，&nbsp;需要感知集群地址变化是较为麻烦的，&nbsp;<strong>如何通过固定的方式来访问到我们的ES集群是我们下一步需要解决的问题</strong>。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">为此我们封装了统一的查询网关，&nbsp;所有<strong>客户端查询es的请求都由查询网关代理</strong>，&nbsp;而查询网关则会不断询问并更新k8s集群中具体es集群的地址信息，并将其保存在内存中。考虑到写入流量较大，&nbsp;可能对查询产生影响。我们也将读写分离，&nbsp;写入侧会询问查询网关具体某一集群与节点实例的ip列表，&nbsp;当获取到每个实例(pod)的ip时，将会直连这些节点ip进行数据写入。&nbsp;</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">同理，&nbsp;对于ck，&nbsp;我们也封装了统一的查询网关提供业务<strong>外部访问</strong>，&nbsp;对于ck集群内部副本间的通信，&nbsp;例如ck间的副本通信，&nbsp;我们为<strong>每一个副本都设置了一个headless&nbsp;service</strong>。</p><p style="word-break: break-all;white-space: normal;">除此之外，ck还依赖zookeeper组件来完成副本间的同步，我们使用的是ck内部开发的clickhouse keeper(以下简称为'keeper')来替代zookeeper。我们对keeper也进行了容器化，通过不同的namespace来区分不同业务使用的keeper。&nbsp;其中， keeper集群实例之间也通过headless service来进行通信。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.8 高可用</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">高可用分为<strong>集群高可用</strong>与<strong>数据高可用</strong>。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">以ES为例，&nbsp;集群高可用需要考虑防止脑裂，&nbsp;部分节点脱离集群时服务依然可用。数据高可用同理，&nbsp;分布在某实例上的数据丢失时(如磁盘损坏)，&nbsp;需要通过副本机制来进行恢复与补偿。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">举个简单的例子，&nbsp;一个ES集群由5个ES实例组成(假设同时为master&amp;data节点)，&nbsp;而这5个实例分布在宿主机A，&nbsp;宿主机B上。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">如果宿主机A发生宕机，&nbsp;会发生什么样的情况?</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">显而易见，&nbsp;这个ES集群将会失去3个实例，&nbsp;集群无法达到最小节点数而无法触发选主，&nbsp;导致集群不可用。</p><p style="word-break: break-all;white-space: normal;">假如是宿主机B宕机呢? 由于宿主机宕机，&nbsp;此ES集群只会失去2个实例，&nbsp;该集群仍然存在3个实例，&nbsp;集群仍然可用。假设此集群存在一个Index A， Index A有一个分片0与一个副本分片0，&nbsp;它们分布在ES实例3与ES实例4上。则<strong>宿主机的宕机会同时导致该Index主分片与副本同时丢失(因为使用的是本地盘)， 造成数据不可用。</strong></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014946" data-ratio="1.199004975124378" data-s="300,640" data-type="jpeg" data-w="402" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4quatPVuUCrZjciaIH5UTV9QTM4Lk921Dmnkeka0w2MoUl3r4y1vic9AA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><strong>如要同时实现集群高可用与数据高可用， 需要同一集群下的相同角色实例不可分布在同一宿主机上。</strong>我们使用k8s中的亲和/反亲和机制来实现，&nbsp;此处的topologyKey为宿主机hostname。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">affinity:</span></code><br><code><span class="code-snippet_outer"> &nbsp;podAntiAffinity:</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;requiredDuringSchedulingIgnoredDuringExecution:</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;- labelSelector:</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;matchLabels:</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;elasticsearch.k8s.elastic.co/cluster-name: es-test</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;elasticsearch.k8s.elastic.co/node-data: <span class="code-snippet__string">'true'</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;topologyKey: kubernetes.io/hostname</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">对于ck来说，要实现高可用也需依赖副本，&nbsp;通过副本间的同步，可以让每个副本都能对外提供服务，即使其中某个副本挂掉，&nbsp;也能保证集群的可用以及数据的完整性。&nbsp;同时，&nbsp;<strong>我们不允许ck集群下的同一shard的不同replica分布在同一宿主机上</strong>。同样使用反亲和机制可以达成此效果。除shard级别不同replica的反亲和，ck operator还支持不同程度的反亲和/亲和，比如chi实例级别反亲和，replica级别反亲和，namespace级别反亲和等。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">podDistribution:</span></code><br><code><span class="code-snippet_outer"> &nbsp;- type: ShardAntiAffinity</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;topologyKey: <span class="code-snippet__string">"kubernetes.io/hostname"</span></span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">以上配置是为了保证keeper集群下不会同时挂掉多个实例而导致整个keeper集群不可用，也是对keeper的实例进行了宿主机级别的反亲和。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.9 内存隔离</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">cgroups保证了容器中内存的隔离性， Lucene的一次写入，&nbsp;文件无变更的特性导致操作系统的page cache也将极大的影响ES的查询性能。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们深入探究了<strong>cgroups对于page&nbsp;cache的作用机制</strong></p><p style="word-break: break-all;white-space: normal;">根据linux内核代码看， cgroup的确只统计了RSS内存(cgroup控制组里所有进程实际使用的物理内存总和) + page cache， 当memory.usage_in_bytes要超过memory.limit_in_bytes时， 内核会自动开始回收这个cgroup控制组里的page cache缓存。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">static</span> <span class="code-snippet__keyword">void</span> <span class="code-snippet__title">mem_cgroup_charge_statistics</span><span class="code-snippet__params">(struct mem_cgroup *memcg, <span class="code-snippet__keyword">int</span> nr_pages)</span></span></span></code><br><code><span class="code-snippet_outer">{</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">/* pagein of a big page is an event。So， ignore page size */</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> (nr_pages &gt; <span class="code-snippet__number">0</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;__count_memcg_events(memcg， PGPGIN， <span class="code-snippet__number">1</span>);</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">else</span> {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;__count_memcg_events(memcg， PGPGOUT， <span class="code-snippet__number">1</span>);</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;nr_pages = -nr_pages; <span class="code-snippet__comment">/* for event */</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;__this_cpu_add(memcg-&gt;vmstats_percpu-&gt;nr_page_events， nr_pages);</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">得出结论，&nbsp;在初始化一个运行ES进程的容器时，&nbsp;<strong>需要同时考虑jvm heap与page cache大小，&nbsp;其中page cache也受cgroups限制，&nbsp;回收行为由内核执行。</strong></p><p style="word-break: break-all;white-space: normal;">&nbsp;同理， ck在访问文件时也会使用os的pagecache，当查询访问的数据被pagecache缓存时，也会加速ck的查询，&nbsp;可以与ck里min_bytes_to_use_direct_io个参数与pod内存结合调整，&nbsp;提升查询性能。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.10 IO隔离</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">考虑到目前B站承载ES与CK的机型，&nbsp;对于热数据存储都使用了Nvme SSD， IO瓶颈在大部分情况下不会先于CPU与MEM触发。IO隔离的意义不大。</p><p style="word-break: break-all;white-space: normal;">对于hdd上的冷数据， 默认查询都会使用buffer io， cgroup v1版本对buffer io隔离不彻底， 这个特性虽在新版本的内核上已经支持， 但Paas团队评估整体升级内核和适配的成本较高， 经过评估我们将在第二期再进行IO隔离的能力的支持。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.11 具体实践</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">以es为例，&nbsp;秉着避免重复造轮子的理念，&nbsp;我们基于开源社区cloud-on-k8s项目进行了改造，&nbsp;使其兼容公司容器平台，&nbsp;优化了指标、日志采集方式，&nbsp;具体实践如下。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1.&nbsp;由paas团队初始化k8s集群， 标准化容器装机</p><p style="word-break: break-all;white-space: normal;">2.登录k8s集群master节点， 安装CRD到集群</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">kubectl create -f crds.yaml</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">3.将operator部署到k8s集群中</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">kubectl apply -f <span class="code-snippet__keyword">operator</span>-bili.yaml</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">其中，&nbsp;在yaml文件中需要指定提前构建好的operator镜像地址</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">containers:</span></code><br><code><span class="code-snippet_outer">- image: <span class="code-snippet__string">"{{镜像仓库地址}}/cloud-on-k8s-bili:2.3.2"</span></span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">4.验证operator是否运行正常</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">kubectl get pod -n elastic-system</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">这里我们看到operator已经处于<strong>READY</strong>状态了</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; READY &nbsp; STATUS &nbsp; &nbsp;RESTARTS &nbsp; AGE</span></code><br><code><span class="code-snippet_outer">elastic-<span class="code-snippet__keyword">operator</span><span class="code-snippet__number">-0</span> &nbsp; <span class="code-snippet__number">1</span>/<span class="code-snippet__number">1</span> &nbsp; &nbsp; Running &nbsp; <span class="code-snippet__number">27</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="code-snippet__number">260</span>d</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">通过日志确认operator是否运行正常</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">kubectl logs -f -n elastic-system elastic-<span class="code-snippet__keyword">operator</span><span class="code-snippet__number">-0</span></span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">5.CRD已注册成功, operator就位， 可以开始创建es集群</p><p style="word-break: break-all;white-space: normal;">一行命令完成es集群创建</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">kubectl apply -f elasticsearch.yaml</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">检查es集群状态</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">kubectl get elasticsearch -n elastic</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">这里可以看到集群已经ready，&nbsp;集群状态为green</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">NAME &nbsp; HEALTH &nbsp; NODES &nbsp; VERSION &nbsp; PHASE &nbsp; AGE</span></code><br><code><span class="code-snippet_outer">test &nbsp; green &nbsp; &nbsp;<span class="code-snippet__number">3</span> &nbsp; &nbsp; &nbsp; <span class="code-snippet__number">7.17</span><span class="code-snippet__number">.9</span> &nbsp; &nbsp;Ready &nbsp; <span class="code-snippet__number">1</span>min</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">进一步检查集群节点日志， 确认集群运行正常</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">kubectl logs -f -n elastic test-es-datanode<span class="code-snippet__number">-0</span></span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">6.集群已初始化完毕， 接下来我们需要获取到外部访问的地址</p><p style="word-break: break-all;white-space: normal;">查看es集群节点信息</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">kubectl get pod -n elastic -owide</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">我们使用了macvlan，&nbsp;pod&nbsp;ip可从集群外访问，&nbsp;直接获取IP字段的值即为节点地址</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; READY &nbsp; STATUS &nbsp; &nbsp;RESTARTS &nbsp; AGE &nbsp; &nbsp; IP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NODE</span></code><br><code><span class="code-snippet_outer">test-es-datanode<span class="code-snippet__number">-0</span> &nbsp; <span class="code-snippet__number">1</span>/<span class="code-snippet__number">1</span> &nbsp; &nbsp; Running &nbsp; <span class="code-snippet__number">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__number">1</span>min &nbsp; &nbsp;xx.xxx.xx.xxx &nbsp; &nbsp;xx.xxx.xx.xx</span></code><br><code><span class="code-snippet_outer">test-es-datanode<span class="code-snippet__number">-1</span> &nbsp; <span class="code-snippet__number">1</span>/<span class="code-snippet__number">1</span> &nbsp; &nbsp; Running &nbsp; <span class="code-snippet__number">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__number">1</span>min &nbsp; &nbsp;xx.xxx.xx.xxx &nbsp; &nbsp;xx.xxx.xx.xx</span></code><br><code><span class="code-snippet_outer">test-es-datanode<span class="code-snippet__number">-2</span> &nbsp; <span class="code-snippet__number">1</span>/<span class="code-snippet__number">1</span> &nbsp; &nbsp; Running &nbsp; <span class="code-snippet__number">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__number">1</span>min &nbsp; &nbsp;xx.xxx.xx.xxx &nbsp; &nbsp;xx.xxx.xx.xx</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">7.operator为集群设置了账号密码， 并保存在secret中， 同样通过命令获取</p></div><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">kubectl get secret test-es-elastic-user -o go-<span class="code-snippet__keyword">template</span>=<span class="code-snippet__string">'{{.data.elastic | base64decode}}'</span> -n elastic</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">8.至此，我们拿到了集群的地址与账号密码，下一步就是从外部(k8s集群外)访问这个es集群了</p><p style="word-break: break-all;white-space: normal;">ck步骤与es几乎一致， 基于社区Altinity开源clickhouse operator进行改造，&nbsp;&nbsp;唯一区别为搭建集群时不仅要创建ck的集群， 也同样需要在k8s中部署keeper集群。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>四、可观测</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>4.1 指标采集</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">目前ES集群指标是通过es exporter暴露，&nbsp;统一上报至Prometheus，并由grafana面板可视化展示。</p><p style="word-break: break-all;white-space: normal;">对于裸金属物理机的ES集群， 每搭建一个集群， 就需要去部署一个es exporter， 如下图所示</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014948" data-ratio="0.40370370370370373" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4fPVBu6S2BgzI4RSPLOeVpKicgYibXqfYb1OliaBeuxY8pla3I57djVMyg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">es on k8s后， es集群创建/销毁/扩缩容频繁， 在面对繁多的集群下， 用原始的一个集群绑定一套exporter显然不是可持续的维护方式。所以我们对es exporter进行了改造，支持es exporter自动感知所有集群， 并支持采集多个集群的指标， 同时exporter也部署在k8s中， expoter本身是无状态的， 支持弹性扩缩容:</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014944" data-ratio="0.46574074074074073" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4h97zHdZ8yO3KAnRYWayib7Qicb9DK8ltgGIkicKhVCzwH0q8lhWXjlyNA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">目前ck集群的指标采集使用的是ck exporter，对应的zookeeper的指标采集使用的是zookeeper exporter。其中ck物理集群的指标采集与es物理集群类似，每个物理集群都会有一个对应的ck exporter，只是exporter会从它的配置文件中去获取该集群节点的信息，从而获取到每个节点的指标。但是zookeeper物理集群的采集是单独每个zk instance配置一个zk exporter。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014949" data-ratio="0.2935185185185185" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX466CrE7HfFYTgpDpnfOLSVXn6uaztNRia4zk3Z2NclYHxCym6rNic1Ficw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">同理于es， 开源方案并不适用于ck容器化集群的采集， 我们改造了现有exporter，也实现了exporter自动感知所有ck集群并进行相应的集群指标自动采集， 容器集群的信息是通过http接口的方式从api server上动态获取的。具体架构图如下。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014950" data-ratio="0.4871001031991744" data-s="300,640" data-type="jpeg" data-w="969" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4l01ncPxTn8RPd7fsXFoJ6rhxQhDmWfAyz9okEQUrRmNSspbKR2TBDw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>4.2 关键指标</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们为ES集群的关键指标创建了相应的Grafana视图面板，&nbsp;主要包含以下部分</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">集群状态、节点数量、shard状态(unassigned/active/relocating)</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">内存监控，&nbsp;包括jvm堆内存、gc信息、查询缓存、segment占用内存等</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">CPU使用率、load负载等</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">线程池状态(search/write/refresh)、thread&nbsp;rejected数量，search、write的线程池队列任务数等</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">集群查询qps、查询耗时</p></li><li><p style="word-break: break-all;">集群写入流量</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014953" data-ratio="0.425" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4RKibia7e1hbricvaDITpAaEbDmrWoib4WApcWESoj5nosCRrrdgBkSafyw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>ES集群监控面板</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">ck集群的指标除了自带的metrics， events等系统表里的数据外还添加了自定义的指标，包括与select/insert/alter相关的各类指标，其中一些用于监控，同时会把指标分为各项大类。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014952" data-ratio="0.3888888888888889" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX44V3ePdOCMbiaVjoaaI8XKBibcYIwCoN5s77QVRxGcVfaXv2nYUpH5zTA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">除应用监控外，&nbsp;<strong>我们使用Cadivisor</strong>(Container&nbsp;Advisor)<strong>对容器指标进行了相应的采集</strong>，&nbsp;例如pagecache也是重要指标之一，&nbsp;它将显著影响es(lucene)查询性能。如果在你的实践中，&nbsp;需要关注其它容器指标，&nbsp;可以自行配置面板。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014951" data-ratio="0.2854006586169045" data-s="300,640" data-type="jpeg" data-w="911" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4u2shACIssLuBLHDrcrA9EYKUZVNZkzuy6t1v5ghibQ0OB8Vmk3IoCzw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>容器page&nbsp;cache监控</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>4.3 日志采集</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">暂时用K8S提供的API暴露日志，方便日常排障。后续我们将会集成公司统一日志系统，&nbsp;对集群日志与慢查询日志采集并持久化、同时提供日志告警、慢查询定位分析等能力。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>五、&nbsp; 产品化</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">与传统的集群搭建方式相比较， 通过简单的几条命令行与yaml配置文件的形式实现集群的创建、扩缩容、滚动重启、发布， 极大的降低了日常工作中的运维成本，但此种方式对人的依赖性依然较大，自动化程度低，操作者也需要对k8s具备相应的技术领域知识，在执行变更时，人工的操作也增加了出错的概率。为了进一步的自动化， 实现<strong>低运维</strong>甚至<strong>免运维</strong>， 我们与基础架构 - 平台产品团队进行了深度协作，将组件以私有云服务的形式进行产品化，旨在提升业务研发业务迭代效率与组件平台运营/运维效率。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">最终实现的产品化能力如下：</p><ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">集群一<strong>键创建/扩缩容/销毁</strong>，&nbsp;在配置平台填写相应工单，&nbsp;经对应负责人审批，&nbsp;自动完成集群创建/扩缩容/销毁(通常1min内即可完成自动变更)。</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">自动绑定cmdb、可观测平台、变更管控平台等，&nbsp;资源信息透明，&nbsp;监控告警自动接入、日常变更有迹可循，&nbsp;提升了整体的稳定性与故障时排障效率。</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">业务一键式接入，&nbsp;通过对<strong>数据集成、集群创建、查询接入</strong>等场景进行适度封装，&nbsp;在自由使用组件的同时，&nbsp;屏蔽底层细节与复杂概念，&nbsp;加速业务迭代与上线。</p></li><li><p style="word-break: break-all;">在运维平台上，&nbsp;实现了一<strong>键发布、迭代更新、扩容缩容、镜像管理、配置管理、坏盘自动修复/Pod自动漂移</strong>等能力，降低日常运维、运营的压力。&nbsp;</p></li></ol></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014959" data-ratio="1.2605042016806722" data-s="300,640" data-type="jpeg" data-w="595" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4SXJYDnWn5jFeQdCtZZp0RUmj6Us3SHpiaHRoSSmcyGicA7LLAJpMWuKQ/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>填写简单的表单，&nbsp;集群自动初始化</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>六、&nbsp; 收益</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">完成技术落地与产品化后，&nbsp;我们来关注一下产生的收益，&nbsp;主要基于<strong>成本、质量、效率</strong>来进行考量。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>6.1 成本</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">ES与CK都是分布式存储， 搭建集群存在最少节点数， 在容器化进程之前，业务需要使用独立的ES/CK集群时， 则最少需要申请3-4台裸金属服务器进行集群搭建， 目前B站托管至k8s的容器es/ck集群已有30+套， 扣除实际使用的资源， 已为公司节省<strong>100+台裸金属服务器</strong>， 迁移进程持续推进中，集群的CPU平均利用率也从原本的<strong>5%提升至15%</strong>。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>6.2 质量</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">传统的公共集群模式下隔离性差， 造成了同一集群中的不同业务互相影响。在es/ck on k8s的能力具备后， 让我们对资源的隔离性有了进一步的可能。多个业务的稳定性也有了相当大的提升。以B站的关系链搜索场景为例， 原本的99分位查询耗时必定超时， 经过es on k8s独立集群的迁移后， 查询超时的问题已解决， 显著提升了用户对B站的使用体验。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014958" data-ratio="0.20555555555555555" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX44OQMUUZ6Jh4tdq30ItYYLc4oot5NzdGFnlDWFtEt1cNGDf4Vg1lZmw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="text-align: center;white-space: normal;" powered-by="xiumi.us"><sup>在迁移集群后，&nbsp;查询毛刺的问题解决</sup></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>6.3 效率</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">此前, 我们搭建一套裸金属集群， 步骤如下:</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1 协调资源并由系统组交付裸金属服务器</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2 创建集群配置， 指定集群名， 日志路径， 数据盘路径， jvm参数等</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3 编写部署集群的ansible脚本</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">4 登录堡垒机， 批量执行ansible脚本进行部署</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">5 批量执行systemd命令启动集群</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">6 验证集群是否初始化成功， 节点数量是否符合预期</p><p style="word-break: break-all;white-space: normal;">7 配置集群地址， 以供写入与查询侧使用</p></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">现在搭建容器集群步骤如下:</p></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1 在配置页面填写集群名等信息， 指定集群规格</p><p style="word-break: break-all;white-space: normal;">2 提交表单， 等待集群自动创建完成，通常会在1min内自动完成集群初始化工作</p></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">创建集群场景， 原先需要部署人员熟悉组件与相应部署脚本， 且需花费&gt;=0.5天/人的工时， 变为从<strong>申请到集群交付可用只需1~2min(如集群节点数较少,几十秒内即可完成)。</strong></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">故障场景，&nbsp;传统的维护模式， SRE需订阅告警，&nbsp;接收告警，&nbsp;通过可观测系统进行定位，&nbsp;并登录机器进行恢复，&nbsp;人力消耗大，&nbsp;效率低下。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">而托管于k8s后， operator在调谐循环中会不断的将集群维护在期望状态。例如因oom产生了节点脱离， operator会不断尝试拉起pod， 将集群维持在健康状态。包括此类在内的<strong>部分故障不需人为介入，节省了相当大的运维成本。</strong></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在集群需要扩容时，&nbsp;如果是裸金属物理机集群，&nbsp;因为不同集群间的配置不同，&nbsp;需要提前准备好脚本及配置文件，&nbsp;不仅繁琐也容易出错。使用容器化集群，&nbsp;我们只需在页面简单变更实例数量、实例规格即可由operator自动完成变更。</p><p style="word-break: break-all;white-space: normal;">总结，&nbsp;operator会自动化进行<strong>资源编排、调度、滚动发布、集群状态调谐</strong>等行为，可以节省传统人肉运维下人力消耗，几乎做到<strong>免运维</strong>。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>七、写在最后</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">选择容器技术时， 会直面许多操作系统、硬件等底层概念。如容器网络、磁盘调度、IO/CPU/MEM/NETWORK的隔离性等等。无论是项目推进过程中亦或日常排障， 单一的技术领域知识储备远远不足。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在一次容器网络故障案例中， 观察到集群中节点间歇性脱离， 通过日志以及监控只能得出节点间tcp网络通信失败。在排除掉集群本身问题后， 我们怀疑为容器网络问题， 使用工具可以稳定复现网络传输丢包的现象， 因为使用的是macvlan技术， 我们首先将出现问题的pod ip与存量的pod ip进行比对，发现存量pod被分配了重复的ip, &nbsp;我们临时将pod进行删除重新调度， 并升级了CNI插件解决了这个问题。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">如果仅具备数据库领域知识， 对整体容器网络， pod间如何通信缺乏整体的认知， 将很难快速定位到故障的根因， 会极大延长止损恢复的时间。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">同样， 如果仅具备k8s/容器领域知识， 组件出现故障时也只能是两眼一抹黑, 因为组件的故障是多因一果, 节点脱离集群只是一个现象, 造成这个现象的原因众多, 你必须将其它原因一一定位并排除。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">任何技术面临tradeoff，&nbsp;我们在享受了容器与k8s资源调度、编排、隔离性便利下，&nbsp;就不得不接受整体技术方案架构的复杂性。这就要求我们对于自身领域外的知识进行持续学习。如果你是一名数据库专家，&nbsp;可能你也需要同时成为k8s专家。如果你是一名k8s专家，&nbsp;在拥抱云原生的时代下，&nbsp;你也需要去了解不同技术领域的知识。我们在执行技术落地的过程中遭遇的疑难杂症, 面临的挑战与解决的难点也只是冰山一角, 在不同组件, 不同架构下有状态服务落地托管至k8s中可能会有更多缺陷与难点暴露出来, 但伴随着云原生的共识以及开源社区良好的生态模式, 我们相信这些困难都可以迎刃而解。</p><p style="word-break: break-all;white-space: normal;">我们选择拥抱新技术，持续学习，&nbsp;你是如何选择的呢?</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>开发者问答</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;font-size: 13px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>诸如mysql/postgresql等关系型数据库适合托管于k8s中吗, 最大的风险有哪些？在面对庞大的数据库集群管理时，你是如何折中解决构建、发布、运维、运营等困境的？</strong></span>欢迎在留言区告诉我们。转发并留言，小编将选取1则最有价值的评论，送出<span style="text-decoration: underline;"><strong>BW纪念盒蛋一个</strong></span>（见下图）。<span style="color: rgb(255, 102, 149);"><strong>3月15日中午12点开奖。如果喜欢本期内容的话，欢迎点个“在看”吧！</strong></span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 50%;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100014957" data-ratio="0.7506329113924051" data-s="300,640" data-type="jpeg" data-w="790" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RJfvwCSHPwqibBiaiaPqohQX4uy44Uv96SwbCeg7UfLqqMLIY3Y2Cn9PwBPpgQUWwYrA1HB7vpaLZJw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>往期精彩指路</strong></p></div></div></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;font-size: 13px;"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247494957&amp;idx=1&amp;sn=02f42e8759f03809694c2dc0243f6697&amp;chksm=cf2f2808f858a11e17ffe1b79ef0449e0d29b87a2906747b21e2862b89f91c47e99efe01121b&amp;scene=21#wechat_redirect" textvalue="百亿数据百万查询——关系链架构演进" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">百亿数据百万查询——关系链架构演进</a></p></li><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247495096&amp;idx=1&amp;sn=b7df3d9adebb1171715b8507aba55420&amp;chksm=cf2f289df858a18b19576385244e02128bfe80fbb90d7b667bf953037b45b2033562676abe95&amp;scene=21#wechat_redirect" textvalue="持续降本：B站日志平台3.0演进之路" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">持续降本：B站日志平台3.0演进之路</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247494408&amp;idx=1&amp;sn=c565f77e74753abe459a6d4bc7cfea27&amp;chksm=cf2f2e2df858a73bf678475b93053991fda5fb0be02b991dd855ef006a0811d2b8f7d865a3e3&amp;scene=21#wechat_redirect" textvalue="云原生安全-从k8s日志审计视角检测自动化工具攻击" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">云原生安全-从k8s日志审计视角检测自动化工具攻击</a></p></li></ul></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;font-size: 13px;letter-spacing: 4px;" powered-by="xiumi.us"><p style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 13px;letter-spacing: 4px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3289447926347317252#wechat_redirect" textvalue="通用工程" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">通用工程</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2390333109742534656#wechat_redirect" textvalue="大前端" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">大前端</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3297757408550699008#wechat_redirect" textvalue="业务线" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">业务线</span></a><br style="outline: 0px;"></p><p style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 13px;letter-spacing: 4px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2329861166598127619#wechat_redirect" textvalue="大数据" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">大数据</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2782124818895699969#wechat_redirect" textvalue="AI" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">AI</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2532608330440081409#wechat_redirect" textvalue="多媒体" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">多媒体</span></a></p><p style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 13px;letter-spacing: 4px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><br></p><p><span style="color: rgb(12, 182, 242);"></span></p></div><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="Mzg3Njc0NTgwMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754SVM7VMibhzz9AicOz5qdQ5oaN6TgXhbVyGHQYPwBErEYQCOnhibA1Qp431JkpPKY0qGhT0EfDchicXMQ/0?wx_fmt=png" data-nickname="哔哩哔哩技术" data-alias="bilibili-TC" data-signature="提供B站相关技术的介绍和讲解" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzUxNTE4OTc0Mg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EVKwaZXNTl9OCCo7pxLHz2e2I3kV3rTPao5LlIickfJS79DNd2yjqjfYEtwtMOyVuKhJoDIq6UU4U9TQbjvOLaQ/0?wx_fmt=png" data-nickname="哔哩哔哩招聘" data-alias="" data-signature="生产快乐的地方" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p></div><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p>]]></summary>
        <author>
            <name>B站基础架构团队</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[商业前端TS开发自动化工具]]></title>
        <id>2247498553_1</id>
        <link href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498553&amp;idx=1&amp;sn=4109d12390f56bba6705717e615478c7&amp;chksm=cf2f3e1cf858b70aba74cb297e04e4bfac46101a46a1a5e6765deb30d210ca69a4a88a7bdc4d#rd"/>
        <updated>2024-03-07T13:25:19.000Z</updated>
        <summary type="html"><![CDATA[<div style="line-height: 1.6;font-size: 16px;"><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>本期作者</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;background-position: 0% 100%;background-repeat: no-repeat;background-size: 100%;overflow: hidden;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RCrSUt4CU71P5bHMxkUibsxic2gYRmHfy8VxPk4QP3D8BPIIyicwkZaNMYA6VibulK3WPJzhfoUHC5bw/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img data-imgfileid="100014885" data-ratio="1.092896174863388" data-s="300,640" data-type="jpeg" data-w="732" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RCrSUt4CU71P5bHMxkUibsxic2gYRmHfy8VxPk4QP3D8BPIIyicwkZaNMYA6VibulK3WPJzhfoUHC5bw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>杨雨浩</p></div><div style="margin-top: 5px;text-align: justify;font-size: 14px;"><p style="text-align: center;white-space: normal;">哔哩哔哩资深开发工程师</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>一、背景</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="margin-bottom: 15px;white-space: normal;">商业侧的业务比较复杂，B端项目中含有大量常量类的类型判断，且因历史原因，很多常量值前端无法直接知其含义，这既不利于新人的上手，也不利于项目的维护。</p><p style="margin-bottom: 15px;white-space: normal;">在开发协作上，前后端的API沟通，大都通过配置swagger api来进行，要不就是口口相传或者通过写info文档来定义结构、入参及出参，这种协作方式不仅沟通成本高，且前端缺少能主动感知后端API变更的手段。</p><p style="margin-bottom: 15px;white-space: normal;">同时，为了提高项目的可维护性，组内推动前端项目TS工程化，在改造过程中，也会因为业务迭代，需要创建新的项目，而新项目TS工程化的过程，不仅需要自定义大量的类型，也需要定义后端API类型参数，如果全部通过手动敲，代价太大，不仅很容易出错，也会影响业务的开发效率。</p><p style="white-space: normal;">因此，为了提升开发协作效率，增加前端主动感知API的能力，提升项目的可维护性和开发效率，开发实现了TS自动化生成工具。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>二、核心功能</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;">自动生成api函数体结构</p></li><li><p style="margin-bottom: 15px;">自动化生成api interface</p></li><li><p style="margin-bottom: 15px;">自动生成本地mock file</p></li><li><p style="margin-bottom: 15px;">支持自定义模版输出改造</p></li><li><p style="margin-bottom: 15px;">支持驼峰与下划线转换输出</p></li><li><p style="margin-bottom: 15px;">支持自定义header改造</p></li><li><p>同时支持swagger api v2和v3版本</p></li></ol></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>三、转换原理</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">swagger api doc的文档结构</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="348" data-imgfileid="100014886" data-ratio="0.5675925925925925" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 578px;height: 328px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Qasmpx4R1Vlicb3rvmFB5RzolsvnMSqGETEeEsibicadkOc2BLnT7eMIzzkk8EEBcO35ciatveWbT4Bw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">关键属性拆分：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014887" data-ratio="0.42685185185185187" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RCrSUt4CU71P5bHMxkUibsx10KTbRuclRPcjIhm0tHq1FMYsFmSnNuOqjbEPycbsBicC1JbhJIOhicg/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">注：Template Function可根据实际情况进行覆盖，默认是商业侧的模版输出格式。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>四、项目接入</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="margin-bottom: 15px;word-break: break-all;white-space: normal;">工具地址：（Package - @bilibili-business/ad-swagger-fe）</p><p style="margin-bottom: 15px;word-break: break-all;white-space: normal;">接入步骤：</p><p style="word-break: break-all;white-space: normal;">1.安装</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">npm install @bilibili-business/ad-swagger-fe --registry=http:<span class="code-snippet__comment">//registry.npm.bilibili.co</span></span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="margin-bottom: 15px;word-break: break-all;white-space: normal;">2.配置模版文件，在项目根目录下新建swagger.config.js文件（目录按需）</p><p style="margin-bottom: 15px;word-break: break-all;white-space: normal;">3.可将示例代码（下方文档中）可以直接copy到swagger.config.js文件中</p><p style="margin-bottom: 15px;word-break: break-all;white-space: normal;">4.替换修改代码中的source地址，将其替换成目标swagger doc地址</p><p style="margin-bottom: 15px;word-break: break-all;white-space: normal;">5.命令行中执行：node ./swagger.config.js</p><p style="margin-bottom: 15px;word-break: break-all;white-space: normal;">6.项目中的src目录下，会多出一个swagger文件夹，即为生成的目标文件</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">7.可以根据生成的内容，调整工具参数，包括header</p><p style="word-break: break-all;white-space: normal;"><strong>模版示例代码</strong></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="465" data-imgfileid="100014889" data-ratio="0.7962962962962963" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 578px;height: 460px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Qasmpx4R1Vlicb3rvmFB5Rz2FMu0eOSSzvOTn8B4c2LLTV1lE8PkicoA75b9hOic3VCYWZqgolXBnrA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>五、项目实践</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="margin-bottom: 15px;word-break: break-all;white-space: normal;">目前该工具已在商业前端项目中推广并广泛使用，商业侧整体接入率85%， 带货项目接入率100%。</p><p style="margin-bottom: 15px;word-break: break-all;white-space: normal;">生成的<strong>API函数</strong>和<strong>TS interface </strong>可直接使用，无需手动编码，业务开发效率提升1pd。</p><p style="word-break: break-all;white-space: normal;"><strong>举例：后端API接口数1556个</strong></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="307" data-imgfileid="100014888" data-ratio="0.5296296296296297" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 578px;height: 306px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Qasmpx4R1Vlicb3rvmFB5Rz0jwR9sVARsgnHtLlSB12lmhLBj0gNiay5wibhlNhKRK9Y4pibMCMej7eg/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>通过工具生成的代码</strong></p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;">生成的API实例</p></li></ul></div><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-croporisrc="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RCrSUt4CU71P5bHMxkUibsxmYVulA9WsgAyFp9kQVe6okwbBMuRicrVoGzTlxUgZ6pl5l9963xLkVA/640?wx_fmt=png&amp;from=appmsg" data-cropx1="9.342560553633218" data-cropx2="1080" data-cropy1="0" data-cropy2="820.2768166089966" data-imgfileid="100014893" data-ratio="0.7665732959850607" data-s="300,640" data-type="jpeg" data-w="1071" style="vertical-align: middle;width: 573px;height: 439px;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Qasmpx4R1Vlicb3rvmFB5RzF1g8FYw7Dy1hLAE4ejnKG32wxEuglm7yhx0682RWTLIjh1cYicEj5Rw/640?wx_fmt=jpeg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;">生成的Interface</p></li></ul></div><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014892" data-ratio="0.7462311557788944" data-s="300,640" data-type="png" data-w="796" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RCrSUt4CU71P5bHMxkUibsxHk2xAypMfkXL3cZ79epaicNrFcvf8dPJicMGwCztiaQE8HDfRaVk6bxuQ/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;">在项目中直接使用</p></li></ul></div><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014894" data-ratio="1.2898148148148147" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RCrSUt4CU71P5bHMxkUibsxl0DpvTqwUf6IGoNgbrxsh5uq1bQqCOEOqSr57wz6UaGhHfiaoiabGZ4A/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><br></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>开发者问答</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;font-size: 13px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>大家在项目TS工程化改造上有遇到过哪些问题？</strong></span>欢迎在留言区告诉我们。转发并留言，小编将选取1则最有价值的评论，送出<span style="text-decoration: underline;"><strong>小电视校园系列金属徽章两只</strong></span>（见下图）。<span style="color: rgb(255, 102, 149);"><strong>3月12日</strong></span><span style="color: rgb(255, 102, 149);"><strong>中午12点开奖。如果喜欢本期内容的话，欢迎点个“在看”吧！</strong></span></p></div><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 45%;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100014891" data-ratio="1" data-s="300,640" data-type="jpeg" data-w="800" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RCrSUt4CU71P5bHMxkUibsxXIkkeHU6xFL6Yv6ibgZT8ChvS1GggLpH1j3fDAgjsPx1mFu1YyiboEfA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>往期精彩指路</strong></p></div></div></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;font-size: 13px;"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247493072&amp;idx=1&amp;sn=ce15e564800fba7fd53ce8bb34b227e9&amp;chksm=cf2f20f5f858a9e3b1c5235dde75e6f1c1a56051712ea44bbbcf063e501e5f71b32e6eb27a19&amp;scene=21#wechat_redirect" textvalue="B站微服务API管理" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">B站微服务API管理</a></p></li><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247485680&amp;idx=1&amp;sn=34c623a7ad0d23e94498658f1d1a9a60&amp;chksm=cf2ccdd5f85b44c3bb84b35cb2cb519ed262e80704424f938e4099a9e7a9c7b154d8ee72c5ab&amp;scene=21#wechat_redirect" textvalue="B站 API 网关的发展" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">B站 API 网关的发展</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247494228&amp;idx=1&amp;sn=0a1ab0362390e855552eee4c85d3d1ad&amp;chksm=cf2f2f71f858a667c655d9c969e832523e93fd4325d5d55867115021604cd256e81b89797bbe&amp;scene=21#wechat_redirect" textvalue="B站PC客户端-架构设计" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">B站PC客户端-架构设计</a></p></li></ul></div></div></div></div></div><div powered-by="xiumi.us" style="margin-bottom: 0px;outline: 0px;text-align: center;font-size: 13px;letter-spacing: 4px;"><p style="outline: 0px;"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3289447926347317252#wechat_redirect" textvalue="通用工程" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">通用工程</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2390333109742534656#wechat_redirect" textvalue="大前端" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">大前端</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3297757408550699008#wechat_redirect" textvalue="业务线" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">业务线</span></a><br style="outline: 0px;"></p><p style="outline: 0px;"><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2329861166598127619#wechat_redirect" textvalue="大数据" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">大数据</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2782124818895699969#wechat_redirect" textvalue="AI" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">AI</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2532608330440081409#wechat_redirect" textvalue="多媒体" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;"><span style="outline: 0px;color: rgb(12, 182, 242);">多媒体</span></a></p><p style="outline: 0px;"><br style="outline: 0px;"></p></div><p class="mp_profile_iframe_wrp" style="margin-bottom: 0px;outline: 0px;"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe js_wx_tap_highlight" data-pluginname="mpprofile" data-id="Mzg3Njc0NTgwMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754SVM7VMibhzz9AicOz5qdQ5oaN6TgXhbVyGHQYPwBErEYQCOnhibA1Qp431JkpPKY0qGhT0EfDchicXMQ/300?wx_fmt=png&amp;wxfrom=19" data-nickname="哔哩哔哩技术" data-alias="bilibili-TC" data-signature="提供B站相关技术的介绍和讲解" data-from="2" data-is_biz_ban="0" data-origin_num="223" data-isban="0" data-biz_account_status="0" data-index="0"></mp-common-profile></p><p class="mp_profile_iframe_wrp" style="margin-bottom: 0px;outline: 0px;"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe js_wx_tap_highlight" data-pluginname="mpprofile" data-id="MzUxNTE4OTc0Mg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EVKwaZXNTl9OCCo7pxLHz2e2I3kV3rTPao5LlIickfJS79DNd2yjqjfYEtwtMOyVuKhJoDIq6UU4U9TQbjvOLaQ/300?wx_fmt=png&amp;wxfrom=19" data-nickname="哔哩哔哩招聘" data-alias="" data-signature="生产快乐的地方" data-from="2" data-is_biz_ban="0" data-origin_num="22" data-isban="0" data-biz_account_status="0" data-index="1"></mp-common-profile></p><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p>]]></summary>
        <author>
            <name>杨雨浩</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[B站自研色彩空间转换引擎]]></title>
        <id>2247498532_1</id>
        <link href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498532&amp;idx=1&amp;sn=6c807c17e114654f2b11188a8f377df3&amp;chksm=cf2f3e01f858b717497972882018192af4edf59a6b0c569d7295e4535af53af4cd423690f73e#rd"/>
        <updated>2024-03-04T13:40:46.000Z</updated>
        <summary type="html"><![CDATA[<div style="line-height: 1.6;font-size: 16px;"><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>本期作者</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 53.1215%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMQJa7giaB9RREOx5YRWoTq44CvicmqH94ZjkpxMcf5MLjBsB2H7Bq5Acg/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014855" data-ratio="1.3337091319052987" data-s="300,640" data-type="jpeg" data-w="887" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMQJa7giaB9RREOx5YRWoTq44CvicmqH94ZjkpxMcf5MLjBsB2H7Bq5Acg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>罗引杰</p></div><div style="margin-top: 5px;text-align: justify;font-size: 12px;"><p style="text-align: center;white-space: normal;">哔哩哔哩资深开发工程师</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 53%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>尹壮</p></div><div style="margin-top: 5px;font-size: 12px;"><p style="text-align: left;">哔哩哔哩资深开发工程师</p></div></div></div></div><div style="display: inline-block;vertical-align: middle;width: 32%;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 26.4031%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCM9icxhOc3RfUAW7M9aNZMotOPEstZ2pZrGIuV4TuhFicQcdQib1ySs7AxA/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img data-imgfileid="100014853" data-ratio="1.4414414414414414" data-s="300,640" data-type="jpeg" data-w="555" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCM9icxhOc3RfUAW7M9aNZMotOPEstZ2pZrGIuV4TuhFicQcdQib1ySs7AxA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>1.&nbsp; &nbsp;背景</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">色彩空间（Color Space）是一种数学模型，用于描述和表示颜色的方式。不同的色彩空间有不同的用途和特点，可以用于不同的应用，如图像处理、计算机图形、印刷、摄影等领域。它一般用于描述设备的色彩能力，或者视频、图片的色彩范围。比如现在大部分人用的手机的屏幕，色彩空间大多为sRGB或者DCI-P3；网页上常见的图片或者视频内容，大多属于sRGB色彩空间；B站客户端播放的HDR视频，则处于BT.2020色彩空间。</p><p style="word-break: break-all;white-space: normal;">目前B站UP主投稿视频是千变万化的，它们包含各种不同的色彩参数, 比如不同的色深，不同的色度采样坐标，不同的色彩空间，不同的亮度传递函数等等（如下图），而且每个用户观看这些视频的终端也不一样，这样就产生了各种各样的兼容性问题——很多时候用户的设备并不能完全正确显示UP主投稿的“原片”，而且老旧的设备或者浏览器也并不支持广色域或者HDR视频。为了考虑终端设备的兼容性和B站服务的完整性，我们会对用户投稿的不同色彩空间的视频进行统一处理。但是如何将各种不同色彩参数的视频进行准确地统一处理，同时又能保证视频的处理速度，这对于我们来说是一个巨大的挑战。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014856" data-ratio="0.48148148148148145" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCML6wGPFtmQd8jCd6HZjPPiaxCPcyhWV2vSwJicoVcLjfQkZWsuHVLE9kg/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>色彩空间转换中需要处理的参数</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>2.&nbsp; &nbsp;引擎架构</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">为了处理各种不同色彩参数的视频，我们研发了一套色彩空间的转换引擎。该引擎会对各种不同色深、色彩空间、亮度传递函数的普通视频统一转换为标准的SDR视频。除了SDR视频， B站也会接收很多HDR视频投稿，对于HDR投稿，B站会统一转出一路标准的HDR视频和一路标准的SDR视频。</p><p style="word-break: break-all;white-space: normal;">该图像转换引擎分为三层，包括滤镜层，引擎层，和设备层。其中滤镜层包含各种滤镜，用于处理不同的色彩参数。引擎层的主要目的是做一些预计算与计算路径优化，比如有一些矩阵乘法只需要计算一次，那么就可以预先计算出来，而不是在像素处理的时候再去做。有一些GPU需要用到的矩阵参数，则也可以进行预拷贝，防止出现CPU与GPU之间出现频繁拷贝的情况，计算路径优化，则是用来去除一些不必要的步骤，来减少计算量。最后，设备层主要包含每种滤镜在不同平台的实现，该引擎包含一个指令集优化的X86版本和一个CUDA版本。接下来我介绍一下该滤镜层的各种色彩转换能力，包括坐标变换、量化、色度采样，色调映射等等。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014854" data-ratio="0.4083333333333333" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMhUmL9EEDR1gibIiaspxapicWrMKbG3fTzwzpguw4ke2rkT2PfTYTAa07Q/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>色彩空间处理引擎的基本架构图</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.1 坐标变换</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">很多时候，用户投稿的视频会有显示矩阵（Display matrix），它表示视频被旋转、被翻转、或者被转置。如果我们在服务端检测到这种视频，那么就需要对输入视频按照显示矩阵进行坐标变换。无论是软解的CPU数据帧还是硬解的CUDA帧，该引擎都能将其准确地渲染出来。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.2 量化与反量化</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">信号的量化主要用于连续的YUV信号转为离散的Y’CbCr，而反量化是将输入视频不同的色深转换为连续信号的过程。该引擎支持8bit、10bit、12bit等不同量化精度的Y’CbCr信号与YUV信号的互相转换，同时也支持pc range、tv range的转换。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.3 色度采样</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">色度采样（Chroma subsampling）是一种用于减少图像或视频中色度信息采样率的技术。在数字图像和视频编码中，颜色信息通常由亮度分量（Y）和两个色度分量（U和V）组成。由于人眼对亮度信息更加敏感，而对色度信息的感知相对较弱，因此可以通过减少色度分量的采样率来降低数据量，同时尽量保持图像或视频的质量。下图为常见的像素格式YUV420的采样坐标。</p><p style="word-break: break-all;white-space: normal;">为了色度采样尽可能平滑，我们采用了双线性（Bilinear）插值策略进行上采样和下采样。例如对YUV420像素格式的视频进行色度的上采样， 我们并不会简单地将一个色度像素共享给4个亮度像素， 而是对其进行插值，否则最后输出的视频会有色度过渡的不均匀。同理，对于色度的下采样，我们也会采用同样的插值方法。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014852" data-ratio="0.26296296296296295" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMDOGwhIPnib85352Mx7HKOmlFGk3HYrulNBlmZjgvgRoqaVwGl6E7hGQ/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>常见的色度采样坐标（4:2:0 chroma format）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.4 色彩矩阵转换</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">视频处理中的一个关键参数是色彩矩阵（Color matrix），有时也称为色彩空间（Color space）。该参数主要用于确定信号如何转换为RGB，色彩矩阵转换是将输入信号通过色彩矩阵映射到RGB色彩空间的过程。</p><p style="word-break: break-all;white-space: normal;">举例来说，常见的BT.709标准就属于一种色彩矩阵，它指导了如何将YUV信号转换为RGB，其转换方式如下:</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014858" data-ratio="0.21602787456445993" data-s="300,640" data-type="png" data-w="574" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMolJkYdRicc9iaicpDF2hnMo17t7LQY7NxEjpkzYGIPYBd4dB3lq9LyHPA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">为什么选择了上述的矩阵而不是其他的呢？这是因为BT.709协议所指定的色彩空间与sRGB相对应，通过sRGB的色域坐标可以推导出上述的转换矩阵。不同的色彩空间对应不同的转换矩阵，具体的矩阵根据输入的色彩矩阵而定。如果需要将R'G'B'转换为Y'U'V'，则需要对上述矩阵进行逆运算。</p><p style="word-break: break-all;white-space: normal;">而对于特殊信号，例如ICtCp信号，我们会首先将其转换为L'M'S'信号，然后再进行后续的转换操作。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.5 亮度传递函数转换</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">亮度传递函数是一种用于调整图像或视频信号亮度级别的函数，分为两种OETF（Opto-Electronic Transfer Function）和EOTF（Electro-Optical Transfer Function）。由于人眼对不同光线区域的敏感度不同，人眼对暗部细微亮度变化的敏锐程度较高，而对于高亮度的细微变化则较难察觉。为了以一种均匀的方式呈现信号，以符合人眼的感知，并且为了能够编码更多的信息，我们需要对信号进行OETF压缩。相反地，如果我们需要解压信号，则需要进行相反的处理，即EOTF。常见的EOTF曲线有Gamma2.4曲线和感知量化曲线（Perceptual Quantization，PQ），如下图。感知量化曲线是一种最接近人眼感知的量化方法，因此它也被广泛用作HDR视频的主要亮度传递函数。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014861" data-ratio="0.5634285714285714" data-s="300,640" data-type="png" data-w="875" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMw7esyoZSBibdDBPibOKN4z9RLFIVvwnNpFsefM4tV3eX6hbiah8nRktGw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>Gamma2.4和PQ的EOTF曲线</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">在该引擎中，我们实现了十几种亮度传递函数的转换，包括Gamma2.2，Gamma2.4，PQ，HLG等等。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.6色域映射</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">当涉及到色彩转换或图像处理时，色域映射是一个重要的概念。它指的是将一个色彩空间中的颜色值映射到另一个色彩空间中的过程。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">假设有一个图像，它使用BT.2020（一种广色域）色彩空间进行编码，但你希望在一个只支持sRGB色彩空间的设备上显示这个图像。由于这两个色彩空间具有不同的色域范围，直接将图像的颜色值转换为sRGB可能会导致颜色失真。在这种情况下，色域映射就派上用场了。色域映射算法会根据源色彩空间和目标色彩空间的特性，将图像的颜色值进行适当的转换，以确保在目标设备上显示的图像颜色尽可能接近原始图像的颜色。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">色域映射的方法一般有两种，一种是基于Clip的方法，一种是基于压缩的方法。首先介绍一下基于Clip方法的色域映射。想要做色域映射，首先需要将RGB线性信号转换到XYZ色彩空间，具体转换矩阵可以由r177协议得到。</p><p style="word-break: break-all;white-space: normal;">比如BT.2020色域的RGB转XYZ的公式如下：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014860" data-ratio="0.2144638403990025" data-s="300,640" data-type="png" data-w="802" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMlBXwMz9fHNUs8ib9a9xx0HO2GgicpFGibMxEtAAwRdmYhV6V7habY4s2Q/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">要将XYZ信号转换为BT.709 RGB信号，使用BT.709的XYZ到RGB的转换矩阵就可以了，如下：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014857" data-ratio="0.20424107142857142" data-s="300,640" data-type="png" data-w="896" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMkMmfdpSvYBg8fjDN10pZVZxcombMEJHVXzRqiaCnBOeic0LW18kNicJvw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">上述两步过程就完成了最简单的色域映射，它将广色域的BT.2020 RGB转换为了窄色域的BT.709 RGB。但是该方法有一个缺点，当广色域转换到窄色域会对信号进行截断（Clip），从而丢失一些色彩信息，导致视频的有些区域会过于饱和。一般来说，更好的色域映射方法是通过色域压缩的方式进行。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">色域压缩可以选择一个人眼看起来相对均匀的色彩空间进行压缩，比如CIE Lab，CIE Luv，在饱和度为某个阈值内的色彩不进行压缩，过于饱和的色彩才进行压缩。在色域压缩的时候，还需要考虑到色相映射（Hue mapping），如果不考虑色相，信号处理的过程可能会有色偏。有些色域压缩的算法的复杂度会非常高，甚至需要用GPU来加速。</p><p style="word-break: break-all;white-space: normal;">下图为BT.2407协议中一种色域映射后的效果图，左图为基于Clip的色域映射，右图为基于压缩方法的色域映射，可以看到优秀的的色域映射算法可以呈现更丰富的细节，它对最后的效果呈现影响非常大。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014859" data-ratio="0.28794326241134754" data-s="300,640" data-type="png" data-w="705" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMpJ5dnibtuZDIrHRYHR0GbXiaj7ENXuxsHrkjEXPKjwP4SojNn43A5PXQ/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>Clip方法和色域压缩方法效果对比图</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">我们的转换引擎也实现了一套自研的色域压缩算法，可以将广色域的视频压缩至sRGB而不会产生色彩溢出，同时也会保留了高饱和区域的细节。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.7 色调映射（Tone mapping）</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">HDR图像包含比传统SDR图像更大的亮度范围，可以捕捉到更多的细节和光照信息。然而，SDR显示设备（如计算机显示器或手机屏幕）的亮度范围有限，无法直接显示HDR图像中的所有细节和对比度。这就需要通过色调映射（Tone mapping）技术将HDR图像转换为SDR图像，使其在常规显示设备上呈现出较好的视觉效果。</p><p style="word-break: break-all;white-space: normal;">下图展示了不同的Tone mapping算法对图像的影响，b为原始HDR图片的色阶图，含有低亮度区域和高光区域，c为归一化（Normalization）方法的进行Tone mapping，虽然c的高光被压缩了，但是它的暗部细节也被等比例压缩，造成暗部细节丢失。d则是简单地将高光进行截断（Clipping），虽然暗部细节保留了，但是高光细节丢失了。e表征了一种更高级的方法，既可以保证暗部细节丢失很少，又可以保留一定的高光细节。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014863" data-ratio="0.23425925925925925" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMK0j1yeMxRGrurHTheACLmQQiaHWIrqtuvnkanD8VN1RHiadvBmevRn9Q/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>不同算法对HDR&nbsp;高光区域渲染的效果</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">图片来源：ITU-R BT.2390-3</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin: 10px 0%;text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 50%;padding-right: 5px;align-self: center;flex: 0 0 auto;"><div style="text-align: center;margin-right: 0%;margin-left: 0%;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014865" data-ratio="0.5606837606837607" data-s="300,640" data-type="png" data-w="585" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMclxrkictTO8RrZiaa7rEsaWxFQClmibibQico1W3CEqp4LQFKLpc2eX6ibSg/640?wx_fmt=png&amp;from=appmsg"></p></div></div><div style="display: inline-block;vertical-align: middle;width: 50%;padding-left: 5px;align-self: center;flex: 0 0 auto;"><div style="text-align: center;margin-right: 0%;margin-left: 0%;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014866" data-ratio="0.5619694397283531" data-s="300,640" data-type="png" data-w="589" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMjj5O0HIEM5QNReAmtZR4KiaPedttW1qyy2VPds6krrMKe7Z8GXF6DUw/640?wx_fmt=png&amp;from=appmsg"></p></div></div></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>基于Clipping和基于压缩算法的Tone mapping效果</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">图片来源：<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>https://www.bilibili.com/video/BV1WA411E7i7</em></span></p><p style="word-break: break-all;white-space: normal;">我们对比了几种常用的Tone mapping算法，并最终选择了BT.2390协议中的一种曲线作为我们Tone mapping的指导算法。BT.2390算法的主要思想是将输入的线性信号转换为PQ空间，以使输入信号更符合人眼的感知特性。然后设定了一个阈值，保证小于该阈值的信号尽可能接近原始信号，大于该阈值的信号通过Hermite样条曲线将其压缩，从而保证了暗部和高光都丢失比较少的细节。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014862" data-ratio="0.767511177347243" data-s="300,640" data-type="png" data-w="671" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMYichuzQo5MkZG51VeSsqlxT13NRMibiaKuYuMXeM1LWCzNrIlcxWHBUXA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>通过BT.2390将线性信号压缩至不同范围的曲线</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">图片来源：ITU-R BT.2390-3</p><p style="word-break: break-all;white-space: normal;">通过色域映射和色调映射，B站最终实现的HDR转SDR效果如下，可以看到，对比于VLC的效果，B站的效果做到了比较好的色相还原，并且保证了饱和度和亮度不溢出，暗部的细节也还原得较好。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin: 10px 0%;text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 50%;padding-right: 5px;align-self: center;flex: 0 0 auto;"><div style="text-align: center;margin-right: 0%;margin-left: 0%;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014864" data-ratio="0.5601851851851852" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMFQa7oKEJOdsDh4FN9JEwg7z1QdicQSN8SpttAnQHeYQaicSNZWOf6weA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div><div style="display: inline-block;vertical-align: middle;width: 50%;padding-left: 5px;align-self: center;flex: 0 0 auto;"><div style="text-align: center;margin-right: 0%;margin-left: 0%;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img data-imgfileid="100014872" data-ratio="0.5592592592592592" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMqbR1rcCey9dA1MicdvJJweibtKQSJjzeiaD7EoBxDeGZ2G7Luox25Jyzw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="margin: 10px 0%;text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 50%;padding-right: 5px;align-self: center;flex: 0 0 auto;"><div style="text-align: center;margin-right: 0%;margin-left: 0%;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014869" data-ratio="0.562962962962963" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMg6DvxLSumPHJDW6nRUUA94l2Liabrnb3ibfuiaIRrT2RQsBCFquSQUicww/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div><div style="display: inline-block;vertical-align: middle;width: 50%;padding-left: 5px;align-self: center;flex: 0 0 auto;"><div style="text-align: center;margin-right: 0%;margin-left: 0%;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014871" data-ratio="0.5592592592592592" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMDdBrNnOEuj4l2Mg98mMHmqdUM7s5dKazUibzpFpzS1hFu6rnLbTaFqw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>B站自研HDR转SDR效果(左)与VLC的效果（右）对比</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.8 HDR动态元数据渲染</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">动态元数据是相对于静态元数据的一个定义，首先介绍一下静态元数据。静态元数据主要包含了整个播放序列的一些参数，包括最高亮度，最大平均亮度，色域信息等。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">HDR视频中静态元数据不随着视频场景的变化而变化，整个播放序列维持着同一个值，终端可以根据静态元数据来判断自身的显示能力能否显示视频内容，一般地，优秀的显示软件会根据自身的显示能力对视频信号进行Tone mapping处理，来保证不丢失高光细节。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">静态元数据的缺点是显而易见的，通过静态元数据进行Tone mapping的方法在整个播放序列中是不变的，以至于它不能适配复杂的场景。有时候它显示高光细节是优秀的，但却无法还原暗部细节；有时候它显示暗部细节不错，但显示高光场景会过曝。总而言之，通过静态元数据进行Tone mapping，它无法识别视频中每个场景的亮度，以至于无法有效地去针对每一个场景进行Tone mapping。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">对比静态元数据，动态元数据则灵活很多。在拥有动态元数据的视频中，视频中的每个场景甚至每帧都会包含一组元数据，来标识视频的亮度信息，它还会对每帧内容生成几组调色曲线来适配不同亮度的显示终端。终端在显示该场景的时候，会根据自身的显示能力来渲染调色曲线，从而让每个场景，无论是暗部还是亮部，都能得到较完美的显示，从而避免了暗部细节和高光细节的丢失。在服务端的色彩空间转换模块中，我们也会根据HDR的动态元数据来生成下变换后的SDR视频，这样生成的SDR视频也会比全局的Tone mapping算法好很多。</p><p style="word-break: break-all;white-space: normal;">包含HDR动态元数据的视频主要包括杜比视界和国产高动态范围视频HDR Vivid，目前我们正在推动HDR Vivid在B站的上线。对于HDR Vivid在服务端的处理，我们除了正常编码一路HDR Vivid，还会借助引擎中动态元数据渲染的能力，来生成一路SDR视频，以适配不支持HDR 的手机。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014870" data-ratio="0.43283582089552236" data-s="300,640" data-type="png" data-w="871" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMPPUw2yYcGicIBzBljtWtic33AFThRPP0uqXV4O4F3E4Ie5QIGLyzxZUA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>HDR Vivid&nbsp;视频在服务端的转换</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>3.&nbsp; &nbsp;工程化加速</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">对于该引擎的工程化加速，我们尝试了很多办法，具体大致有如下图几种：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014868" data-ratio="0.28055555555555556" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMeoibgGtyQ9Hweeymu9WlJbEFHKsASXdVxzfQiaibGa1M1ytdxreQIV30Q/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>工程化加速用到的方法</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">色彩空间转换中，有很多参数是需要预先计算的，比如各种矩阵的参数，图像插值的数值，亮度传递函数中的一些常数等等。如果这些参数在像素处理的时候再去计算会极大地浪费计算资源，所以在引擎初始化的时候就将其计算出来是一个不错的选择。除此，在CUDA计算中，矩阵参数和插值参数也是需要进行预拷贝处理，这样可以避免程序在像素处理中进行频繁拷贝而影响性能。</p><p style="word-break: break-all;white-space: normal;">计算路径优化的主要目的是为了消除重复计算，以找到一个色彩空间到另外一个色彩空间的最优转换路径。举例来说，如果一个视频只需要进行range转换，那么我们无需整个转换路径走一遍，从而避免了额外的色彩转换和电光转换，如下图。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014877" data-ratio="0.4111111111111111" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMVdjvvdo0sH1Mf0vOzO0aXmGLVnLJLcrpgf8lRaPlNCCyq7ibx8C3y6g/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>pc range信号转tv range计算路径优化示意图</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">对于CPU优化来说，色彩空间转换中的幂运算和矩阵乘法对CPU的消耗很大。为了提高程序的性能，在CPU处理中，我们对频繁使用的矩阵乘法和幂运算进行了指令集优化。这样的优化显著提升了程序的性能。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在对幂运算进行指令集优化的过程中，存在一个难点。常见的编译器并没有提供针对幂运算的向量化函数，因此我们需要手动编写一套幂运算函数。为了实现幂运算的向量化优化，首先将pow函数写成形如pow(x, m) = exp(m * log(x))的形式。然后，通过泰勒级数展开逐步实现了经过AVX指令集加速的log(x)和exp(x)函数。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">这种优化策略充分利用了指令集的特性，以提高幂运算和矩阵乘法的计算效率。通过手动编写幂运算函数并进行向量化优化，我们能够更好地利用CPU的计算能力，从而加速色彩空间转换的处理过程。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">除了使用指令集加速，我们还采用了查找表进行优化，通过将复杂的计算提前存储在查找表中，可以显著减少计算量。</p><p style="word-break: break-all;white-space: normal;">通过使用指令集优化和使用查找表优化策略，CPU端的性能提升达到如下</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014876" data-ratio="0.2545018007202881" data-s="300,640" data-type="png" data-w="833" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCML0Wfua5BUTm1WwHC2lNz23veUbqIdk0U8St24HI7vFBb8IhdlcT9Ow/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>CPU加速策略对性能的提升</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">将CPU端的代码进行一系列优化后，通过4K视频在AMD Ryzen 9 5950X上的测试，我们的色彩空间转换引擎的性能达到了如下指标：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014875" data-ratio="0.4065533980582524" data-s="300,640" data-type="png" data-w="824" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCM8d00RegqDSo0n88JsKeTTcT6aAvD0X4LV2VJllYEOF6tVH3FUHmDxQ/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>CPU端色彩空间转换性能实验数据</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">对于CUDA端优化来说，加速手段主要有C++模板和Kernel融合技术。由于色彩空间的属性和种类非常多，需要写很多if else分支，但是CUDA是天然不支持分支预测功能的，所以我们没有将很多if else放在核函数内部，而是使用C++模板来编译kernel函数，这样可以防止kernel中出现很多分支，从而大大加快了GPU的处理速度。</p><p style="word-break: break-all;white-space: normal;">此外，由于CUDA在执行全局内存（Gobal memory）的I/O操作时非常耗时，因此我们应避免为每个细小的操作编写单独的核函数（Kernel）。相反，我们可以将一些操作合并到一个核函数中以减少I/O开销。例如，我们可以将range转换和量化处理合并为一个核函数，将色彩矩阵转换和亮度传递函数的转换也可以合并为一个核函数（如下图所示）。通过合并核函数，我们在一定程度上牺牲了一些通用性，但却能大大节省GPU的I/O开销。这样做是一个明智的选择，特别是在涉及I/O操作频繁的情况下。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014874" data-ratio="0.658965896589659" data-s="300,640" data-type="png" data-w="909" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMVqMPdPVxYUu7mAPD86SCAOslsvn0iauvUvTjLcibfuuLgP7YepdVrnzQ/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>色彩空间转换引擎中kernel融合示意图</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">通过使用C++模板和使用Kernel融合策略，CUDA端的性能提升达到如下</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014873" data-ratio="0.2581818181818182" data-s="300,640" data-type="png" data-w="825" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMcmVFxhrRWkcLGzuxjHQZ5PLDicyA3QIsffjbJFZics1CzKwaOibUDickgA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>CUDA 加速策略对性能的提升</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">将CUDA端的代码进行一系列优化后，通过4K视频在RTX2060上的测试，我们的色彩空间引擎转换性能达到了225FPS+(未编码)，对比于CPU端，处理速度得到了很大的提升，详细数据如下表</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014880" data-ratio="0.40498034076015726" data-s="300,640" data-type="png" data-w="763" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMibsbVdlL90JibvoxXulzDrossCQTXA09ficka3E3B3O9Ro8wZ7icOVZhQA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>CUDA端色彩空间转换性能实验数据（未包含编解码耗时）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>4.&nbsp; &nbsp;总结与展望</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">目前，我们的色彩空间转换引擎已经稳定地在线上为成千上万的用户提供服务。在用户的观看体验中，视频的色彩质量至关重要。因此，将视频的色彩准确呈现在用户眼前一直是我们追求的目标。我们将继续致力于优化色彩转换效果，以提供更好的用户体验。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们实现了一套HDR转SDR的算法，但是当下并没有一个好的算法可以准确评估HDR转SDR的效果，像HDR-VDP（一种客观的图像质量评估方法），它只能评估亮度、对比度、细节上的质量，并无法评估两张图像在色度上的差异。色差公式CIEDE2000可以比较两个像素在亮度、色度、饱和度上的差异，但是由于HDR和SDR之间存在巨大的亮度范围差异，仅仅使用CIEDE2000公式计算的色差值无法准确反映HDR转SDR后的差异。在实际应用中，评估HDR转SDR的效果通常需要结合其他指标和方法，如亮部细节、暗部细节、色相差异等。结合这些指标可以更全面地衡量HDR与SDR之间的差异，以便更好地评估转换后的图像质量和观看体验。</p><p style="word-break: break-all;white-space: normal;">随着高动态范围的视频内容越来越普及，HDR协议也在扩充新的标准，最新的高动态范围标准主要有杜比视界以及HDR Vivid。其中，HDR Vivid是中国超高清视频产业联盟发布的国产高动态范围的视频技术标准，目前最新的开源框架FFmpeg已经集成了HDR Vivid元数据的解码，我们正在将HDR Vivid元数据的渲染集成到我们自己的色彩转换引擎中，来支持国产的动态范围标准，相信未来的不久，大家就可以在B站客户端上欣赏到来自国产高动态范围标准的视频了。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>开发者问答</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;font-size: 13px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>大家在视频色彩空间的处理中遇到过哪些问题？</strong></span>欢迎在留言区告诉我们。转发并留言，小编将选取1则最有价值的评论，送出<span style="text-decoration: underline;"><strong>哔哩哔哩“一笼好运”新春礼盒</strong></span>（见下图）。<span style="color: rgb(255, 102, 149);"><strong>3月8日中午12点开奖。如果喜欢本期内容的话，欢迎点个“在看”吧！</strong></span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 45%;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100014881" data-ratio="1.0935960591133005" data-s="300,640" data-type="png" data-w="812" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754Ru3cG5IrZQU3O5xmPNgnCMxSQLGHqf3JeJQv6I5nEqvRc0ezsicOenOwxYkFIjeAGrQ7OxC4B5VUw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>往期精彩指路</strong></p></div></div></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;font-size: 13px;"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247485169&amp;idx=1&amp;sn=0069b18268b7787387e881e911c02920&amp;chksm=cf2cc3d4f85b4ac29dd6db281056504ed9dc36b3234acfc52466fadaa0f908b160db31077084&amp;scene=21#wechat_redirect" textvalue="是什么影响了视频的码率" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">是什么影响了视频的码率</a></p></li><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247497917&amp;idx=1&amp;sn=e1e73c0bb872d1ffd4a84f83361bdeb7&amp;chksm=cf2f3d98f858b48e6c200e6da673289b1e048f4917226c8c754dac7de57c549459d2012955a0&amp;scene=21#wechat_redirect" textvalue="B站画质补完计划（1）：插帧提升《雍正王朝》等视频流畅度" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">B站画质补完计划（1）：插帧提升《雍正王朝》等视频流畅度</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498477&amp;idx=1&amp;sn=8797700f2462cbf29332f6d7226a2213&amp;chksm=cf2f3fc8f858b6de585c0a822bab314d895b131eca5266dce1556dd0902b66a647e8cba161d5&amp;scene=21#wechat_redirect" textvalue="B站画质补完计划（2）：视频超分让像素细腻生动" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">B站画质补完计划（2）：视频超分让像素细腻生动</a></p></li></ul></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;font-size: 13px;letter-spacing: 4px;" powered-by="xiumi.us"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3289447926347317252#wechat_redirect" textvalue="通用工程" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">通用工程</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2390333109742534656#wechat_redirect" textvalue="大前端" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">大前端</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3297757408550699008#wechat_redirect" textvalue="业务线" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">业务线</span></a><br></p><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2329861166598127619#wechat_redirect" textvalue="大数据" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">大数据</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2782124818895699969#wechat_redirect" textvalue="AI" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">AI</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2532608330440081409#wechat_redirect" textvalue="多媒体" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">多媒体</span></a></p><p><br></p></div><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="Mzg3Njc0NTgwMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754SVM7VMibhzz9AicOz5qdQ5oaN6TgXhbVyGHQYPwBErEYQCOnhibA1Qp431JkpPKY0qGhT0EfDchicXMQ/0?wx_fmt=png" data-nickname="哔哩哔哩技术" data-alias="bilibili-TC" data-signature="提供B站相关技术的介绍和讲解" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzUxNTE4OTc0Mg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EVKwaZXNTl9OCCo7pxLHz2e2I3kV3rTPao5LlIickfJS79DNd2yjqjfYEtwtMOyVuKhJoDIq6UU4U9TQbjvOLaQ/0?wx_fmt=png" data-nickname="哔哩哔哩招聘" data-alias="" data-signature="生产快乐的地方" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p></div><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p>]]></summary>
        <author>
            <name>罗引杰&amp;尹壮</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[B站画质补完计划（2）：视频超分让像素细腻生动]]></title>
        <id>2247498477_1</id>
        <link href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498477&amp;idx=1&amp;sn=8797700f2462cbf29332f6d7226a2213&amp;chksm=cf2f3fc8f858b6de585c0a822bab314d895b131eca5266dce1556dd0902b66a647e8cba161d5#rd"/>
        <updated>2024-03-01T04:12:12.000Z</updated>
        <summary type="html"><![CDATA[<div><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>本期作者</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;background-position: center center;background-repeat: no-repeat;background-size: cover;overflow: hidden;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmW7EZ5NvB9smm2YrjALpMIYWN8XYfsuzQw10yUcUljb9syeqb1ay40NQ/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014798" data-ratio="1" data-s="300,640" data-type="jpeg" data-w="602" style="width: 100%;opacity: 0;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmW7EZ5NvB9smm2YrjALpMIYWN8XYfsuzQw10yUcUljb9syeqb1ay40NQ/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>徐嘉文</p></div><div style="margin-top: 5px;text-align: justify;font-size: 12px;"><p style="text-align: center;white-space: normal;">哔哩哔哩算法工程师</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 53%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>张雅君</p></div><div style="margin-top: 5px;font-size: 12px;"><p style="text-align: left;">哔哩哔哩高级算法工程师</p></div></div></div></div><div style="display: inline-block;vertical-align: middle;width: 32%;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 13.5417%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWEQRWAmAvuK6Ota50TVlNNsxxIa7BBmnY8ib52MaQAj4M8uPdt8kzlgA/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014796" data-ratio="1.4" data-s="300,640" data-type="jpeg" data-w="295" style="width: 100%;opacity: 0;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWEQRWAmAvuK6Ota50TVlNNsxxIa7BBmnY8ib52MaQAj4M8uPdt8kzlgA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 59.375%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWnrGzLic6B3DQwE8HsaosKspMsxqyubwJB4kvk4NibdZmjzFS4sRqglVA/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014799" data-ratio="1.3333333333333333" data-s="300,640" data-type="jpeg" data-w="1080" style="width: 100%;opacity: 0;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWnrGzLic6B3DQwE8HsaosKspMsxqyubwJB4kvk4NibdZmjzFS4sRqglVA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>张鹏伟</p></div><div style="margin-top: 5px;text-align: justify;font-size: 12px;"><p style="text-align: center;white-space: normal;">哔哩哔哩资深开发工程师</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 53%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>蔡春磊</p></div><div style="margin-top: 5px;font-size: 12px;"><p style="text-align: left;">哔哩哔哩多媒体算法teamleader</p></div></div></div></div><div style="display: inline-block;vertical-align: middle;width: 32%;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 45.8333%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWIUgRHgOtkv4ibdEJjfXswaUQqM9RVmI0PmFyRdwhpk9tcGHB4HUSJOg/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014797" data-ratio="1.5" data-s="300,640" data-type="jpeg" data-w="1080" style="width: 100%;opacity: 0;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWIUgRHgOtkv4ibdEJjfXswaUQqM9RVmI0PmFyRdwhpk9tcGHB4HUSJOg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>1 前言</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">为了给用户提供更清晰的画质体验，B站自研的超分辨率算法已经在站内广泛应用，支持了如<strong>《赛马娘》、《流浪地球2》、《权力的游戏》、英雄联盟S赛赛事直播</strong>等知名番剧、电影电视剧以及重要游戏赛事直播的 4K 视频流生产。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>2 超分算法的应用背景</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.1 不同分辨率视频的画质差异</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">随着终端显示技术的快速发展，4K 规格的终端显示设备已经逐渐开始普及，用户对于 4K 清晰度视频的观看需求也呈现出不断增长的趋势。然而，由于制作年代久远、拍摄设备受限等原因，流媒体平台上大量视频片源还是以 1080P、720P 的规格存在，无法满足用户在高规格显示设备上观看 4K 清晰度视频的需求。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>那么，1080P 视频和 4K 视频的画面质量差距有多大呢</strong>？可以参考图1中的视频画面对比，由于 1080P 视频画面里没有足够多的有效像素去描述草地的纹理、圆柱的线条，因此其呈现的草地纹理细节远没有 4K 视频画面中丰富，圆柱线条也远没有 4K 视频画面中流畅。</p><p style="word-break: break-all;white-space: normal;"><strong>为了满足不断增长的 4K 清晰度视频的观看需求，可以将低分辨率视频增强提升为高分辨率视频，所使用的技术称为超分辨率（ Super Resolution ）。</strong></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014800" data-ratio="1.9826302729528535" data-s="300,640" data-type="png" data-w="806" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWOibT9quiaUvjRqpr6TKwj8UeibFRjH0kF8Qf7ibkbsibq3UZMdje2pAw7AA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图1. 1080P 视频和 4K 视频的画面质量对比</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>&nbsp;2.2 传统插值超分算法的局限</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">各类超分辨率算法中，在实际应用层面覆盖范围最广的是传统插值超分算法。传统插值超分算法（最近邻差值、双线性插值、双三次插值等等）的原理是利用原始画面中的部分像素作为原始信息并根据某些规则对新像素的像素值进行预测。<strong>传统插值超分算法解决的问题是可以将原始视频的分辨率高效地上采样到任意规格，以适应各种高规格显示设备的实际播放尺寸。</strong></p><p style="word-break: break-all;white-space: normal;"><strong>但是，传统插值超分算法缺乏足够的非线性拟合能力来复现复杂的图像特征，无法真正还原缺失的纹理细节。</strong>如图2所示，1080P 原始视频画面中缺失的草地细节在经过传统插值超分算法处理后并未被恢复。因此，其主要作用仅限于调整视频播放的尺寸，并不能改善原始视频的画面质量。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014801" data-ratio="0.6333333333333333" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWFUZsM7cC9IPupauKAprMAoblnw6YTZLOJfiaaHVXtCP0pmlEIrFL3aA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图2. 传统插值超分算法的局限</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.3 深度学习超分算法的应用价值</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">由于插值超分算法在提升分辨率的同时并不能真正还原缺失的纹理细节，因此如果想要在高分辨率屏幕上获得更优质的观看体验，就<strong>需要一种在提升分辨率的同时又能拟合复杂纹理细节的超分算法，基于深度学习的超分算法在这方面展现了出色的效果。</strong>如图3所示，低分辨率图像块在经过插值超分算法处理后线条边缘仍存在一定程度的伪影，且整体观感较为模糊。对比之下，经过深度学习超分算法处理后的高分辨率图像块显然减少了线条附近的伪影，线条边缘更加连续。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014802" data-ratio="0.6842592592592592" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWJ0x3bNic1hZFEkgMv1BneKlEt7sw1kJlLaa2Z7LHTlJnYicm2R4UmY9g/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图3. 插值算法与超分算法的处理结果对比</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.4 超分算法的难点及基于深度学习的</strong><strong style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">解决方案</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">超分辨率算法的原理如图4所示，低分辨率像素块在像素域扩充后得到高分辨率像素块，高分辨率像素块中存在诸多未知像素值的像素，而超分辨率算法的作用就是预测出合理的像素值以提升高分辨率像素块的画面质量。从原理上看，超分算法的难点在于这是一个不适定问题，其潜在的解空间可能很大，很难找出唯一的最优解。</p><p style="word-break: break-all;white-space: normal;">因此，对于基于深度学习的超分算法的落地而言，需要解决两个最关键的问题：<strong>1. 如何给不同类型的输入像素块提供一个合适的优化方向？2. 如何设计一个合理的算法链路实现对输入像素块的优化？</strong></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014806" data-ratio="0.32685185185185184" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWQ4DYNWibqRyPicIzpVS2xBKrPJIA9kKfE1iaX7F2WOu1R80jtpMVukecQ/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图4. 超分算法的基本原理</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">针对第一个问题，<strong>我们对海量视频做了基础画质特征分析，并根据画质分析的结果对视频内容进行分类，给不同类别的视频内容设定不同的优化方向，并提供了业务上落地的具体案例，这部分内容将在第三章节进行详细介绍。</strong></p><p style="word-break: break-all;white-space: normal;">对于第二个问题，<strong>我们自研了一套超分算法，完成了从数据模拟、模型结构设计到损失函数定义的整套技术链路研发，这部分内容将在第四章节进行详细介绍。</strong></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>3 基础画质特征及画质优化方向分析</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">在本章节，我们将对站内海量视频进行了基础画质特征分析，发现不同内容的视频在基础画质特征上有明显差异。根据这种差异我们给不同内容的视频提供了专项的优化方向，并提供了业务上落地的案例。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.1 基础画质特征分析</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在实际应用超分算法提升视频清晰度的过程中，需要考虑到不同内容的视频在基础画质特征上的差异，进而可能导致优化方向的不同。如图5所示，我们对不同内容的视频画面做了离散余弦变换 ( DCT 变换)，并在频域上观测其强度值的分布。需要说明的是，DCT 变换后的频域图的低频部分集中在左上角，高频部分集中在右下角。<strong>我们发现动漫、游戏和真实世界视频在频域上的响应有明显差距。</strong></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>动漫视频画面</strong>的频域响应集中在低频区域，意味着动漫视频画面在像素域上主要由大面积的纯色区域以及粗粒度的线条构成。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>游戏视频画面</strong>增加了高频部分的响应，但响应主要还是集中在低频区域，意味着游戏类视频画面和动漫视频在像素域上拥有相似的特点，但在此基础上增加了一些有高频属性的复杂纹理、细粒度线条结构。</p><p style="word-break: break-all;white-space: normal;"><strong>真实世界视频画面</strong>的频域响应范围最广，在高频部分的响应最强，意味着这类视频在像素域上的纹理结构最为复杂，有着细腻的纹理细节，而这点在诸如动物毛发、皮肤表面的构造上也有所体现。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014805" data-ratio="0.9259259259259259" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWW3z7ibfJu5CrsAh3xuFmUhLl8QVe5Pmqt3RcuRDljaB8zstA9SOsjDg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="text-align: center;white-space: normal;" powered-by="xiumi.us"><sup>图5. 视频画面频域变换</sup><br></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.2 画质优化方向分析及落地案例展示</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">如图6所示，根据对海量视频进行基础画质特征分析的结果，考虑到动漫、游戏和真实世界视频在画质基础特征上呈现的不同点，我们给各类视频设计了特定的优化方向，并提供了业务上落地的具体案例进行展示。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014803" data-ratio="0.4046296296296296" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWzSPowdejQaCUhNSPWvp3OJhIySe7dJ2BkT2G2habBspZroHu3CqicdA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图6. 线上超分业务落地逻辑</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.2.1 动漫视频</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>优化方向：</strong>对于动漫视频，其画面的构成元素大多是纯色区域、粗粒度的线条结构，缺乏复杂、细腻的纹理结构。因此，针对动漫视频的重点优化方向是提升线条的锐利程度，去除大面积色块中的画面噪声。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>案例一：</strong>由图7可知，《赛马娘》视频画面中人物面部线条、服饰线条在经过动漫超分模型处理后变得更加连续、锐利，大面积纯色区域中的画面噪声得到去除，整体清晰度得到大幅提升。</p><p style="word-break: break-all;white-space: normal;"><strong>案例二：</strong>同样地，图8《知晓天空之蓝的人啊》视频画面中架子鼓、人物面部的轮廓线条在经过动漫超分模型的优化后变得更加平滑、锐利。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014808" data-ratio="1.087962962962963" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmW8n3qb4U7qme7W2mXw5DvQ9QCluq4cGnicz79QKia7UxHiaFHo2iaZK1Krg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图7. 《赛马娘》画面超分前后画质对比，上图为超分前，下图为超分后</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014807" data-ratio="1.087962962962963" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWwfn6D932l2EvNFicTHXSda19oM0ibgl59Z9xbUL0uLZxRdtmnb6W0tQg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图8. 《知晓天空之蓝的人啊》画面超分前后画质对比，上图为超分前，下图为超分后</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.2.2 游戏视频</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>优化方向：</strong>对于游戏视频，其画面的构成元素与动漫视频相近，但在此基础上又有相对复杂的纹理结构。因此，对游戏视频画面的优化需要兼顾线条锐利程度的提升、噪声去除，以及对纹理结构的强化。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>案例一：</strong>由图9可知，经过游戏超分模型处理，王者荣耀视频中英雄轮廓变得更加连续，画面噪声被成功去除，与此同时，草地、树木等较为复杂的纹理细节也得到了恢复，画面整体清晰度得到大幅提升。</p><p style="word-break: break-all;white-space: normal;"><strong>案例二：</strong>由图10可知，经过游戏超分模型处理，炉石传说视频中蓝色宝石的观感从模糊变得清晰，同时文字边缘的锯齿得到了有效消除，呈现出更为连续、锐利的外观。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014809" data-ratio="1.087962962962963" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmW5eAOLm5cBxIEmozGMbugqt8SHrlOqEdiaAUeZGwotZicTZqaSjUDwkhg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图9. 王者荣耀游戏画面超分前后画质对比，上图为超分前，下图为超分后</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014811" data-ratio="1.087037037037037" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWCBc8MPXeHUKBY8vIy2UNZheS9CPzib8eo7IiaiaLbFdIEDYVooibqMsInQ/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图10. 炉石传说游戏画面超分前后画质对比，上图为超分前，下图为超分后</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.2.3 真实世界视频</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>优化方向：</strong>对于真实世界视频而言，其画面的构成元素主要由细粒度的线条和复杂、细腻的纹理构成。因此，针对真实世界视频的优化方向是对细粒度的线条结构以及复杂纹理结构的强化。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>案例一：</strong>在图11可知，经过真实世界超分模型处理后，画面中高楼建筑外立面的清晰度明显提升，马路边绿化的细节也得到大幅增强，绿化带中树叶的细节变得更加丰富。</p><p style="word-break: break-all;white-space: normal;"><strong>案例二：</strong>图12中人物的头发细节在经过真实世界超分模型处理后变得更加细腻，细小的发丝也变得清晰可见。人物衣物上的纹理细节也得到强化，织物表面呈现出更为丰富的层次感。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014810" data-ratio="1.087962962962963" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWIsOjQF0UX77jFib334rOs61L2UNMGjVpibst2IiarAATHJwaahLSpHGcg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图11. 《前任4》画面超分前后画质对比，上图为超分前，下图为超分后</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014814" data-ratio="1.087962962962963" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWQnqMH8NZnbQRMsic1Hj6CFKxnl0SPujat4REVOg2pX5QUqRba308zQA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">图12. 《权力的游戏》画面超分前后画质对比，</span><span style="font-size: 13px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">上图为超分前，下图为超分后</span><br></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>4 自研超分算法设计细节</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">本章节将介绍B站自研超分算法的实现细节。如图13所示，关键的算法包含三个部分：<strong>降质方法，模型结构，以及损失函数</strong>，每个部分的设计细节将在以下小节内作具体介绍。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014813" data-ratio="0.9055555555555556" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWVNF8ibYa4MZ6yIFibOv8HazEMkYqzZDvZzXyl9oFicHKZJFeLT4UF02eg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><br></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图13. 超分算法 Pipeline</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>&nbsp;4.1 降质方法</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>4.1.1 主流降质方法</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在超分辨率领域，较为主流的降质方法为 Real-ESRGAN 论文中提到的高阶降质策略。对于一个降质周期而言，其模拟的都是图像从成像、处理、编码、传输过程中可能经历的退化过程，而高阶降质策略就是将图像经过多个相似的降质周期处理，进而产生低清图像。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">然而在实际生产过程中，由于不同内容视频的优化方向不同，降质的策略也会有所变化。例如，对于动漫视频，超分模型的优化方向是增强线条的锐利度和去除纯色区域的画面噪声，所以降质策略的重点在于对线条的破坏和对噪声的模拟。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">但是对于真实世界视频，超分模型优化的方向是增强图像中的纹理信息，当降质过程中线条被过度破坏或噪声添加过度时，原始图像中存在的纹理信息往往会被模型当作噪声抹去，导致模型生成的高分辨率图像有涂抹感和平滑感。</p><p style="word-break: break-all;white-space: normal;"><strong>因此，为了适应不同视频内容所对应的模型优化方向，需要微调高阶降质策略中的某些子模块，然而在现有的串行降质方法中，微调子模块的工作量较大且结果往往不可控。</strong></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014815" data-ratio="0.40370370370370373" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWLge1cZZfJWGQy11eNRicTvf5U2fW3tgbic0teuIH2icRsMXuI4KeuPHHA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><br></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图14. Real-ESRGAN 降质方法</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>4.1.2 自研降质方法</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">因此，我们自研了一种适配实际应用的降质方法，目标是降低微调降质策略的工作量，且让微调的结果稳定可控。我们没有采用类似于 Real-ESRGAN 中串行的降质方法，而是自研了一种更有针对性的具有并行结构的降质策略。并行降质分为三个分支，分别为<strong>面向纹理增强的降质、面向线条恢复的降质以及面向噪声去除的降质。</strong></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014812" data-ratio="0.35" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWAexIj5ulV2ayLRmIIgD8qEyeGxVUGdhkR18iacblzyZMSwXlgJfAV4Q/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图15. 自研降质方法</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>面向纹理增强的降质</strong>由轻度模糊退化、上下采样和压缩退化构成，其目的是轻微破坏高清图像中的纹理结构信息，但由于降质程度较轻，原始纹理信息又有所保留，给模型提供一个稳定优化纹理的优化方向。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>面向线条恢复的降质</strong>由随机模糊退化、上下采样和压缩退化构成，其目的是较大程度地破坏高清图像中的线条，使模型在训练过程中获得将扭曲断裂的线条恢复成连续流畅的能力。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>面向噪声去除的降质</strong>由随机高斯噪声、随机柏松噪声以及随机压缩退化构成，其目的是给高清图像添加一定的程度的噪声，使模型在训练过程中获得去除噪声的能力。</p><p style="word-break: break-all;white-space: normal;">三个分支的降质结果会被赋予相对应的权重，并最终相加形成最终的降质结果，而权重的赋值是与视频内容高度相关的。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>4.2 模型结构</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>4.2.1 整体框架</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">对于模型结构，我们有针对性地设计了两个串联的模块，分别为<strong>结构信息处理模块和纹理信息处理模块。</strong>结构信息处理模块对大尺度结构信息敏感，负责去除平滑区域的噪声、修复物体的轮廓线条。<strong>纹理信息处理模块</strong>负责对细粒度的纹理细节进行一定程度的拟合和增强。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">对于<strong>结构信息处理模块</strong>，由于这部分图像信息处理难度不高，所以先对输入进行 Pixel Unshuffle 下采样，并牺牲一些通道数，用较小的算力和较大感受野对粗粒度的结构信息进行处理，得到粗估计结果。</p><p style="word-break: break-all;white-space: normal;">对于<strong>纹理信息处理模块</strong>，需要对细粒度的纹理细节进行拟合，故在输入尺寸上对粗估计的结果进行精调。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014816" data-ratio="0.6194444444444445" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWR6UicoArhjneVSeuqV05t1oMDBByb6ffDfBjXUjna5UyiapRzlBEmIxg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图16. 自研超分模型结构设计</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>4.2.2 基本组件</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">实际上，结构信息处理模块和纹理信息处理模块采用的是同一种卷积模块<strong>&nbsp;REPB</strong>，其全称为&nbsp;<strong>Residual Efficient re-Parameterization Block</strong>。<strong>REPB</strong>&nbsp;有两个基本的组件，分别为<strong>&nbsp;Conv-x</strong>&nbsp;和<strong>&nbsp;ESA</strong>。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>Conv-x&nbsp;</strong>是一组运用了重参数化技巧的卷积核，在训练时有三个并行的分支，分别为 3x3、5x5、1x1 卷积核和残差连接。由于卷积核的线性可加特性，故在推理时可将三个并行分支的权重合并为同一个卷积核下的权重，在不牺牲效果的条件下获得更高的推理效率。</p><p style="word-break: break-all;white-space: normal;"><strong>ESA</strong>全称为<strong>&nbsp;Efficient Self-Attention</strong>，是一种高效的自注意力机制，通过池化层和残差结构的组合来对局部和非局部的图像特征进行融合，并对某些重要的结构、纹理特征进行强化。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>4.3 损失函数</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">同样地，在设计损失函数时，我们也充分考虑到了模型在处理不同内容的输入时需要有不同优化方向的需求，故有针对性地采用了<strong>像素损失函数、线条损失函数</strong>以及<strong>纹理损失函数</strong>，并通过加权的方式得到最终的损失函数，以适应不同的超分内容。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>4.3.1 像素损失函数</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">像素损失函数计算了图像真值和模型预测值的逐像素差值之和，并通过求平均的方式得到最终的整体损失。像素损失函数衡量的是图像真值和模型预测值的整体差异，为模型提供全局的优化方向。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014819" data-ratio="0.762962962962963" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWvpA7hYAklnQQXrYGAxNTUaias2Spx2ZloD8aLLqqtibl40lic3k0pGZkg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图17. 像素损失函数</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>4.3.2 线条损失函数</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">对于线条损失函数的构建，我们先对图像真值通过 Sobel 算子提取图像内的边缘信息，进一步经过阈值分割得到初步的线条区域掩膜，将初步的线条区域进行膨胀腐蚀得到覆盖范围更大的线条掩膜。最终，将线条掩膜附加于像素损失函数上，得到对线条恢复更有针对性的线条损失函数。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014821" data-ratio="0.5842592592592593" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWGQ1qRXWb6tVW4PwIc9diaILR6gLffSENdEibo2SQibXbCbYFnN9QibkJRA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图18. 线条损失函数</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>4.3.3 纹理损失函数</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">对于纹理损失函数，首先将图像真值和模型预测值进行切块得到两组能更好描述图像局部纹理结构的小图像块集合，再对两组小图像块集合进行结构相似性（SSIM）的计算。SSIM 衡量了局部纹理细节的相似程度，相似程度越高，SSIM 的数值越接近1。最终，将两组小图像块集合的 SSIM 值求平均并计算与理论最优值的差距，我们就构造出了描述真值与预测值纹理相似程度的纹理损失函数。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014820" data-ratio="0.5657407407407408" data-s="300,640" data-type="jpeg" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWURSZYCjKULywbXDIwDljgm2GibnqI3ziaDCXCWpxYw8ZbKWdZibUH7x0w/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><span style="font-size: 13px;">图19. 纹理损失函数</span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">最后，<strong>根据视频内容以及优化方向的不同，像素、线条、纹理损失函数会被赋予相应的权重，并通过加权的方式得到最终的损失函数</strong>。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>5 总结与展望</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">作为B站视频画质矩阵的关键组成部分，我们的视频超分算法以提高视频画质为出发点，旨在为用户创造极致清晰的视频观看体验。在实际的算法落地实践中，我们从超分算法的基本原理出发，经过对海量视频的基础画质特征和优化方向的分析，配合算法层面的合理设计，最终实现了清晰自然的画质优化效果。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">目前， 超分算法已成功投入线上点播业务，并已支持了大量视频的高分辨率视频流生产。未来，我们将持续在覆盖范围、主观效果和部署灵活度等方面进行算法的迭代更新，以在直播、点播、应用端等多个场景为视频画质提供更大的增益。</p><p style="word-break: break-all;white-space: normal;">B站对画质的优化，不仅依靠的是视频超分算法的巧妙应用，我们多媒体实验室画质矩阵中的画质增强、人脸修复、HDR、插帧等技术同样发挥着至关重要的作用。关注哔哩哔哩多媒体实验室，我们将陆续分享更多画质相关技术文章，敬请期待。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;white-space: normal;">哔哩哔哩<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3082123172369383426#wechat_redirect" textvalue="多媒体实验室" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2">多媒体实验室</a>（bilibili mlab）是一支技术驱动的年轻队伍，具备完善的多媒体技术能力，以清晰流畅的极致视频体验为目标，通过对自研视频编码器、高效转码策略、视频图像分析与处理、画质评价等技术的持续打磨和算法创新，提出了<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247486956&amp;idx=1&amp;sn=cd8f971697eafa4dc1394c220195b7e6&amp;chksm=cf2cc8c9f85b41dfa4744b143cb91c774c442b514efcf67f1ba5765852f77e8c4e0094d80473&amp;scene=21#wechat_redirect" textvalue="画质可控的自适应转码算法" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">画质可控的自适应转码算法</a>、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247491507&amp;idx=3&amp;sn=9a34d561f3126596d6437151fb5527c7&amp;chksm=cf2cda96f85b53802aa3f2697120db4fff078a1c3cdb662498acb3e08a6fbde7db6bc6b5ece2&amp;scene=21#wechat_redirect" textvalue="超实时4K60FPS直播超分" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">超实时4K60FPS直播超分</a>、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247496515&amp;idx=1&amp;sn=f92b17b0ce4ea7d55488fc04f520cdf9&amp;chksm=cf2f3666f858bf70d113e8d3a0642199d45001a98f15572f3c4bbc8d79a83d69b24ca87d2d81&amp;scene=21#wechat_redirect" textvalue="视频画质评价" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">视频画质评价</a>、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247496459&amp;idx=1&amp;sn=f3144d31fa8c2857c43caf2b2a2b76cf&amp;chksm=cf2f362ef858bf382cba3a4908df1a34640db1c999f266a10b84a5dba37e4cb7a84fa63f2257&amp;scene=21#wechat_redirect" textvalue="数字水印" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">数字水印</a>、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247497296&amp;idx=1&amp;sn=170fcbaebf586b9bf3dee7102e849f3a&amp;chksm=cf2f3375f858ba63090acf131ca8f6d6bb7265f258b3657b9a0f3f978908282cb5aa5a7b38f0&amp;scene=21#wechat_redirect" textvalue="高性能多媒体算法推理基座" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">高性能多媒体算法推理基座</a>、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247497504&amp;idx=1&amp;sn=80c2a6f15d7448d2d5d39cd60e24048d&amp;chksm=cf2f3205f858bb13000cd82758da10b8e11372b33c4586cda866611e0ced8af3b5a0116945d6&amp;scene=21#wechat_redirect" textvalue="自研编码器" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">自研编码器</a>、<a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247497917&amp;idx=1&amp;sn=e1e73c0bb872d1ffd4a84f83361bdeb7&amp;chksm=cf2f3d98f858b48e6c200e6da673289b1e048f4917226c8c754dac7de57c549459d2012955a0&amp;scene=21#wechat_redirect" textvalue="视频插帧" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">视频插帧</a>等诸多高质量、低成本的多媒体解决方案，从系统尺度提升了整个多媒体系统的性能和效率, 助力哔哩哔哩成为体验最好的互联网视频社区。</p></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>开发者问答</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;font-size: 13px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>大家还对超分辨率技术落地过程中的哪些问题感兴趣呢？</strong></span>欢迎在留言区告诉我们。转发并留言，小编将选取1则最有价值的评论，送出<span style="text-decoration: underline;"><strong>日版赫斯缇雅手办景品一个</strong></span>（见下图）。<span style="color: rgb(255, 102, 149);"><strong>3月5日中午12点开奖。如果喜欢本期内容的话，欢迎点个“在看”吧！</strong></span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 35%;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100014818" data-ratio="2.19941348973607" data-s="300,640" data-type="jpeg" data-w="682" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QkLficCicCQ0XibTXXoH1mhmWPbWyjK2SbPqrpyMejLO9UdibiccHdrJWEU8zbSuHjibVwrESXpZu0iczNQ/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>往期精彩指路</strong></p></div></div></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;font-size: 13px;"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247497917&amp;idx=1&amp;sn=e1e73c0bb872d1ffd4a84f83361bdeb7&amp;chksm=cf2f3d98f858b48e6c200e6da673289b1e048f4917226c8c754dac7de57c549459d2012955a0&amp;scene=21#wechat_redirect" textvalue="B站画质补完计划（1）：插帧提升《雍正王朝》等视频流畅度" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">B站画质补完计划（1）：插帧提升《雍正王朝》等视频流畅度</a></p></li><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247496872&amp;idx=1&amp;sn=7647f520422d80760060e18a99163d13&amp;chksm=cf2f318df858b89b7da28bad96e56672859fa867a731040e60bd2751592f6a13ae4f3e85df72&amp;scene=21#wechat_redirect" textvalue="基于多模态的视频高能点提取技术" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">基于多模态的视频高能点提取技术</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247497296&amp;idx=1&amp;sn=170fcbaebf586b9bf3dee7102e849f3a&amp;chksm=cf2f3375f858ba63090acf131ca8f6d6bb7265f258b3657b9a0f3f978908282cb5aa5a7b38f0&amp;scene=21#wechat_redirect" textvalue="BVT：高性能多媒体算法推理基座" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">BVT：高性能多媒体算法推理基座</a></p></li></ul></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;font-size: 13px;letter-spacing: 4px;" powered-by="xiumi.us"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3289447926347317252#wechat_redirect" textvalue="通用工程" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">通用工程</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2390333109742534656#wechat_redirect" textvalue="大前端" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">大前端</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3297757408550699008#wechat_redirect" textvalue="业务线" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">业务线</span></a><br></p><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2329861166598127619#wechat_redirect" textvalue="大数据" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">大数据</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2782124818895699969#wechat_redirect" textvalue="AI" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">AI</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2532608330440081409#wechat_redirect" textvalue="多媒体" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">多媒体</span></a></p></div></div><p class="mp_profile_iframe_wrp"><mp-common-profile class="custom_select_card mp_profile_iframe mp_common_widget" data-pluginname="mpprofile" data-id="MzUxNTE4OTc0Mg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EVKwaZXNTl9OCCo7pxLHz2e2I3kV3rTPao5LlIickfJS79DNd2yjqjfYEtwtMOyVuKhJoDIq6UU4U9TQbjvOLaQ/0?wx_fmt=png" data-nickname="哔哩哔哩招聘" data-signature="生产快乐的地方" data-from="0"></mp-common-profile></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="custom_select_card mp_profile_iframe mp_common_widget" data-pluginname="mpprofile" data-id="Mzg3Njc0NTgwMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754SVM7VMibhzz9AicOz5qdQ5oaN6TgXhbVyGHQYPwBErEYQCOnhibA1Qp431JkpPKY0qGhT0EfDchicXMQ/0?wx_fmt=png" data-nickname="哔哩哔哩技术" data-alias="bilibili-TC" data-signature="提供B站相关技术的介绍和讲解" data-from="0"></mp-common-profile></p><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p>]]></summary>
        <author>
            <name>多媒体实验室</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[FFmpeg前端视频合成实践]]></title>
        <id>2247498441_1</id>
        <link href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498441&amp;idx=1&amp;sn=0fb84abc1a311880c1bb7591c83a80b4&amp;chksm=cf2f3fecf858b6facb7e050f46fe89e72e6eea9c4f346bbfc37287eadfdccc19c8735bff69a4#rd"/>
        <updated>2024-02-26T12:59:06.000Z</updated>
        <summary type="html"><![CDATA[<div style="line-height: 1.6;font-size: 16px;"><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>本期作者</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 100% 100%;background-repeat: no-repeat;background-size: 162.5%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhb37rnJdfmWN79picD1Q1NkzrcK8HFrJugobtMribEWwVrnOh3AhA54SEw/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014774" data-ratio="1" data-s="300,640" data-type="jpeg" data-w="640" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhb37rnJdfmWN79picD1Q1NkzrcK8HFrJugobtMribEWwVrnOh3AhA54SEw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>梁晴天</p></div><div style="margin-top: 5px;text-align: justify;font-size: 14px;"><p style="text-align: center;white-space: normal;">哔哩哔哩高级开发工程师</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>视频合成能力的开发背景</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">想要开发一个具有视频合成功能的应用，从原理层面和应用层面都有一定的复杂度。原理上，视频合成需要应用使用各种算法对音视频数据进行编解码，并处理各类不同音视频格式的封装；应用上，视频合成流程较长，需要对多个输入文件进行并行处理，以实现视频滤镜、剪辑、拼接等功能，使用应用场景变得复杂。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">视频合成应用的代表是各类视频剪辑软件，过去主要以原生应用的形式存在。近年来随着浏览器的接口和能力的不断开放，逐渐也有了Web端视频合成能力的解决思路和方案。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">本文介绍的是一种基于FFmpeg + WebAssembly开发的视频合成能力，与社区既有的方案相比，此方案通过JSON来描述视频合成过程，可提高业务侧使用的便利性和灵活性，对应更多视频合成业务场景。</p><p style="word-break: break-all;white-space: normal;">2023年上半年，基于AI进行内容创作的AIGC趋势来袭。笔者所在的团队负责B站的创作、投稿等业务，也在此期间参与了相关的AIGC创作工具类项目，并负责项目中的Web前端视频合成能力的开发。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>技术选型</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">如果需要在应用中引入音视频相关能力，目前业界常见的方案之一是使用FFmpeg。FFmpeg是知名的音视频综合处理框架，使用C语言写成，可提供音视频的录制、格式转换、编辑合成、推流等多种功能。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">而为了在浏览器中能够使用FFmpeg，我们则需要WebAssembly + Emscripten这两种技术：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">WebAssembly是浏览器可以运行的一种类汇编语言，常用于浏览器端上高性能运算的场景。汇编语言一般难以手写，因此有了通过其他高级语言（C/C++, Go, Rust等）编译到WebAssembly的方案。</p></li><li><p style="word-break: break-all;">Emscripten则是一个适用于C/C++项目的编译工具包，我们可以用它来将C/C++项目编译成WebAssembly，并移植到浏览器中运行。WebAssembly + Emscripten两者构筑了C语言项目在浏览器中运行的环境。再加上FFmpeg模块提供的实际的音视频处理能力，理论上我们就可以在浏览器中进行视频合成了。</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>编译FFmpeg至WebAssembly</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">想要通过Emscripten将FFmpeg编译至WebAssembly，需要使用Emscripten。Emscripten本身是一系列编译工具的合称，它仿照gcc中的编译器、链接器、汇编器等程序的分类方式，实现了处理wasm32对象文件的对应工具，例如emcc用于编译到wasm32、wasm-ld用于链接wasm32格式的对象文件等。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">而对于FFmpeg这个大型项目来说，其模块主要分为以下三个部分</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">libav系列库，是构成FFmpeg本身的重要组成部分。提供了用于音视频处理的大量函数，涵盖格式封装、编解码、滤镜、工具函数等多方面</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">第三方库，指的是并非FFmpeg原生提供，需要在编译FFmpeg时，通过编译配置来选择性添加的模块。包括第三方的格式、编解码、协议、硬件加速能力等</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">fftools，FFmpeg提供的三个可执行程序，提供命令行参数界面，使得音视频相关功能的使用更加方便。三个可执行程序分别用于音视频合成、音视频播放、音视频文件元信息提取。因此在编译FFmpeg至WebAssembly时，我们需要按照“优先库，最终可执行程序”的顺序，首先将libav系列库和第三方库编译至wasm32对象文件，最后再编译可执行程序至wasm32对象文件，并与前面的产物链接为完整的FFmpeg WebAssembly版。</p></li></ul><p style="word-break: break-all;white-space: normal;">自行编译FFmpeg到WebAsssembly难度较大，我们在实际在为项目落地时，选择了社区维护的版本。目前社区内维护比较积极，功能相对全面的是<span style="text-decoration: underline;">ffmpeg.wasm</span>（<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>https://github.com/ffmpegwasm/ffmpeg.wasm</em></span>）项目。该项目作者也提供了如何<span style="text-decoration: underline;">自行编译FFmpeg到WebAssembly的系列博文</span>（<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>https://itnext.io/build-ffmpeg-webassembly-version-ffmpeg-js-part-1-preparation-ed12bf4c8fac</em></span>）</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>FFmpeg在浏览器的运行</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">FFmpeg本身是一个可执行命令行程序。我们可以通过为FFmpeg程序输入不同的参数，来完成各类不同的视频合成任务。例如在终端中输入以下命令，则可以将视频缩放至原来一半大小，并且只保留前5秒：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">ffmpeg -i input.mp4 -vf scale=w=<span class="code-snippet__string">'0.5*iw'</span>:h=<span class="code-snippet__string">'0.5*ih'</span> -t <span class="code-snippet__number">5</span> output.mp4</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014776" data-ratio="0.44722222222222224" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhbBoTiaTYsGj0HdnWbFXkc2e9AJxYCrdyC0cBU4zXsTzr8Ml09S5M1wEA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">而在浏览器中，FFmpeg以及视频合成的运行机制如上所示：在业务层，我们为视频合成准备好需要的FFmpeg命令以及若干个输入文件，将其预加载到Emscripten模块的MEMFS（一种虚拟文件系统）中，并同时传递命令至Emscripten模块，最后通过Emscripten的胶水代码驱动WebAssembly进行逻辑计算。视频合成的输出视频会在MEMFS中逐步写入完成，最终可以被取回到业务层</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>对FFmpeg命令行界面进行封装</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">上面的例子中，我们为FFmpeg输入了一个视频文件，以及一串命令行参数，实现了对视频的简单缩放加截断操作。实际情况下，业务侧产生的视频合成需求可能是千变万化的，这样直接调用FFmpeg的方式，会导致业务层需要处理大量代码处理命令行字符串的构建、组合逻辑，就显得不合适宜。同时，我们在项目实践的过程中发现，由于项目需要接入 WebCodecs 和 FFmpeg 两种视频合成能力，这就需要一个中间层，从上层接收业务层表达的视频合成意图，并传递到下层的WebCodecs 或 FFmpeg 进行具体的视频合成逻辑的“翻译”和执行。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>API设计</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014777" data-ratio="0.4888888888888889" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhb5iaclYasmUVfBAwWUmYvWUr2a9So7cJHEcGNqOMT7fbEVsQiaZjUV40Q/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">如上所示，描述一个视频合成任务，可以采用类似“基于时间轴的视频合成工程文件”的方式：在视频剪辑软件中，用户通过可视化的操作界面导入素材，向轨道上拖入素材成为片段，为每个片段设置位移、宽高、不透明度、特效等属性；同理，对于我们的项目来说，业务方自行准备素材资源，并按一定的结构搭建描述视频合成工程的对象树，然后调用中间层的方法执行合成任务。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>分层设计</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014775" data-ratio="0.5074074074074074" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhbWRJecOt1GcNBicQqO47rp32BTOiaZ2HX4v8kT8AphRdaRuz9gGEIASwA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">以上是我们最终形成的一个分层结构：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">业务方代码使用一个JSON对象来描述自己的视频合成意图。为了方便业务方使用，这一层允许大量使用默认值，无需过多配置；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">状态层是一个对象树，将视频的全局属性、片段的属性等状态补齐，方便后续的翻译；同时，这一层的各个对象都支持读写，未来可以用于可视化视频编辑器的场景等；</p></li><li><p style="word-break: break-all;">执行层负责FFmpeg命令的翻译和执行逻辑。如果状态层抽象得当，则这个执行层也可以被WebCodecs的翻译和执行模块替换</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>执行流程</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014778" data-ratio="0.5444444444444444" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhbaS4HIgHvOTnyiatbhRyV5dnM3Whg9vzPfKkjodDyu3XAdSNgMmrFRTA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">以上是我们最终实现的FFmpeg前端视频合成能力，各个模块在运行时的相互调用时序图。各个模块之间并不是简单地按顺序层层向下调用，再层层向上返回。有以下这些点值得注意</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>状态树，是JSON + 文件元信息综合生成的</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">例如，业务方想要把一个宽高未知的视频片段，放置在最终合成视频（假设为1280x720）的正中央时，我们需要将视频片段的transform.left设置为(1280 - videoWidth) / 2，transform.top 设置为&nbsp;(720 - videoHeight) / 2。这里的videoWidth, videoHeight就需要通过FFmpeg读取文件元信息得到。因此我们设计的流程中，需要对所有输入的资源文件进行预加载，再生成状态树。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>输出结果多样化</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">实践过程中我们发现，业务方在使用FFmpeg能力时，至少需要使用以下三种不同的形式的输出结果：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">事件回调：例如业务方所需的合成进度、合成开始、合成结束等</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">合成结果的二进制文件：合成结束时异步返回</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">日志结果：例如获取文件元信息，获取音频的平均音量等操作，FFmpeg的输出都是以log的形式</p></li></ul><p style="word-break: break-all;white-space: normal;">因此我们为执行层的输出设计了这样的统一接口</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">export</span> interface RunTaskResult {</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__comment">/** 日志树结果 */</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__built_in">log</span>: LogNode</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__comment">/** 二进制文件结果 */</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;output: Uint8Array</span></code><br><code><span class="code-snippet_outer">}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__function">function <span class="code-snippet__title">runProject</span><span class="code-snippet__params">(json: ProjectJson)</span>: </span>{</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__comment">/** 事件结果 */</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;evt: EventEmitter&lt;RunProjectEvents, any&gt;;</span></code><br><code><span class="code-snippet_outer"> &nbsp;result: Promise&lt;RunTaskResult&gt;;</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>部分代码实现</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>执行主流程</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">runProject 函数是我们对外提供的视频合成的主函数。包含了“对输入JSON进行校验，补全、预加载文件并获取文件元信息、预加载字幕相关文件、翻译FFmpeg命令、执行、emit事件”等多种逻辑。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"><span class="code-snippet__comment">/**</span></span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__comment"> * 按照projectJson执行视频合成</span></span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__comment"> * @public</span></span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__comment"> * @param json - 一个视频合成工程的描述JSON</span></span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__comment"> * @returns 一个evt对象，用以获取合成进度，以及异步返回的视频合成结果数据</span></span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__comment"> */</span></span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">export</span> function <span class="code-snippet__title">runProject</span><span class="code-snippet__params">(json: ProjectJson)</span> </span>{</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__keyword">const</span> evt = <span class="code-snippet__keyword">new</span> EventEmitter&lt;RunProjectEvents&gt;()</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__keyword">const</span> steps = async () =&gt; {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">// hack 这里需要加入一个异步，使得最早在evt上emit的事件可以被evt.on所设置的回调函数监听到</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;await Promise.resolve()</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> parsedJson = ProjectSchema.parse(json) <span class="code-snippet__comment">// 使用json schema验证并补全一些默认值</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">// 预加载并获取文件元信息</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;evt.emit(<span class="code-snippet__string">'preload_all_start'</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> preloadedClips = [</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;...await preloadAllResourceClips(parsedJson, evt),</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;...await preloadAllTextClips(parsedJson)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;]</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">// 预加载字幕相关信息</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> subtitleInfo = await preloadSubtitle(parsedJson, evt)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;evt.emit(<span class="code-snippet__string">'preload_all_end'</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">// 生成project对象树</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> projectObj = initProject(parsedJson, preloadedClips)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">// 生成ffmpeg命令</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> { fsOutputPath, fsInputs, args } = parseProject(projectObj, parsedJson, preloadedClips, subtitleInfo)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> (subtitleInfo.hasSubtitle) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;fsInputs.push(subtitleInfo.srtInfo!, subtitleInfo.fontInfo!)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">// 在ffmpeg任务队列里执行</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> task: FFmpegTask = {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;fsOutputPath,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;fsInputs,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;args</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">// 处理进度事件</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;task.logHandler = (<span class="code-snippet__built_in">log</span>) =&gt; {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> p = getProgressFromLog(<span class="code-snippet__built_in">log</span>, project.timeline.end)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> (p !== undefined) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;evt.emit(<span class="code-snippet__string">'progress'</span>, p)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;evt.emit(<span class="code-snippet__string">'start'</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">// 返回执行日志，最终合成文件，事件等多种形式的结果</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> res = runInQueue(task)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;await res</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;evt.emit(<span class="code-snippet__string">'end'</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> res</span></code><br><code><span class="code-snippet_outer"> &nbsp;}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__keyword">return</span> {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;evt,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;result: steps()</span></code><br><code><span class="code-snippet_outer"> &nbsp;}</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>翻译流程</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">FFmpeg命令的翻译流程，对应的是上述runProject方法中的parseProject，是在所有的上下文（视频合成描述JSON对象，状态树文件预加载后的元信息等）都齐备的情况下执行的。本身是一段很长，且下游较深的同步执行代码。这里用伪代码描述一下parseProject的过程</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="go"><code><span class="code-snippet_outer"><span class="code-snippet__number">1.</span> 实例化一个命令行参数操作对象ctx，此对象用于表达命令行参数的结构，可以设置有哪些输入（多个）和哪些输出（一个），并提供一些简便的方法用以操作filtergraph</span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__number">2.</span> 初始化一个视频流的空数组layers（这里指广义的视频流，只要是有图像信息的输入流（例如视频、占一定时长的图片、文字片段转成的图片），都算作视频流）；初始化一个音频流的空数组audios</span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__number">3.</span> （作为最终合成的视频或音频内容的基底）在layers中加入一个颜色为project.backgroundColor, 大小为project.size，时长为无限长的纯色的视频流；在audios中加入一个无声的，时长为无限长的静音音频流</span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__number">4.</span> 对于每一个project中的片段</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__number">1.</span> 将片段中所包含的资源的url添加到ctx的输入数组中</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__number">2.</span> （从所有已预加载的文件元信息中）找到这个片段对应的元信息（宽高、时长等）</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__number">3.</span> （处理片段本身的截取、宽高、旋转、不透明度、动画等的处理）基于此片段的JSON定义和预加载信息，翻译成一组作用于该片段的FFmpeg filters，并且这一组filters之间需要相互串联，filters头部连接到此片段的输入流。得到片段对应的中间流。</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__number">4.</span> 获取到的中间流，如果是广义的视频流的，推入layers数组；如果是广义的音频流的，推入audios数组</span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__number">5.</span> 视频流layers数组做一个类似reduce的操作，按照画面中内容叠放的顺序，从最底层到最顶层，逐个合并流，得到单个视频流作为最终视频输出流。</span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__number">6.</span> 音频流audios数组进行混音，得到单个音频流作为最终输出流。</span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__number">7.</span> 调用ctx的toString方法，此方法是会将整个命令行参数结构输出为<span class="code-snippet__keyword">string</span>。ctx下属的各类对象(Input, Option, FilterGraph)都有自己的toString方法，它们会依次层层toString，最终形成整体的ffmpeg命令行参数</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>动画能力</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">适当的元素动画有助提高视频的画面丰富度，我们实现的视频合成能力中，也对元素动画能力进行了初步支持。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>&nbsp;业务端如何配置动画</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在视频剪辑软件中，为元素配置动画主要是基于关键帧模型，典型操作步骤如下：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">选中画布中的一个元素后</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">在时间轴上为元素的某一属性添加若干个关键帧</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">在每个关键帧上，为该属性设置不同的值。例如将位于第1秒的关键帧的x方向位移设置为0，将位于第5秒的关键帧的x方向位移设置为100</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">软件会自动将1-5秒的动画过程补帧出来，预览播放（以及最后合成的结果中）就可以看到元素从第1秒到第5秒向下平移的效果。而在前端开发中，通过CSS的@keyframes所声明的动画，也与上述关键帧模型吻合。除此之外，在CSS动画标准中，我们还需要附加以下这些信息，才能将一段关键帧动画应用到元素上</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">delay延迟（动画在元素出现后，延迟多少时间再开始播放）</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">iterationCount（动画需要重复播放多少次）</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">duration（在单次重复播放内，动画所占总时长）</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">timingFunction（动画的补帧方式。线性方式实现简单但关键帧之间的过渡生硬，因此一般会采用“ease-in-out”等带有缓进缓出的非线性方式）。除此之外还有direction, fillMode等配置，这些并未在我们的视频合成能力中实现，故不再赘述。</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在视频合成描述JSON中，我们参照了CSS动画声明进行了以下设计，来满足元素动画的配置</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">为片段了定义了 x, y, w, h, angle, opacity这六种可配置的属性（涵盖了位移、缩放、旋转、不透明度等）</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">对于需要静态配置的属性，在static字段的子字段中配置</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">对于需要动画配置的属性，在animation字段的子字段中逐个关键帧进行配置</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">animation字段同时可以进行duration, delay等动画附加信息的配置</p></li></ul><p style="word-break: break-all;white-space: normal;">以下是元素动画配置的例子</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"><span class="code-snippet__comment">// 视频片段bg.mp4，在画面的100,100处出现，并伴随有闪烁（不透明度从0到1再到0）的动画，动画延迟1秒，时长5秒</span></span></code><br><code><span class="code-snippet_outer">{</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__string">"type"</span>: <span class="code-snippet__string">"video"</span>,</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__string">"url"</span>: <span class="code-snippet__string">"/bg.mp4"</span>,</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__string">"static"</span>: {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"x"</span>: <span class="code-snippet__number">100</span>,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"y"</span>: <span class="code-snippet__number">100</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;},</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__string">"animation"</span>: {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"properties"</span>: {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;<span class="code-snippet__string">"delay"</span>: <span class="code-snippet__number">1</span>,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;<span class="code-snippet__string">"duration"</span>: <span class="code-snippet__number">5</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;},</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"keyframes"</span>: {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;<span class="code-snippet__string">"0"</span>: {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__string">"opacity"</span>: <span class="code-snippet__number">0</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;},</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;<span class="code-snippet__string">"50"</span>: {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__string">"opacity"</span>: <span class="code-snippet__number">1</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;},</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;<span class="code-snippet__string">"100"</span>: {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__string">"opacity"</span>: <span class="code-snippet__number">0</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp;}</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>FFmpeg合成添加动画效果的原理</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">动画效果的本质是一定时间内，元素的某个状态逐帧连续变化。而FFmpeg的视频合成的实际操作都是由filter完成的，所以想要在FFmpeg视频合成中添加动画，则需要视频类的filter支持按视频的当前时间，逐帧动态设置filter的参数值。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">以overlay filter为例，此filter可以将两个视频层叠在一起，并设置位于顶层的视频相对位置。如果无需设置动画时，我们可以将参数写成overlay=x=100:y=100表示将顶层视频放置在距离底层视频左上角100,100的位置。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">需要设置动画时，我们也可以设置x, y为包含了t变量（当前时间）的表达式。例如overlay=x=t*100:y=t*100，可以用来表达顶层视频从左上到右下的位移动画，逐帧计算可知第0秒坐标为0,0，第1秒时坐标为100,100，以此类推。</p><p style="word-break: break-all;white-space: normal;">像overlay=x=expr:y=expr这样的，expr的部分被称为FFmpeg的表达式，它也可以看成是以时间（以及其他一些可用的变量）作为输入，以filter的属性值作为输出的函数。表达式中除了可以使用实数、t变量、各类算术运算符之外，还可以使用很多内置函数，具体可参考<span style="text-decoration: underline;">FFmpeg文档中对于表达式取值的说明</span>（<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>https://ffmpeg.org/ffmpeg-utils.html#Expression-Evaluation</em></span>）</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>常见动画模式的表达式总结</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">由于表达式的本质是函数，我们在把动画翻译成FFmpeg表达式时，可以先绘制动画的函数图像，然后再从FFmpeg表达式的可用变量、内置函数、运算符中，进行适当组合来还原函数图像。下面是一些常见的动画模式的FFmpeg表达式对应实现</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>动画的分段</strong></p><p style="word-break: break-all;white-space: normal;">假设对于某元素，我们设置了一个向上弹跳一次的动画，此动画有一定延迟，并且只循环一次，动画已结束后又过了一段时间，元素再消失。则此元素的y属性函数图像及其公式可能如下</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 70%;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100014780" data-ratio="0.8614457831325302" data-s="300,640" data-type="png" data-w="332" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhbao0Wr9MTBdUvYEK2NQXb2VtmLJjHgCpbRt2Zobdz4sEUxLuc2j39UA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014782" data-ratio="0.26479750778816197" data-s="300,640" data-type="png" data-w="642" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhbfL5e24wSomzVlWzfAglk7MvIhib6YGxyVuHkGsSwu6obezX8r1035ZQ/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">通过以上函数图像我们可知，此类函数无法通过一个单一部分表达出来。在FFmpeg表达式中，我们需要将三个子表达式，按条件组合到一个大表达式中。对于分段的函数，我们可以使用FFmpeg自带的if(x,y,z)函数（类似脚本语言中的三元表达式）来等价模拟，将条件判断/then分支/else分支 这三个子表达式 分别传入并组合到一起。对于分支有两个以上的情况，则在else分支处再嵌入新的if(x,y,z)即可。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"># 实际在生成表达式时，所有的换行和空格可以省略</span></code><br><code><span class="code-snippet_outer">y=</span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span>(</span></code><br><code><span class="code-snippet_outer"> &nbsp;lt(t,<span class="code-snippet__number">2</span>), &nbsp;<span class="code-snippet__meta"># lt函数相当于&lt;操作符</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__number">1</span>,</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__keyword">if</span>(</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;lt(t,<span class="code-snippet__number">4</span>),</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__built_in">sin</span>(-PI*t/<span class="code-snippet__number">2</span>)+<span class="code-snippet__number">1</span>,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__number">1</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;)</span></code><br><code><span class="code-snippet_outer">)</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">我们可以实现一个递归函数nestedIfElse，来将N个条件判断表达式和N+1个分支表达式组合起来，成为一个大的FFmpeg表达式，用于分段动画的场景</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"><span class="code-snippet__function">function <span class="code-snippet__title">nestedIfElse</span><span class="code-snippet__params">(branches: <span class="code-snippet__built_in">string</span>[], predicates: <span class="code-snippet__built_in">string</span>[])</span> </span>{</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__comment">// 如果只有一个逻辑分支，则返回此分支的表达式</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__keyword">if</span> (branches.length === <span class="code-snippet__number">1</span>) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> branches[<span class="code-snippet__number">0</span>]</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__comment">// 如果有两个逻辑分支，则只有一个条件判断表达式，使用if(x,y,z)组合在一些即可</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;} <span class="code-snippet__keyword">else</span> <span class="code-snippet__keyword">if</span> (branches.length === <span class="code-snippet__number">2</span>) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> predicate = predicates[<span class="code-snippet__number">0</span>]</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> [ifBranch, elseBranch] = branches</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> `<span class="code-snippet__keyword">if</span>(${predicate},${ifBranch},${elseBranch})`</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__comment">// 递归case</span></span></code><br><code><span class="code-snippet_outer"> &nbsp;} <span class="code-snippet__keyword">else</span> {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> predicate = predicates.shift()</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> ifBranch = branches.shift()</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">const</span> elseBranch = nestedIfElse(branches, predicates) as <span class="code-snippet__built_in">string</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> `<span class="code-snippet__keyword">if</span>(${predicate},${ifBranch},${elseBranch})`</span></code><br><code><span class="code-snippet_outer"> &nbsp;}</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>线性和非线性补帧</strong></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">补帧是将关键帧间的空白填补，并连接为动画的基本方式。被补出来的每一帧中，对应的属性值需要使用插值函数进行计算。</p><p style="word-break: break-all;white-space: normal;">对于线性插值，FFmpeg自带了lerp(x,y,z)函数，表示从x开始到y结束，按z的比例（z为0到1的比值）线性插值的结果。因此我们可以结合上面的if(x,y,z)函数的分段功能，实现一个多关键帧的线性补帧动画。例如，某属性有两个关键帧，在t1时属性值为a，在t2时属性值为b，则补帧表达式为</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014779" data-ratio="0.25691699604743085" data-s="300,640" data-type="png" data-w="506" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhbvXu2xiczroGZ9tSPpKpUDUGiaqDcMGhfffNp3jGnOeICguRJkTklC2lw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">对于非线性补帧，我们可以将其理解为在上述线性补帧公式的基础上，将lerp(x,y,z)函数的z参数（进度的比例）再进行一次变换，使得动画的行进变得不均匀即可。以下公式中的t'代表了一种典型的缓慢开始和缓慢结束的缓动函数(timing function)，将其代入原公式即可</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014783" data-ratio="0.5865921787709497" data-s="300,640" data-type="png" data-w="716" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhbFQNUoEebibKWrh3QtfWngez6dR3F8SQ4t3HVHwW9Z17jSJD09AJk9cw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 80%;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100014781" data-ratio="1" data-s="300,640" data-type="png" data-w="414" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhbJ3KPSDEm36pbAYJ1IcvialMkXDOiaPiakiaN9JsQHRPHUC2yDkA6YhODCg/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup style="font-size: 12px;">（图中展示了从左下角的关键帧到右上角的关键帧的&nbsp;</sup></p><p><sup style="font-size: 12px;">线性/非线性 补帧的函数图像）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">以下是对应的代码实现</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"><span class="code-snippet__comment">// 假设有关键帧(t1, v1)和(t2, v2)，返回这两个关键帧之间的非线性补帧表达式</span></span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__function">function <span class="code-snippet__title">easeInOut</span><span class="code-snippet__params">(</span></span></span></code><br><code><span class="code-snippet_outer"> &nbsp;t1: number, v1: number,</span></code><br><code><span class="code-snippet_outer"> &nbsp;t2: number, v2: number</span></code><br><code><span class="code-snippet_outer"><span class="code-snippet_outer">)</span> {</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__keyword">const</span> t = `t-${t1})/(${t2-t1})`</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__keyword">const</span> tp = `<span class="code-snippet__keyword">if</span>(lt(${t},<span class="code-snippet__number">0.5</span>),<span class="code-snippet__number">4</span>*<span class="code-snippet__built_in">pow</span>(${t},<span class="code-snippet__number">3</span>),<span class="code-snippet__number">1</span>-<span class="code-snippet__built_in">pow</span>(<span class="code-snippet__number">-2</span>*${t}+<span class="code-snippet__number">2</span>,<span class="code-snippet__number">3</span>)/<span class="code-snippet__number">2</span>)`</span></code><br><code><span class="code-snippet_outer"> &nbsp;<span class="code-snippet__keyword">return</span> `lerp(${v1},${v2},${tp})`</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>循环</strong></p><p style="word-break: break-all;white-space: normal;">如果我们需要表达一个带有循环的动画，最直接的方式是将某个时段上的映射关系，复制并平移到其他的时段上。例如，想要实现一个从画面左侧平移至右侧的动画，重复多次时，我们可能使用下面这样的函数</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014785" data-ratio="0.421455938697318" data-s="300,640" data-type="png" data-w="522" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhbHgX6gibNAnhJiaR8gdYBpnCY7NTvfdjNDYdqnGqIXZYo3YOBPj92ZjIA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">以上使用分段函数的写法的问题在于，如果循环次数过多时，函数的分支较多，产生的表达式很长，也会影响在视频合成时对表达式求值的性能。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">事实上，我们可以引入FFmpeg表达式中自带的mod(x,y)函数（取余操作）来实现循环。由于取余操作常用来生成一个固定范围内的输出，例如不断重复播放的过程。上面的函数，在引入mod(x,y)后，可以简化为 x=mod(t,1)。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">上述对于动画分段、循环、补帧如何实现的问题，其共通点都是如何找到其对应函数，并在FFmpeg中翻译为对应的表达式，或者对已有表达式进行组合。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">据此，我们实现了KFAttr（关键帧属性，用以封装关键帧和动画全局配置等信息）和TimeExpr（以KFAttr作为入参，并翻译为FFmpeg表达式）两个类。其中，TimeExpr的整体算法大致如下：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1.将动画分成前，中，后三部分。前半部分是由于delay配置导致的，元素已出现但动画还未开始的静止部分；中间部分是动画的主体部分；后半部分是由于动画重复次数较少，元素未消失但动画已结束的静止部分</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2.对于前半部分，表达式设置为等于关键帧中第一帧的值；对于后半部分，表达式设置为等于关键帧中最后一值的值</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3.对于中间部分 &nbsp;</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">3.1 将keyframes中声明的每个关键帧点（某个百分比及其对应值），结合动画的duration配置，缩放为新的关键帧点（某个时间点及其对应值） &nbsp;</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">3.2 根据上述关键帧，获取predicates数组（也就是动画中间部分，进入每一个分支的条件表达式，例如t&lt;2, t&lt;5 等）</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">3.3 根据上述关键帧，获取branches数组（也就是动画中间部分，每一个分支本身的表达式）。每一个branch声明了一个关键帧到下一个关键帧的连接，也就是补帧表达式 &nbsp;</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">3.4 使用nestedIfElse(branches, predicates)组合出中间部分的表达式</p></li></ul><p style="word-break: break-all;white-space: normal;">4.再次使用nestedIfElse，将前、中、后三部分组合成最终的表达式</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>浏览器里视频合成的内存不足问题</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">在项目实践的过程中，我们发现浏览器中通过ffmpeg.wasm进行视频合成时，有一定机率出现内存不足的现象。表现为以下Emscripten的运行时报错（OOM为Out of memory的缩写）</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">exception thrown: RuntimeError: <span class="code-snippet__built_in">abort</span> (<span class="code-snippet__number">00</span>M). Build with -s ASSERTIONS=<span class="code-snippet__number">1</span> <span class="code-snippet__keyword">for</span> more info.RuntimeError: <span class="code-snippet__built_in">abort</span> (<span class="code-snippet__number">00</span>M). Build with -s ASSERTIONS=<span class="code-snippet__number">1</span> <span class="code-snippet__keyword">for</span> more info.</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">分析后我们认为，内存不足的问题主要是由于以下这些因素导致的</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">视频合成本身是开销很大的计算过程，这是由于音视频文件往往都有着很高的压缩率，在合成时，音视频文件被解码成未压缩的数据，占用了大量内存</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">和原生环境相比，浏览器中的应用会额外受到单个标签页可使用的最大内存的限制。例如在64位系统的Chrome中，一个标签页最多可使用的内存大小为4GB</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">浏览器沙盒机制，不允许Web应用直接读写客户端本地文件。而Emscripten为了使得移植的C/C++项目仍能够拥有原来的文件读写的能力，实现了一个MEMFS的虚拟文件系统。将文件预加载到内存中，把对磁盘的读写转换为对内存的读写。这部分文件的读写也占用了一定的内存。在浏览器中运行视频合成时，还会额外受到浏览器对于单个标签页可使用的最大内存的限制（在64位的Chrome中，最多可为一个标签页分配4G内存）</p></li></ul><p style="word-break: break-all;white-space: normal;">为了应对以上问题，在实践中，我们采取了以下这些策略，来减少内存不足导致的合成失败率：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>视频合成的严格串行执行</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">视频合成的过程出现了并发时，会加剧内存不足现象的产生。因此我们在runProject以及其他FFmpeg执行方法背后实现了一个统一的任务队列，确保一个任务在执行完成后再进行下一个任务，并且在下一个任务开始执行前，重启ffmpeg.wasm的运行时，实现内存垃圾回收。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>时间分段，多次合成</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">实践中我们发现，如果一个FFmpeg命令中输入的音视频素材文件过多时，即使这些素材在时间线上都重叠（也就是某一时间点上，所有的素材视频画面都需要出现在最终画面中）的情况很少，也会大大提高内存不足的概率。</p><p style="word-break: break-all;white-space: normal;">我们采取了对视频合成的结果进行时间分段的策略。根据每个片段在时间轴上的分布情况，将整个视频合成的FFmpeg任务，拆分成多个规模更小的FFmpeg任务。每个任务仅需要2-3个输入文件（常规的视频合成需求中，同屏同时播放的视频最多也在3个左右），各任务单独进行视频合成，最后再使用FFmpeg的concat功能，将视频前后相接即可。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>减少重编码的场景</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">视频合成的重编码（解码输入文件，操作数据并再编码），会消耗大量的CPU和内存资源。而视频和音频的前后拼接操作，则无需重编码，可以在非常短的时间内完成。</p><p style="word-break: break-all;white-space: normal;">对于不太复杂的视频合成场景，往往并不是画面的每一帧都需要重新编码再输出的。我们可以分析视频合成的时间轴，找出不需要重编码的时间段（指的是此时画面内容仅来自一个输入文件，并且没有缩放旋转等滤镜效果，没有其他层叠的内容的时间段）。对这些时间段，我们通过FFmpeg的流拷贝功能截取出来（通过-vcodec copy命令行参数实现）即可，这样进一步减少了CPU和内存的消耗。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>在视频中添加文字的实践</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">在视频中添加文字是视频合成的常见需求，这类需求可以大致分为两种情况：少量的样式复杂的艺术字，大量的字幕文字。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">FFmpeg自带的filters中提供了以下的文字绘制能力，包括：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">subtitles，配合srt格式的字幕文件。适合大量添加字幕，对样式定制化不高的场景</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">drawtext，绘制单条文字，并进行一些简单的样式配置。如果不使用filters，由于我们是在浏览器作为上层环境使用FFmpeg的，此时也可以使用DOM API提供的一些文字转图片的技术（例如直接使用Canvas API的fillText绘制文字，或者使用SVG的foreignObject对包含文字的html文档进行图片转换等），把文字当作图片文件进行处理。</p></li></ul><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">最初在支持视频合成方案的文字能力时，我们选择了后者的文字转图片技术，基本满足了业务需求。这一做法的优势在于：复用DOM的文字渲染能力，绘制效果好并且支持的文字样式丰富；并且由于转换为图片处理，可以让文字直接支持缩放、旋转、动画等许多已经在图片上实现的能力。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">但正如上面提到的“为FFmpeg的命令一次性输入过多的文件容易引起OOM”的问题，文字转为图片后，视频合成时需要额外导入的图片输入文件也增加了。这也促使我们开始关注FFmpeg自带的文字渲染能力。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">FFmpeg自带subtitles, drawtext等文字渲染能力，底层都使用了C语言的字体字符库（包括freetype字体光栅化，harfbuzz文字塑形，fribidi双向编码等），在每一帧编码前的filter阶段，将字符按指定的字体和样式即时绘制成位图，并与当前的framebuffer混合来实现的。这种做法会耗费更多的计算资源，但同时因为不需要缓存或文件，使用的内存更少。因此我们对于制作字幕这样需要大量添加固定样式的文字的场景，提供了相应的JSON配置，并在底层使用FFmpeg的subtitles filter进行绘制，避免了OOM的问题。</p><p style="word-break: break-all;white-space: normal;">基于浏览器和FFmpeg本身的现有能力，在视频中添加文字的方案还可以有更多探索的可能。例如可以“使用SVG来声明文字的内容和样式，并在FFmpeg侧进行渲染”来实现。SVG方案的优点在于：文字的样式控制能力强；可以随意添加任意的文字的前景、背景矢量图形；与位图相比占用资源少等。后续在进行自编译的FFmpeg WebAssembly版相关调研时，会尝试支持。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>后续迭代</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">通过 Emscripten 移植到浏览器运行的 FFmpeg，在性能上与原生FFmpeg有很大差距，大体原因在于浏览器作为中间环境，其现有的API能力不足，以及一些安全政策的限制，导致 FFmpeg 对于硬件能力的利用受限。随着浏览器能力和API的逐步演进，FFmpeg + WebAssembly 的编译、运行方式都可以与时俱进，以达到提高性能的目的。目前可以预见的一些优化点有：</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">文件IO方面，接入浏览器的<span style="text-decoration: underline;">OPFS</span>（<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API#origin_private_file_system</em></span>）。这是浏览器中访问文件系统的一种新API，有较高的读写性能。未来有可能被Emscripten实现，以替换掉当前默认的MEMFS</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">并行计算方面，考虑使用<span style="text-decoration: underline;">WebAssembly SIMD</span>（<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>https://v8.dev/features/simd</em></span>）。SIMD可以更充分地使用CPU进行并行计算。对于图像处理较多的编码场景（例如x264编码器），适当地使用WebAssembly的SIMD来优化代码有助于提高编码性能</p></li><li><p style="word-break: break-all;">图像处理方面，尝试使用WebGL优化。WebGL为浏览器提供了基于显卡的并行计算的能力，特别适合对视频抠像、滤镜、转场等应用场景进行加速。</p></li></ul></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>开发者问答</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;font-size: 13px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>你的前端项目中有落地实践过音视频能力吗？</strong></span>欢迎在留言区告诉我们。转发并留言，小编将选取1则最有价值的评论，送出<span style="text-decoration: underline;"><strong>日版赫斯缇雅手办景品一个</strong></span>（见下图）。<span style="color: rgb(255, 102, 149);"><strong>3月1日中午12点开奖。如果喜欢本期内容的话，欢迎点个“在看”吧！</strong></span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 35%;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100014786" data-ratio="2.19941348973607" data-s="300,640" data-type="jpeg" data-w="682" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RdMyqzxL0gYJT1xlF3OUhbWWp6nDPHpibeqSVjPxAt5MfxuicCjG5MzdSOlibg3JkcHMhbKTbboUpZw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>往期精彩指路</strong></p></div></div></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;font-size: 13px;"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247496872&amp;idx=1&amp;sn=7647f520422d80760060e18a99163d13&amp;chksm=cf2f318df858b89b7da28bad96e56672859fa867a731040e60bd2751592f6a13ae4f3e85df72&amp;scene=21#wechat_redirect" textvalue="基于多模态的视频高能点提取技术" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">基于多模态的视频高能点提取技术</a></p></li><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498175&amp;idx=1&amp;sn=c00bc752a72595fc8d52174301116626&amp;chksm=cf2f3c9af858b58c9d7902bfca13d5940fa5e5cd5565b2c9f91c93c4296859eda9464a34b521&amp;scene=21#wechat_redirect" textvalue="WebCodecs 开启 Web 音视频新篇章" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">WebCodecs 开启 Web 音视频新篇章</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498279&amp;idx=1&amp;sn=6b537b59cfb7b03777946de43c50689b&amp;chksm=cf2f3f02f858b614fae703d2fd19e166e87b04af9ac6f48b13d8a333dd34f5da0ce09bfb6770&amp;scene=21#wechat_redirect" textvalue="基于WebCodecs的网页端高性能视频截帧" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">基于WebCodecs的网页端高性能视频截帧</a></p></li></ul></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;font-size: 13px;letter-spacing: 4px;" powered-by="xiumi.us"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3289447926347317252#wechat_redirect" textvalue="通用工程" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">通用工程</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2390333109742534656#wechat_redirect" textvalue="大前端" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">大前端</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3297757408550699008#wechat_redirect" textvalue="业务线" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">业务线</span></a><br></p><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2329861166598127619#wechat_redirect" textvalue="大数据" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">大数据</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2782124818895699969#wechat_redirect" textvalue="AI" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">AI</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2532608330440081409#wechat_redirect" textvalue="多媒体" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">多媒体</span></a></p><p><span style="color: rgb(12, 182, 242);"><br></span></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="Mzg3Njc0NTgwMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754SVM7VMibhzz9AicOz5qdQ5oaN6TgXhbVyGHQYPwBErEYQCOnhibA1Qp431JkpPKY0qGhT0EfDchicXMQ/0?wx_fmt=png" data-nickname="哔哩哔哩技术" data-alias="bilibili-TC" data-signature="提供B站相关技术的介绍和讲解" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzUxNTE4OTc0Mg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EVKwaZXNTl9OCCo7pxLHz2e2I3kV3rTPao5LlIickfJS79DNd2yjqjfYEtwtMOyVuKhJoDIq6UU4U9TQbjvOLaQ/0?wx_fmt=png" data-nickname="哔哩哔哩招聘" data-alias="" data-signature="生产快乐的地方" data-from="0" data-is_biz_ban="0"></mp-common-profile></p></div></div><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p>]]></summary>
        <author>
            <name>梁晴天</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[WebGL高质量实时角色渲染]]></title>
        <id>2247498417_1</id>
        <link href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498417&amp;idx=1&amp;sn=f2c196d6224d8273fdcd42498429ce43&amp;chksm=cf2f3f94f858b682c031213895ceac8f514018fa2892d0411b1c68b717396807a956f0d96050#rd"/>
        <updated>2024-02-22T12:48:28.000Z</updated>
        <summary type="html"><![CDATA[<div><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>本期作者</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;background-position: center center;background-repeat: no-repeat;background-size: cover;overflow: hidden;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QsoomDywL7COia5PI9QdJqnF0BrBAD4SX2qsiaQeC5G1ehjEm2bUgmPbcgAOGmxW1Nv6gopZqS1cyg/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014722" data-ratio="1.1222222222222222" data-s="300,640" data-type="jpeg" data-w="1080" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QsoomDywL7COia5PI9QdJqnF0BrBAD4SX2qsiaQeC5G1ehjEm2bUgmPbcgAOGmxW1Nv6gopZqS1cyg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>万成</p></div><div style="margin-top: 5px;text-align: justify;font-size: 14px;"><p style="text-align: center;white-space: normal;">哔哩哔哩资深技术美术</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014723" data-ratio="0.4222222222222222" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnxWgndSYqg6sjhO4oliatic9FM6oXvHMuYMKyAicD8MFFRFGNwdSLXib2Pg/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>背景</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">随着图形图像渲染技术的快速发展，如何在移动端呈现出高质量的数字人渲染效果，是实时渲染领域最主流的技术研究方向之一。对于B站移动端App而言，如果使用主流的实时渲染引擎如Unreal/Unity等，都会带来100-130M左右的安装包体积增量，进而增加应用安装和版本更新的成本。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">针对该问题，我们选择了更为灵活轻量的WebGL渲染方案，将包体增量大幅降低至1M以内，同时借助Web天然的开箱即用特性，加速了业务需求在移动端落地的整体节奏。经过对Web渲染能力的行业调研，我们最终从众多的Web3D渲染引擎中选择了Three.JS。Three.JS作为一款轻量级的JavaScript 3D渲染库，具备强大的图形能力和广泛的社区支持，在数字人渲染方向能够给予我们一定的基础能力支持。</p><p style="word-break: break-all;white-space: normal;">但如果只是使用Three.JS自带的PBR（Physically-Based Rendering）渲染，在偏CG和写实方向的数字人渲染效果上，很难达到令人满意的品质感。为了能够进一步还原商业实时渲染引擎Unreal的人物效果，同时兼顾好WebGL在移动设备上的性能和发热问题，我们在人物皮肤，瞳孔，抗锯齿，半透明等方向上做了深入的二次研发，提出了一套完整的高质量角色移动端WebGL渲染解决方案。本文将分享我们在探索和实现该方案的过程中遇到的挑战及最终的解决思路。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>PBR优化</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">PBR（Physically-Based Rendering）是一种计算机图形学中的渲染技术，旨在模拟（近似）光线在现实世界中的物理行为，以实现更真实、逼真的渲染效果。因此我们的美术资产的制作采用了全套PBR流程，Three.JS内置的MeshPhysicalMaterial也对PBR做了材质支持，但我们发现Three.JS的PBR实现在移动端上依然存在性能瓶颈。所以针对以上问题我们给出了如下解决方案：</p><p style="word-break: break-all;white-space: normal;">首先我们来看Cook-Torrance的BRDF模型：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014721" data-ratio="0.12449799196787148" data-s="300,640" data-type="png" data-w="498" style="vertical-align: middle;width: 298px;height: 37px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnufIAzW8Lq7WJLrk9shteP8fydCR6qkxrTX8wEt4f5eMWYpibZ6wa79w/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">其中Cook-Torrance镜面反射如下：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014720" data-ratio="0.2288135593220339" data-s="300,640" data-type="png" data-w="472" style="vertical-align: middle;width: 282px;height: 65px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqn7Wxmgd0ibnocls9ukYwIOzhCsraxbicj7AxQricotWu8VkXpKPaibuspmA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">D表示法线分布函数（Normal Distribution Function）</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">G表示几何函数（Geometry function）</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">F表示菲尼尔函数（Fresnel function）</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">n表示法线方向，l表示灯光方向，v表示视线方向，h表示l与v的中间方向（halfway）</p><p style="word-break: break-all;white-space: normal;">首先，我们使用 UE4 粗糙度的定义，将它用于以下所有方程中的α：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014719" data-ratio="0.17647058823529413" data-s="300,640" data-type="png" data-w="255" style="vertical-align: middle;width: 160px;height: 28px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnicKjN0WicU8dVpCwe31k20gbZlzPOKtS7lzmOMUGaGiaicU9lf0BuhM6Nw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">分布函数：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014728" data-ratio="0.15160796324655437" data-s="300,640" data-type="png" data-w="653" style="vertical-align: middle;width: 320px;height: 49px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnFFLwhg903DUicGdxj0UlE8t09ib0Lww4AmspTVtG2vcgrOganWLB9YDA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">几何函数：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014727" data-ratio="0.14246947082767977" data-s="300,640" data-type="png" data-w="737" style="vertical-align: middle;width: 366px;height: 52px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnvnTvQGd9AOQueeWTxzly2F9RrLrBSJ8GLdNlMSKkAAN9b8TQuJTBMw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">我们使用史密斯方法（Smith's method）将G_GGX作为子函数G_sub：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014725" data-ratio="0.09330985915492958" data-s="300,640" data-type="png" data-w="568" style="vertical-align: middle;width: 296px;height: 28px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnfjM75njvbsNCCEzdDMDP12ACy6b7DzcCFCWtBQAQYyabic2rqFBqemg/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">菲尼尔函数：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014724" data-ratio="0.08307692307692308" data-s="300,640" data-type="png" data-w="650" style="vertical-align: middle;width: 362px;height: 30px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnM5REeVEoGtUl8sAXlG8ArQOLjBrd8iaSEIh3Xwdibap21EMzUicPVjySw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">F0表示表明的基础反射率，一般我们采用vec3(0.04)</p><p style="word-break: break-all;white-space: normal;">我们还可以将镜面反射分母与几何函数进行合并得到可见性项（Visibility）：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014726" data-ratio="0.30844155844155846" data-s="300,640" data-type="png" data-w="308" style="vertical-align: middle;width: 136px;height: 42px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnNxHZXaC0ibWviawej7nhlY4WJDa2BXOnh8K1gEKjYmzZFkggH3HDzthg/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">最后我们得到了：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014731" data-ratio="0.09653465346534654" data-s="300,640" data-type="png" data-w="404" style="vertical-align: middle;width: 253px;height: 24px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnxT4fQYNSc651SW8TvxZYuBdJrfQhmGibsow42UJ3twl2j4A3bGUrGow/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">我们发现几何函数里有除法和求平方根，写成代码为：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014730" data-ratio="0.19534883720930232" data-s="300,640" data-type="png" data-w="430" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnOdRznCz5Q6zwJSGJognkR7WFbmK0AwW4g70ZCia8WRkiaCtgDA4GnG1g/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">有没有办法简化呢？根据SIGGRAPH 2015 Optimizing PBR for Mobile有关简化VF项：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014729" data-ratio="0.1723027375201288" data-s="300,640" data-type="png" data-w="621" style="vertical-align: middle;width: 334px;height: 58px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnj2PXVo5beZvicG6BrctVnAj1RdiaLBvY116Rp33Fl9UlSBSSZMugXZXg/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">最终我们的表达式：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014732" data-ratio="0.10355648535564854" data-s="300,640" data-type="png" data-w="956" style="vertical-align: middle;width: 496px;height: 51px;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqn6pPKAqh5edPWe3ju0QlPWiaO6iac7QiaibB7lxW6uiaaywPwHgGSOsE3Lww/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">加和乘，仅有一次除法。</p><p style="word-break: break-all;white-space: normal;"><strong>与Three.JS内置PBR性能对比</strong></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014733" data-ratio="0.537962962962963" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnhlsYUxBLliaYPiaSo5xqCdqkibK7OH3oniaVfqtYKib9TKoic9aYcmaZ77gg/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">我们设计了一个测试场景，仅渲染一个角色，同时去除了其他干扰，为了能体现本次性能差距，选用了3款机器进行测试帧生成时间（SOC由于发热等因素可能是一个区间）：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;" powered-by="xiumi.us"><p><br></p><table resolved=""><colgroup><col><col><col><col></colgroup><tbody><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;background-color: rgb(255, 254, 213);"><p><strong><span style="font-size: 14px;">机型 (处理器)</span></strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;background-color: rgb(255, 254, 213);"><p><strong><span style="font-size: 14px;">ThreeJS PBR</span></strong></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;background-color: rgb(255, 254, 213);"><p><strong><span style="font-size: 14px;">优化 PBR</span></strong></p></td><td colspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;background-color: rgb(255, 254, 213);"><strong><span style="font-size: 14px;">提升比例</span></strong></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><span style="font-size: 14px;">iPhone 6 (A8)</span></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><span style="font-size: 14px;">20-22ms</span></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><span style="font-size: 14px;">&lt;16ms</span></p></td><td colspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">20-33%</span></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><span style="font-size: 14px;">Redmi 6 Pro (骁龙625)</span></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><span style="font-size: 14px;">52ms</span></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><span style="font-size: 14px;">32ms</span></p></td><td colspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><span style="font-size: 14px;">62%</span></td></tr><tr><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><span style="font-size: 14px;">华为 P20 (麒麟970)</span></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><span style="font-size: 14px;">10ms</span></p></td><td colspan="1" rowspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;"><p><span style="font-size: 14px;">7-8ms</span></p></td><td colspan="1" style="border-color: rgb(193, 199, 208);padding-top: 7px;padding-bottom: 7px;vertical-align: top;min-width: 8px;word-break: break-all;"><span style="font-size: 14px;">25-42%</span></td></tr></tbody></table></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">较好的机器在该场景下通常能跑上百帧，两者差距相对较小，这里就不一一列举。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>皮肤优化</strong></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">为了营造皮肤的通透感，我们调研了市面上主流的皮肤渲染方案，例如屏幕空间次表面散射（Screen Space Subsurface Scattering Skin Rendering）、可分离次表面散射（Separable Subsurface Scattering）、预积分次表面散射（Pre-Integrated Skin Shading）</p><p style="word-break: break-all;white-space: normal;">以上方案除了预积分次表面散射，其它两种方案都要使用实时卷积模糊，开销非常高。而预积分次表面散射方案，根据SIGGRAPH 2011 Pre-integrated Skin Shading的分享，在完成LUT贴图和曲率贴图烘培的情况下，仅使用两次贴图采样即可模拟较好的次表面散射效果。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014738" data-ratio="0.5554123711340206" data-s="300,640" data-type="png" data-w="776" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnkOMmViawtehiaVsauUJTibwCI0RDdztKicfibzLq2BvNsvI1m6QbZQcibFfw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>LUT贴图烘培</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014735" data-ratio="0.5570117955439057" data-s="300,640" data-type="png" data-w="763" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqn3YuBOdE2icYGiby1gwSXXwNPxSPKLl9Licnj1x8EyaBb7h1exsNQExAvw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>曲率贴图烘培</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">考虑到移动端性能和效果平衡取舍，所以采用了预积分次表面散射的方案：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014739" data-ratio="0.36983471074380164" data-s="300,640" data-type="png" data-w="484" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnhWLzN5RMTR53lJwIyJwnafWkxB79aC9ic2QCNcAASOkC5BmI2nMrWpA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014736" data-ratio="0.6387096774193548" data-s="300,640" data-type="png" data-w="620" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqn995jHicNuXyyBwTdUr18JicNHQpbw0licYibgHISFibfx1zxUQwe4F2nianA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>左：未开启SSS &nbsp;&nbsp; &nbsp; &nbsp;右：开启SSS</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>瞳孔优化</strong></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">眼睛渲染一大难点是模拟瞳孔的一个自然的凹陷，如果没有处理好，从角色侧面观察瞳孔会突出，角色将失去神采。</p><p style="word-break: break-all;white-space: normal;">瞳孔处理通常有两种方法，一种是将瞳孔和眼角膜分开建模，瞳孔向下凹陷，另一种做法是用视差方法模拟瞳孔凹陷。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014737" data-ratio="1.0880829015544042" data-s="300,640" data-type="png" data-w="386" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnAJia5AChMV4PAovNIH9UF9J3uNibac9QhMXb5P7bjfibEGlkjLnvsibaoQ/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>Tda式初音ミク・アペンドVer1.10</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">考虑到美术制作流程上的复杂度，我们选用了后者，需要把眼球的前向量传递给Shader，然后把视线转换到切线空间对贴图进行采样，最后应用一张Mask贴图决定整个瞳孔的凹陷程度。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014743" data-ratio="0.5683060109289617" data-s="300,640" data-type="png" data-w="732" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnUyq3GcTPIgyvVxM0EBCXFPW0cI6lup9wgtonPyOcnbuwQUg2VNIagA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>左：未开启瞳孔优化&nbsp; &nbsp; &nbsp; &nbsp; 右：开启瞳孔优化</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>渲染管线设计</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">我们遇到一些移动设备高分屏的问题，在IPhone13Pro上，内部分辨率高达1170×1992，根据我们的经验，这会造成手机发热与性能问题。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014741" data-ratio="0.909556313993174" data-s="300,640" data-type="png" data-w="586" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnl6WJZicw2T5hMD2gI2UicWqaFb4O4AHno7xDhqpM81WK2LXpvpCL504Q/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">为了解决上述问题我们设计了一套离屏渲染管线，使用Threejs的EffectComposer申请了与屏幕分辨率不同的RenderTarget，并且在RenderScale=0.5的情况下，在大部分高分屏手机上取得了还不错的效果，兼顾了效果与性能。</p><p style="word-break: break-all;white-space: normal;">具体管线如下：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014740" data-ratio="0.38796296296296295" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqntImnia2rTOfzyGibqNLEvPkTIE1SDRLQ70SZA1xvBjpMH4OQjkNuxbAA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">与Three.JS默认直接画到画布上的管线做对比，我们的方案实现的功能更复杂，由于可以控制离屏渲染分辨率，性能与质量之间可配置的灵活度也更高。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>抗锯齿</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">Three.JS支持硬件抗锯齿MSAA和屏幕空间抗锯齿SMAA，在最开始我们觉得这两种抗锯齿是够用的，但随着美术需求逐渐复杂，我们发现上述两种抗锯齿对于一些边缘光照产生的高频像素无能为力，并且在实现头发等效果时，发现MSAA仅对几何走样（Geometry Aliasing）有较好的效果，但对着色走样（Shading Aliasing）基本无效。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014744" data-ratio="0.5555555555555556" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnocf963l3QtEiaDeial689qeCQsaJQQaOuF3gmgUPXGMChiaE2Ef6eHnbg/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">MSAA着色走样</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们尝试使用SMAA解决，但最终结果仍不理想。根据经验，着色走样需使用超采样（Super-Sampling）抗锯齿解决，但这样无疑又增加了渲染像素，导致性能问题。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">有没有即不需要超采样，又可以解决着色走样的抗锯齿技术呢？答案是有的，我们采用时域抗锯齿（Temporal Anti-Aliasing），接下来简称为TAA。</p><p style="word-break: break-all;white-space: normal;">在实践中发现，Three.JS上并没有直接可用的TAA，官方内置的TAA本质是个超采样，这并不符合我们的预期。根据上述背景，我们决定从零开发TAA。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>摄影机抖动</strong></p><p style="word-break: break-all;white-space: normal;">TAA的核心思想是将多次采样的过程分布到每一帧当中，这里我们除了空间上均匀分布，还希望能在时间上均匀分布。这里根据SIGGRAPH2014 Unreal Engine 4 TAA的分享，我们使用低差异序列Halton(2, 3)作为子像素抖动偏移：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014742" data-ratio="0.4396825396825397" data-s="300,640" data-type="png" data-w="630" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqn2yUcK2FylotibNaCYkZF4JtLzsykJl7La114XoR3sHV1Nk4gWxgibYcQ/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">然后我们将这个抖动（Jitter）偏移调整到摄影机的投影矩阵上：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014746" data-ratio="0.08686440677966102" data-s="300,640" data-type="png" data-w="472" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnzYd6jfuaH6zyiaT9GyZttsSGXMuCRmibon9jQmOX8ricLMa5a8O5weXPA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>运动向量</strong></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">尽管我们将采样分布到了每一帧上，但是保存多帧对于移动平台来说是不实际的，这时我们需要简化为只保存两帧，当前帧和历史帧。我们通过指数混合的方式将当前帧和历史帧进行不断累积。如果我们只是简单的将当前帧和历史帧混合，一旦摄影机或物体发生运动就会出现残影问题，我们还需要知道当前像素在上一帧所处的位置，这个过程称为重投影（Reprojection），我们使用运动向量（Motion Vector）重建上一帧当前像素的位置。</p><p style="word-break: break-all;white-space: normal;">渲染运动向量：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014745" data-ratio="0.12375249500998003" data-s="300,640" data-type="png" data-w="501" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnSjDVYzpNdIcOY5uBYIxj9CZLjFDBb0jzgdetJchNuVhgm8nskz5sUQ/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">这里需要注意的是，计算上一帧裁剪空间（Clip Space）位置时我们除了要传递上一帧的MVP矩阵给Shader外，我们还需要将上一帧的蒙皮骨骼矩阵一并上传（Three.JS使用的是GPU蒙皮）。为了节省性能，运动向量的RT我们使用了RGBA8格式，在输出时，还需要将两个Float打包进RGBA8中，在使用运动向量时，我们还需要进行相应的Unpack操作。</p><p style="word-break: break-all;white-space: normal;">当然，在移动端渲染运动向量需要将场景中物体再次渲染一遍，这样开销在低端机上依然无法接受，所以在低端机上我们使用深度图进行位置重建：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014747" data-ratio="0.2608695652173913" data-s="300,640" data-type="png" data-w="529" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnFMJZ4xIWybuoksjjhiaDSIMq2cKB5icr6VvL5LuFPsKgcnliafiaib9O6Iw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">具体思路是用逆VP矩阵将位置转换到世界空间，然后再算出上一帧的位置。当然这个方法的缺点是无法重建蒙皮动画的运动。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>计算颜色包围盒</strong></p><p style="word-break: break-all;white-space: normal;">尽管进行了上述操作后，残影问题解决了一大部分，但是我们发现在平移物体的时候，依然会在背景上出现大量的鬼影（Ghosting）。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014749" data-ratio="0.838006230529595" data-s="300,640" data-type="png" data-w="642" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnia5CcleQW2blyOvU4v0egTwNmKHjnvtx0cTIia94FgJ6scXucNtJMORA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">这是由于当前像素在上一帧并没有出现（被遮挡），在速度向量上也不会有记录。这里我们的解决办法是计算当前帧像素周围8个采样点的颜色，计算出最大最小颜色，形成一个颜色包围盒。我们还可以在YCoCg空间中获得更加精确的结果。然后我们就可以将历史帧的颜色限制在这个颜色包围盒范围之内。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>方差裁剪</strong></p><p style="word-break: break-all;white-space: normal;">在高端设备或PC平台上，我们还参考了Nvidia GDC 2016上提出的方差裁剪（Variance Clipping）</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014748" data-ratio="0.632295719844358" data-s="300,640" data-type="png" data-w="514" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnq6PTwmVQSYgpOmX4rBtx64hqsn02I47mZ9exc6fj1Hgxy0TYsFYKUA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">这里我们的gamma值取2将会获得一个比较稳定的结果。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014750" data-ratio="0.38482384823848237" data-s="300,640" data-type="png" data-w="369" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqngWy21MDNHQmmp1uMXv2fuJ4Mib77w6K2beM0aoJeicLufY886p4TJfXg/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>左：gamma 1.0&nbsp; &nbsp; &nbsp; &nbsp; 右：gamma 2.0</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>深度扩张</strong></p><p style="word-break: break-all;white-space: normal;">到目前为止，我们已经得到了比较好的效果，但我们移动摄影机会发现，物体边缘会有锯齿。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014752" data-ratio="0.8505434782608695" data-s="300,640" data-type="png" data-w="368" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnpQzNTgxOp21ayGMVTtKwd6LCLh8LeiaReMaQcyFN00MWtY1BlPcrWwQ/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">这里我们需要对当前像素的深度周围8个像素进行采样，得到一个最小值（离摄影机最近），然后得到该采样点的纹理坐标偏移。然后对速度向量采样时，应用这个偏移。这样相当于对速度向量离摄影机最近的部分进行扩张，这样就解决了物体边缘锯齿的问题。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>抗闪烁</strong></p><p style="word-break: break-all;white-space: normal;">最后一个问题，也是最难解决的问题，就是TAA抖动的时候，造成一些像素当前帧被光栅化了，但到了下一帧又消失了，这就导致之前计算颜色包围盒时，历史帧的颜色与当前帧色彩差距过大，被裁剪掉了，这时就会出现非常明显的闪烁问题。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img data-imgfileid="100014754" data-ratio="1" data-s="300,640" data-type="gif" data-w="128" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_gif/1BMf5Ir754QsoomDywL7COia5PI9QdJqnKsdJd04vyxpygcOquRSoOCxOxrFCuJ013aibMOee9NkxMOZXlQ0acLg/640?wx_fmt=gif&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">这里我们的解决办法是再多申请一张RT，记录上一帧的颜色，然后根据速度向量的差值混合当前帧和上一帧颜色。这个方法初衷是使用两帧颜色，尽可能还原更多高频信息。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014753" data-ratio="0.5" data-s="300,640" data-type="png" data-w="744" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnPOoZLLiaSpoE2nkd1QEB9r3H9UrGItdbaMceJQsyBvl4dXwuzwBnB2g/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>左：单帧&nbsp; &nbsp; &nbsp; &nbsp; 右：2帧混合</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014751" data-ratio="0.7857142857142857" data-s="300,640" data-type="png" data-w="420" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnw7ezhBrChFSvvq64G1vnOvESBBgXZ6ibDwicaiay460qQz9MD83J0G0EQ/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">我们可以观察到头发丝的结果也更加稳定，改善了发丝断断续续的情况。虽然目前画面仍有一些闪烁问题，但已经可以被接受。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014757" data-ratio="0.33376792698826596" data-s="300,640" data-type="png" data-w="767" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnLNe7VIwP9ybqgqnatk5sWh4WHwR99iatau7X9X5fFwZhJFHhzvrftwg/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>左：TAA &nbsp;&nbsp; &nbsp; &nbsp; 中：MSAA &nbsp;&nbsp; &nbsp; &nbsp; 右：SMAA</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>抖动半透明</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">半透明渲染一直是光栅化渲染中的难题，纯半透明渲染又和渲染顺序息息相关，要解决顺序问题，我们可以在美术资产制作的时候严格按照顺序进行分组与拆分，但这样无疑对美术制作负担过重。如果我们使用类似深度剥离、权重混合等OIT技术，作为移动平台开销又太高了。至于像链表OIT WebGL不支持，我们即希望开销足够低，又可以无视排序问题，还可以获得不错的半透明效果，那有没有这样的解决方案呢？答案是有的：抖动半透明（Dithering Transparency）。值得一提的是，目前市面大多数3A游戏也在使用这个技术。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014758" data-ratio="1.0790273556231003" data-s="300,640" data-type="png" data-w="329" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnzibUFFRhWqaAeGfZFDaBVgMpumnSuPPqj5FTbh2Eegpb1uBZCsqwenw/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">但请注意，这个技术需要配合TAA一起使用，如果单纯使用抖动技术并不能获得很好的效果。</p><p style="word-break: break-all;white-space: normal;">此外关于抖动的pattern，规则抖动可以获得较平滑的结果，但是由于其原理没法保留背后的半透明信息，相当于覆盖掉了。我们的解决办法是在规则抖动中加入一些随机抖动：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014759" data-ratio="0.38796296296296295" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnbJzNbtu3RibwvCKY0yicGXOzFyhGkUQp9KMN6G7wGR05zWaocQDOEI1w/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>左：半透明裁剪&nbsp; &nbsp; &nbsp; &nbsp; 中：规则抖动&nbsp; &nbsp; &nbsp; &nbsp; 右：规则抖动+随机抖动</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>软阴影</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">一个好的阴影效果，将会大大提升画面的真实度，Three.JS内置4种阴影类型：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014755" data-ratio="0.23394495412844038" data-s="300,640" data-type="png" data-w="654" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnmSqK9cf52FA3a6vSqyNLjyO9qEGjViaVgOAd7jTzticgoBLISUjygONg/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">未过滤，锯齿感严重，无法使用</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">PCF相比上面多了几次采样，但依然有锯齿感</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">VSM对于平面投影效果非常不错，但是对于复杂曲面物体，瑕疵较多</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">PCF Soft虽然消除了锯齿感，但是半影范围无法调整</p></li></ol><p style="word-break: break-all;white-space: normal;">综上所述Three.JS内置的阴影均不符合预期效果，我们的诉求是不要有明显锯齿感，且可以有较大的半影范围。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>泊松分布</strong></p><p style="word-break: break-all;white-space: normal;">我们使用泊松盘（Poisson Disc）对阴影贴图进行采样，并且每次会随机旋转一个角度，来消除规则pattern。最后我们配合TAA消除噪点：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014756" data-ratio="0.51" data-s="300,640" data-type="png" data-w="300" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnd11c82nl1dzdp6f3JdZlczMk4q7ibFPpKD0FwIIYTsWQccxXjcQtGhw/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>左：旋转泊松盘&nbsp; &nbsp; &nbsp; &nbsp; 右：泊松盘+TAA</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>泛光</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">一般来说我们的显示设备通常不支持HDR（高动态范围），于是我们需要模拟光线在薄膜中的次表面散射（胶片、镜头滤光片、视网膜等）。在PBR管线下，镜面反射的动态范围通常非常高，此技术可以帮助物体表现相对亮度，或给LDR图像添加真实感。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014762" data-ratio="0.34942084942084944" data-s="300,640" data-type="png" data-w="518" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqn1icCuoibD5I7GWxVsTsHzRyDYg883N4rbLkD3fWngbglcfo5PBPEnKRQ/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">Three.JS中包含多个内置的Bloom、Glow效果，但效果往往是一种简单的模糊，不符合我们对高动态范围亮度泛光效果的预期。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>基于物理的泛光</strong></p><p style="word-break: break-all;white-space: normal;">（Physically Based Bloom）流程如下：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014764" data-ratio="1.0805555555555555" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnuFOxUKQJHLabeuhwXvmjxoTIe6LZvOtujplk9Bib29cLsLKdlHQuPOA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">首先对原画面图做一个阈值处理，过滤出亮度超过阈值的颜色，然后对这个颜色进行降采样并进行模糊，每次下采样的纹理尺寸将是之前的一半，一般我们迭代7-8次，由于迭代次数越多，最终Bloom能溢出的范围将越大。达到最低的mip等级后，我们就可以进行上采用，这里需要注意，所有mip等级都需要持久保存，将当前等级和前一级模糊的图像进行混合，混合因子也决定了溢出范围。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>泛光透明穿透</strong></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">完成上采样以后，最后一步是和原图颜色混合，一般来说在Linear色彩空间下使用加法即可。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">由于我们的项目还需要透明背景，仅仅对Alpha通道进行模糊处理依然会有光晕黑边问题。</p><p style="word-break: break-all;white-space: normal;">这里我们将最终Bloom颜色转换到HSV色彩空间，将V值保存为Alpha，然后将V值设为1。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014763" data-ratio="1.0382022471910113" data-s="300,640" data-type="png" data-w="445" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QsoomDywL7COia5PI9QdJqnpXXb7CL9TeDfedmFXFN27mnjAss0PvCLk8tAIBUFemichBj2fU6ArDA/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>总结</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">通过上述的技术方案重构和优化，我们在Web上实现了符合预期的3D数字人渲染效果。横向对比头部的移动端数字人竞品，在CG和仿真风格领域，我们具备较大的竞争优势，特别是在人物关键特征的还原和光影效果的复现上。在未来的迭代中，我们将继续在捏脸换装，人物面部/身体动画，互动特效方向上继续深耕效果优化，打造更具行业竞争力的数字人个性化动态渲染解决方案。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>参考文献</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">Zioma, R. (2015). Optimizing PBR [PowerPoint slides].&nbsp;<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>https://community.arm.com/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-20-66/siggraph2015_2D00_mmg_2D00_renaldas_2D00_slides.pdf</em></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">Jimenez, J., &amp; von der Pahlen, J. (2013). Next Generation Character Rendering [PowerPoint slides].&nbsp;<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>http://www.iryoku.com/stare-into-the-future</em></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">Penner, E. (2011). Pre-Integrated Skin Shading [PowerPoint slides].&nbsp;<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>http://advances.realtimerendering.com/s2011/Penner%20-%20Pre-Integrated%20Skin%20Rendering%20(Siggraph%202011%20Advances%20in%20Real-Time%20Rendering%20Course).pptx</em></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">Karis, B. (2014). High Quality Temporal Supersampling [PowerPoint slides].&nbsp;<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>https://de45xmedrsdbp.cloudfront.net/Resources/files/TemporalAA_small-59732822.pdf</em></span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">OpenGL Tutorial. Tutorial 16 : Shadow mapping.&nbsp;<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-16-shadow-mapping/#stratified-poisson-sampling</em></span></p><p style="word-break: break-all;white-space: normal;">Christensen, A. P. (2022). Physically Based Bloom.&nbsp;<span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>https://learnopengl.com/Guest-Articles/2022/Phys.-Based-Bloom</em></span></p><p style="word-break: break-all;white-space: normal;"><span style="text-decoration: underline;color: rgb(12, 182, 242);"><em><br></em></span></p></div><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>开发者问答</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;font-size: 13px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>你知道在风格化渲染上还有哪些技巧吗？</strong></span>欢迎在留言区告诉我们。转发并留言，小编将选取1则最有价值的评论，送出<span style="text-decoration: underline;"><strong>哔哩哔哩双层六芒星玻璃杯1个</strong></span>（见下图）。<span style="color: rgb(255, 102, 149);"><strong>2月27日中午12点开奖。如果喜欢本期内容的话，欢迎点个“在看”吧！</strong></span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 45%;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100014760" data-ratio="1" data-s="300,640" data-type="jpeg" data-w="800" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754QsoomDywL7COia5PI9QdJqnsicE9p87BuaS7wW8asw0rOZMT9xb8JfcPQKD12DcJwl983mDhefyQFA/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>往期精彩指路</strong></p></div></div></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;font-size: 13px;"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247495537&amp;idx=1&amp;sn=0315691622577924f9f4e28929cad16a&amp;chksm=cf2f2a54f858a342520cb94e03f5de2ca07c14cc17c8809f8a4912bf6f9aca9f680b25328ee3&amp;scene=21#wechat_redirect" textvalue="B站幻星数字人3D渲染技术揭秘" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">B站幻星数字人3D渲染技术揭秘</a></p></li><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247495403&amp;idx=1&amp;sn=6a0197dadd8f8a4a6d4efcd85018287c&amp;chksm=cf2f2bcef858a2d8d8266faba7fc458f996442f2f2525270015ed81369a7be242dd891b94195&amp;scene=21#wechat_redirect" textvalue="B站虚拟人与动作捕捉技术" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">B站虚拟人与动作捕捉技术</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247494394&amp;idx=1&amp;sn=e82b908c3e3f4c954b611bbd7c32e334&amp;chksm=cf2f2fdff858a6c995323554c8151575ee767bea54d54818bab969fd366a438ee4a16be5c459&amp;scene=21#wechat_redirect" textvalue="浏览器渲染原理与弹幕" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">浏览器渲染原理与弹幕</a></p></li></ul></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;font-size: 13px;letter-spacing: 4px;" powered-by="xiumi.us"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3289447926347317252#wechat_redirect" textvalue="通用工程" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">通用工程</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2390333109742534656#wechat_redirect" textvalue="大前端" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">大前端</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3297757408550699008#wechat_redirect" textvalue="业务线" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">业务线</span></a><br></p><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2329861166598127619#wechat_redirect" textvalue="大数据" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">大数据</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2782124818895699969#wechat_redirect" textvalue="AI" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">AI</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2532608330440081409#wechat_redirect" textvalue="多媒体" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">多媒体</span></a></p><p><br></p></div><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzUxNTE4OTc0Mg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EVKwaZXNTl9OCCo7pxLHz2e2I3kV3rTPao5LlIickfJS79DNd2yjqjfYEtwtMOyVuKhJoDIq6UU4U9TQbjvOLaQ/0?wx_fmt=png" data-nickname="哔哩哔哩招聘" data-alias="" data-signature="生产快乐的地方" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="Mzg3Njc0NTgwMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QyhiatboUJGZpnzrVDJZCDFYOWhcbdbvj2TlhSXVeErhqCZ8CzgHob1wNDy9IUl4HJheIaIrzgN3A/0?wx_fmt=png" data-nickname="哔哩哔哩技术" data-alias="bilibili-TC" data-signature="提供B站相关技术的介绍和讲解" data-from="0" data-is_biz_ban="0"></mp-common-profile></p></div><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p>]]></summary>
        <author>
            <name>万成</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[精心设计的 DNS Failover 策略在 Go 中竟然带来了反效果，发生了什么？]]></title>
        <id>2247498366_1</id>
        <link href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498366&amp;idx=1&amp;sn=6524781738ad6352aa85d46286872c3a&amp;chksm=cf2f3f5bf858b64d28600e9f31166de0427f7d3d47ee7ff04cc745ded45f9ea1910043e7e784#rd"/>
        <updated>2024-02-19T13:00:51.000Z</updated>
        <summary type="html"><![CDATA[<div style="line-height: 1.6;font-size: 16px;"><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>本期作者</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 45.9532%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RFIjDhHyCfk6jU6tYC7ggj9ibsr8ZO7F5hXTHwKoJMWNPdopWIibiaJ2xjxjOXQfwZeGMFFdWIkEbfw/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014714" data-ratio="1.5148148148148148" data-s="300,640" data-type="jpeg" data-w="1080" style="width: 100%;height: 100%;opacity: 0;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RFIjDhHyCfk6jU6tYC7ggj9ibsr8ZO7F5hXTHwKoJMWNPdopWIibiaJ2xjxjOXQfwZeGMFFdWIkEbfw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>卫智雄</p></div><div style="margin-top: 5px;text-align: justify;font-size: 14px;"><p style="text-align: center;white-space: normal;">哔哩哔哩高级运维工程师</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>一. 背景</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">如下配置所示，我们在 /etc/resolv.conf 中配置了两个 nameserver，其中 server2 在灾备机房 ，作为一种 failover 策略。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">nameserver server1</span></code><br><code><span class="code-snippet_outer">nameserver server2</span></code><br><code><span class="code-snippet_outer">options timeout:<span class="code-snippet__number">1</span> attempts:<span class="code-snippet__number">1</span></span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们的预期是如果 server1 服务正常，则所有的 DNS 请求应该由 server1 处理，且 server2 故障不应对业务有任何影响 。只有当 server1 服务异常，DNS 请求才应该重试到 server2。</p><p style="word-break: break-all;white-space: normal;">然而我们在线上观察到一直有 AAAA 类型的 DNS 请求发送到 server2，而且如果 client 到 server2 的网络异常时，业务的 http 请求耗时会增加 1s，这并不符合预期。同时因为我们的内网域名都没有 AAAA 记录，且内网服务器也是关闭了 IPv6 协议的，AAAA 请求也不符合预期。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>二. 问题排查</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">经过和业务同学求证，相关程序语言为 Go ，请求使用的是 Go 原生 net 库。在 Go net 库中，最经常使用的方式如下：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"><span class="code-snippet__function">package main</span></span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__title">import</span> <span class="code-snippet__params">(</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"net"</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"net/http"</span></span></code><br><code><span class="code-snippet_outer">)</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"><span class="code-snippet_outer">func <span class="code-snippet__title">main</span><span class="code-snippet__params">()</span> </span>{</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;http.Get(<span class="code-snippet__string">"https://internal.domain.name"</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;net.Dial(<span class="code-snippet__string">"tcp"</span>, <span class="code-snippet__string">"internal.domain.name:443"</span>)</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>1. 梳理源码</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">让我们顺着源码分析 net 库的解析逻辑。无论是 http.Get 还是 net.Dial 最终都会到 <span style="color: rgb(255, 102, 149);">func (d *Dialer) DialContext() </span>这个方法。然后层层调用到 <span style="color: rgb(255, 102, 149);">func (r *Resolver) lookupIP() </span>方法，这里定义了何时使用 Go 内置解析器或调用操作系统 C lib 库提供的解析方法，以及&nbsp;/etc/hosts&nbsp;的优先级。</p><p style="word-break: break-all;white-space: normal;">同时补充一个比较重要的信息：windows&nbsp;、darwin(MacOS等)优先使用 C lib 库解析，debug 时需要注意。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">func (d *Dialer) DialContext(ctx context.Context, network, address <span class="code-snippet__built_in">string</span>) (Conn, error) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;addrs, err := d.resolver().resolveAddrList(resolveCtx, <span class="code-snippet__string">"dial"</span>, network, address, d.LocalAddr)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer">}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer">func (r *Resolver) resolveAddrList(ctx context.Context, op, network, addr <span class="code-snippet__built_in">string</span>, hint Addr) (addrList, error) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;addrs, err := r.internetAddrList(ctx, afnet, addr)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer">}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer">func (r *Resolver) internetAddrList(ctx context.Context, net, addr <span class="code-snippet__built_in">string</span>) (addrList, error) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;ips, err := r.lookupIPAddr(ctx, net, host)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer">}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer">func (r *Resolver) lookupIPAddr(ctx context.Context, network, host <span class="code-snippet__built_in">string</span>) ([]IPAddr, error) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;resolverFunc := r.lookupIP</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;ch := r.getLookupGroup().DoChan(lookupKey, func() (any, error) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> testHookLookupIP(lookupGroupCtx, resolverFunc, network, host)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;})</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer">}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer">func (r *Resolver) lookupIP(ctx context.Context, network, host <span class="code-snippet__built_in">string</span>) (addrs []IPAddr, err error) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> r.preferGo() {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> r.goLookupIP(ctx, network, host)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;order, conf := systemConf().hostLookupOrder(r, host)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> order == hostLookupCgo {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> cgoLookupIP(ctx, network, host)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;ips, _, err := r.goLookupIPCNAMEOrder(ctx, network, host, order, conf)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> ips, err</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">我们线上的操作系统是 Debain，确认会使用 Go 内置解析器。所以下一步来到了&nbsp;<span style="color: rgb(255, 102, 149);">func (r *Resolver)&nbsp;goLookupIPCNAMEOrder()&nbsp;</span>方法。这里我们可以通过 qtypes 看到如果&nbsp;<span style="color: rgb(255, 102, 149);">net.Dial</span>&nbsp;的&nbsp;<span style="color: rgb(255, 102, 149);">network&nbsp;</span>参数传入的是&nbsp;<span style="color: rgb(255, 102, 149);">tcp&nbsp;</span>，域名的 A 和 AAAA 记录都会被查询，无论服务器是否关闭 ipv6。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">func (r *Resolver) goLookupIPCNAMEOrder(ctx context.Context, network, name <span class="code-snippet__built_in">string</span>, order hostLookupOrder, conf *dnsConfig) (addrs []IPAddr, cname dnsmessage.Name, err error) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;lane := make(chan result, <span class="code-snippet__number">1</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;qtypes := []dnsmessage.Type{dnsmessage.TypeA, dnsmessage.TypeAAAA}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">switch</span> ipVersion(network) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">case</span> <span class="code-snippet__string">'4'</span>:</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;qtypes = []dnsmessage.Type{dnsmessage.TypeA}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">case</span> <span class="code-snippet__string">'6'</span>:</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;qtypes = []dnsmessage.Type{dnsmessage.TypeAAAA}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;var queryFn func(fqdn <span class="code-snippet__built_in">string</span>, qtype dnsmessage.Type)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;var responseFn func(fqdn <span class="code-snippet__built_in">string</span>, qtype dnsmessage.Type) result</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> conf.singleRequest {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;queryFn = func(fqdn <span class="code-snippet__built_in">string</span>, qtype dnsmessage.Type) {}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;responseFn = func(fqdn <span class="code-snippet__built_in">string</span>, qtype dnsmessage.Type) result {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dnsWaitGroup.Add(<span class="code-snippet__number">1</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;defer dnsWaitGroup.Done()</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p, server, err := r.tryOneName(ctx, conf, fqdn, qtype)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> result{p, server, err}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;} <span class="code-snippet__keyword">else</span> {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;queryFn = func(fqdn <span class="code-snippet__built_in">string</span>, qtype dnsmessage.Type) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dnsWaitGroup.Add(<span class="code-snippet__number">1</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;go func(qtype dnsmessage.Type) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p, server, err := r.tryOneName(ctx, conf, fqdn, qtype)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lane &lt;- result{p, server, err}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dnsWaitGroup.Done()</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}(qtype)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;responseFn = func(fqdn <span class="code-snippet__built_in">string</span>, qtype dnsmessage.Type) result {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> &lt;-lane</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">for</span> _, fqdn := range conf.nameList(name) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">for</span> _, qtype := range qtypes {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;queryFn(fqdn, qtype)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">for</span> _, qtype := range qtypes {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;result := responseFn(fqdn, qtype)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">从&nbsp;<span style="color: rgb(255, 102, 149);">goLookupIPCNAMEOrder&nbsp;</span>方法中我们可以看到由&nbsp;<span style="color: rgb(255, 102, 149);">tryOneName</span>&nbsp;方法分别处理 A 和 AAAA 记录。深入&nbsp;<span style="color: rgb(255, 102, 149);">tryOneName&nbsp;</span>内部，我们终于发现具体的 nameserver 选择逻辑，在某些错误情况下会重试请求到下一个 nameserver。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">func (r *Resolver) tryOneName(ctx context.Context, cfg *dnsConfig, name <span class="code-snippet__built_in">string</span>, qtype dnsmessage.Type) (dnsmessage.Parser, <span class="code-snippet__built_in">string</span>, error) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;q := dnsmessage.Question{</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;Name: &nbsp;n,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;Type: &nbsp;qtype,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;Class: dnsmessage.ClassINET,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">for</span> i := <span class="code-snippet__number">0</span>; i &lt; cfg.attempts; i++ {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">for</span> j := uint32(<span class="code-snippet__number">0</span>); j &lt; sLen; j++ {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;server := cfg.servers[(serverOffset+j)%sLen]</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p, h, err := r.exchange(ctx, server, q, cfg.timeout, cfg.useTCP, cfg.trustAD)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> err := checkHeader(&amp;p, h); err != nil {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dnsErr := &amp;DNSError{</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Err: &nbsp; &nbsp;err.Error(),</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Name: &nbsp; name,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Server: server,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> err == errServerTemporarilyMisbehaving {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dnsErr.IsTemporary = <span class="code-snippet__literal">true</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> err == errNoSuchHost {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__comment">// The name does not exist, so trying</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__comment">// another server won't help.</span></span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dnsErr.IsNotFound = <span class="code-snippet__literal">true</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> p, server, dnsErr</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lastErr = dnsErr</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">continue</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>&nbsp;2. 线上 debug</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">接下来我们可以构造一个简单的程序在线上 debug，看看到底是因为原因导致 AAAA 请求重试到了下一个 nameserver。(tips: debug 需要把 resolv.conf 的 timeout 调长一些)</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"><span class="code-snippet__function">package main</span></span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__title">import</span> <span class="code-snippet__params">(</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"net"</span></span></code><br><code><span class="code-snippet_outer">)</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"><span class="code-snippet_outer">func <span class="code-snippet__title">main</span><span class="code-snippet__params">()</span> </span>{</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;c, err := net.Dial(<span class="code-snippet__string">"tcp"</span>, <span class="code-snippet__string">"internal.domain.name:80"</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> err != nil {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">return</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;_ = c.Close()</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">dlv debug main.go</span></code><br><code><span class="code-snippet_outer">(dlv) <span class="code-snippet__keyword">break</span> /usr/local/go/src/net/dnsclient_unix.go:<span class="code-snippet__number">279</span></span></code><br><code><span class="code-snippet_outer">(dlv) <span class="code-snippet__keyword">break</span> /usr/local/go/src/net/dnsclient_unix.go:<span class="code-snippet__number">297</span></span></code><br><code><span class="code-snippet_outer">(dlv) <span class="code-snippet__keyword">continue</span></span></code><br><code><span class="code-snippet_outer">(dlv) <span class="code-snippet__function">print err</span></span></code><br><code><span class="code-snippet_outer"><span class="code-snippet_outer"><span class="code-snippet__title">error</span><span class="code-snippet__params">(*errors.errorString)</span> *</span>{</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;s: <span class="code-snippet__string">"lame referral"</span>,}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">通过 debug 我们最终定位到 err 由下面这段代码抛出。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"><span class="code-snippet__function">func <span class="code-snippet__title">checkHeader</span><span class="code-snippet__params">(p *dnsmessage.Parser, h dnsmessage.Header)</span> error </span>{</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;...</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">// libresolv continues to the next server when it receives</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__comment">// an invalid referral response. See golang.org/issue/15434.</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> h.RCode == dnsmessage.RCodeSuccess &amp;&amp; !h.Authoritative &amp;&amp; !h.RecursionAvailable &amp;&amp; err == dnsmessage.ErrSectionDone {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> errLameReferral</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;....</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">原来如果返回的 DNS response 以下4个条件全部满足，就会触发重试逻辑：</p><ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">响应没有错误</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">应答 Server 不是权威服务器</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">应答 Server 不支持递归请求</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">应答的&nbsp;records&nbsp;为空</p></li></ol><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">这里有一个疑点是我们的 DNS Server 是支持递归请求的，经过排查，我们发现是因为在 DNS Server 有一层 NetScaler 作为负载均衡器，负载均衡是以 DNS proxy server 的方式运行，默认并没有开启对递归请求的支持。</p><p style="word-break: break-all;white-space: normal;">我们可以运行 dig 命令观察是否有如下输出来判断 server 是否支持递归请求。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">;; WARNING: recursion requested but <span class="code-snippet__keyword">not</span> available</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3. 原因梳理</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">至此，我们已经弄清楚了为什么会有 AAAA 类型的请求发送到 nameserver2。而文章开头提到的业务 http 请求耗时增加 1s 的原因则是因为 client 到 server2 网络异常时，需要等待重试的 AAAA 请求超时，才会返回解析结果。</p><p style="word-break: break-all;white-space: normal;">还有一个问题困扰着我们，为什么用 ping 等程序验证，并没有发现类似的问题。我们通过直接用 C getaddrinfo 函数测试，以及通过 -tags 'netcgo' 编译相同的 go 程序验证，发现在 A 记录有值的情况下，AAAA 请求都不会重试到下一个 nameserver。回到 Go 中触发重试的这段代码深入分析，注释中可以看到由&nbsp;golang.org/issue/15434&nbsp;引入，提交代码的作者是为了解决 issue 中的问题复制了 libresolv 的行为。然而翻阅 glibc 的代码可以看到 next_ns 中还有这样一段逻辑：只要 A 或者 AAAA 任意一个有记录值，都不会重试到下一个 nameserver。这段逻辑并没有引入 Go 中。所以我们需要注意 Go 内置解析器与 glibc 中的行为和结果都有差异，它可能会影响到我们的服务。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">next_ns:</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> (recvresp1 || (buf2 != <span class="code-snippet__literal">NULL</span> &amp;&amp; recvresp2)) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;*resplen2 = <span class="code-snippet__number">0</span>;</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> resplen;</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer">...</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (anhp-&gt;rcode == NOERROR &amp;&amp; anhp-&gt;ancount == <span class="code-snippet__number">0</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;&amp;&amp; anhp-&gt;aa == <span class="code-snippet__number">0</span> &amp;&amp; anhp-&gt;ra == <span class="code-snippet__number">0</span> &amp;&amp; anhp-&gt;arcount == <span class="code-snippet__number">0</span>) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">goto</span> next_ns;</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>三. 优化</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">经过上面的排查，我们已经确认了 AAAA 请求的源头，以及为什么会重试到下一个 server。接下来可以针对性的优化。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1.&nbsp; 对于 Go 程序中 AAAA 请求重试到下一个 server 的优化方案：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">&nbsp; a. 代价相对较小的方案，程序构建时添加&nbsp;-tags 'netcgo' 编译参数，指定使用 cgo-based 解析器。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">&nbsp; b. DNS Server proxy 层支持递归请求。这里有必要说明递归支持不能在 proxy 层简单的直接开启，proxy 和 recursion 在逻辑上有冲突的地方，务必做好必要的验证和确认，否则可能会带来新的问题。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2. 如果业务程序不需要支持 IPv6 网络，可以通过指定网络类型为 IPv4，来消除 AAAA 请求，同时避免随之带来的问题。（也顺带减少了相关开销）</p><p style="word-break: break-all;white-space: normal;">&nbsp; &nbsp;a.&nbsp;<span style="color: rgb(255, 102, 149);">net.Dial</span>&nbsp;相关方法可以指定&nbsp;<span style="color: rgb(255, 102, 149);">network&nbsp;</span>为&nbsp;<span style="color: rgb(255, 102, 149);">tcp4</span>、<span style="color: rgb(255, 102, 149);">udp4</span>&nbsp;来强制使用 IPv4</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer">net.Dial(<span class="code-snippet__string">"tcp4"</span>, <span class="code-snippet__string">"internal.domain.name:443"</span>)</span></code><br><code><span class="code-snippet_outer">net.Dial(<span class="code-snippet__string">"udp4"</span>, <span class="code-snippet__string">"internal.domain.name:443"</span>)</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">&nbsp; b.&nbsp;<span style="color: rgb(255, 102, 149);">net/http&nbsp;</span>相关方法可以通过如下示例来强制使用 IPv4</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="c"><code><span class="code-snippet_outer"><span class="code-snippet__function">package main</span></span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"><span class="code-snippet__title">import</span> <span class="code-snippet__params">(</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"context"</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"log"</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"net"</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"net/http"</span></span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__string">"time"</span></span></code><br><code><span class="code-snippet_outer">)</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"><span class="code-snippet_outer">func <span class="code-snippet__title">main</span><span class="code-snippet__params">()</span> </span>{</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;dialer := &amp;net.Dialer{</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;Timeout: &nbsp; <span class="code-snippet__number">30</span> * time.Second,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;KeepAlive: <span class="code-snippet__number">30</span> * time.Second,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;transport := http.DefaultTransport.(*http.Transport).Clone()</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;transport.DialContext = func(ctx context.Context, network, addr <span class="code-snippet__built_in">string</span>) (net.Conn, error) {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__keyword">return</span> dialer.DialContext(ctx, <span class="code-snippet__string">"tcp4"</span>, addr)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;httpClient := &amp;http.Client{</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;Timeout: <span class="code-snippet__number">30</span> * time.Second,</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;httpClient.Transport = transport</span></code><br><code><span class="code-snippet_outer"> </span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;resp, err := httpClient.Get(<span class="code-snippet__string">"https://internal.domain.name"</span>)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__keyword">if</span> err != nil {</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="code-snippet__built_in">log</span>.Fatal(err)</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;}</span></code><br><code><span class="code-snippet_outer"> &nbsp; &nbsp;<span class="code-snippet__built_in">log</span>.Println(resp.StatusCode)</span></code><br><code><span class="code-snippet_outer">}</span></code><br></pre></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>四. 总结</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">Go net 库中提供了两种解析逻辑：自实现的内置解析器和系统提供的解析函数。windows&nbsp;、darwin(MacOS等)优先使用系统提供的解析函数，常见的 Debain、Centos 等优先使用内置解析器。</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">Go net 库中的内置解析器和系统提供的解析函数行为和结果并不完全一致，它可能会影响到我们的服务。</p></li><li><p>业务应设置合理的超时时间，不易过短，以确保基础设施的 failover 策略有足够的响应时间。</p></li></ol></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong>推荐阅读：</strong></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="text-decoration: underline;color: rgb(12, 182, 242);"><em>https://studygolang.com/topics/15021</em></span></p><p style="word-break: break-all;white-space: normal;"><span style="color: rgb(12, 182, 242);"><em><span style="text-decoration: underline;">https://pkg.go.dev/net</span></em></span>&nbsp;中的 Name Resolution 章节</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>开发者问答</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;font-size: 13px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>你还遇到过哪些域名解析相关的故障？</strong></span>欢迎在留言区告诉我们。转发并留言，小编将选取1则最有价值的评论，送出<span style="text-decoration: underline;"><strong>哔哩哔哩双层六芒星玻璃杯1个</strong></span>（见下图）。<strong><span style="color: rgb(255, 102, 149);">2月23日中午</span></strong><span style="color: rgb(255, 102, 149);"><strong>12点开奖。如果喜欢本期内容的话，欢迎点个“在看”吧！</strong></span></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 45%;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100014712" data-ratio="1" data-s="300,640" data-type="jpeg" data-w="800" style="vertical-align: middle;width: 100%;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RFIjDhHyCfk6jU6tYC7ggj23dIr7SFjltHpHPsdgCYKJO3Ks9UBico9jQicxncNewuWgTv7um8qAeQ/640?wx_fmt=jpeg&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>往期精彩指路</strong></p></div></div></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;font-size: 13px;"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247487748&amp;idx=1&amp;sn=c9cbcacf3bba25b478abf2a0f5c0e75f&amp;chksm=cf2cd421f85b5d37adce8fc782151942912bf38a24be2ebd42b000505bcae60a4833d9a230cd&amp;scene=21#wechat_redirect" textvalue="全链路压测改造之全链自动化测试实践" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">全链路压测改造之全链自动化测试实践</a></p></li><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247493174&amp;idx=1&amp;sn=648bf0ffb5e31b1c211d22e636e2c3df&amp;chksm=cf2f2313f858aa0580dad7ee9b8347739122dcaba50071616e444a73ad28f4c3dcaf62c79f33&amp;scene=21#wechat_redirect" textvalue="哔哩哔哩⼤数据建设之路—实时DQC篇" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">哔哩哔哩⼤数据建设之路—实时DQC篇</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247491092&amp;idx=1&amp;sn=b09492563c760775ed61f75db1bd5822&amp;chksm=cf2cdb31f85b5227b96a3da04fd89153c40635ce4d9ae20cbe9baadc58dbae9e41060d3cd003&amp;scene=21#wechat_redirect" textvalue="Apache Kyuubi 在B站大数据场景下的应用实践" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">Apache Kyuubi 在B站大数据场景下的应用实践</a></p></li></ul></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;font-size: 13px;letter-spacing: 4px;" powered-by="xiumi.us"><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3289447926347317252#wechat_redirect" textvalue="通用工程" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">通用工程</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2390333109742534656#wechat_redirect" textvalue="大前端" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">大前端</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=3297757408550699008#wechat_redirect" textvalue="业务线" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">业务线</span></a><br></p><p><a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2329861166598127619#wechat_redirect" textvalue="大数据" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">大数据</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2782124818895699969#wechat_redirect" textvalue="AI" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">AI</span></a>丨<a target="_blank" href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg3Njc0NTgwMg==&amp;action=getalbum&amp;album_id=2532608330440081409#wechat_redirect" textvalue="多媒体" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2"><span style="color: rgb(12, 182, 242);">多媒体</span></a></p><p><span style="color: rgb(12, 182, 242);"><br></span></p></div></div><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="Mzg3Njc0NTgwMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QyhiatboUJGZpnzrVDJZCDFYOWhcbdbvj2TlhSXVeErhqCZ8CzgHob1wNDy9IUl4HJheIaIrzgN3A/0?wx_fmt=png" data-nickname="哔哩哔哩技术" data-alias="bilibili-TC" data-signature="提供B站相关技术的介绍和讲解" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzUxNTE4OTc0Mg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EVKwaZXNTl9OCCo7pxLHz2e2I3kV3rTPao5LlIickfJS79DNd2yjqjfYEtwtMOyVuKhJoDIq6UU4U9TQbjvOLaQ/0?wx_fmt=png" data-nickname="哔哩哔哩招聘" data-alias="" data-signature="生产快乐的地方" data-from="0" data-is_biz_ban="0"></mp-common-profile></p><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p>]]></summary>
        <author>
            <name>卫智雄</name>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[人身攻击与引战类评论的社区治理（文末抽奖）]]></title>
        <id>2247498359_1</id>
        <link href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247498359&amp;idx=1&amp;sn=ffb3e2c4b76266fe2553f1b2cc2d6ae8&amp;chksm=cf2f3f52f858b644b26dac041f7ab4ab1937fb0ff48149ee36b3b9ce0e5c6cc5d1ca81d134ef#rd"/>
        <updated>2024-02-18T03:17:39.000Z</updated>
        <summary type="html"><![CDATA[<div><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>本期作者</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 32%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 41.0141%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhd4uUd816iat3TXb6CaX2YjPvoN1659qFslBhB4q7iaV9IfLtdsT7emTrw/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014677" data-ratio="1.2318435754189945" data-s="300,640" data-type="jpeg" data-w="358" style="width: 100%;opacity: 0;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhd4uUd816iat3TXb6CaX2YjPvoN1659qFslBhB4q7iaV9IfLtdsT7emTrw/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div></div><div style="display: inline-block;vertical-align: middle;width: 48%;align-self: center;flex: 0 0 auto;"><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>曹森荣</p></div><div style="margin-top: 5px;text-align: justify;font-size: 12px;"><p style="text-align: center;white-space: normal;">哔哩哔哩资深开发工程师</p></div></div></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin: 10px 0%;justify-content: center;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: middle;width: 53%;margin-top: 10px;align-self: center;flex: 0 0 auto;height: auto;"><div style="margin-top: 0.5em;margin-bottom: 0.5em;" powered-by="xiumi.us"><div style="display: inline-block;"><div style="border-bottom: 1px solid rgb(0, 0, 0);display: inline-block;padding-right: 0.8em;padding-left: 0.8em;color: rgb(0, 0, 0);"><p>肖巧文</p></div><div style="margin-top: 5px;font-size: 12px;"><p style="text-align: left;">哔哩哔哩资深开发工程师</p></div></div></div></div><div style="display: inline-block;vertical-align: middle;width: 32%;align-self: center;flex: 0 0 auto;height: auto;"><div style="font-size: 32px;margin: 10px 0%;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: bottom;margin: auto;width: 3em;height: 3em;border-radius: 100%;overflow: hidden;background-position: 0% 39.5833%;background-repeat: no-repeat;background-size: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhd9Da9xibef7Lm18ua05R4ibK8zklzNezriaU0Nh7wRu4wE7LGskpxkeWgg/640?wx_fmt=jpeg&amp;from=appmsg&quot;);"><p style="width: 100%;height: 100%;overflow: hidden;line-height: 0;"><img data-imgfileid="100014679" data-ratio="1.4" data-s="300,640" data-type="jpeg" data-w="1080" style="width: 100%;opacity: 0;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhd9Da9xibef7Lm18ua05R4ibK8zklzNezriaU0Nh7wRu4wE7LGskpxkeWgg/640?wx_fmt=jpeg&amp;from=appmsg"></p></div></div><div style="text-align: justify;" powered-by="xiumi.us"><p style="white-space: normal;"><br></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>1. 治理背景和目标</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>&nbsp;1.1&nbsp;治理背景</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;"><br></p><p style="margin-top: 10px;margin-bottom: 0px;color: rgb(23, 43, 77);font-family: -apple-system, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Roboto, Oxygen, Ubuntu, &quot;Fira Sans&quot;, &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif;font-size: 14px;letter-spacing: normal;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">B站作为一个有用有趣的综合性视频社区，每个用户都是在与内容的互动过程中形成单向/双向关注和身份上的群体团结，具有相同兴趣爱好的小伙伴聚集在一起形成不同圈子，所以，当小部分用户在社区中有贬低或者拉踩其他用户的行为，甚至出现人身攻击等恶意发言，社区氛围很容易被破坏。</span></p><p style="margin-top: 10px;margin-bottom: 0px;color: rgb(23, 43, 77);font-family: -apple-system, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Roboto, Oxygen, Ubuntu, &quot;Fira Sans&quot;, &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif;font-size: 14px;letter-spacing: normal;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">社区文化和价</span><span style="font-size: 16px;">值的体现来源</span><span style="font-size: 16px;">于内容的创作和交流</span><span style="font-size: 16px;">，</span><span style="font-size: 16px;">其中评论作为B站用户交流互动最重要的阵地之一，自然也</span><span style="font-size: 16px;">是社区氛</span><span style="font-size: 16px;">围的重要组成</span><span style="font-size: 16px;">部分。根据2022年6月评论的举报理由分布，目前B站负向评论的主要来源为引战和人身攻击。</span></p><p style="word-break: break-all;white-space: normal;"><br></p></div><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>&nbsp;1.2 治理目标</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">社区一直面临一个挑战就是：减少贬损、侮辱、诽谤等粗俗人身攻击内容的曝光，一方面能够促进正向内容和情绪的流通；一方面希望通过治理引导用户正向发言，进一步促进社区友好互动、建设社区氛围，从而让用户看到良好的社区环境和氛围。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p></div><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>2.平台人身攻击内容现状</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.1 人身攻击短词</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">首先需要关注的是无差别的纯人身攻击文本，此类文本是不会随着社会或者站内热点事件而变化的包含辱</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">骂、攻击性质的文本。</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">常规的攻击性短词是有限且可控的，但是其变体形式是治理的难点。攻击性短词的变体主要包括：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1)&nbsp; 同音同形类（如伞兵、剑冢）；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2)&nbsp; 首字母匹配类（如出生、我测你码）；</p><p style="word-break: break-all;white-space: normal;">3)&nbsp; 特殊字符、表情、罕见字变体类（如大乃√、🐒）。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014681" data-ratio="0.43425925925925923" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhddJKwibgnQwSicpTTaMibIc2OwYuoPiayGWFJ07me9gibEL6Wyru44zR9DgA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图2.1.1 ：人身攻击短词变体分析</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>2.2 部分分区人身攻击问题突出</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">由</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">于分区生态与用户习惯的不同</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">，对所有分区一刀切的治理模式是不可取的。为了既能有针对性地解决问题，又能有效引导社区情绪正向发展，我们对生活、娱乐、影视、知识、科技、运动、游戏以及音乐这八个区的人身攻击以及引战的举报情况的摸底，从可评估性、可治理性两个角度发现娱乐、影视区和游戏区的问题更为突出，具体体现在以下两个方面：</span><br></p><ol style="word-break: break-all;margin-bottom: 15px;white-space: normal;padding-right: 8px;padding-left: 8px;font-size: 16px;" class="list-paddingleft-1"><li style="word-break: break-all;margin-bottom: 15px;white-space: normal;padding-right: 8px;padding-left: 8px;font-size: 16px;"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;padding-right: 8px;padding-left: 8px;font-size: 16px;">在游戏、娱乐、影视三个分区中，人身攻击举报的数量远高于平均值，是总人身攻击举报量的大头。</p></li><li style="word-break: break-all;margin-bottom: 15px;white-space: normal;padding-right: 8px;padding-left: 8px;font-size: 16px;"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;padding-right: 8px;padding-left: 8px;font-size: 16px;">在游戏、娱乐、影视三个分区中，人身攻击举报评论的前 100 个关键字里面，实体词的占比分别为 45%、57%、63%，相比于其他话题丰富的区域，这些分区的话题聚焦度更强、可治理性更高。<span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;"></span></p></li></ol></div><div style="text-align: center;" powered-by="xiumi.us"><p><br></p></div><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>3.专项治理过程</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">我们首先结合问题评论锁定要治理的对象是人身攻击。需要特别说明的是，引战评论当然也是问题评论中需要去治理的，但引战问题相对而言更加复杂，定义问题难度更高，因此，在本次治理过程中我们更侧重于更能引发负向情绪的人身攻击评论。整个治理过程见下图3.1：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014686" data-ratio="0.7138888888888889" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhdAdIKElCc8ewuoLD85JbW6ZUrwZkIvyrcZDPnqEMuX6ibkKTibFbp0m5Q/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图3.1 ：人身攻击治理过程</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.1 无差别覆盖治理</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1.词匹配识别</p><p style="word-break: break-all;white-space: normal;">针对变形体的识别，依赖已经积累的大量的技术手段包括：拼音识别、数字同音识别、汉字相似识别、单词检测识别、汉字关键词识别、变形体映射等文本预处理能力。通过对用户评论进行文本预处理，我们可以对评论进行归一化，然后使用汉字或拼音进行识别。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014684" data-ratio="0.337037037037037" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhdyy8NlQpezgibc0dMia3iaGg6bw39IfibCpaZVvicfF7rHBNJMbVZPEDGd9w/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图3.1.1 ：问题和相应文本预处理能力</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">举例其中的汉字相似能力，我们引进了“音形码“的概念（音形码的概念非自创，常用于输入法产品），借助音形码可以快速计算出汉字的相似结果，这里借助这个概念可以把汉字转化成机器可以理解的数字串，数据结构大体上如下图：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014685" data-ratio="0.5018518518518519" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhd6zkaiav6aVo81NQR1NkzmmuTkA3FZI6dd6UEfgicObfFDibfOJbe1rfgA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>（图片来源于网络，如有侵权请联系删除）</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">这个结构涵盖了一个字的拼音和字形数据，可以很好的识别 音似例如“傻”和“杀”，形似例如“娘”和“狼”等。具体的上线效果如下：</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014682" data-ratio="0.2898148148148148" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhdhlYBZVD5BibnfBUUONqpzzibxQjQ196tNjUccSRROOSCMHnupQuVjBqg/640?wx_fmt=png&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">接口直接根据设置好的相似阈值返回风险文本。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2. 模型识别</p><p style="word-break: break-all;white-space: normal;">根据数据显示，不同分区中人身攻击举报评论的准确度在10%到40%之间，其中绝大多数为阴阳怪气或者对线过程中稍稍偏激的言论。为此，我们在前期准备了多种算法模型，包括人身攻击模型、对线模型以及阴阳怪气模型。依赖模型的语言理解能力，我们能够拦截覆盖掉一部分的纯人身攻击以及引战文本。</p></div><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014689" data-ratio="0.32314814814814813" data-s="300,640" data-type="png" data-w="1080" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhdhg2UVmib1OneWAjF68QD0ZHNZdnXAnItPTSz4E2FMic1ibLwdcyt4aCHA/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图3.1.1 ：人生攻击专项依赖的模型能力</sup></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;">第一类文本分类模型</p></li></ul><p style="margin-bottom: 15px;white-space: normal;">在分类问题上，Fasttext、DPCNN、TextRCNN、Attention、Bert等模型都是比较经典的可用于文本而分类问题上的模型。在 NLP 领域，BERT 的强大毫无疑问，但由于模型过于庞大，单个样本计算一次的开销也会比较大，因此，我们使用比较多的是体量更小、速度更快的tiny_bert。在模型训练的过程中，我们可能面临的一个问题是样本质量不够高导致模型效果不佳，在已有样本的基础上，我们会先通过Bert进行样本提纯，再喂给tiny_bert，以提高模型准确度。而在在对线模型中，我们将输入样本写成“[CLS] +当前评论 + [SEP] + 父评论 + [SEP] +“跟评论” + [SEP]”的格式，让模型学习到对线过程，并采用bert与图神经网络结合的方式进行对线文本的分类，将预训练模型BERT与图网络GCN（GAT）相结合用于文本分类，能充分融合二者处理数据、提取特征的能力，使得模型有比较好的预测效果。</p><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;">第二类文本相似模型</p></li></ul><p style="margin-bottom: 15px;white-space: normal;">分类模型能帮我们覆盖掉大部分的特殊case，而在B站这个社区平台上，不同的分区有着不一样的文化符号，并且随着各类社会舆情的发生，部分人身攻击文本会具有一定的特殊性，而文本相似模型能根据输入的负向样本种子，快速准确地覆盖掉同关键词、同核心思想文本。</p><p style="margin-bottom: 15px;white-space: normal;"><br></p><p style="white-space: normal;">为了使模型持续有效，我们每周对召回数据和举报数据进行校准，一方面用于评估模型的可用性，另一方面及时向算法侧返回Bad Case和提供新的训练样本，以实现模型对用户多变地发评习性及时作出反应。由于模型的更新并不是实时的，对于突发的高举报案例，我们将相关的数据经过筛选后放入模型后台的黑模型样本集中，对相关负向内容进行拦截。<br></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.2 重点分区突破</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">由于不同分区的人身攻击评论的发评人、讨论话题、稿件信息特性不一致，因此问题的严重程度也不一样，词+模型并不能完全解决问题，对于无法覆盖的部分，我们需要对单点问题进行重点突破。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">我们把这一部分的治理分成了以下几个步骤：</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">1. 确定每个分区的治理内容；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">基于每个分区特性，对重点分区深入分析，结合社区知识图谱系统，对重点分区的问题进行细致梳理并归纳。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">2. 划分治理等级；</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">对不同分区的不同问题进行严重程度分级。</p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;">3. 确定治理策略。</p><p style="word-break: break-all;white-space: normal;">结合社区阿瓦隆系统，对线上进行定向管控治理。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.2.1 确定分区治理内容</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;">结合社区知识图谱系统的抽象归纳，并通过分析上半年的的举报数据，得到重点分区现存人身攻击的需治理的问题，其中娱乐区4个，影视区3个，游戏区2个。</p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.2.2 划分治理等级</strong></p><p><strong><br></strong></p></div></div></div><div powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;padding-right: 8px;padding-left: 8px;font-size: 16px;line-height: 1.75em;">综上，结合举报数据和评论内容，我们划分成两个治理方向：</p><p style="line-height: 1.75em;">&nbsp; 一是针对某一具体对象（人或群体）的带有恶意引导性质或攻击性的评论，这类评论需要予以拦截；</p><p style="line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">&nbsp; 二是减少引战类型且容易被举报的调侃或负向梗的曝光度。</span></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><br></p></div><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;color: rgb(12, 182, 242);"><p><strong>3.2.3 确定以及实施治理策略</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;line-height: 1.6em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">我们的策略围绕着三个维度展开，分别是关键词、人群、稿件以及up主。</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;line-height: 1.6em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">1.关键词维度。</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;line-height: 1.6em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;"></span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">对于人身攻击言论，抨击或辱骂的对象通常是实体。</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">基于此，除了人身攻击短词外，我们</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">还分区维护了一个“实体——关键词”知识库。</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">我们结合评论内容和稿</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">件</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">信息进行精准匹配，基于匹</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">配情况决策处置策略。</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">另外，</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">为了及时发现讨论的话题和实</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">体，我们线上使用高讨论度的事件人物识别模型，再基于报表展示讨论实体，以保证文档信息的持续更新。</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;line-height: 1.6em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">2.人群</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">维度。</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;line-height: 1.6em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;"></span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">从发评者角度来看，可按攻击目标分为两种：</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">一种针对的是非现实个体(明星、游戏、视频内容等），占据大部分，第二种攻击的对象是站内用户或UP主。</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">在</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">大多数情况下，第一类用户群更具稳定性和聚集性，因此我们考虑综合行为等多重维度来识别第一类人群。</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;line-height: 1.6em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;"></span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">我们通过互动内容、关系等标记出第一类人群，并采取相应的治理策略。</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">经过治理，被举报用户的重复率下降了40%。</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">被举报用户的重复率指的是被重复举报用户</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">与被举报用户总数的比例，这个下降趋势表明了极端用户的极端互动行为减少了。</span></p></div><div powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;font-size: 16px;"><br></p></div><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014687" data-ratio="0.679465776293823" data-s="300,640" data-type="png" data-w="599" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhd6zuUm1gtjdib77BcBPeZtPlZib4Ovlfaia6ZJPciabmm8jsXCUrtHSDic8A/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;"><img class="rich_pages wxw-img" data-imgfileid="100014693" data-ratio="0.7033333333333334" data-s="300,640" data-type="png" data-w="600" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhdH0BNdNuQicv89qrGqgS9z4vYm3dl2H1dg3c0oTsnbKHRTDeeWZES1jQ/640?wx_fmt=png&amp;from=appmsg"></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup style="font-size: 12px;">图3.4 人群包策略实施前（上）后（下）被举报用户重复率</sup></p></div><div powered-by="xiumi.us"><p style="word-break: break-all;white-space: normal;line-height: 1.6em;"><br></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;line-height: 1.6em;font-size: 16px;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">3.稿件维度和UP主维度。</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;line-height: 1.6em;font-size: 16px;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">某些稿件自带引战或者人身攻击风险，需要及时干进行干预。对于不同的治理内容，我们结合了关键词、人群稿件以及UP主信息这几维度来部署相应策略。被策略识别为高风险的内容中包含较高浓度的攻击性评论，从中实施高召可以达到精准扩召的效果。</span></p><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;line-height: 1.6em;font-size: 16px;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">我们提高召回的方式通常包含两种，分别是调整单一模型分的阈值和基于多个模型（如阴阳怪气、对线、文本质量分、立场分）训练一个融合模型的方式。融合模型方式包括常见的线性融合（如多元回归、逻辑回归）和非线性融合（树模型）。而融合模型可以较大程度地丰富召回样本的多样性。</span></p><p style="word-break: break-all;white-space: normal;line-height: 1.6em;"><br></p></div><div style="margin-top: 10px;margin-bottom: 10px;text-align: left;" powered-by="xiumi.us"><div style="display: inline-block;"><p style="width: 0.7em;height: 0.7em;margin-right: 5px;margin-top: 0.5em;display: inline-block;vertical-align: top;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;text-align: center;font-size: 18px;color: rgb(12, 182, 242);"><p><strong>3.3 回查以及跟进</strong></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="word-break: break-all;margin-bottom: 15px;">持续收集模型训练样本：数据同学根据标注标准，对每周的举报数据进行抽样打标，漏召回case放入模型重新学习，形成良性循环；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">敏感词系统相似模型召回：漏召回的人身攻击样本清洗一遍以后，作为相似模型的种子，对问题文本召回；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">基于举报数据线上回查删除：被举报过多次的人身攻击文本，文本的人身攻击模型分&gt;阈值，直接删除；</p></li><li><p style="word-break: break-all;margin-bottom: 15px;">策略的迭代和更新：更新的内容除模型外还有负向词、人群等，基于策略的聚集内容或被反馈的误召回案例对策略进行回查并迭代；</p></li><li><p style="word-break: break-all;">数据探查：通过报表展示或告警风险稿件、人群、单评以及各项举报数据的异常波动。</p></li></ol></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>4. 治理效果</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><strong style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;">经过治理，影视、娱乐以及游戏三个重点分区23年12月份相较于23年6月份，人身攻击举报占比绝对下了31.97%，引战的举报占比24.77%。</strong></p><p style="word-break: break-all;white-space: normal;"><img class="rich_pages wxw-img" data-imgfileid="100014694" data-ratio="0.5333333333333333" data-s="300,640" data-type="png" data-w="1080" style="text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhdTS8OP7wia3zh9og4Atbiaqx4PuTDrQ2IOaMyAw8SkVht3JusQDdOXBVA/640?wx_fmt=png&amp;from=appmsg"><br></p></div><div style="text-align: center;" powered-by="xiumi.us"><p><sup>图4.1 影视、娱乐和游戏区的综合人身攻击引战举报占比</sup></p></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="word-break: break-all;margin-bottom: 15px;white-space: normal;"><br></p></div><div style="margin-top: 10px;margin-bottom: 10px;text-align: center;" powered-by="xiumi.us"><div style="display: inline-block;vertical-align: top;padding-left: 10px;"><div style="border-bottom: 1px dashed rgb(0, 0, 0);padding-left: 5px;font-size: 20px;color: rgb(12, 182, 242);"><p><strong>5. 总结与展望</strong></p></div><div style="margin-top: -7px;margin-left: -10px;width: 10px;"><p style="transform: rotate(0deg);margin-left: auto;width: 7px;height: 7px;background-color: rgb(255, 102, 149);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><p style="margin-top: -4px;margin-left: -3px;width: 10px;height: 10px;background-color: rgb(12, 182, 242);"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p></div></div></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div powered-by="xiumi.us" style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;">经过治理，人身攻击举报占比下降趋势比较明显，但是数值上仍有下探空间。互联网不是法外之地，为了维护一个正向和谐的社区氛围，我们还可以从以下几方面去进行优化：</p><ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;">考虑优化稿件下的内容展示逻辑，丰富内容排序标准。</p></li><li style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;">对于“黑话”、负向关键词的挖掘需要更自动化；</p></li><li style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;">如何引导用户正确选择举报理由或对举报理由进行二次判定以提高举报数据的准确度；</p></li><li style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;">模型短周期的自动化训练和上线；</p></li><li style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;"><div powered-by="xiumi.us" style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;"><p style="word-break: break-all;margin-bottom: 15px;padding-right: 8px;padding-left: 8px;">.......<span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;"></span></p></div></li></ol></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: center;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><p style="vertical-align: middle;display: inline-block;line-height: 0;width: 30px;height: auto;"><img class="rich_pages wxw-img" data-imgfileid="100014700" data-ratio="2.258503401360544" data-s="300,640" data-type="gif" data-w="147" style="vertical-align: middle;width: 100%;height: auto !important;" src="https://mmbiz.qpic.cn/mmbiz_gif/1BMf5Ir754RWEyE2H1PXib3ON2FcQhKhd6OLEibPF8U8kEJ0dDNNPRzbSlGtLVmYtG5mQG0huBeLBpCcdW4KsJoA/640?wx_fmt=gif&amp;from=appmsg"></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>哔哩哔哩技术年货送不停</strong></p></div></div></div><div style="padding-right: 8px;padding-left: 8px;" powered-by="xiumi.us"><p style="margin-bottom: 15px;white-space: normal;"><span style="color: rgb(255, 102, 149);"><strong>在B站，你认为还有哪些负面内容需被治理呢？</strong></span>欢迎在留言区告诉我们。<strong>点赞并转发参与下方抽奖</strong>，小编将抽取3位幸运的小伙伴送出<strong><span style="text-decoration: underline;">龙年小电视抱枕</span></strong>（见下图）。<span style="color: rgb(255, 102, 149);"><strong>2月23日中午12点开奖。</strong></span><strong style="color: rgb(255, 102, 149);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;">哔哩哔哩技术祝您龙年风调码顺，日富一日！</strong></p></div><p style="white-space: normal;" powered-by="xiumi.us"><br></p><p><mp-common-miniprogram data-miniprogram-nickname="抽奖助手" data-miniprogram-avatar="http://mmbiz.qpic.cn/mmbiz_png/Vdys2e8jP1l1clbflznHYO7IRflCZWjPfD4NMn1Xqgr5gZbBy1qVc12cGVG1whLTXiafBT7kiaWRl38HCbqLnRzw/640?wx_fmt=png&amp;wxfrom=200" data-miniprogram-title="龙年小电视抱枕*3" data-miniprogram-imageurl="http://mmbiz.qpic.cn/mmbiz_jpg/1BMf5Ir754RPRMPuiawC8yL2tJWczk2tuyhJnC3SI1fK9rSe7I2IeqRgB7OrgG3cBIqLLGUJedxajgWlB2UOrow/0?wx_fmt=jpeg" data-miniprogram-type="card" data-miniprogram-servicetype="0" data-pluginname="insertminiprogram" class="js_uneditable custom_select_card mp_miniprogram_iframe" data-miniprogram-appid="wx01bb1ef166cd3f4e" data-miniprogram-applink="#小程序://抽奖/4WcKLYXIHQ45Osw" data-miniprogram-path="pages/lucky/lottery/detail?id=8xgWTnGYT3y"></mp-common-miniprogram></p><p style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><br></p><p style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;" powered-by="xiumi.us"><br></p><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><p style="display: inline-block;vertical-align: top;width: auto;min-width: 5%;flex: 0 0 auto;height: auto;padding-right: 5px;"><svg viewBox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></p><div style="display: inline-block;vertical-align: top;width: auto;align-self: flex-start;flex: 0 0 auto;border-style: solid;border-width: 0px 0px 1px;border-color: rgb(30, 88, 134);min-width: 5%;height: auto;padding: 5px;"><div style="text-align: justify;color: rgb(12, 182, 242);" powered-by="xiumi.us"><p style="white-space: normal;"><strong>往期精彩指路</strong></p></div></div></div><div style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;margin-top: 5px;margin-bottom: 10px;" powered-by="xiumi.us"><div style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;background-color: rgba(234, 244, 255, 0.34);padding: 25px;height: auto;"><div style="transform: translate3d(-5px, 0px, 0px);" powered-by="xiumi.us"><div style="text-align: justify;padding-right: 8px;padding-left: 8px;font-size: 13px;"><ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;"><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247496204&amp;idx=1&amp;sn=9738c7048008cc5f869e1ac50180480c&amp;chksm=cf2f3729f858be3f790c49155566d40f63dffccaa4d52594277b1c1857ac070c00e87aa73f17&amp;scene=21#wechat_redirect" textvalue="告警平台：给告警一个胶带" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">告警平台：给告警一个胶带</a></p></li><li><p style="margin-bottom: 15px;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247494098&amp;idx=1&amp;sn=adace79cf2c8104ba42adf7b17f59749&amp;chksm=cf2f2cf7f858a5e1632cd900c80d522aa5fd0a74e7bbd2fc0a6c62d7f425372bd2eabc090f96&amp;scene=21#wechat_redirect" textvalue="B站埋点分析平台的构建之路" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">B站埋点分析平台的构建之路</a></p></li><li><p><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247497953&amp;idx=1&amp;sn=69bbe0ff49bdd77b20630ed9c456c7e3&amp;chksm=cf2f3dc4f858b4d20c941756772b964f7b179755f8c9b6a3489ec48de51311a90f34239afc97&amp;scene=21#wechat_redirect" textvalue="爬虫与反爬-接口安全的风控介绍" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">爬虫与反爬-接口安全的风控介绍</a></p></li></ul></div></div></div></div></div><p class="mp_profile_iframe_wrp"><mp-common-profile class="custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzUxNTE4OTc0Mg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/EVKwaZXNTl9OCCo7pxLHz2e2I3kV3rTPao5LlIickfJS79DNd2yjqjfYEtwtMOyVuKhJoDIq6UU4U9TQbjvOLaQ/0?wx_fmt=png" data-nickname="哔哩哔哩招聘" data-signature="生产快乐的地方" data-from="0"></mp-common-profile></p><p class="mp_profile_iframe_wrp"><mp-common-profile class="custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="Mzg3Njc0NTgwMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/1BMf5Ir754QyhiatboUJGZpnzrVDJZCDFYOWhcbdbvj2TlhSXVeErhqCZ8CzgHob1wNDy9IUl4HJheIaIrzgN3A/0?wx_fmt=png" data-nickname="哔哩哔哩技术" data-alias="bilibili-TC" data-signature="提供B站相关技术的介绍和讲解" data-from="0"></mp-common-profile></p><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p>]]></summary>
        <author>
            <name>曹森荣&amp;肖巧文</name>
        </author>
    </entry>
</feed>